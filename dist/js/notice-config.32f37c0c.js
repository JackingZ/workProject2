(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["notice-config"],{4241:function(e,t,n){},"6c19":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"roles-container"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[n("div",{staticClass:"app-container"},[n("head-info",{attrs:{title:"通知配置",info:""}}),n("div",{staticClass:"app-panel",staticStyle:{height:"calc(100vh - 170px)"}},[n("el-row",{staticClass:"notice-title"},[n("el-col",{attrs:{xs:8,sm:8,lg:6}},[n("div",{staticStyle:{color:"#666","padding-left":"25px","font-size":"14px"}},[e._v("\n              通知类型\n            ")])]),n("el-col",{attrs:{xs:10,sm:12,lg:14}},[n("div",{staticStyle:{color:"#666","padding-left":"50px","font-size":"14px"}},[e._v("\n              通知方式\n            ")])]),n("el-col",{attrs:{xs:6,sm:4,lg:4}},[n("div",{staticStyle:{color:"#666","padding-left":"10px","font-size":"14px"}},[e._v("\n              通知人\n            ")])])],1),n("el-tree",{ref:"tree",attrs:{data:e.treeData,"show-checkbox":"","node-key":"unqId","default-expand-all":"","expand-on-click-node":!1,props:e.defaultProps},on:{check:e.onCheck},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,a=t.data;return n("span",{staticClass:"custom-tree-node",style:2===i.level?"margin-top: 10px;":""},[n("el-row",[n("el-col",{attrs:{xs:8,sm:8,lg:6}},[n("div",{staticStyle:{color:"#666","font-size":"14px"},style:2===i.level?"margin-top: 1px;":""},[e._v("\n                  "+e._s(a.name)+"\n                ")])]),2===i.level?n("el-col",{attrs:{xs:10,sm:12,lg:14}},[n("div",{staticStyle:{color:"#666"}},[n("el-checkbox",{attrs:{disabled:!e.$checkPermission(["updateNotificationMethodConfig"])},on:{change:function(t){return e.checkChange(a,t)}},model:{value:a.mail,callback:function(t){e.$set(a,"mail",t)},expression:"data.mail"}},[e._v("\n                    站内信\n                  ")]),n("el-checkbox",{attrs:{disabled:!e.$checkPermission(["updateNotificationMethodConfig"])},on:{change:function(t){return e.checkChange(a,t)}},model:{value:a.phone,callback:function(t){e.$set(a,"phone",t)},expression:"data.phone"}},[e._v("\n                    手机\n                  ")]),n("el-checkbox",{attrs:{disabled:!e.$checkPermission(["updateNotificationMethodConfig"])},on:{change:function(t){return e.checkChange(a,t)}},model:{value:a.notification,callback:function(t){e.$set(a,"notification",t)},expression:"data.notification"}},[e._v("\n                    邮箱\n                  ")]),n("el-checkbox",{attrs:{disabled:!e.$checkPermission(["updateNotificationMethodConfig"])},on:{change:function(t){return e.checkChange(a,t)}},model:{value:a.wechat,callback:function(t){e.$set(a,"wechat",t)},expression:"data.wechat"}},[e._v("\n                    微信\n                  ")]),n("el-checkbox",{attrs:{disabled:!e.$checkPermission(["updateNotificationMethodConfig"])},on:{change:function(t){return e.checkChange(a,t)}},model:{value:a.app,callback:function(t){e.$set(a,"app",t)},expression:"data.app"}},[e._v("\n                    app\n                  ")])],1)]):e._e(),2===i.level?n("el-col",{attrs:{xs:6,sm:4,lg:4}},[n("el-button",{attrs:{disabled:!e.$checkPermission(["noticeUpdataPerson"]),type:"text",size:"mini"},on:{click:function(){return e.updataPerson(i,a)}}},[e._v("\n                  修改通知接收人\n                ")])],1):e._e()],1)],1)}}])}),n("noticePerson",{ref:"noticePerson",on:{load:e.queryAll}})],1)],1)])])},a=[],s=(n("8e6e"),n("ac6a"),n("456d"),n("bd86")),o=n("a8db"),r=n("d225"),c=n("b0b4"),l=n("308d"),u=n("6bb5"),d=n("4e2b"),f=n("9ab4"),p=n("60a3"),h=n("17e1"),b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{attrs:{title:"添加地址",visible:e.visible,width:"960px","close-on-click-modal":!1},on:{close:e.dialogClose}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[n("el-button",{attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:e.addRow}},[e._v("\n      新增\n    ")]),n("div",[n("el-table",{attrs:{data:e.tableData,height:"400px",border:""}},[n("el-table-column",{attrs:{label:"服务类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[t.row.isEditRow?n("el-select",{staticStyle:{width:"100%"},attrs:{loading:e.selectLoading,placeholder:"请选择",size:"small",filterable:"",clearable:""},on:{focus:e.getServiceTypeList,change:function(n){return e.onType(n,t.row)}},model:{value:t.row.service,callback:function(n){e.$set(t.row,"service",n)},expression:"scope.row.service"}},e._l(e.typeList,function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1):n("span",[e._v("\n                "+e._s(t.row.serviceName)+"\n              ")])],1)]}}])}),n("el-table-column",{attrs:{label:"业务类型","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[t.row.isEditRow?n("el-select",{staticStyle:{width:"100%"},attrs:{loading:e.selectLoading,disabled:!t.row.service,placeholder:"请选择",size:"small",filterable:"",clearable:"",multiple:"","collapse-tags":""},model:{value:t.row.subtypeIds,callback:function(n){e.$set(t.row,"subtypeIds",n)},expression:"scope.row.subtypeIds"}},e._l(e.subtypeList,function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1):n("span",[e._v("\n                "+e._s(t.row.businessName)+"\n              ")])],1)]}}])}),n("el-table-column",{attrs:{label:"接收者","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[t.row.isEditRow?n("el-select",{staticStyle:{width:"100%"},attrs:{loading:e.selectLoading,placeholder:"请选择",size:"small",filterable:"",multiple:"","collapse-tags":"",clearable:""},model:{value:t.row.userIds,callback:function(n){e.$set(t.row,"userIds",n)},expression:"scope.row.userIds"}},e._l(e.userList,function(e){return n("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})}),1):n("span",[e._v("\n                "+e._s(t.row.userName)+"\n              ")])],1)]}}])}),n("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEditRow?n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.saveRow(t.row)}}},[e._v("\n              保存\n            ")]):n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.editRow(t.row)}}},[e._v("\n              编辑\n            ")]),t.row.isEditRow?n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.cancelRow(t.row)}}},[e._v("\n              取消\n            ")]):n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.delRow(t.row)}}},[e._v("\n              删除\n            ")])]}}])})],1)],1)],1)])},v=[],g=(n("28a5"),n("7f7f"),n("96cf"),n("3b8d")),m=(n("7514"),n("75fc")),y=n("9dba");function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(n,!0).forEach(function(t){Object(s["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var O=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(l["a"])(this,Object(u["a"])(t).apply(this,arguments)),e.typeList=[],e.subtypeList=[],e.userList=[],e.visible=!1,e.loading=!1,e.selectLoading=!1,e.tableData=[],e.currentObj={},e}return Object(d["a"])(t,e),Object(c["a"])(t,[{key:"add",value:function(){this.tableData.map(function(e){e.isEditRow=!1}),this.tableData=[].concat(Object(m["a"])(this.tableData),[{serviceName:void 0,service:void 0,subtypeIds:[],userIds:[],business:void 0,businessName:void 0,user:void 0,userName:void 0,isEditRow:!0}])}},{key:"addRow",value:function(){var e=this,t=this.tableData.find(function(e){return e.isEditRow});t?t.id?this.$confirm("您修改的尚未保存！","温馨提示",{confirmButtonText:"保存",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:if(!e.validate(t)){n.next=3;break}return n.next=3,e.saveRow(t,"isAdd");case 3:case"end":return n.stop()}},n)}))).catch(function(){e.tableData.map(function(e){e.isEditRow=!1})}):this.$confirm("您新增的尚未保存！","温馨提示",{confirmButtonText:"保存",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(Object(g["a"])(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:if(!e.validate(t)){n.next=3;break}return n.next=3,e.saveRow(t,"isAdd");case 3:case"end":return n.stop()}},n)}))).catch(function(){e.tableData=e.tableData.filter(function(e){return!e.isEditRow})}):this.add()}},{key:"editRow",value:function(e){this.tableData=this.tableData.map(function(t){return t.isEditRow=!1,t.id===e.id&&(t.isEditRow=!0),t}),this.loading=!0,this.getSubtypeList(e)}},{key:"validate",value:function(e){return e.service?e.subtypeIds.length<=0?(this.$message.error("请选择业务类型"),!1):!(e.userIds.length<=0)||(this.$message.error("请选择接收人"),!1):(this.$message.error("请选择服务类型"),!1)}},{key:"delRow",value:function(e){var t=this;this.$confirm("请确认是否删除该条数据?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){if(e.id){var n={id:e.id};t.loading=!0,Object(h["b"])(n).then(function(e){t.loading=!1,e.success&&(t.$message.success("删除成功"),t.getPersonList())}).catch(function(e){return t.loading=!1,e})}}).catch(function(){return!1})}},{key:"cancelRow",value:function(e){e.id?e.isEditRow=!1:this.tableData=this.tableData.filter(function(e){return e.id})}},{key:"saveRow",value:function(){var e=Object(g["a"])(regeneratorRuntime.mark(function e(t,n){var i,a,s,r,c,l,u,d,f,p,b=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!this.validate(t)){e.next=23;break}if(i=this.tableData.reduce(function(e,t){var n=e.some(function(e){var n=e.service===t.service,i=(e.subtypeIds||[]).some(function(e){return(t.subtypeIds||[]).some(function(t){return t===e})}),a=(e.userIds||[]).some(function(e){return(t.userIds||[]).some(function(t){return t===e})});return n&&i&&a});return n?e:e.concat(t)},[]),!(i.length<this.tableData.length)){e.next=5;break}return this.$message.error("相同服务类型和业务类型下有重复的接收者"),e.abrupt("return",!1);case 5:if(a=t.subtypeIds,s=t.userIds,r=t.service,c=t.id,t.isEditRow,l=Object(o["a"])(t,["subtypeIds","userIds","service","id","isEditRow"]),u=k({},l,{id:c,service:r,unqId:this.currentObj.unqId,parentId:this.currentObj.parentId}),d=this.typeList.find(function(e){return e.id===r})||{},u.serviceName=d.name,f=this.subtypeList.filter(function(e){return a.some(function(t){return t===e.id})}),p=this.userList.filter(function(e){return s.some(function(t){return t===e.id})}),u.business=f.map(function(e){return e.id}).join(","),u.businessName=f.map(function(e){return e.name}).join(","),u.userId=p.map(function(e){return e.id}).join(","),u.userName=p.map(function(e){return e.label}).join(","),this.loading=!0,!c){e.next=21;break}return e.next=19,Object(h["c"])(u).then(function(e){b.loading=!1,e.success&&(b.$message.success("编辑成功"),b.getPersonList())}).catch(function(e){return b.loading=!1,e});case 19:e.next=23;break;case 21:return e.next=23,Object(h["n"])(u).then(function(e){b.loading=!1,e.success&&(b.$message.success("新增成功"),b.getPersonList())}).catch(function(e){return b.loading=!1,e});case 23:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"getServiceTypeList",value:function(){var e=this,t={custId:this.custId};Object(h["k"])(t).then(function(t){e.typeList=t.data||[]}).catch(function(e){return e})}},{key:"getSubtypeList",value:function(e){var t=this,n={typeId:e.service};this.selectLoading=!0,Object(h["i"])(n).then(function(e){var n=e.data||[];t.subtypeList=n,t.selectLoading=!1,t.loading=!1}).catch(function(e){return t.selectLoading=!1,t.loading=!1,e})}},{key:"getUserList",value:function(){var e=this,t={custId:this.custId};this.selectLoading=!0,Object(h["l"])(t).then(function(t){var n=t.data,i=n||[];e.userList=i.map(function(e){var t=e.deptName,n=e.realName,i=e.username,a=Object(o["a"])(e,["deptName","realName","username"]);return k({},a,{deptName:t,realName:n,username:i,label:"".concat(n,"-").concat(i,"-").concat(t)})}),e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,t})}},{key:"dialogClose",value:function(){this.visible=!1,this.currentObj={},this.$emit("load")}},{key:"show",value:function(e){this.visible=!0,this.currentObj=e,this.getPersonList(),this.getUserList(),this.getServiceTypeList()}},{key:"onType",value:function(e,t){this.subtypeList=[],t.subtypeIds=[],this.getSubtypeList(t)}},{key:"getPersonList",value:function(e){var t=this,n={unqId:this.currentObj.unqId};this.loading=!0,Object(h["g"])(n).then(function(n){if(t.loading=!1,n.success){var i=n.data||[],a=i;t.tableData=a.map(function(e){e.isEditRow=!1;var t=e.business,n=e.userId,i=(t||"").split(",")||[],a=(n||"").split(",")||[];return k({},e,{subtypeIds:i,userIds:a})}),"isAdd"===e&&t.add()}}).catch(function(e){return t.loading=!1,e})}},{key:"custId",get:function(){var e=y["a"].info||{},t=e.custId;return t}}]),t}(p["e"]);O=f["a"]([Object(p["a"])({name:"",components:{},props:{}})],O);var j=O,x=j,I=n("2877"),P=Object(I["a"])(x,b,v,!1,null,"8e11fc0c",null),L=P.exports;function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach(function(t){Object(s["a"])(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var $=function(e){function t(){var e;return Object(r["a"])(this,t),e=Object(l["a"])(this,Object(u["a"])(t).apply(this,arguments)),e.treeData=[],e.checkList=[],e.checkObj={},e.loading=!1,e.defaultProps={children:"result",label:"name"},e}return Object(d["a"])(t,e),Object(c["a"])(t,[{key:"created",value:function(){this.queryAll()}},{key:"queryAll",value:function(){var e=this;this.loading=!0,Object(h["f"])().then(function(t){var n=t.data||[],i=n,a=[];e.treeData=i.map(function(e){var t=(e.result||[]).every(function(e){return 1===e.status});1===e.status&&t&&a.push(e.unqId);var n=(e.result||[]).map(function(e){1===e.status&&a.push(e.unqId);var t=e.app,n=e.mail,i=e.notification,s=e.phone,r=e.wechat,c=(e.status,Object(o["a"])(e,["app","mail","notification","phone","wechat","status"]));return R({},c,{app:1===t,mail:1===n,notification:1===i,phone:1===s,wechat:1===r})});return R({},e,{result:n})}),e.setCheckedKeys(a),e.loading=!1}).catch(function(t){return e.loading=!1,t})}},{key:"setCheckedKeys",value:function(e){var t=this.$refs.tree;t.setCheckedKeys(e)}},{key:"onCheck",value:function(e){var t=e.parentId,n=e.unqId;this.checkObj={parentId:t,unqId:n};var i=this.$refs.tree,a=i.getCheckedKeys(),s=a.some(function(e){return n===e});this.checkObj.status=s?1:0,this.saveHomePage()}},{key:"checkChange",value:function(e,t){var n=e.app,i=e.mail,a=e.notification,s=e.phone,r=e.wechat,c=Object(o["a"])(e,["app","mail","notification","phone","wechat"]);this.checkObj=R({},c,{app:n?1:0,mail:i?1:0,notification:a?1:0,phone:s?1:0,wechat:r?1:0}),this.updateHomePage()}},{key:"updateHomePage",value:function(){var e=this;this.loading=!0,Object(h["q"])(this.checkObj).then(function(t){e.$message({type:"success",message:"保存成功"}),e.loading=!1,e.queryAll()}).catch(function(t){return e.loading=!1,t})}},{key:"saveHomePage",value:function(){var e=this;this.loading=!0,Object(h["m"])(this.checkObj).then(function(t){e.$message({type:"success",message:"保存成功"}),e.loading=!1,e.queryAll()}).catch(function(t){return e.loading=!1,t})}},{key:"updataPerson",value:function(e,t){this.$refs.noticePerson.show(t)}}]),t}(p["e"]);$=f["a"]([Object(p["a"])({name:"",components:{noticePerson:L},props:{}})],$);var C=$,D=C,S=(n("f312"),Object(I["a"])(D,i,a,!1,null,"7f99f5ad",null));t["default"]=S.exports},f312:function(e,t,n){"use strict";var i=n("4241"),a=n.n(i);a.a}}]);