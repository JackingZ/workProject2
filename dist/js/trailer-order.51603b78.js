(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["trailer-order"],{"387b":function(t,e,i){},"45b6":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","min-height":"inherit"}},[i("div",{staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:"i"===t.detailShow,expression:"detailShow === 'i'"}],staticClass:"app-container"},[i("head-info",{attrs:{info:"",title:"拖车订单"}}),i("div",{staticClass:"app-panel"},[i("div",{staticStyle:{"text-align":"right"}},["0"===t.custType||"2"===t.custType?i("el-select",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{placeholder:"订单类型",size:"small"},on:{change:t.onOrderType},model:{value:t.searchForm.orderType,callback:function(e){t.$set(t.searchForm,"orderType",e)},expression:"searchForm.orderType"}},t._l(t.orderTypeList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e(),"2"===t.custType&&"1"===t.custSubtype&&"0"===t.searchForm.orderType?i("el-select",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{size:"small",placeholder:"公司类型",clearable:""},on:{change:t.onComType},model:{value:t.searchForm.comType,callback:function(e){t.$set(t.searchForm,"comType",e)},expression:"searchForm.comType"}},t._l(t.companyTypeList,function(t,e){return i("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1):t._e(),"0"!==t.custType&&"2"!==t.custType||"0"!==t.searchForm.orderType?t._e():i("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:t.selectLoading,size:"small",placeholder:"所属公司",filterable:"",clearable:""},on:{change:t.onCompany,focus:t.getCompanyList},model:{value:t.searchForm.comId,callback:function(e){t.$set(t.searchForm,"comId",e)},expression:"searchForm.comId"}},t._l(t.companyList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),i("el-select",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{placeholder:"订单状态",size:"small",clearable:"",filterable:""},model:{value:t.searchForm.status,callback:function(e){t.$set(t.searchForm,"status",e)},expression:"searchForm.status"}},t._l(t.statusList,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),i("el-select",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{size:"small",placeholder:"拖车类型",filterable:"",clearable:""},model:{value:t.searchForm.type,callback:function(e){t.$set(t.searchForm,"type",e)},expression:"searchForm.type"}},t._l(t.typeList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),i("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:t.selectLoading,clearable:"",filterable:"",placeholder:"起运港",size:"small"},on:{focus:t.getPortList},model:{value:t.searchForm.exportId,callback:function(e){t.$set(t.searchForm,"exportId",e)},expression:"searchForm.exportId"}},t._l(t.portList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),i("el-input",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{size:"small",placeholder:"SO号"},model:{value:t.searchForm.soCodes,callback:function(e){t.$set(t.searchForm,"soCodes",e)},expression:"searchForm.soCodes"}}),i("el-date-picker",{staticStyle:{width:"240px","margin-right":"5px"},attrs:{clearable:!1,"unlink-panels":"",type:"daterange",align:"right",size:"small","value-format":"yyyy-MM-dd","range-separator":"~","start-placeholder":"取货起始时间","end-placeholder":"取货截止时间"},model:{value:t.searchForm.outTime,callback:function(e){t.$set(t.searchForm,"outTime",e)},expression:"searchForm.outTime"}}),i("el-date-picker",{staticStyle:{width:"240px","margin-right":"10px"},attrs:{clearable:!1,"unlink-panels":"",type:"daterange",align:"right",size:"small","value-format":"yyyy-MM-dd","range-separator":"~","start-placeholder":"进仓起始时间","end-placeholder":"进仓截止时间"},model:{value:t.searchForm.inTime,callback:function(e){t.$set(t.searchForm,"inTime",e)},expression:"searchForm.inTime"}}),i("el-date-picker",{staticStyle:{width:"240px","margin-right":"10px"},attrs:{clearable:!1,"unlink-panels":"",type:"daterange",align:"right",size:"small","value-format":"yyyy-MM-dd","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"结束时间"},model:{value:t.searchForm.createTime,callback:function(e){t.$set(t.searchForm,"createTime",e)},expression:"searchForm.createTime"}}),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["trailerOrderQuery"],expression:"['trailerOrderQuery']"}],attrs:{type:"primary",size:"small"},on:{click:function(e){return t.getTableData(1)}}},[t._v("\n            查询\n          ")])],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:t.tableData,height:"calc(100vh - 313px)",border:""}},[i("el-table-column",{attrs:{prop:"export",label:"起运港","min-width":"180","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"soCodes",label:"SO号","min-width":"150","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s((e.row.soCodes||[]).join(","))+"\n            ")]}}])}),i("el-table-column",{attrs:{prop:"audit",label:"审核状态",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s((t.auditList.find(function(t){return t.value===e.row.audit})||{}).label)+"\n            ")]}}])}),i("el-table-column",{attrs:{prop:"status",label:"订单状态",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s((t.statusList.find(function(t){return t.value===e.row.status})||{}).label)+"\n            ")]}}])}),i("el-table-column",{attrs:{prop:"type",label:"拖车类型",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[0===e.row.type?i("span",[t._v("进口拖车")]):1===e.row.type?i("span",[t._v("出口拖车")]):t._e()]}}])}),i("el-table-column",{attrs:{prop:"customerName",label:"下单客户","min-width":"150","show-overflow-tooltip":""}}),"0"===t.custType?i("el-table-column",{attrs:{prop:"sellerName",label:"供应商",width:"150","show-overflow-tooltip":""}}):t._e(),"2"===t.custType?i("el-table-column",{attrs:{prop:"sellerName",label:"服务提供商",width:"150","show-overflow-tooltip":""}}):t._e(),i("el-table-column",{attrs:{prop:"warehouseTime",label:"进仓时间",width:"180"}}),i("el-table-column",{attrs:{prop:"pickTime",label:"取货时间",width:"180"}}),i("el-table-column",{attrs:{prop:"createTime",label:"创建时间",width:"180"}}),i("el-table-column",{attrs:{label:"操作",fixed:"right",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["trailerOrderView"],expression:"['trailerOrderView']"}],attrs:{type:"text"},on:{click:function(i){return t.viewData(e.row)}}},[t._v("\n                查看\n              ")]),"0"===e.row.isFlag?i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["trailerOrderSupperier"],expression:"['trailerOrderSupperier']"}],attrs:{type:"text"},on:{click:function(i){return t.viewSupperier(e.row)}}},[t._v("\n                指定供应商\n              ")]):t._e(),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["trailerOrderVehicle"],expression:"['trailerOrderVehicle']"}],attrs:{type:"text"},on:{click:function(i){return t.allocationCar(e.row)}}},[t._v("\n                分配车辆\n              ")]),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["trailerOrderFinancial"],expression:"['trailerOrderFinancial']"}],attrs:{type:"text"},on:{click:function(i){return t.showFinancial(e.row)}}},[t._v("\n                账单信息\n              ")])]}}])})],1),i("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":t.page,"page-size":t.size,layout:"total, prev, pager, next",total:t.total},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"d"===t.detailShow,expression:"detailShow === 'd'"}],staticClass:"app-container"},[i("detail",{ref:"detailForm",on:{back:function(e){t.detailShow="i"}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"c"===t.detailShow,expression:"detailShow === 'c'"}],staticClass:"app-container"},[i("car",{ref:"car",on:{back:function(e){t.detailShow="i"}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:"f"===t.detailShow,expression:"detailShow === 'f'"}],staticClass:"app-container"},[i("order-financial",{ref:"financial",on:{back:function(e){t.detailShow="i"}}})],1),i("el-dialog",{attrs:{title:"指定供应商",width:"600px","close-on-click-modal":!1,visible:t.isSupperierVisible},on:{"update:visible":function(e){t.isSupperierVisible=e},close:t.cancelSupperier}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.formLoading,expression:"formLoading"}]},[i("el-form",{ref:"supperierForm",staticStyle:{"padding-right":"20px"},attrs:{model:t.supperierForm,rules:t.rules,"label-width":"100px",size:"small"}},[i("el-form-item",{attrs:{label:"指派方式",prop:"type"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small"},on:{change:t.onSupperType},model:{value:t.supperierForm.type,callback:function(e){t.$set(t.supperierForm,"type",e)},expression:"supperierForm.type"}},[i("el-option",{attrs:{label:"默认供应商",value:"1"}}),i("el-option",{attrs:{label:"指定供应商",value:"2"}})],1)],1),i("el-form-item",{attrs:{label:"报关行",prop:"supplyId"}},["1"===t.supperierForm.type?i("el-input",{attrs:{clearable:"",placeholder:"请输入",maxlength:20},model:{value:t.supperierForm.name,callback:function(e){t.$set(t.supperierForm,"name",e)},expression:"supperierForm.name"}}):"2"===t.supperierForm.type?i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small",loading:t.selectLoading},on:{focus:t.getCustTypeList},model:{value:t.supperierForm.supplyId,callback:function(e){t.$set(t.supperierForm,"supplyId",e)},expression:"supperierForm.supplyId"}},t._l(t.supplierList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e()],1)],1),i("div",{staticStyle:{"text-align":"right","padding-top":"20px"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:t.cancelSupperier}},[t._v("\n            取 消\n          ")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.confirmSupperier}},[t._v("\n            确 定\n          ")])],1)],1)])],1)])},r=[],n=(i("8e6e"),i("ac6a"),i("456d"),i("c5f6"),i("bd86")),s=i("a8db"),o=(i("a481"),i("d225")),l=i("b0b4"),c=i("308d"),u=i("6bb5"),d=i("4e2b"),p=i("9ab4"),m=i("60a3"),f=i("9dba"),v=i("5c49"),h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.detailLoading,expression:"detailLoading"}]},[i("div",{staticClass:"detail-back"},[i("span",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.$emit("back")}}},[i("i",{staticClass:"el-icon-back"}),i("span",[t._v("返回")])])]),i("div",{staticClass:"app-panel order-detail"},[i("el-form",{ref:"detail",staticClass:"detail-form",attrs:{model:t.form,"label-width":"130px","label-position":"right"}},[i("div",{staticClass:"form-title"},[i("el-row",[i("el-col",{attrs:{span:4}},[t._v("\n            基础信息\n          ")]),i("el-col",{staticStyle:{"text-align":"right"},attrs:{span:20}})],1)],1),i("div",{staticStyle:{padding:"0 20px"}},[i("el-form-item",{attrs:{label:"拖车类型："}},[0===t.form.type?i("span",[t._v("\n            进口拖车\n          ")]):1===t.form.type?i("span",[t._v("\n            出口拖车\n          ")]):t._e()]),0===t.form.type?i("el-form-item",{attrs:{label:"卸货方式："}},["1"===t.form.mode?i("span",[t._v("\n            等货卸货\n          ")]):"2"===t.form.mode?i("span",[t._v("\n            到场卸货\n          ")]):t._e()]):t._e(),i("el-form-item",{attrs:{label:"付款方式："}},["0"===t.form.pay?i("span",[t._v("\n            现金\n          ")]):"1"===t.form.pay?i("span",[t._v("\n            电子支付\n          ")]):"2"===t.form.pay?i("span",[t._v("\n            支票\n          ")]):t._e()]),0===t.form.type?i("div",[i("el-form-item",{attrs:{label:"起运港："}},[t._v("\n            "+t._s(t.form.export)+"\n          ")]),i("el-form-item",{attrs:{label:"取货时间："}},[t._v("\n            "+t._s(t.form.pickTime)+"\n          ")])],1):t._e(),0===t.form.type?i("el-form-item",{attrs:{label:"入仓号："}},[t._v("\n          "+t._s(t.form.warehouseNo)+"\n        ")]):t._e(),0===t.form.type?i("el-form-item",{attrs:{label:"入仓时间："}},[t._v("\n          "+t._s(t.form.warehouseTime)+"\n        ")]):t._e(),1===t.form.type?i("el-form-item",{attrs:{label:"还柜地址："}},[t._v("\n          "+t._s(t.form.export)+"\n        ")]):t._e(),1===t.form.type?i("el-form-item",{attrs:{label:"补料时间："}},[t._v("\n          "+t._s(t.form.xxx)+"\n        ")]):t._e(),i("el-form-item",{attrs:{label:"过磅类型："}},["0"===t.form.poundType?i("span",[t._v("\n            重磅过磅\n          ")]):"1"===t.form.poundType?i("span",[t._v("\n            轻磅过磅\n          ")]):t._e()]),i("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"备注："}},[t._v("\n          "+t._s(t.form.remake)+"\n        ")])],1),0===t.form.type?i("div",{staticClass:"form-title"},[t._v("\n        收货人信息\n      ")]):t._e(),0===t.form.type?i("div",{staticStyle:{padding:"0 20px"}},[i("el-form-item",{attrs:{label:"联系人："}},[t._v("\n          "+t._s(t.form.harvestMan)+"\n        ")]),i("el-form-item",{attrs:{label:"联系电话："}},[t._v("\n          "+t._s(t.form.harvestPhone)+"\n        ")]),i("el-form-item",{attrs:{label:"联系邮箱："}},[t._v("\n          "+t._s(t.form.harvestMail)+"\n        ")]),i("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"联系地址："}},[t._v("\n          "+t._s(t.form.harvestAdd)+"\n        ")]),i("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"详细地址："}},[t._v("\n          "+t._s(t.form.harvestCountry+" "+t.form.harvestProvince+"  "+t.form.harvestCity+" "+t.form.harvestAdd)+"\n        ")]),i("el-form-item",{attrs:{label:"邮编："}},[t._v("\n          "+t._s(t.form.harvestPostcode)+"\n        ")]),i("el-form-item",{attrs:{label:"公司："}},[t._v("\n          "+t._s(t.form.harvestCompany)+"\n        ")])],1):t._e(),1===t.form.type?i("div",{staticClass:"form-title"},[t._v("\n        装柜地址\n      ")]):t._e(),1===t.form.type?i("div",{staticStyle:{padding:"0 20px"}},[i("el-collapse",{attrs:{accordion:""}},t._l(t.goodsData,function(e,a){return i("el-collapse-item",{key:a},[i("template",{slot:"title"},[i("span",[t._v("地址"+t._s(a+1))]),e.sortPacking?i("span",{staticStyle:{margin:"0 10px"}},[t._v("\n                装载次序 "+t._s(e.sortPacking)+"\n              ")]):t._e(),e.volume?i("span",[t._v("\n                装载体积 "+t._s(e.volume)+" m³\n              ")]):t._e()]),i("div",[i("el-form-item",{attrs:{label:"工厂/仓库："}},[t._v("\n                "+t._s(e.warehouse)+"\n              ")]),i("el-form-item",{attrs:{label:"联系人："}},[t._v("\n                "+t._s(e.contact)+"\n              ")]),i("el-form-item",{attrs:{label:"联系电话："}},[t._v("\n                "+t._s(e.tel)+"\n              ")]),i("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"联系地址："}},[t._v("\n                "+t._s(e.address)+"\n              ")]),i("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"详细地址："}},[t._v("\n                "+t._s((e.countryName||"")+" "+(e.stateName||"")+" "+(e.cityName||"")+" "+(e.address||""))+"\n              ")])],1)],2)}),1)],1):t._e(),i("div",{staticClass:"form-title"},[t._v("\n        货物信息\n      ")]),i("div",{staticStyle:{padding:"0 20px"}},[i("el-form-item",{attrs:{label:"柜型："}},[t._v("\n          "+t._s(t.form.cabinetType)+"\n        ")]),i("el-form-item",{attrs:{label:"SO号："}},[t._v("\n          "+t._s(t.soNum)+"\n        ")]),i("el-form-item",{attrs:{label:"柜数："}},[t._v("\n          "+t._s(t.form.cabinetNumber)+"\n        ")]),i("el-form-item",{attrs:{label:"总货值："}},[t._v("\n          "+t._s(t.form.trailerValue)+"\n        ")]),i("el-form-item",{attrs:{label:"总件数："}},[t._v("\n          "+t._s(t.form.total)+"\n        ")]),i("el-form-item",{attrs:{label:"总重量："}},[t._v("\n          "+t._s(t.form.weight)+" "+t._s(t.$fomatWeight(t.form.umWeight))+"\n        ")]),i("el-form-item",{attrs:{label:"总体积："}},[t._v("\n          "+t._s(t.$volumeConversion(t.form.volume,"CBCM","CBM"))+" m³\n        ")]),i("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"货物描述："}},[t._v("\n          "+t._s(t.form.trailerDescribe)+"\n        ")])],1)])],1)])},y=[],b=i("5a0c"),g=i.n(b),w=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.detailLoading=!1,t.form={},t.goodsData=[],t.soNum="",t}return Object(d["a"])(e,t),Object(l["a"])(e,[{key:"setData",value:function(t){var e=t.id;this.soNum=(t.soCodes||[]).join(","),this.getDetail(e)}},{key:"getDetail",value:function(t){var e=this;this.detailLoading=!0,Object(v["n"])({id:t}).then(function(t){var i=t.data||{},a=i.list,r=i.trailerOrder;e.form=r||{},e.goodsData=a||[],e.detailLoading=!1}).catch(function(t){return e.detailLoading=!1,e.$emit("back"),[null,t]})}},{key:"getContainerList",value:function(t){var e=this,i={trailerId:t};this.detailLoading=!0,Object(v["k"])(i).then(function(t){e.detailLoading=!1;var i=t.data||[];e.goodsData=i.reduce(function(t,e){var i=e.packList||[];return i.forEach(function(e){t.push(e)}),t},[])}).catch(function(){e.detailLoading=!1,e.goodsData=[],e.$emit("back")})}},{key:"timeSplice",value:function(t,e){return"1"===e?t?g()(t).format("YYYY-MM-DD"):"":"2"===e?t?g()(t).format("HH:mm:ss"):"":void 0}},{key:"volumesFilter",value:function(t,e){return"CM"===e?(1e-6*t).toFixed(3):"M"===e?t.toFixed(3):"INCH"===e?(164e-7*t).toFixed(3):"FT"===e?(.0283168*t).toFixed(3):void 0}},{key:"custType",get:function(){var t=f["a"].info||{},e=t.custType;return e}}]),e}(m["e"]);w=p["a"]([Object(m["a"])({name:"detail",components:{},props:{}})],w);var _=w,k=_,x=(i("605b"),i("2877")),O=Object(x["a"])(k,h,y,!1,null,"12b108ba",null),C=O.exports,S=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[i("div",{staticClass:"detail-back"},[i("span",{staticClass:"title"},[t._v("\n      分配车辆\n    ")]),i("div",[i("el-button",{attrs:{type:"text",icon:"el-icon-refresh-right"},on:{click:t.getContainerList}},[i("span",[t._v("刷新")])]),i("el-button",{attrs:{type:"text",icon:"el-icon-back"},on:{click:t.goBack}},[i("span",[t._v("返回")])])],1)]),i("div",{staticClass:"app-panel order-detail"},[t.containerList.length?i("div",t._l(t.containerList,function(e,a){return i("div",{key:e.id},[i("div",{staticClass:"container-info"},[i("div",{staticClass:"c-no"},[t._v("\n            "+t._s("货柜"+(a+1))+"\n          ")]),i("div",{staticClass:"c-status"},[i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[t._v("\n                状态\n              ")]),i("div",{staticClass:"value status"},[t._v("\n                "+t._s((t.containerStatusList.find(function(t){return t.value===e.status})||{}).label)+"\n              ")])]),1===e.status?i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[t._v("\n                司机状态\n              ")]),i("div",{staticClass:"value status"},[t._v("\n                "+t._s((t.driverStatusList.find(function(t){return t.value===e.driverInfo.orderStatus})||{}).name)+"\n              ")])]):t._e(),e.driverInfo.reason?i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[t._v("\n                司机取消/拒绝\n              ")]),i("div",{staticClass:"value status"},[t._v("\n                "+t._s(e.driverInfo.reason)+"\n              ")])]):t._e(),i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[t._v("\n                分配司机\n              ")]),i("div",{staticClass:"value"},[i("el-select",{staticStyle:{width:"160px"},attrs:{disabled:1===e.status,placeholder:"请选择",size:"small"},model:{value:e.driverInfo.driverId,callback:function(i){t.$set(e.driverInfo,"driverId",i)},expression:"item.driverInfo.driverId"}},t._l(t.driverList,function(t){return i("el-option",{key:t.driverId,attrs:{label:t.driverName+"-"+t.plateNumber,value:t.driverId}})}),1)],1)]),i("el-button",{attrs:{type:"text",disabled:1===e.status},on:{click:function(i){return t.assignDriver(e)}}},[t._v("\n              保存\n            ")])],1)]),i("div",{staticClass:"my-table-header"},[i("div",{staticStyle:{display:"flex",flex:"1","align-items":"center"}},[i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[t._v("\n                SO号\n              ")]),i("div",{staticClass:"value"},[i("el-input",{staticStyle:{width:"160px"},attrs:{disabled:"",clearable:"",size:"small",placeholder:"请输入"},model:{value:e.soCode,callback:function(i){t.$set(e,"soCode",i)},expression:"item.soCode"}})],1)]),i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[t._v("\n                柜号\n              ")]),i("div",{staticClass:"value"},[i("el-input",{staticStyle:{width:"160px"},attrs:{disabled:!e.form.isEdit,clearable:"",size:"small",placeholder:"请输入"},model:{value:e.form.cabinetNo,callback:function(i){t.$set(e.form,"cabinetNo",i)},expression:"item.form.cabinetNo"}})],1)]),i("div",{staticClass:"item"},[i("div",{staticClass:"label"},[t._v("\n                关封号\n              ")]),i("div",{staticClass:"value"},[i("el-input",{staticStyle:{width:"160px"},attrs:{disabled:!e.form.isEdit,clearable:"",size:"small",placeholder:"请输入"},model:{value:e.form.sealNo,callback:function(i){t.$set(e.form,"sealNo",i)},expression:"item.form.sealNo"}})],1)]),i("div",{staticClass:"img-list"},[e.file.name?i("div",{staticClass:"preview-img-wrap"},[i("div",{staticClass:"preview-img"},[i("img",{attrs:{src:e.file.url}}),i("div",{staticClass:"mask"},[i("i",{staticClass:"el-icon-view mask-view-icon",on:{click:function(i){return t.handlePreview(e.file.url)}}}),e.form.isEdit?i("i",{staticClass:"el-icon-delete mask-del-icon",on:{click:function(i){return t.handleDelete(e.file.name,e)}}}):t._e()])])]):i("div",{staticClass:"img-item-upload"},[i("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,disabled:!e.form.isEdit,"before-upload":t.beforeAvatarUpload,"http-request":function(i){return t.uploadFile(i,e)}}},[i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)])]),e.form.isEdit?t._e():i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.editSealNo(e)}}},[t._v("\n            编辑\n          ")]),e.form.isEdit?i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.cancelSealNo(e)}}},[t._v("\n            取消\n          ")]):t._e(),e.form.isEdit?i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.saveSealNo(e)}}},[t._v("\n            保存\n          ")]):t._e()],1),i("div",{staticClass:"status-table"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.statusList,border:""}},[i("el-table-column",{attrs:{label:"操作",prop:"status",width:"200"}}),i("el-table-column",{attrs:{label:"详情"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticStyle:{display:"flex","text-align":"center","flex-wrap":"wrap"}},t._l(e.row.fileList,function(e){return i("div",{key:e.id},[i("div",{staticClass:"preview-img-wrap"},[i("div",{staticClass:"preview-img"},[i("img",{attrs:{src:e.url}}),i("div",{staticClass:"mask"},[i("i",{staticClass:"el-icon-view mask-view-icon",on:{click:function(i){return t.handlePreview(e.url)}}})])])]),i("div",{staticClass:"des"},[t._v("\n                      "+t._s(e.des)+"\n                    ")])])}),0)]}}],null,!0)}),i("el-table-column",{attrs:{label:"操作时间",width:"200",prop:"time"}})],1)],1),i("div",{staticClass:"cost-table-header"},[i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("div",{staticClass:"status",staticStyle:{"margin-right":"20px"}},[i("span",{staticStyle:{"margin-right":"5px"}},[t._v("费用状态")]),i("span",{staticStyle:{color:"#FF7D19"}},[t._v("\n                "+t._s((t.costAuditList.find(function(t){return t.value===e.costAudit})||{}).name)+"\n              ")])]),3===e.costAudit?i("div",{staticClass:"status"},[i("span",{staticStyle:{"margin-right":"5px"}},[t._v("拒绝原因")]),i("span",{staticStyle:{color:"#FF7D19"}},[t._v("\n                "+t._s(e.costReason)+"\n              ")])]):t._e()]),i("div",{staticClass:"option-btn"},[0!==e.costAudit&&3!==e.costAudit||1!==e.status?t._e():i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.addNewCost(e)}}},[t._v("\n              新增额外费用\n            ")]),3===e.costAudit&&1===e.status?i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.commitCost(e)}}},[t._v("\n              重新提交审核\n            ")]):t._e(),1===e.costAudit&&1===e.status?i("div",[i("div",{staticStyle:{display:"inline-block","margin-right":"10px"}},[i("span",{staticStyle:{"padding-right":"10px"}},[t._v("费用审核")]),i("el-radio-group",{model:{value:t.form.audit,callback:function(e){t.$set(t.form,"audit",e)},expression:"form.audit"}},[i("el-radio",{attrs:{label:2}},[t._v("\n                    通过\n                  ")]),i("el-radio",{attrs:{label:3}},[t._v("\n                    拒绝\n                  ")])],1)],1),3===t.form.audit?i("div",{staticStyle:{display:"inline-block","margin-right":"10px"}},[i("span",{staticStyle:{"padding-right":"10px"}},[t._v("拒绝原因")]),i("el-input",{staticStyle:{width:"160px"},attrs:{clearable:"",size:"small",placeholder:"请输入"},model:{value:t.form.reason,callback:function(e){t.$set(t.form,"reason",e)},expression:"form.reason"}})],1):t._e(),i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.auditCost(e)}}},[t._v("\n                保存\n              ")])],1):t._e()],1)]),i("div",{staticClass:"cost-table"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.costList,border:""}},[i("el-table-column",{attrs:{label:"费用名称",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?i("el-input",{staticStyle:{width:"160px"},attrs:{clearable:"",size:"small",placeholder:"请输入"},model:{value:e.row.costName,callback:function(i){t.$set(e.row,"costName",i)},expression:"scope.row.costName"}}):i("span",[t._v(t._s(e.row.costName))])]}}],null,!0)}),i("el-table-column",{attrs:{label:"支付金额",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?i("el-input",{staticStyle:{width:"160px"},attrs:{clearable:"",size:"small",placeholder:"请输入"},model:{value:e.row.money,callback:function(i){t.$set(e.row,"money",i)},expression:"scope.row.money"}}):i("span",[t._v(t._s(e.row.money))])]}}],null,!0)}),i("el-table-column",{attrs:{label:"支付凭证",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticClass:"img-list"},[e.row.file.name?i("div",{staticClass:"preview-img-wrap"},[i("div",{staticClass:"preview-img"},[i("img",{attrs:{src:e.row.file.url}}),i("div",{staticClass:"mask"},[i("i",{staticClass:"el-icon-view mask-view-icon",on:{click:function(i){return t.handlePreview(e.row.file.url)}}}),e.row.isEdit?i("i",{staticClass:"el-icon-delete mask-del-icon",on:{click:function(i){return t.handleDelete(e.row.file.name,e.row)}}}):t._e()])])]):i("div",{staticClass:"img-item-upload"},[i("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,disabled:!e.row.isEdit,"before-upload":t.beforeAvatarUpload,"http-request":function(i){return t.uploadFile(i,e.row)}}},[i("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1)])]}}],null,!0)}),i("el-table-column",{attrs:{label:"费用描述"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.isEdit?i("el-input",{staticStyle:{width:"160px"},attrs:{clearable:"",size:"small",placeholder:"请输入"},model:{value:e.row.costDescribe,callback:function(i){t.$set(e.row,"costDescribe",i)},expression:"scope.row.costDescribe"}}):i("span",[t._v(t._s(e.row.costDescribe))])]}}],null,!0)}),i("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(a){return[0!==e.costAudit&&3!==e.costAudit||a.row.isEdit?t._e():i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.delCost(e,a.$index)}}},[t._v("\n                  删除\n                ")]),0!==e.costAudit&&3!==e.costAudit||!a.row.isEdit?t._e():i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.cancelCost(e)}}},[t._v("\n                  取消\n                ")]),0!==e.costAudit&&3!==e.costAudit||!a.row.isEdit?t._e():i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.saveCost(e,a.row)}}},[t._v("\n                  保存\n                ")]),0!==e.costAudit&&3!==e.costAudit||a.row.isEdit||!a.row.id?t._e():i("el-button",{attrs:{type:"text"},on:{click:function(i){return t.editRow(e,a.row)}}},[t._v("\n                  编辑\n                ")])]}}],null,!0)})],1)],1)])}),0):i("div",{staticStyle:{"text-align":"center",color:"#909399"}},[t._v("\n      暂无柜子信息\n    ")])]),i("el-dialog",{attrs:{title:"照片预览",visible:t.dialogVisible,top:"20px","append-to-body":""},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("img",{attrs:{width:"100%",src:t.imageUrl}})])],1)},j=[];i("55dd"),i("7514"),i("28a5"),i("7f7f");function L(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)}return i}function I(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?L(i,!0).forEach(function(e){Object(n["a"])(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):L(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var T=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.loading=!1,t.dialogVisible=!1,t.imageUrl="",t.form={reason:"",audit:2},t.driverStatusList=[{name:"待确认",value:0},{name:"进行中",value:1},{name:"已完成",value:2},{name:"已取消",value:3}],t.costAuditList=[{name:"司机未提交",value:0},{name:"司机已提交待审核",value:1},{name:"审核通过",value:2},{name:"审核拒绝",value:3}],t.containerStatusList=[{label:"待分配",value:0},{label:"已分配",value:1},{label:"司机拒绝接单",value:2}],t.driverList=[],t.containerList=[],t.showRow={},t}return Object(d["a"])(e,t),Object(l["a"])(e,[{key:"goBack",value:function(){this.form={reason:"",audit:2},this.imageUrl="",this.driverList=[],this.containerList=[],this.showRow={},this.$emit("back")}},{key:"commitCost",value:function(t){var e=this,i={driverId:t.driverInfo.id,containerId:t.id};this.loading=!0,Object(v["d"])(i).then(function(){e.loading=!1,e.$message.success("操作成功"),e.getContainerList()}).catch(function(){e.loading=!1})}},{key:"auditCost",value:function(t){var e=this;if(3!==this.form.audit||this.form.reason){var i=I({trailerId:t.trailerId,driverId:t.driverInfo.id,containerId:t.id},this.form);this.loading=!0,Object(v["c"])(i).then(function(){e.loading=!1,e.$message.success("操作成功"),e.getContainerList()}).catch(function(){e.loading=!1})}else this.$message.error("请填写拒绝原因")}},{key:"checkCostData",value:function(t){if(!t.costName)return this.$message.error("请输入费用名称"),!1;if(!t.money)return this.$message.error("请输入支付金额"),!1;var e=/^\d+.?\d*$/;return e.test(t.money)?t.file&&t.file.name?!!t.costDescribe||(this.$message.error("请输入费用描述"),!1):(this.$message.error("请上传支付凭证"),!1):(this.$message.error("请填写正确的支付金额"),!1)}},{key:"saveCost",value:function(t,e){if(this.checkCostData(e)){var i=I({},e,{url:e.file.name,driverId:t.driverInfo.id});i.id?this.editCost(i):this.addCost(i)}}},{key:"editCost",value:function(t){var e=this;this.loading=!0,Object(v["h"])(t).then(function(){e.loading=!1,e.$message.success("费用保存成功"),e.getContainerList()}).catch(function(){e.loading=!1})}},{key:"addCost",value:function(t){var e=this;this.loading=!0,Object(v["a"])(t).then(function(){e.loading=!1,e.$message.success("费用保存成功"),e.getContainerList()}).catch(function(){e.loading=!1})}},{key:"editRow",value:function(t,e){t.costList=t.costList.map(function(t){return t.isEdit=!1,t.id===e.id&&(t.isEdit=!0),t}).filter(function(t){return t.id})}},{key:"cancelCost",value:function(t){t.costList=t.costList.map(function(t){return t.isEdit=!1,t}).filter(function(t){return t.id})}},{key:"addNewCost",value:function(t){t.costList=t.costList.map(function(t){return t.isEdit=!1,t}).filter(function(t){return t.id}),t.costList.push({costName:"",money:"",isEdit:!0,file:{url:"",name:""},costDescribe:""})}},{key:"delCost",value:function(t,e){var i=this,a=t.costList[e];a.id?this.$confirm("请确认是否删除该条数据?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){var t={id:a.id};i.loading=!0,Object(v["e"])(t).then(function(){i.loading=!1,i.$message.success("费用删除成功"),i.getContainerList()}).catch(function(){i.loading=!1})}).catch(function(){return!1}):t.costList=t.costList.filter(function(t,i){return i!==e})}},{key:"handleDelete",value:function(t,e){var i=this,a={ifPublic:!0,fileList:[t]};this.loading=!0,Object(v["f"])(a).then(function(){i.loading=!1,e.file={url:"",name:""}}).catch(function(){i.loading=!1})}},{key:"handlePreview",value:function(t){this.imageUrl=t,this.dialogVisible=!0}},{key:"editSealNo",value:function(t){t.form.isEdit=!0}},{key:"cancelSealNo",value:function(t){t.form.isEdit=!1}},{key:"saveSealNo",value:function(t){var e=this;if(t.form.cabinetNo)if(t.form.sealNo)if(t.file.name){var i=I({},t.form,{url:t.file.name,containerId:t.id});this.loading=!0,Object(v["r"])(i).then(function(){e.loading=!0,e.getContainerList()}).catch(function(){e.loading=!1})}else this.$message.error("请上传文件");else this.$message.error("请输入关封号");else this.$message.error("请输入柜号")}},{key:"beforeAvatarUpload",value:function(t){var e=-1!==t.type.indexOf("image"),i=t.size/1024/1024<2;return e||this.$message.error("上传照片只能是图片格式!"),i||this.$message.error("上传照片大小不能超过 2MB!"),e&&i}},{key:"uploadFile",value:function(t,e){var i=this,a=new FormData,r=new File([t.file],t.file.name.split(".")[0]+(new Date).getTime()+"."+t.file.name.split(".")[1],{type:t.file.type});a.append("file",r),this.loading=!0,Object(v["s"])(a).then(function(t){i.loading=!1;var a=t.data||{};e.file.name=a.objectName,e.file.url="https://file.jhtinfo.net/"+a.objectName}).catch(function(){e.file={name:"",url:""},i.loading=!1})}},{key:"assignDriver",value:function(t){var e=this;if(t.driverInfo.driverId){var i=this.driverList.find(function(e){return e.driverId===t.driverInfo.driverId})||{},a=I({},i);a.operationUser=this.userInfo.realName,a.operationPhone=this.userInfo.phone,a.containerId=t.id,a.trailerId=t.trailerId,this.loading=!0,Object(v["b"])(a).then(function(){e.loading=!1,e.$message.success("车辆分配成功"),e.getContainerList()}).catch(function(){e.loading=!1})}else this.$message.error("请选择司机")}},{key:"show",value:function(t){this.showRow=t,this.getContainerList(),this.getCarList()}},{key:"getCarList",value:function(){var t=this,e={custId:this.showRow.sellerId};Object(v["j"])(e).then(function(e){t.driverList=e.data||[]}).catch(function(){t.driverList=[]})}},{key:"getContainerList",value:function(){var t=this,e={trailerId:this.showRow.id};this.loading=!0,Object(v["k"])(e).then(function(e){t.loading=!1;var i=e.data||[];t.containerList=i.map(function(t){for(var e=t.trailerContainer||{},i=t.driverOrderTrailer||{driverId:"",orderStatus:0},a=t.packList||[],r=[],n=0,s=Object.keys(i);n<s.length;n++){var o=s[n];"orderStatus"===o&&0!==i[o]&&3!==i[o]&&r.push({id:o,status:"司机确认接单",time:i.confirmDate,fileList:[]}),"carryCabinetStatus"===o&&1===i[o]&&r.push({id:o,status:"提柜确认",time:i.carryCabinetTime,fileList:[{url:"https://file.jhtinfo.net/"+i.carryCabiner1,des:"柜后门",name:i.carryCabiner1},{url:"https://file.jhtinfo.net/"+i.carryCabiner2,des:"封条",name:i.carryCabiner2}]}),"returnCabinetStatus"===o&&1===i[o]&&r.push({id:o,status:"还柜确认",time:i.returnCabinetTime,fileList:[{url:"https://file.jhtinfo.net/"+i.returnCabinet1,des:"过磅单",name:i.returnCabinet1},{url:"https://file.jhtinfo.net/"+i.returnCabinet2,des:"还柜纸",name:i.returnCabinet2}]})}a.forEach(function(t,e){for(var i=0,a=Object.keys(t);i<a.length;i++){var n=a[i];"presentStatus"===n&&"1"===t[n]&&r.push({id:n+e,status:"到场确认",time:t.presentTime,address:t.address,fileList:[{url:"https://file.jhtinfo.net/"+t.presentUrl,des:"到场照片",name:t.presentUrl}]}),"departureStatus"===n&&"1"===t[n]&&r.push({id:n+e,status:"离场确认",time:t.departureTime,address:t.address,fileList:[{url:"https://file.jhtinfo.net/"+t.departure1,des:"装货前",name:t.departure1},{url:"https://file.jhtinfo.net/"+t.departure2,des:"装货中",name:t.departure2},{url:"https://file.jhtinfo.net/"+t.departure3,des:"装货完",name:t.departure3},{url:"https://file.jhtinfo.net/"+t.departure4,des:"关柜门",name:t.departure4},{url:"https://file.jhtinfo.net/"+t.departure5,des:"封锁条",name:t.departure5}]})}});var l=(t.list||[]).map(function(t){return I({},t,{isEdit:!1,file:{url:"https://file.jhtinfo.net/"+t.url,name:t.url}})});return I({form:{isEdit:!e.cabinetNo,cabinetNo:e.cabinetNo,sealNo:e.sealNo},file:{url:"https://file.jhtinfo.net/"+e.url,name:e.url}},e,{statusList:r.map(function(t){return t.fileList=t.fileList.filter(function(t){return t.name}),t}).sort(function(t,e){return e.time<t.time?1:-1}),driverInfo:I({},i),costList:l})})}).catch(function(){t.loading=!1,t.containerList=[],t.$emit("back")})}},{key:"userInfo",get:function(){return f["a"].info||{}}}]),e}(m["e"]);T=p["a"]([Object(m["a"])({name:"",components:{},props:{}})],T);var F=T,D=F,N=(i("510f"),Object(x["a"])(D,S,j,!1,null,"1764b77e",null)),$=N.exports,A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"invoice-order-info"},[i("div",{staticClass:"top-option",staticStyle:{overflow:"hidden"}},[i("el-link",{directives:[{name:"permission",rawName:"v-permission",value:["trailerOrderFinancialAdd"],expression:"['trailerOrderFinancialAdd']"}],staticStyle:{float:"left"},attrs:{underline:!1,type:"primary"},on:{click:t.addInvoice}},[t._v("\n      "+t._s("3"===t.custType?"新增应收款":"新增应付款")+"\n    ")]),i("el-link",{staticStyle:{float:"right"},attrs:{underline:!1,type:"primary"},on:{click:t.goBack}},[t._v("\n      返回\n    ")])],1),i("div",{staticClass:"my-scrollbar",staticStyle:{height:"calc(100vh - 180px)","overflow-y":"auto"}},[t._l(t.invoiceList,function(e,a){return i("div",{key:e.code,staticClass:"invoice-item",style:{"margin-top":0===a?0:"16px"}},[i("el-row",{staticClass:"invoice-title",nativeOn:{click:function(i){return t.showDetails(e)}}},[i("el-col",{attrs:{span:16}},["0"===e.status?i("span",{staticClass:"invoice-audit",staticStyle:{background:"#2291E6"}}):t._e(),"1"===e.status?i("span",{staticClass:"invoice-audit",staticStyle:{background:"#189800"}}):t._e(),"2"===e.status?i("span",{staticClass:"invoice-audit",staticStyle:{background:"#E12E2E"}}):t._e(),"3"===e.status?i("span",{staticClass:"invoice-audit",staticStyle:{background:"#FF7D19"}}):t._e(),i("span",{staticStyle:{"font-size":"14px"}},[t._v("\n            发票号："+t._s(e.code)+"\n          ")]),1===e.ifVerify?i("span",{staticClass:"invoice-type"},[t._v("\n            已核销\n          ")]):t._e(),t.formatterCutoffTime(e)?i("span",{staticClass:"invoice-day"},[t._v("\n            逾期"+t._s(t.formatterCutoffTime(e))+"天\n          ")]):t._e()]),e.isOpen?i("el-col",{staticStyle:{"text-align":"right"},attrs:{span:8}},["1"!==e.status&&!e.isEdit&&t.$checkPermission(["trailerOrderFinancialAudit"])?i("el-button",{attrs:{type:"text"},on:{click:function(i){return i.stopPropagation(),t.auditInvoice(e)}}},[t._v("\n            审核\n          ")]):t._e(),e.isEdit||e.isAdd||0!==e.ifVerify||"3"===e.status||!t.$checkPermission(["trailerOrderFinancialEdit"])?t._e():i("el-button",{attrs:{type:"text"},on:{click:function(i){return i.stopPropagation(),t.editRowClick(e)}}},[t._v("\n            编辑\n          ")]),e.isEdit||e.isAdd?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){return i.stopPropagation(),t.cancelInvoice(e)}}},[t._v("\n            取消\n          ")]):t._e(),e.isEdit||e.isAdd?i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){return i.stopPropagation(),t.saveInvoice(e)}}},[t._v("\n            保存\n          ")]):t._e()],1):t._e()],1),i("el-row",{staticClass:"img-flex"},[i("el-col",{attrs:{span:4}},[i("div",{staticClass:"img-word"},[i("span",{staticStyle:{color:"#909399"}},[t._v("账单金额:")]),i("br"),i("span",{staticClass:"img-number"},[t._v(t._s(e.amount))]),i("span",{staticClass:"img-unit"},[t._v(t._s(""+(e.currencyName||"")+(e.currencyId||"")))])])]),i("el-col",{attrs:{span:4}},[i("div",{staticClass:"img-word"},[i("span",{staticStyle:{color:"#909399"}},[t._v("本币金额：")]),i("br"),i("span",{staticClass:"img-number"},[t._v(t._s(e.selfAmount))]),i("span",{staticClass:"img-unit"},[t._v(t._s(""+(e.selfName||"")+(e.selfId||"")))])])]),i("el-col",{attrs:{span:5}},[i("div",{staticClass:"img-word"},[i("span",{staticStyle:{color:"#909399"}},[t._v("创建时间：")]),i("br"),i("span",{staticClass:"img-unit"},[t._v(t._s(e.createTime))]),i("span",{staticClass:"img-number"},[t._v(" ")])])]),i("el-col",{attrs:{span:5}},[i("div",{staticClass:"img-word"},[i("span",{staticStyle:{color:"#909399"}},[t._v("审核时间：")]),i("br"),i("span",{staticClass:"img-unit"},[t._v(t._s(e.auditTime||"--"))]),i("span",{staticClass:"img-number"},[t._v(" ")])])]),i("el-col",{attrs:{span:5}},[i("div",{staticClass:"img-word"},[i("span",{staticStyle:{color:"#909399"}},[t._v("截止付款：")]),i("br"),i("span",{staticClass:"img-unit"},[t._v(t._s(e.cutoffTime||"--"))]),i("span",{staticClass:"img-number"},[t._v(" ")])])])],1),i("el-collapse-transition",[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isOpen,expression:"itemV.isOpen"}]},[i("el-form",{staticStyle:{padding:"16px 16px 0"},attrs:{"label-width":"85px",size:"small"}},[e.isEdit?i("el-row",[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"发票日期",prop:"invDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择"},model:{value:e.invDate,callback:function(i){t.$set(e,"invDate",i)},expression:"itemV.invDate"}})],1),i("el-form-item",{attrs:{label:"发票类型",prop:"invoiceType"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small",filterable:""},model:{value:e.invoiceType,callback:function(i){t.$set(e,"invoiceType",i)},expression:"itemV.invoiceType"}},t._l(t.invoiceTypeList,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),i("el-form-item",{attrs:{label:"发票货币",prop:"currencyId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small",filterable:""},on:{focus:t.getCurrencyList,change:function(i){return t.currencyChange(i,e)}},model:{value:e.currencyId,callback:function(i){t.$set(e,"currencyId",i)},expression:"itemV.currencyId"}},t._l(t.currencyList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name+"-"+t.sign,value:t.id}})}),1)],1),i("el-form-item",{attrs:{label:"汇率",prop:"exRate"}},[i("el-input-number",{staticClass:"input-number-valiate",attrs:{controls:!1,placeholder:"请输入",size:"small",min:0,max:9999},on:{change:function(i){return t.calculateTotalPrice(e)}},model:{value:e.exRate,callback:function(i){t.$set(e,"exRate",i)},expression:"itemV.exRate"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"备注"}},[i("el-input",{attrs:{type:"textarea",rows:2,size:"small",placeholder:"请输入",clearable:""},model:{value:e.remark,callback:function(i){t.$set(e,"remark",i)},expression:"itemV.remark"}})],1)],1)],1):i("el-row",{staticStyle:{"font-size":"12px","padding-bottom":"16px"}},[i("el-col",{attrs:{span:12}},[i("el-row",{staticStyle:{"font-size":"12px"}},[i("el-col",{attrs:{span:12}},[i("span",{staticStyle:{color:"#909399"}},[t._v("发票日期：")]),i("span",[t._v(t._s(e.invDate))])]),i("el-col",{attrs:{span:12}},[i("span",{staticStyle:{color:"#909399"}},[t._v("发票类型：")]),i("span",[t._v(t._s((t.invoiceTypeList.find(function(t){return t.value===e.invoiceType})||{}).label))])]),i("el-col",{staticStyle:{"padding-top":"10px"},attrs:{span:12}},[i("span",{staticStyle:{color:"#909399"}},[t._v("发票货币：")]),i("span",[t._v(t._s(e.currencyId))])]),i("el-col",{staticStyle:{"padding-top":"10px"},attrs:{span:12}},[i("span",{staticStyle:{color:"#909399"}},[t._v("汇率：")]),i("span",[t._v(t._s(e.exRate))])])],1)],1),i("el-col",{attrs:{span:12}},[i("el-row",{staticStyle:{"font-size":"12px"}},[i("el-col",{attrs:{span:24}},[i("span",{staticStyle:{color:"#909399"}},[t._v("备注：")]),i("span",[t._v(t._s(e.remark))])])],1)],1)],1)],1),i("div",{staticStyle:{"border-top":"1px solid #e8e8e8",padding:"0 16px"}},[i("div",{staticStyle:{"line-height":"44px","font-size":"14px","font-weight":"600"}},[t._v("\n              明细行\n            ")]),i("div",{staticStyle:{"font-size":"14px"}},[i("span",{staticStyle:{color:"#324770"}},[t._v("开票总金额：")]),i("span",[t._v(t._s(e.amount))]),i("span",[t._v(t._s(""+(e.currencyName||"")+(e.currencyId||"")))]),i("span",{staticStyle:{color:"#324770","margin-left":"72px"}},[t._v("账单本币总金额：")]),i("span",[t._v(t._s(e.selfAmount))]),i("span",[t._v(t._s(""+(e.selfName||"")+(e.selfId||"")))])])]),e.isEdit?i("div",{staticStyle:{width:"100%",padding:"10px 16px"}},[i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap"}},[i("div",{staticStyle:{flex:"1"}},[i("el-row",{staticClass:"details-table-header details-row",attrs:{gutter:10}},[i("el-col",{attrs:{span:12}},[t._v("\n                    成本项目\n                  ")]),i("el-col",{attrs:{span:3}},[t._v("\n                    数量\n                  ")]),i("el-col",{attrs:{span:3}},[t._v("\n                    单价\n                  ")]),i("el-col",{attrs:{span:3}},[t._v("\n                    金额\n                  ")]),i("el-col",{attrs:{span:3}},[t._v("\n                    本币金额\n                  ")])],1)],1),i("div",{staticStyle:{width:"60px"}},[i("div",{staticClass:"details-table-header"},[t._v("\n                  操作\n                ")])])]),i("div",t._l(e.items,function(a,r){return i("div",{key:a.id,staticClass:"details-table-body"},[i("div",{staticStyle:{flex:"1"}},[i("el-row",{staticClass:"details-row",attrs:{gutter:10}},[i("el-col",{attrs:{span:12}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small",filterable:""},on:{focus:t.getCostitemList,change:function(e){return t.costitemChange(e,a)}},model:{value:a.costitemId,callback:function(e){t.$set(a,"costitemId",e)},expression:"itemD.costitemId"}},t._l(t.projectData,function(t){return i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),i("el-col",{attrs:{span:3}},[i("el-input-number",{staticClass:"input-number-valiate",attrs:{controls:!1,placeholder:"请输入",size:"small",min:-99999999,max:99999999},on:{change:function(i){return t.handleChange(e,a,r)}},model:{value:a.quantity,callback:function(e){t.$set(a,"quantity",e)},expression:"itemD.quantity"}})],1),i("el-col",{attrs:{span:3}},[i("el-input-number",{staticClass:"input-number-valiate",attrs:{controls:!1,placeholder:"请输入",size:"small",min:-99999999,max:99999999},on:{change:function(i){return t.handleChange(e,a,r)}},model:{value:a.price,callback:function(e){t.$set(a,"price",e)},expression:"itemD.price"}})],1),i("el-col",{attrs:{span:3}},[i("span",[t._v("\n                        "+t._s(a.amount||"--")+"\n                      ")])]),i("el-col",{attrs:{span:3}},[i("span",[t._v("\n                        "+t._s(a.selfAmount||"--")+"\n                      ")])])],1),i("el-row",{staticClass:"details-row",attrs:{gutter:10}},[i("el-col",{staticStyle:{"padding-top":"4px"},attrs:{span:18}},[i("el-input",{attrs:{type:"textarea",rows:2,size:"small",placeholder:"说明",clearable:""},model:{value:a.itemDesc,callback:function(e){t.$set(a,"itemDesc",e)},expression:"itemD.itemDesc"}})],1)],1)],1),i("div",{staticStyle:{width:"60px"}},[e.isEdit?i("el-button",{staticStyle:{color:"#f56c6c"},attrs:{type:"text"},on:{click:function(i){return t.handleDelete(e,a)}}},[t._v("\n                    删除\n                  ")]):t._e()],1)])}),0)]):i("div",{staticStyle:{width:"100%",padding:"10px 16px"}},[i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap"}},[i("div",{staticStyle:{flex:"1"}},[i("el-row",{staticClass:"details-table-header details-row",attrs:{gutter:10}},[i("el-col",{attrs:{span:6}},[t._v("\n                    成本项目\n                  ")]),i("el-col",{attrs:{span:6}},[t._v("\n                    说明\n                  ")]),i("el-col",{attrs:{span:3}},[t._v("\n                    数量\n                  ")]),i("el-col",{attrs:{span:3}},[t._v("\n                    单价\n                  ")]),i("el-col",{attrs:{span:3}},[t._v("\n                    金额\n                  ")]),i("el-col",{attrs:{span:3}},[t._v("\n                    本币金额\n                  ")])],1)],1),i("div",{staticStyle:{width:"60px"}},[i("div",{staticClass:"details-table-header"},[t._v("\n                  操作\n                ")])])]),i("div",t._l(e.items,function(a){return i("div",{key:a.id,staticClass:"details-table-body"},[i("div",{staticStyle:{flex:"1"}},[i("el-row",{staticClass:"details-row",attrs:{gutter:10}},[i("el-col",{attrs:{span:6}},[i("span",[t._v("\n                        "+t._s(a.costitemName)+"\n                      ")])]),i("el-col",{attrs:{span:6}},[i("div",{staticStyle:{"font-size":"12px",color:"#303133",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},[t._v("\n                        "+t._s(a.itemDesc)+"\n                      ")])]),i("el-col",{attrs:{span:3}},[i("span",[t._v("\n                        "+t._s(a.quantity)+"\n                      ")])]),i("el-col",{attrs:{span:3}},[i("span",[t._v("\n                        "+t._s(a.price)+"\n                      ")])]),i("el-col",{attrs:{span:3}},[i("span",[t._v("\n                        "+t._s(a.amount)+"\n                      ")])]),i("el-col",{attrs:{span:3}},[i("span",[t._v("\n                        "+t._s(a.selfAmount)+"\n                      ")])])],1)],1),i("div",{staticStyle:{width:"60px"}},[e.isEdit?i("el-button",{staticStyle:{color:"#f56c6c"},attrs:{type:"text"},on:{click:function(i){return t.handleDelete(e,a)}}},[t._v("\n                    删除\n                  ")]):t._e()],1)])}),0)]),e.isEdit?i("el-button",{staticStyle:{"margin-left":"16px"},attrs:{icon:"el-icon-circle-plus-outline",type:"primary",size:"small"},on:{click:function(i){return t.addCostitem(e)}}},[t._v("\n            新增明细行\n          ")]):t._e()],1)])],1)}),0===t.invoiceList.length?i("div",{staticStyle:{"font-size":"14px",color:"#5e6d82","text-align":"center",padding:"10px"}},[t._v("\n      暂无数据\n    ")]):t._e()],2),i("el-dialog",{attrs:{title:"发票审核",visible:t.visible,"close-on-click-modal":!1,width:"500px"},on:{"update:visible":function(e){t.visible=e}}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.dialogLoading,expression:"dialogLoading"}]},[i("el-form",{ref:"auditForm",attrs:{model:t.auditForm,"label-width":"50px",size:"small"}},[i("el-form-item",{attrs:{label:"审核",prop:"status"}},[i("el-radio-group",{model:{value:t.auditForm.status,callback:function(e){t.$set(t.auditForm,"status",e)},expression:"auditForm.status"}},[i("el-radio",{attrs:{label:"1"}},[t._v("\n              通过\n            ")]),i("el-radio",{attrs:{label:"2"}},[t._v("\n              拒绝\n            ")])],1)],1)],1),i("div",{staticStyle:{"text-align":"right","padding-top":"10px"}},[i("el-button",{attrs:{size:"small",disabled:t.dialogLoading},on:{click:t.cancelAudit}},[t._v("\n          取 消\n        ")]),i("el-button",{attrs:{type:"primary",size:"small",disabled:t.dialogLoading},on:{click:t.confirmAudit}},[t._v("\n          确 定\n        ")])],1)],1)])],1)},E=[],P=(i("ac4d"),i("8a81"),i("75fc")),z=(i("6b54"),i("7dfc"));function R(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)}return i}function M(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?R(i,!0).forEach(function(e){Object(n["a"])(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):R(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var B=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.service={id:"06",name:"拖车"},t.rowDetail={},t.orderCustomer={},t.loading=!1,t.visible=!1,t.dialogLoading=!1,t.invoiceList=[],t.invoiceTypeList=[{label:"订单发票",value:"1"},{label:"冲红发票",value:"2"}],t.currencyList=[],t.projectData=[],t.whiteCountryList=[{countryId:"CN",currencyId:"RMB"}],t.editRow={},t.auditForm={id:"",status:"",note:""},t.selfCurrency={currencyId:"",currencyName:""},t}return Object(d["a"])(e,t),Object(l["a"])(e,[{key:"goBack",value:function(){this.orderCustomer={},this.rowDetail={},this.invoiceList=[],this.currencyList=[],this.projectData=[],this.editRow={},this.auditForm={id:"",status:"",note:""},this.selfCurrency={currencyId:"",currencyName:""},this.$emit("back")}},{key:"show",value:function(t){this.rowDetail=t,this.getInvoiceList(),this.getCurrencyList(),this.getCostitemList(),this.getSelfCurrency(),this.getCustType()}},{key:"getCustType",value:function(){var t=this;Object(z["u"])([this.rowDetail.custId]).then(function(e){var i=e.data||[];t.orderCustomer=i[0]||{}}).catch(function(){t.orderCustomer={}})}},{key:"cancelInvoice",value:function(t){var e=this;t.isAdd?this.invoiceList=this.invoiceList.filter(function(t){return!t.isAdd}):this.invoiceList=this.invoiceList.filter(function(t){return!t.isAdd}).map(function(t){var i=M({},t);return i.isEdit=!1,i.isOpen=!1,i.items=[],e.editRow.id===i.id&&(i=M({},e.editRow),i.isEdit=!1,i.isOpen=!0),i})}},{key:"addInvoice",value:function(){var t=this;if(this.invoiceList.some(function(t){return t.isEdit}))this.$confirm("您有修改未保存请问是否保存？","提示",{cancelButtonText:"否",confirmButtonText:"是"}).then(function(){var e=t.invoiceList.find(function(t){return t.isEdit});e?t.saveInvoice(e):(t.invoiceList=t.invoiceList.filter(function(t){return!t.isAdd}).map(function(e){var i=M({},e);return t.editRow.id===i.id&&(i=M({},t.editRow)),i.isEdit=!1,i.isOpen=!1,i.items=[],i}),t.editRow={})}).catch(function(){t.invoiceList=t.invoiceList.filter(function(t){return!t.isAdd}).map(function(e){var i=M({},e);return t.editRow.id===i.id&&(i=M({},t.editRow)),i.isEdit=!1,i.isOpen=!1,i.items=[],i}),t.editRow={};var e=t.getInvoiceItem();t.invoiceList.push(e),t.currencyChange("RMB",e)});else{this.invoiceList=this.invoiceList.filter(function(t){return!t.isAdd}).map(function(t){return t.isEdit=!1,t.isOpen=!1,t.items=[],t});var e=this.getInvoiceItem();this.invoiceList.push(e),this.currencyChange("RMB",e),this.editRow={}}}},{key:"getUId",value:function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.substr(e.lastIndexOf("/")+1)}},{key:"validateData",value:function(t){if(!t.invDate)return this.$message.error("发票日期不能为空"),!1;if(!t.invoiceType)return this.$message.error("发票类型不能为空"),!1;if(!t.currencyId)return this.$message.error("发票货币不能为空"),!1;if(!t.exRate)return this.$message.error("汇率不能为空"),!1;if(0===t.items.length)return this.$message.error("发票明细行不能为空"),!1;for(var e=!0,i=0;i<t.items.length;i++){var a=t.items[i];if(!a.costitemId){this.$message.error("第".concat(i+1,"明细行项目不能为空")),e=!1;break}if(!a.itemDesc){this.$message.error("第".concat(i+1,"明细行说明不能为空")),e=!1;break}if(!a.quantity&&0!==a.quantity){this.$message.error("第".concat(i+1,"明细行数量不能为空")),e=!1;break}if(!a.price&&0!==a.price){this.$message.error("第".concat(i+1,"明细行单价不能为空")),e=!1;break}}return e}},{key:"saveInvoice",value:function(t){var e=this;if(this.validateData(t)){var i=M({},t);delete i.isOpen,delete i.isEdit,delete i.isAdd,this.editRow.id||delete i.id,i.items=i.items.map(function(t){return e.editRow.id||(delete t.id,delete t.invoiceId),t.isAdd&&delete t.id,delete t.isAdd,t}),this.loading=!0,this.editRow.id?Object(z["Y"])(i).then(function(){e.loading=!1,e.getInvoiceList(t.id),e.$message.success("添加成功"),e.editRow={}}).catch(function(){e.loading=!1}):Object(z["X"])(i).then(function(){e.loading=!1,e.getInvoiceList(t.id),e.$message.success("添加成功"),e.editRow={}}).catch(function(){e.loading=!1})}}},{key:"addCostitem",value:function(t){var e=this;this.invoiceList=this.invoiceList.map(function(i){return i.id===t.id&&(i.items=[].concat(Object(P["a"])(i.items),[e.getCostitem(t)])),i})}},{key:"getCostitem",value:function(t){return{id:this.getUId(),invoiceId:t.id,costitemId:"",costitemName:"",itemDesc:"",quantity:"",price:"",amount:"",selfAmount:"",isAdd:!0}}},{key:"getInvoiceItem",value:function(){var t={serviceSubtypeId:this.rowDetail.type,currencyId:"RMB",currencyName:"人民币",selfId:this.selfCurrency.currencyId,selfName:this.selfCurrency.currencyName,selfAmount:"",exRate:"",amount:"",agentId:this.rowDetail.parentId,agentName:this.rowDetail.parentName,clientId:this.rowDetail.custId,clientName:this.rowDetail.custName,serviceTypeId:this.service.id,serviceTypeName:this.service.name,invoiceType:"",orderId:this.rowDetail.id,orderCode:this.rowDetail.soCodes[0],invDate:g()().format("YYYY-MM-DD HH:mm:ss"),remark:"",clientProperty:this.orderCustomer.type+(this.orderCustomer.subtype?"-"+this.orderCustomer.subtype:""),status:"0",items:[],isOpen:!0,isEdit:!0,isAdd:!0};return t.items=[this.getCostitem(t)],t}},{key:"handleDelete",value:function(t,e){this.invoiceList=this.invoiceList.map(function(i){return i.id===t.id&&(i.items=i.items.filter(function(t){return t.id!==e.id}),i.amount=i.items.reduce(function(t,e){return parseFloat((t+e.amount).toFixed(2))},0),i.selfAmount=i.items.reduce(function(t,e){return parseFloat((t+e.selfAmount).toFixed(2))},0)),i})}},{key:"handleChange",value:function(t,e,i){var a=this;this.invoiceList=this.invoiceList.map(function(r){return r.id===t.id&&(r.items=r.items.map(function(r,n){return n===i&&(r.amount=parseFloat(((e.quantity||0)*(e.price||0)).toFixed(2)),r.selfAmount=a.calculateSelfTotalPrice(t.currencyId,t.selfId,r.amount,t.exRate)),r}),r.amount=r.items.reduce(function(t,e){return parseFloat((t+e.amount).toFixed(2))},0),r.selfAmount=r.items.reduce(function(t,e){return parseFloat((t+e.selfAmount).toFixed(2))},0)),r})}},{key:"costitemChange",value:function(t,e){e.costitemName="";var i=this.projectData.find(function(e){return e.id===t});i&&(e.costitemName=i.name)}},{key:"calculateTotalPrice",value:function(t){var e=this;this.invoiceList=this.invoiceList.map(function(i){return i.id===t.id&&(i.items=i.items.map(function(t,a){return t.selfAmount=e.calculateSelfTotalPrice(i.currencyId,i.selfId,t.amount,i.exRate),t}),i.selfAmount=e.calculateSelfTotalPrice(t.currencyId,t.selfId,t.amount,t.exRate)),i})}},{key:"calculateSelfTotalPrice",value:function(t,e,i,a){return t===e?i:a?parseFloat((i*a).toFixed(2)):i}},{key:"currencyChange",value:function(t,e){var i=this,a=this.currencyList.find(function(e){return e.id===t});if(a)if(e.currencyName=a.name,e.selfId===t)e.exRate=1,this.calculateTotalPrice(e);else{var r={c1:e.selfId,c2:t};e.exRate="",Object(z["x"])(r).then(function(a){var r=(a.data||[]).filter(function(i){return i.lcId===t&&i.fcId===e.selfId}).sort(function(t,e){return g()(e.updateTime).diff(g()(t.updateTime),"second")});if(r.length){var n=!0,s=!1,o=void 0;try{for(var l,c=r[Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var u=l.value;if(g()().diff(g()(u.effective),"second")>0){e.exRate=u.rate;break}}}catch(d){s=!0,o=d}finally{try{n||null==c.return||c.return()}finally{if(s)throw o}}e.exRate?i.calculateTotalPrice(e):i.$message.error("系统暂无汇率，请联系管理员或手动输入")}else i.$message.error("系统暂无汇率，请联系管理员或手动输入")}).catch(function(t){return t})}else e.currencyName="",e.exRate="",this.calculateTotalPrice(e)}},{key:"getSelfCurrency",value:function(){this.selfCurrency={currencyId:"RMB",currencyName:"人民币"}}},{key:"cancelAudit",value:function(){this.visible=!1,this.auditForm={id:"",status:"",note:""}}},{key:"confirmAudit",value:function(){var t=this,e=M({},this.auditForm);this.dialogLoading=!0,Object(z["f"])(e).then(function(){t.$message.success("操作成功"),t.dialogLoading=!1,t.getInvoiceList(t.auditForm.id),t.cancelAudit()}).catch(function(){t.dialogLoading=!1})}},{key:"auditInvoice",value:function(t){var e=this;if("0"===t.status){var i={id:t.id,status:"3",note:""};this.loading=!0,Object(z["f"])(i).then(function(){e.loading=!1,t.status="3",e.visible=!0,e.auditForm={id:t.id,status:"1",note:""}}).catch(function(t){return e.loading=!1,t})}else this.visible=!0,this.auditForm={id:t.id,status:"1",note:""}}},{key:"editRowClick",value:function(t){this.editRow=JSON.parse(JSON.stringify(t)),t.isEdit=!0}},{key:"getCurrencyList",value:function(){var t=this;this.currencyList.length||Object(z["t"])().then(function(e){var i=e.data||{};t.currencyList=i.result||[]}).catch(function(e){return t.currencyList=[],e})}},{key:"getCostitemList",value:function(){var t=this;if(!this.projectData.length){var e={name:"",serviceTypeId:this.service.id,typeId:this.rowDetail.type,page:1,size:9999};Object(z["s"])(e).then(function(e){var i=e.data||{};t.projectData=i.result||[]}).catch(function(e){return t.projectData=[],e})}}},{key:"showDetails",value:function(t){var e=this;this.invoiceList.some(function(t){return t.isEdit})?this.$confirm("您有修改未保存请问是否保存？","提示",{cancelButtonText:"否",confirmButtonText:"是"}).then(function(){e.saveInvoice(t)}).catch(function(){e.getInvoiceById(t)}):this.getInvoiceById(t)}},{key:"getInvoiceById",value:function(t){var e=this,i=t.isOpen;if(i)return this.invoiceList=this.invoiceList.filter(function(t){return!t.isAdd}).map(function(t){var i=M({},t);return e.editRow.id===i.id&&(i=M({},e.editRow)),i.isEdit=!1,i.isOpen=!1,i.items=[],i}),void(this.editRow={});this.loading=!0,Object(z["A"])({id:t.id}).then(function(i){e.loading=!1;var a=i.data||{};e.invoiceList=e.invoiceList.filter(function(t){return!t.isAdd}).map(function(i){var r=M({},i);return e.editRow.id===r.id&&(r=M({},e.editRow)),r.isEdit=!1,r.isOpen=!1,r.items=[],r.id===t.id&&(r.isOpen=!0,r.items=(a.items||[]).map(function(t){return M({},t,{isAdd:!1})})),r}),e.editRow={}}).catch(function(){e.loading=!1})}},{key:"getInvoiceList",value:function(t){var e=this,i={orderId:this.rowDetail.id,enterpriseId:[this.rowDetail.parentId],serviceTypeId:this.service.id};this.loading=!0,Object(z["E"])(i).then(function(i){e.loading=!1,e.invoiceList=(i.data||[]).map(function(i){var a=M({items:[]},i,{isOpen:!1,isEdit:!1,isAdd:!1});return a.id===t&&e.getInvoiceById(a),a})}).catch(function(){e.loading=!1})}},{key:"formatterCutoffTime",value:function(t){var e=t.cutoffTime;if(!e)return 0;if(g()(e).format("YYYY-MM-DD")===g()().format("YYYY-MM-DD"))return 0;var i=g()().diff(e,"day")+1;return i>0&&0===t.ifVerify?i:0}},{key:"userCountryId",get:function(){var t=f["a"].info||{};return t.countryId}},{key:"custType",get:function(){var t=f["a"].info||{};return t.custType}}]),e}(m["e"]);B=p["a"]([Object(m["a"])({name:"order-financial",components:{}})],B);var V=B,Y=V,U=(i("d982"),Object(x["a"])(Y,A,E,!1,null,"1cf7efcc",null)),q=U.exports;function H(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)}return i}function J(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?H(i,!0).forEach(function(e){Object(n["a"])(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):H(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var Q=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(c["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.detailShow="i",t.loading=!1,t.formLoading=!1,t.isSupperierVisible=!1,t.selectLoading=!1,t.isEdit=!1,t.companyTypeList=[{id:"1",name:"客户"},{id:"2",name:"二级代理商"}],t.orderTypeList=[{name:"销售订单",id:"0"},{name:"采购订单",id:"1"}],t.typeList=[{name:"进口拖车",id:0},{name:"出口拖车",id:1}],t.portList=[],t.companyList=[],t.selectType="1",t.tableData=[],t.statusList=[{value:0,label:"待分配"},{value:1,label:"部分已分配"},{value:2,label:"分配完成"}],t.auditList=[{value:0,label:"待审核"},{value:1,label:"审核通过"},{value:2,label:"审核拒绝"},{value:3,label:"审核中"}],t.searchForm={status:void 0,soCodes:void 0,type:void 0,custId:void 0,outTime:[],exportId:void 0,comId:void 0,comType:"",orderType:"1",inTime:[],createTime:[]},t.title="",t.customsId="",t.page=1,t.size=10,t.total=0,t.supperierForm={supplyId:void 0,name:void 0,type:"1"},t.rules={type:{required:!0,message:"请选择指派方式",trigger:"change"},supplyId:{required:!0,message:"请选择报关行",trigger:"change"}},t.supplierList=[],t}return Object(d["a"])(e,t),Object(l["a"])(e,[{key:"showFinancial",value:function(t){if(t.sellerId)if(t.soCodes&&0!==t.soCodes.length){this.detailShow="f";var e=this.$refs.financial;e.show(t)}else this.$message.warning("暂无SO");else this.$message.warning("请指定供应商")}},{key:"allocationCar",value:function(t){this.detailShow="c";var e=this.$refs.car;e.show(t)}},{key:"onOrderType",value:function(){this.tableData=[],"1"===this.searchForm.orderType&&(this.searchForm.comType="",this.searchForm.comId="",this.companyList=[]),this.getTableData(1)}},{key:"onComType",value:function(){this.searchForm.comId="",this.companyList=[],this.tableData=[]}},{key:"onCompany",value:function(){this.tableData=[],this.getTableData(1)}},{key:"getCompanyList",value:function(){var t=this,e={page:1,size:9999},i=this.custType,a=this.custSubtype,r=null;if("2"!==i||"1"!==this.searchForm.comType&&"2"!==a)if("2"===i&&"2"===this.searchForm.comType)e.parentId=this.custId,e.subtype="2",e.types="06",r=v["i"];else{if("0"!==i)return void(this.companyList=[]);e.parentId=this.custId,e.subtype="1",e.types="06",r=v["i"]}else e.custIds=[this.custId],r=v["m"];this.selectLoading=!0,r(e).then(function(e){if("2"!==i||"1"!==t.searchForm.comType&&"2"!==a){var r=e.data||{};t.companyList=r.result||[]}else{var n=e.data||[];t.companyList=n}t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"getPortList",value:function(){var t=this;this.selectLoading=!0,Object(v["p"])({page:1,size:9999}).then(function(e){var i=e.data||{};t.portList=i.result||[],t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"onSupperType",value:function(){this.supperierForm.supplyId=void 0}},{key:"getCustTypeList",value:function(){var t=this,e={page:1,size:9999,cas:"S",typeId:"06",subtypeId:this.supperierForm.subtypeId};return Object(v["l"])(e).then(function(e){var i=e.data||{},a=i.result||[];t.supplierList=JSON.parse(JSON.stringify(a).replace(/custName/g,"name").replace(/custId/g,"id"))}).catch(function(t){return t})}},{key:"viewSupperier",value:function(t){this.isSupperierVisible=!0,this.supperierForm.declareId=t.id,this.supperierForm.subtypeId=t.type}},{key:"confirmSupperier",value:function(t){var e=this,i=this.$refs.supperierForm;i.validate(function(t){if(!t)return!1;e.formLoading=!1,Object(v["q"])(e.supperierForm).then(function(t){e.$message({type:"success",message:"保存成功"}),e.formLoading=!1,e.isSupperierVisible=!1,e.getTableData()}).catch(function(t){return e.formLoading=!1,t})})}},{key:"cancelSupperier",value:function(){this.isSupperierVisible=!1,this.resetSupperierForm()}},{key:"resetSupperierForm",value:function(){this.supperierForm={supplyId:void 0,type:"1"};var t=this.$refs.supperierForm;t.clearValidate()}},{key:"viewData",value:function(t){this.detailShow="d";var e=this.$refs.detailForm;e.setData(t)}},{key:"deleteData",value:function(t){var e=this,i={id:t.id};this.$confirm("请确认是否删除该条数据?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){var t=null;t=v["g"],t&&t(i).then(function(t){e.$message({type:"success",message:"删除成功"}),e.getTableData()}).catch(function(t){return t})}).catch(function(){return!1})}},{key:"getTableData",value:function(t){var e=this;this.loading=!0;var i=this.custType;"1"===i?this.searchForm.orderType="1":"3"===i&&(this.searchForm.orderType="0");var a=this.searchForm,r=a.comId,n=(a.comType,a.orderType),o=a.createTime,l=a.custId,c=a.inTime,u=a.outTime,d=(a.code,Object(s["a"])(a,["comId","comType","orderType","createTime","custId","inTime","outTime","code"]));t&&(this.page=t);var p={page:this.page,size:this.size,model:J({},d)};"0"===n?(p.model.sellerId=l,p.model.customerId="3"===i?"0":r):"1"===n&&(p.model.customerId=l),Array.isArray(u)&&u.length>0&&(p.model.pikeStartTime=u[0]+" 00:00:00",p.model.pikeEndTime=u[1]+" 23:59:59"),Array.isArray(c)&&c.length>0&&(p.model.warehouseStartTime=c[0]+" 00:00:00",p.model.warehouseEndTime=c[1]+" 23:59:59"),Array.isArray(o)&&o.length>0&&(p.model.startTime=o[0]+" 00:00:00",p.model.endTime=o[1]+" 23:59:59"),Object(v["o"])(p).then(function(t){var i=t.data||{};e.tableData=i.result||[],e.total=i.total,e.loading=!1}).catch(function(t){return e.loading=!1,t})}},{key:"handleSizeChange",value:function(t){this.size=Number(t),this.getTableData()}},{key:"handleCurrentChange",value:function(t){this.page=Number(t),this.getTableData()}},{key:"created",value:function(){this.searchForm.custId=this.custId,this.searchForm.createTime=[g()().subtract(30,"d").format("YYYY-MM-DD"),g()().format("YYYY-MM-DD")],this.getTableData()}},{key:"custId",get:function(){var t=f["a"].info||{},e=t.custId;return e}},{key:"custType",get:function(){var t=f["a"].info||{},e=t.custType;return e}},{key:"custSubtype",get:function(){var t=f["a"].info||{},e=t.custSubtype;return e}},{key:"parentId",get:function(){var t=f["a"].info||{},e=t.parentId;return e}},{key:"parentName",get:function(){var t=f["a"].info||{},e=t.parentName;return e}}]),e}(m["e"]);Q=p["a"]([Object(m["a"])({name:"",components:{detail:C,car:$,orderFinancial:q},props:{}})],Q);var W=Q,X=W,G=Object(x["a"])(X,a,r,!1,null,"085dcb06",null);e["default"]=G.exports},"510f":function(t,e,i){"use strict";var a=i("387b"),r=i.n(a);r.a},"5c49":function(t,e,i){"use strict";i.d(e,"p",function(){return r}),i.d(e,"i",function(){return n}),i.d(e,"m",function(){return s}),i.d(e,"o",function(){return o}),i.d(e,"n",function(){return l}),i.d(e,"g",function(){return c}),i.d(e,"l",function(){return u}),i.d(e,"q",function(){return d}),i.d(e,"k",function(){return p}),i.d(e,"r",function(){return m}),i.d(e,"b",function(){return f}),i.d(e,"j",function(){return v}),i.d(e,"s",function(){return h}),i.d(e,"f",function(){return y}),i.d(e,"a",function(){return b}),i.d(e,"h",function(){return g}),i.d(e,"e",function(){return w}),i.d(e,"c",function(){return _}),i.d(e,"d",function(){return k});var a=i("b32d");function r(t){var e={url:"/setting/ports/getPortList",method:"get",params:t};return Object(a["a"])(e)}function n(t){var e={url:"/auth/agent/getAgentList",method:"get",params:t};return Object(a["a"])(e)}function s(t){var e={url:"/auth/customer/customer",method:"post",data:t};return Object(a["a"])(e)}function o(t){var e={url:"/orders/trailer/page",method:"post",data:t};return Object(a["a"])(e)}function l(t){var e={url:"/orders/trailer/details",method:"post",params:t};return Object(a["a"])(e)}function c(t){var e={url:"",method:"delete",params:t};return Object(a["a"])(e)}function u(t){var e={url:"/auth/custtype/getCustTypeList",method:"get",params:t};return Object(a["a"])(e)}function d(t){var e={url:"",method:"post",params:t};return Object(a["a"])(e)}function p(t){var e={url:"/orders/trailer/get_container",method:"post",params:t};return Object(a["a"])(e)}function m(t){var e={url:"/orders/trailer/up_container",method:"post",params:t};return Object(a["a"])(e)}function f(t){var e={url:"/orders/trailer/assign_driver",method:"post",data:t};return Object(a["a"])(e)}function v(t){var e={url:"/orders/trailer/get_car",method:"get",params:t};return Object(a["a"])(e)}function h(t){var e={url:"/wms/aliyun/oss/upload",method:"post",data:t};return Object(a["a"])(e)}function y(t){var e={url:"/wms/aliyun/oss/del",method:"post",data:t};return Object(a["a"])(e)}function b(t){var e={url:"/orders/trailer/save_cost",method:"post",data:t};return Object(a["a"])(e)}function g(t){var e={url:"/orders/trailer/edit_cost",method:"post",data:t};return Object(a["a"])(e)}function w(t){var e={url:"/orders/trailer/delete_cost",method:"post",params:t};return Object(a["a"])(e)}function _(t){var e={url:"/orders/trailer/audit_cost",method:"post",params:t};return Object(a["a"])(e)}function k(t){var e={url:"/orders/trailer/commit_cost",method:"post",params:t};return Object(a["a"])(e)}},"605b":function(t,e,i){"use strict";var a=i("ae19"),r=i.n(a);r.a},"7dfc":function(t,e,i){"use strict";i.d(e,"Q",function(){return o}),i.d(e,"o",function(){return l}),i.d(e,"p",function(){return c}),i.d(e,"U",function(){return u}),i.d(e,"W",function(){return d}),i.d(e,"V",function(){return p}),i.d(e,"s",function(){return m}),i.d(e,"t",function(){return f}),i.d(e,"D",function(){return v}),i.d(e,"E",function(){return h}),i.d(e,"A",function(){return y}),i.d(e,"h",function(){return b}),i.d(e,"X",function(){return g}),i.d(e,"Y",function(){return w}),i.d(e,"B",function(){return _}),i.d(e,"C",function(){return k}),i.d(e,"H",function(){return x}),i.d(e,"G",function(){return O}),i.d(e,"i",function(){return C}),i.d(e,"a",function(){return S}),i.d(e,"l",function(){return j}),i.d(e,"x",function(){return L}),i.d(e,"M",function(){return I}),i.d(e,"J",function(){return T}),i.d(e,"I",function(){return F}),i.d(e,"K",function(){return D}),i.d(e,"b",function(){return N}),i.d(e,"m",function(){return $}),i.d(e,"j",function(){return A}),i.d(e,"q",function(){return E}),i.d(e,"L",function(){return P}),i.d(e,"P",function(){return z}),i.d(e,"N",function(){return R}),i.d(e,"O",function(){return M}),i.d(e,"k",function(){return B}),i.d(e,"c",function(){return V}),i.d(e,"n",function(){return Y}),i.d(e,"v",function(){return U}),i.d(e,"f",function(){return q}),i.d(e,"e",function(){return H}),i.d(e,"d",function(){return J}),i.d(e,"g",function(){return Q}),i.d(e,"z",function(){return W}),i.d(e,"w",function(){return X}),i.d(e,"r",function(){return G}),i.d(e,"R",function(){return K}),i.d(e,"y",function(){return Z}),i.d(e,"S",function(){return tt}),i.d(e,"F",function(){return et}),i.d(e,"T",function(){return it}),i.d(e,"u",function(){return at});i("8e6e"),i("ac6a"),i("456d");var a=i("bd86"),r=i("b32d");function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,a)}return i}function s(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(i,!0).forEach(function(e){Object(a["a"])(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function o(t){var e={url:"/auth/supplier/getSupplierList",method:"get",params:t};return Object(r["a"])(e)}function l(t){var e={url:"/auth/agent/getAgentList",method:"get",params:t};return Object(r["a"])(e)}function c(t){var e={url:"/cfg/type/getServiceTypeList",method:"get",params:t};return Object(r["a"])(e)}function u(t){var e={url:"/auth/custtype/getServerType",method:"get",params:t};return Object(r["a"])(e)}function d(t){var e={url:"/finance/account/rollback",method:"get",params:t};return Object(r["a"])(e)}function p(t){var e={url:"/orders/worder/getOrderList",method:"post",data:t};return Object(r["a"])(e)}function m(t){var e={url:"/finance/costitem/getCostitemList",method:"get",params:t};return Object(r["a"])(e)}function f(t){var e={url:"/setting/currency/getCurrencyList",method:"get",params:s({page:1,size:999},t)};return Object(r["a"])(e)}function v(t){var e={url:"/finance/account/page",method:"post",data:t};return Object(r["a"])(e)}function h(t){var e={url:"finance/account/order_invoice",method:"post",data:t};return Object(r["a"])(e)}function y(t){var e={url:"/finance/account/getInvoice",method:"get",params:t};return Object(r["a"])(e)}function b(t){var e={url:"/finance/account/deleteInvoice",method:"post",params:t};return Object(r["a"])(e)}function g(t){var e={url:"/finance/account/saveInvoice",method:"post",data:t};return Object(r["a"])(e)}function w(t){var e={url:"/finance/account/updateInvoice",method:"post",data:t};return Object(r["a"])(e)}function _(t){var e={url:"/finance/account/exportAll",method:"post",responseType:"blob",data:t};return Object(r["a"])(e)}function k(t){var e={url:"/finance/account/export2",method:"post",responseType:"blob",data:t};return Object(r["a"])(e)}function x(t){var e={url:"/finance/p/page",method:"post",data:t};return Object(r["a"])(e)}function O(t){var e={url:"/finance/p/get",method:"get",params:t};return Object(r["a"])(e)}function C(t){var e={url:"/auth/p/del",method:"delete",params:t};return Object(r["a"])(e)}function S(t){var e={url:"/finance/p/add",method:"post",data:t};return Object(r["a"])(e)}function j(t){var e={url:"/finance/p/edit",method:"post",data:t};return Object(r["a"])(e)}function L(t){var e={url:"/setting/exchange/rate",method:"get",params:t};return Object(r["a"])(e)}function I(t){var e={url:"/finance/r/page",method:"post",data:t};return Object(r["a"])(e)}function T(t){var e={url:"/finance/account/query",method:"post",data:t};return Object(r["a"])(e)}function F(t){var e={url:"/finance/r/payback",method:"get",params:t};return Object(r["a"])(e)}function D(t){var e={url:"/finance/r/info",method:"get",params:t};return Object(r["a"])(e)}function N(t){var e={url:"/finance/r/add",method:"post",data:t};return Object(r["a"])(e)}function $(t){var e={url:"/finance/r/edit",method:"post",data:t};return Object(r["a"])(e)}function A(t){var e={url:"/auth/r/del",method:"delete",params:t};return Object(r["a"])(e)}function E(t){var e={url:"/auth/acct/getAcctList",method:"get",params:t};return Object(r["a"])(e)}function P(t){var e={url:"/finance/r/export",method:"post",responseType:"blob",data:t};return Object(r["a"])(e)}function z(t){var e={url:"/finance/apply/page",method:"post",data:t};return Object(r["a"])(e)}function R(t){var e={url:"/finance/account/handel",method:"post",data:t};return Object(r["a"])(e)}function M(t){var e={url:"/finance/apply/get",method:"get",params:t};return Object(r["a"])(e)}function B(t){var e={url:"/auth/apply/del",method:"delete",params:t};return Object(r["a"])(e)}function V(t){var e={url:"/finance/apply/add",method:"post",data:t};return Object(r["a"])(e)}function Y(t){var e={url:"/finance/apply/edit",method:"post",data:t};return Object(r["a"])(e)}function U(t){var e={url:"/auth/customer/customer",method:"post",data:t};return Object(r["a"])(e)}function q(t){var e={url:"/finance/account/audit",method:"get",params:t};return Object(r["a"])(e)}function H(t){var e={url:"/finance/r/audit",method:"get",params:t};return Object(r["a"])(e)}function J(t){var e={url:"/auth/apply/audit",method:"post",params:t};return Object(r["a"])(e)}function Q(t){var e={url:"/auth/p/audit",method:"post",params:t};return Object(r["a"])(e)}function W(t){var e={url:"/orders/fullorder/getOrderList",method:"post",data:t};return Object(r["a"])(e)}function X(t){var e={url:"/orders/declare_order/get_declare_data",method:"post",data:t};return Object(r["a"])(e)}function G(t){var e={url:"/orders/card/get_data",method:"post",data:t};return Object(r["a"])(e)}function K(t){var e={url:"/orders/trailer/page",method:"post",data:t};return Object(r["a"])(e)}function Z(t){var e={url:"/express/web/expressorder/list",method:"post",data:t};return Object(r["a"])(e)}function tt(){var t={url:"/auth/agent/customer_finance",method:"get"};return Object(r["a"])(t)}function et(t){var e={url:"/finance/bill/billPage",method:"post",data:t};return Object(r["a"])(e)}function it(t){var e={url:"/finance/account/unverified",method:"post",data:t};return Object(r["a"])(e)}function at(t){var e={url:"/auth/supplier/custType",method:"post",data:t};return Object(r["a"])(e)}},"894f":function(t,e,i){},ae19:function(t,e,i){},d982:function(t,e,i){"use strict";var a=i("894f"),r=i.n(a);r.a}}]);