(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["currency-management"],{1829:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","min-height":"inherit"}},[r("div",{staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[r("div",{staticClass:"app-container"},[r("head-info",{attrs:{info:"",title:"货币管理"}}),r("div",{staticClass:"app-panel"},[r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["addCurrency"],expression:"['addCurrency']"}],staticStyle:{"margin-left":"10px"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:e.addCur}},[e._v("\n          新增货币\n        ")]),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.list,height:"calc(100vh - 313px)",border:""}},[r("el-table-column",{attrs:{label:"中文名称",prop:"name"}}),r("el-table-column",{attrs:{label:"英文名称",prop:"alias"}}),r("el-table-column",{attrs:{label:"货币编码",prop:"id"}}),r("el-table-column",{attrs:{label:"货币符号",prop:"sign"}}),r("el-table-column",{attrs:{label:"通用国家","min-width":"200","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("span",[e._v(e._s(e.countryNameFilter(t.row)))])]}}])}),r("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["editCurrency"],expression:"['editCurrency']"}],attrs:{type:"text",size:"medium"},on:{click:function(r){return e.handleEditRow(t.row)}}},[e._v("\n                编辑\n              ")]),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["deleteCurrency"],expression:"['deleteCurrency']"}],attrs:{type:"text",size:"medium"},on:{click:function(r){return e.handleDeleteRow(t.row.id)}}},[e._v("\n                删除\n              ")])]}}])})],1),r("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":e.page,"page-size":e.size,layout:"total, prev, pager, next",total:e.total},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),r("el-dialog",{attrs:{title:e.title,width:"600px",visible:e.formShow,"close-on-click-modal":!1},on:{"update:visible":function(t){e.formShow=t},closed:e.handleCancel}},[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],ref:"ruleForm",staticStyle:{"padding-right":"20px"},attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px",size:"small"}},[r("el-form-item",{attrs:{label:"中文名称",prop:"name"}},[r("el-input",{ref:"firstInput",attrs:{placeholder:"请输入","show-word-limit":"",maxlength:20},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),r("el-form-item",{attrs:{label:"英文名称",prop:"alias"}},[r("el-input",{attrs:{placeholder:"请输入",maxlength:20},model:{value:e.ruleForm.alias,callback:function(t){e.$set(e.ruleForm,"alias",t)},expression:"ruleForm.alias"}})],1),r("el-form-item",{attrs:{label:"货币编码",prop:"id"}},[r("el-input",{attrs:{disabled:e.isEdit,placeholder:"请输入",maxlength:3,"show-word-limit":""},model:{value:e.ruleForm.id,callback:function(t){e.$set(e.ruleForm,"id",t)},expression:"ruleForm.id"}})],1),r("el-form-item",{attrs:{label:"货币符号",prop:"sign"}},[r("el-input",{attrs:{placeholder:"请输入",maxlength:3,"show-word-limit":""},model:{value:e.ruleForm.sign,callback:function(t){e.$set(e.ruleForm,"sign",t)},expression:"ruleForm.sign"}})],1),r("el-form-item",{attrs:{label:"通用国家",prop:"countryIds"}},[r("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"已选择("+e.ruleForm.countryIds.length+")",size:"small",disabled:""},model:{value:e.cty,callback:function(t){e.cty=t},expression:"cty"}},[r("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleCountry},slot:"append"})],1)],1)],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.handleCancel}},[e._v("\n              取 消\n            ")]),r("el-button",{attrs:{type:"primary",loading:e.formLoading},on:{click:e.handleSubmit}},[e._v("\n              确 定\n            ")])],1)],1),r("el-dialog",{attrs:{title:e.rateTitle,width:"600px",visible:e.rateDialogShow},on:{"update:visible":function(t){e.rateDialogShow=t}}},[e.rateDialogShow?r("currency-record",{attrs:{id:e.rateId}}):e._e()],1),r("el-dialog",{attrs:{title:"关联货币通用国家",visible:e.isRelateVisible,"close-on-click-modal":!1,width:"960px"},on:{"update:visible":function(t){e.isRelateVisible=t},close:e.cancelRelate}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.countryLoading,expression:"countryLoading"}]},[r("el-transfer",{ref:"transferItem",staticStyle:{height:"500px"},attrs:{filterable:"","filter-method":e.filterMethod,titles:["关联货币通用国家/地区","已选择"],props:{key:"id",label:"label"},"filter-placeholder":"输入搜索",data:e.countryList},model:{value:e.ruleForm.countryIds,callback:function(t){e.$set(e.ruleForm,"countryIds",t)},expression:"ruleForm.countryIds"}})],1),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:e.cancelRelate}},[e._v("\n              取 消\n            ")]),r("el-button",{attrs:{type:"primary"},on:{click:e.saveRelate}},[e._v("\n              确 定\n            ")])],1)])],1)],1)])])},a=[],i=(r("8e6e"),r("ac6a"),r("456d"),r("768b")),l=(r("96cf"),r("3b8d")),o=r("bd86"),s=(r("c5f6"),r("7514"),r("7f7f"),r("d225")),u=r("b0b4"),c=r("308d"),d=r("6bb5"),m=r("4e2b"),f=r("9ab4"),h=r("60a3"),p=r("ac1a"),g=r("b32d");function y(e){var t={url:"/setting/currency/getCurrencyList",method:"get",params:e};return Object(g["a"])(t)}function b(e){var t={url:"/setting/currency/addCurrency",method:"post",data:e};return Object(g["a"])(t)}function v(e){var t={url:"/setting/currency/updateCurrency",method:"post",data:e};return Object(g["a"])(t)}function w(e){var t={url:"/setting/currency/deleteCurrency",method:"delete",params:{id:e}};return Object(g["a"])(t)}function k(){var e={url:"/setting/area/getCountryList",method:"get"};return Object(g["a"])(e)}function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function C(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(r,!0).forEach(function(t){Object(o["a"])(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var O=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(c["a"])(this,Object(d["a"])(t).apply(this,arguments)),e.loading=!1,e.formShow=!1,e.formLoading=!1,e.rateDialogShow=!1,e.countryLoading=!1,e.isRelateVisible=!1,e.list=[],e.countryList=[],e.form={},e.cty="",e.ruleForm={name:"",alias:"",id:"",sign:"",countries:[],countryIds:[]},e.rules={name:[{required:!0,message:"中文名称不能为空",trigger:"blur"}],alias:[{required:!0,message:"英文名称不能为空",trigger:"blur"},{validator:function(e,t,r){var n=/[\u4e00-\u9fa5]/;t?n.test(t)?r(new Error("英文名称不能有中文")):r():r(new Error("英文名称不能为空"))},trigger:"blur"}],id:[{required:!0,message:"货币编码不能为空",trigger:"blur"},{validator:function(e,t,r){var n=/^[a-zA-Z]*$/;t?3!==t.length?r(new Error("货币编码长度为3")):n.test(t)?r():r(new Error("货币编码只能包含字母")):r(new Error("货币编码不能为空"))},trigger:"blur"}],sign:[{required:!0,message:"货币符号不能为空",trigger:"blur"},{validator:function(e,t,r){var n=/[\u4e00-\u9fa5]/;t?n.test(t)?r(new Error("货币符号不能是中文")):r():r(new Error("货币符号不能为空"))},trigger:"blur"}],countryIds:[{required:!0,message:"通用国家不能为空",trigger:"blur"}]},e.isEdit=!1,e.title="",e.rateTitle="",e.rateId="",e.page=1,e.size=10,e.total=0,e}return Object(m["a"])(t,e),Object(u["a"])(t,[{key:"created",value:function(){this.handleCurrencyList()}},{key:"getCountryList",value:function(){var e=this;this.countryLoading=!0,k().then(function(t){var r=t.data||{},n=r.result||[];e.countryList=n.map(function(e){var t=e.name,r=e.id,n=e.alias;return{id:r,name:t,alias:n,label:t+"-"+n}}),e.countryLoading=!1}).catch(function(t){return e.countryLoading=!1,t})}},{key:"handleCountry",value:function(){this.isRelateVisible=!0,this.getCountryList()}},{key:"filterMethod",value:function(e,t){var r=t.name||"";return r.indexOf(e)>-1}},{key:"cancelRelate",value:function(){this.isRelateVisible=!1;var e=this.$refs.transferItem;e.clearQuery("left"),e.clearQuery("right")}},{key:"saveRelate",value:function(){var e=this;this.cancelRelate();var t=this.ruleForm.countryIds.map(function(t){var r=(e.countryList.find(function(e){return e.id===t})||{}).label||"";return{id:t,name:r}});t.filter(function(e){return e.id&&e.name}),this.ruleForm.countries=t}},{key:"countryNameFilter",value:function(e){var t=e.countries||[];return t.map(function(e){return e.name}).join(", ")}},{key:"handleCurrencyList",value:function(){var e=this;this.loading=!0,y({page:this.page,size:this.size}).then(function(t){if(e.loading=!1,t.success){var r=t.data||{};e.list=r.result||[],e.total=r.total}}).catch(function(t){return e.loading=!1,t})}},{key:"handleSizeChange",value:function(e){this.size=Number(e),this.handleCurrencyList()}},{key:"handleCurrentChange",value:function(e){this.page=Number(e),this.handleCurrencyList()}},{key:"addCur",value:function(){var e=this;this.formShow=!0,this.title="新增货币",this.isEdit=!1,this.$nextTick(function(){var t=e.$refs.firstInput;t.focus()})}},{key:"handleEditRow",value:function(e){this.formShow=!0,this.title="编辑货币",this.ruleForm=C({},e),this.ruleForm.countryIds=(e.countries||[]).map(function(e){return e.id}),this.isEdit=!0}},{key:"handleDeleteRow",value:function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(t){var r,n,a,l,o,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r="删除货币将导致无法继续使用，确定要删除吗？",n="温馨提示",e.next=4,this.$confirm(r,n,{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(e){return[null,e]}).catch(function(e){return[e,null]});case 4:if(a=e.sent,l=Object(i["a"])(a,2),o=l[0],l[1],!o){e.next=10;break}return e.abrupt("return");case 10:w(t).then(function(e){e.success?(s.$message({type:"success",message:"删除成功!"}),s.handleCurrencyList()):s.$message({type:"error",message:e.msg})}).catch(function(e){return e});case 11:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"handleSubmit",value:function(){var e=this,t=this.$refs.ruleForm;t.validate(function(t){if(t)switch(e.formLoading=!0,e.isEdit){case!0:v(e.ruleForm).then(function(t){e.formLoading=!1,t.success?(e.formShow=!1,e.$message({type:"success",message:"编辑成功!"}),e.handleCurrencyList()):e.$message({type:"error",message:t.msg})}).catch(function(t){return e.formLoading=!1,t});break;case!1:b(e.ruleForm).then(function(t){e.formLoading=!1,t.success?(e.formShow=!1,e.$message({type:"success",message:"新增成功!"}),e.handleCurrencyList()):e.$message({type:"error",message:t.msg})}).catch(function(t){return e.formLoading=!1,t});break;default:break}})}},{key:"handleCancel",value:function(){this.formShow=!1,this.ruleForm={name:"",alias:"",id:"",sign:"",countries:[],countryIds:[]};var e=this.$refs.ruleForm;e.clearValidate()}},{key:"handleRecord",value:function(e){this.rateDialogShow=!0;var t=e.exRate,r=e.name;this.rateId=t,this.rateTitle="汇率记录-"+r}},{key:"labelPosition",get:function(){var e=p["a"].language;return e&&"en"===e?"top":"left"}},{key:"lang",get:function(){var e=p["a"].language;return e||"en"}}]),t}(h["e"]);O=f["a"]([Object(h["a"])({name:"Currency",components:{},props:{}})],O);var F=O,L=F,S=(r("8e47"),r("2877")),j=Object(S["a"])(L,n,a,!1,null,"711a5df9",null);t["default"]=j.exports},"8e47":function(e,t,r){"use strict";var n=r("b588"),a=r.n(n);a.a},b588:function(e,t,r){}}]);