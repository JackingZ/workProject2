(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["payment-order"],{1306:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","min-height":"inherit"}},[a("div",{staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.detailShow,expression:"!detailShow"}],staticClass:"app-container"},[a("head-info",{attrs:{info:"",title:"付款单"}}),a("div",{staticClass:"app-panel"},[a("el-row",[a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:24}},[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["receiptsAdd"],expression:"['receiptsAdd']"}],staticStyle:{float:"left"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:t.handleAdd}},[t._v("\n              新增付款单\n            ")]),"2"===t.custType&&"1"===t.custSubtype?a("el-select",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{size:"small",placeholder:"公司类型"},on:{change:t.onComType},model:{value:t.searchForm.comType,callback:function(e){t.$set(t.searchForm,"comType",e)},expression:"searchForm.comType"}},t._l(t.companyTypeList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1):t._e(),"2"===t.custType&&"1"===t.custSubtype&&"2"===t.searchForm.comType?a("el-select",{staticStyle:{width:"170px","margin-right":"5px"},attrs:{loading:t.selectLoading,size:"small",placeholder:"所属公司",filterable:"",clearable:""},on:{change:t.onCompany,focus:t.getCompanyList},model:{value:t.searchForm.comId,callback:function(e){t.$set(t.searchForm,"comId",e)},expression:"searchForm.comId"}},t._l(t.companyList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e(),a("el-select",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{placeholder:"状态",size:"small",clearable:""},model:{value:t.searchForm.status,callback:function(e){t.$set(t.searchForm,"status",e)},expression:"searchForm.status"}},t._l(t.statusList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1),a("el-select",{staticStyle:{width:"120px","margin-right":"5px"},attrs:{placeholder:"付款类型",size:"small",clearable:""},model:{value:t.searchForm.payType,callback:function(e){t.$set(t.searchForm,"payType",e)},expression:"searchForm.payType"}},t._l(t.categoryList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1),a("el-select",{staticStyle:{width:"120px","margin-right":"5px"},attrs:{placeholder:"付款方式",size:"small",clearable:""},model:{value:t.searchForm.payMethod,callback:function(e){t.$set(t.searchForm,"payMethod",e)},expression:"searchForm.payMethod"}},t._l(t.sourceList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1),a("el-date-picker",{staticStyle:{width:"240px","margin-right":"5px"},attrs:{type:"daterange","unlink-panels":"",align:"right",size:"small","range-separator":"~","value-format":"yyyy-MM-dd","start-placeholder":"发票起期","end-placeholder":"发票止期"},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}}),a("el-input",{staticClass:"input-with-select",staticStyle:{width:"250px","margin-right":"10px"},attrs:{placeholder:"请输入内容",size:"small",clearable:""},model:{value:t.keyWord,callback:function(e){t.keyWord=e},expression:"keyWord"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",size:"small",placeholder:"请选择"},slot:"prepend",model:{value:t.selectType,callback:function(e){t.selectType=e},expression:"selectType"}},[a("el-option",{attrs:{label:"客户名称",value:"2"}}),a("el-option",{attrs:{label:"付款单号",value:"3"}})],1)],1),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["receiptsQuery"],expression:"['receiptsQuery']"}],attrs:{type:"primary",size:"small"},on:{click:function(e){return t.handleSearch(1)}}},[t._v("\n              查询\n            ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:t.tableData,height:"calc(100vh - 313px)",border:""}},[a("el-table-column",{attrs:{fixed:"left",prop:"id",label:"付款单号",width:"150"}}),a("el-table-column",{attrs:{prop:"",label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s((t.statusList.find(function(t){return t.id===e.row.status})||{}).name)+"\n            ")]}}])}),a("el-table-column",{attrs:{prop:"payTime",label:"付款日期",width:"170"}}),a("el-table-column",{attrs:{prop:"custName",label:"客户名称",width:"150"}}),a("el-table-column",{attrs:{prop:"",label:"客户类型",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return["0"===e.row.custType?a("span",[t._v("聚货通")]):"3"===e.row.custType?a("span",[t._v("供应商")]):"2-1"===e.row.custType?a("span",[t._v("一级代理")]):"2-2"===e.row.custType?a("span",[t._v("二级代理")]):"1-0"===e.row.custType?a("span",[t._v("直客")]):"1-1"===e.row.custType?a("span",[t._v("同行")]):a("span",[t._v("--")])]}}])}),a("el-table-column",{attrs:{prop:"",label:"付款类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s((t.categoryList.find(function(t){return t.id===e.row.payType})||{}).name)+"\n            ")]}}])}),a("el-table-column",{attrs:{prop:"",label:"付款方式",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s((t.sourceList.find(function(t){return t.id===e.row.payMethod})||{}).name)+"\n            ")]}}])}),a("el-table-column",{attrs:{prop:"currencyName",label:"货币",width:"120"}}),a("el-table-column",{attrs:{prop:"payAmount",label:"金额","min-width":"120"}}),a("el-table-column",{attrs:{prop:"exRate",label:"汇率",width:"100"}}),a("el-table-column",{attrs:{prop:"selfAmount",label:"本币金额","min-width":"120"}}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[3!==e.row.status&&1!==e.row.status&&t.$checkPermission(["receiptsUpdate"])?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.handleEdit(e.row)}}},[t._v("\n                编辑\n              ")]):t._e(),1!==e.row.status&&t.$checkPermission(["receiptsDel"])?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.handleDelete(e.row.id)}}},[t._v("\n                删除\n              ")]):t._e(),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["receiptsDetail"],expression:"['receiptsDetail']"}],attrs:{type:"text"},on:{click:function(a){return t.handleDetail(e.row.id)}}},[t._v("\n                查看详情\n              ")]),1!==e.row.status&&t.$checkPermission(["paymentAudit"])?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.handleAudit(e.row,e.$index)}}},[t._v("\n                审核\n              ")]):t._e()]}}])})],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":t.page,"page-size":t.size,layout:"total, prev, pager, next",total:t.total},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.detailShow,expression:"detailShow"}],staticClass:"app-container"},[a("detail",{ref:"detailForm",attrs:{"is-edit":t.isEdit,"is-once":t.isOnce,"status-list":t.statusList,"source-list":t.sourceList,"category-list":t.categoryList},on:{back:function(e){t.detailShow=!1},getTableData:t.handleSearch}})],1),a("el-dialog",{attrs:{title:"发票审核",visible:t.dialogAudit,"close-on-click-modal":!1,width:"700px"},on:{"update:visible":function(e){t.dialogAudit=e}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.dialogLoading,expression:"dialogLoading"}]},[a("el-form",{ref:"auditForm",staticStyle:{"padding-top":"20px"},attrs:{model:t.auditForm,rules:t.auditFormRules,"label-width":"110px",size:"small"}},[a("el-form-item",{attrs:{label:"审核",prop:"status"}},[a("el-radio-group",{model:{value:t.auditForm.status,callback:function(e){t.$set(t.auditForm,"status",e)},expression:"auditForm.status"}},[a("el-radio",{attrs:{label:1}},[t._v("\n                通过\n              ")]),a("el-radio",{attrs:{label:2}},[t._v("\n                拒绝\n              ")])],1)],1)],1),a("div",{staticStyle:{"text-align":"right","padding-top":"10px"}},[a("el-button",{attrs:{size:"small"},on:{click:t.cancelAudit}},[t._v("\n            取 消\n          ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.confirmAudit}},[t._v("\n            确 定\n          ")])],1)],1)])],1)])},i=[],r=(a("8e6e"),a("ac6a"),a("456d"),a("a8db")),o=a("bd86"),s=a("d225"),c=a("b0b4"),l=a("308d"),u=a("6bb5"),d=a("4e2b"),p=a("9ab4"),m=a("60a3"),f=a("9dba"),h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.detailLoading,expression:"detailLoading"}],staticStyle:{"background-color":"#ffffff"}},[a("div",{staticStyle:{padding:"0 20px","line-height":"50px","border-bottom":"1px solid #e8e8e8"}},[a("div",{staticStyle:{"text-align":"right"}},[a("span",{staticStyle:{cursor:"pointer"},on:{click:t.handleBack}},[a("i",{staticClass:"el-icon-back"}),a("span",[t._v("返回")])])])]),a("div",{staticClass:"app-panel order-detail"},[a("el-row",{staticStyle:{"background-color":"#f2f2f2",padding:"10px"}},[a("el-col",{staticStyle:{"font-weight":"700","font-size":"18px","line-height":"30px"},attrs:{span:4}},[t._v("\n        付款单\n      ")]),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:20}},[t.isEdit?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleSave}},[t._v("\n          "+t._s(t.isOnce?"提交":"重新提交")+"\n        ")]):t._e()],1)],1),a("el-form",{ref:"editForm",class:t.isEdit?"":"view-item",staticStyle:{"padding-top":"20px"},attrs:{model:t.form,rules:t.formRules,"label-width":"110px",size:"small"}},[t.isOnce?t._e():a("el-form-item",{attrs:{label:"付款单号",prop:"id"}},[t.isEdit?a("el-input",{attrs:{maxlength:30,size:"small",placeholder:"请输入","show-word-limit":"",disabled:""},model:{value:t.form.id,callback:function(e){t.$set(t.form,"id",e)},expression:"form.id"}}):a("span",{staticClass:"number-text"},[t._v("\n          "+t._s(t.form.id)+"\n        ")])],1),t.isOnce?t._e():a("el-form-item",{attrs:{label:"状态",prop:"status"}},[t.isEdit?a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small",disabled:""},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.statusData,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1):a("span",[t._v("\n          "+t._s((t.statusData.find(function(e){return e.id===t.form.status})||{}).name)+"\n        ")])],1),a("el-form-item",{attrs:{label:"客户",prop:"custId"}},[t.isEdit?a("el-input",{attrs:{size:"small",placeholder:"请输入",disabled:""},model:{value:t.form.custName,callback:function(e){t.$set(t.form,"custName",e)},expression:"form.custName"}},[t.isOnce?a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:t.handleCustomer},slot:"append"}):t._e()],1):a("span",[t._v("\n          "+t._s(t.form.custName)+"\n        ")])],1),a("el-form-item",{attrs:{label:"付款流水号"}},[t.isEdit?a("el-input",{attrs:{maxlength:50,size:"small",placeholder:"请输入"},model:{value:t.form.serialNumber,callback:function(e){t.$set(t.form,"serialNumber",e)},expression:"form.serialNumber"}}):a("span",{staticClass:"number-text"},[t._v("\n          "+t._s(t.form.serialNumber)+"\n        ")])],1),a("el-form-item",{attrs:{label:"付款类型",prop:"payType"}},[t.isEdit?a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small"},model:{value:t.form.payType,callback:function(e){t.$set(t.form,"payType",e)},expression:"form.payType"}},t._l(t.categoryData,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1):a("span",[t._v("\n          "+t._s((t.categoryData.find(function(e){return e.id===t.form.payType})||{}).name)+"\n        ")])],1),a("el-form-item",{attrs:{label:"付款方式",prop:"payMethod"}},[t.isEdit?a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small"},model:{value:t.form.payMethod,callback:function(e){t.$set(t.form,"payMethod",e)},expression:"form.payMethod"}},t._l(t.sourceData,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1):a("span",[t._v("\n          "+t._s((t.sourceData.find(function(e){return e.id===t.form.payMethod})||{}).name)+"\n        ")])],1),a("el-form-item",{attrs:{label:"付款日期",prop:"payTime"}},[t.isEdit?a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择"},model:{value:t.form.payTime,callback:function(e){t.$set(t.form,"payTime",e)},expression:"form.payTime"}}):a("span",[t._v("\n          "+t._s(t.form.payTime)+"\n        ")])],1),a("el-form-item",{attrs:{label:"货币",prop:"currencyId"}},[t.isEdit?a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small",filterable:""},on:{change:t.onExRate},model:{value:t.form.currencyId,callback:function(e){t.$set(t.form,"currencyId",e)},expression:"form.currencyId"}},t._l(t.currencyList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name+"-"+t.sign,value:t.id}})}),1):a("span",[t._v("\n          "+t._s(t.form.currencyName)+"\n        ")])],1),a("el-form-item",{attrs:{label:"汇率",prop:"exRate"}},[t.isEdit?a("el-input-number",{staticClass:"input-number-valiate",attrs:{controls:!1,placeholder:"请输入",size:"small",min:0,max:9999},on:{change:t.onAmount},model:{value:t.form.exRate,callback:function(e){t.$set(t.form,"exRate",e)},expression:"form.exRate"}}):a("span",[t._v("\n          "+t._s(t.form.exRate)+"\n        ")])],1),a("el-form-item",{attrs:{label:"付款金额",prop:"payAmount"}},[t.isEdit?a("el-input-number",{staticClass:"input-number-valiate",attrs:{controls:!1,placeholder:"请输入",size:"small",min:-99999999,max:99999999,precision:2},on:{blur:t.onAmount,change:t.onAmount},model:{value:t.form.payAmount,callback:function(e){t.$set(t.form,"payAmount",e)},expression:"form.payAmount"}}):a("span",[t._v("\n          "+t._s(t.form.payAmount)+"\n        ")])],1),a("el-form-item",{attrs:{label:"本币金额",prop:"selfAmount"}},[t.isEdit?a("el-input-number",{staticClass:"input-number-valiate",attrs:{controls:!1,placeholder:"请输入",size:"small",min:-99999999,max:99999999,precision:2,disabled:""},model:{value:t.form.selfAmount,callback:function(e){t.$set(t.form,"selfAmount",e)},expression:"form.selfAmount"}}):a("span",[t._v("\n          "+t._s(t.form.selfAmount)+"\n        ")])],1),t.isEdit?a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入",clearable:""},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1):t._e(),t.isEdit?t._e():a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"备注"}},[t._v("\n        "+t._s(t.form.remark?t.form.remark:"")+"\n      ")])],1),a("div",[a("div",{staticStyle:{"border-top":"1px solid #e8e8e8","line-height":"50px"}},[t._v("\n        冲销明细\n      ")]),a("el-row",[a("el-col",{attrs:{span:4}},[a("span",{staticStyle:{"font-weight":"700","padding-left":"20px"}},[t._v("总计请款金额：")]),a("span",[t._v(t._s(t.amountFilter))])]),a("el-col",{attrs:{span:20}},[a("div",{staticStyle:{"text-align":"right","padding-right":"10px"}},[t.isEdit?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleAccount}},[t._v("\n              选择请款申请单\n            ")]):t._e()],1)])],1),a("el-table",{staticStyle:{width:"100%",margin:"10px 0 20px 0"},attrs:{data:t.table,"header-align":"center",align:"center",border:""}},[a("el-table-column",{attrs:{prop:"id",label:"请款申请单号"}}),a("el-table-column",{attrs:{prop:"applyTime",label:"请款日期",width:"170"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注",width:"200","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"currencyName",label:"货币"}}),a("el-table-column",{attrs:{prop:"exRate",label:"汇率",width:"80"}}),a("el-table-column",{attrs:{prop:"payAmount",label:"金额","min-width":"100"}}),a("el-table-column",{attrs:{prop:"selfAmount",label:"本币金额","min-width":"100"}}),a("el-table-column",{attrs:{fixed:"right",width:"100",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.isEdit?a("el-button",{staticStyle:{color:"#f56c6c"},attrs:{type:"text"},on:{click:function(a){return t.handleDelete(e.$index,"1")}}},[t._v("\n              删除\n            ")]):t._e()]}}])})],1),a("div",{staticStyle:{"border-top":"1px solid #e8e8e8","line-height":"50px"}},[t._v("\n        关联发票\n      ")]),a("el-row",[a("el-col",{attrs:{span:4}},[a("span",{staticStyle:{"font-weight":"700","padding-left":"20px"}},[t._v("总计发票金额：")]),a("span",[t._v(t._s(t.invoiceFilter))])]),a("el-col",{attrs:{span:20}},[a("div",{staticStyle:{"text-align":"right","padding-right":"10px"}},[t.isEdit?a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.handleInvoice}},[t._v("\n              选择发票\n            ")]):t._e()],1)])],1),a("el-table",{staticStyle:{width:"100%",margin:"10px 0 20px 0"},attrs:{data:t.invoicesTable,"header-align":"center",align:"center",border:""}},[a("el-table-column",{attrs:{prop:"code",label:"发票编号"}}),a("el-table-column",{attrs:{prop:"orderCode",label:"原单号"}}),a("el-table-column",{attrs:{prop:"invDate",label:"发票日期",width:"170"}}),a("el-table-column",{attrs:{prop:"auditTime",label:"审核时间",width:"170"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注",width:"200","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"currencyName",label:"货币"}}),a("el-table-column",{attrs:{prop:"exRate",label:"汇率",width:"80"}}),a("el-table-column",{attrs:{prop:"amount",label:"金额","min-width":"100"}}),a("el-table-column",{attrs:{prop:"selfAmount",label:"本币金额","min-width":"100"}}),a("el-table-column",{attrs:{fixed:"right",width:"100",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.isEdit?a("el-button",{staticStyle:{color:"#f56c6c"},attrs:{type:"text"},on:{click:function(a){return t.handleDelete(e.$index,"2")}}},[t._v("\n              删除\n            ")]):t._e()]}}])})],1),a("el-dialog",{attrs:{title:"选择客户",visible:t.isCustomer,"close-on-click-modal":!1,width:"1000px"},on:{"update:visible":function(e){t.isCustomer=e},closed:function(e){t.isCustomer=!1,t.name=""}}},[a("div",{staticStyle:{"text-align":"right"}},["2"===t.custType&&"1"===t.custSubtype?a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"公司类型"},on:{change:t.onComType},model:{value:t.form.custTag,callback:function(e){t.$set(t.form,"custTag",e)},expression:"form.custTag"}},[a("el-option",{attrs:{label:"本公司",value:"1"}}),a("el-option",{attrs:{label:"分公司",value:"2"}})],1):t._e(),"2"===t.custType&&"1"===t.custSubtype&&"2"===t.form.custTag?a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:t.selectLoading,size:"small",placeholder:"所属公司",filterable:"",clearable:""},on:{change:t.onCompany,focus:t.getCompanyList},model:{value:t.form.agentId,callback:function(e){t.$set(t.form,"agentId",e)},expression:"form.agentId"}},t._l(t.companyList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e(),a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{placeholder:"客户类型",size:"small",filterable:""},on:{change:t.handleCustType},model:{value:t.form.custType,callback:function(e){t.$set(t.form,"custType",e)},expression:"form.custType"}},t._l(t.custTypeList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1),"3"===t.form.custType?a("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"客户",size:"small",clearable:""},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}):t._e(),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.getCustomerType}},[t._v("\n            查询\n          ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dialogLoading,expression:"dialogLoading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:t.customerList,border:"",height:"375px"},on:{"row-click":t.onCustomerRow}},[a("el-table-column",{attrs:{prop:"name",label:"客户名称"}}),a("el-table-column",{attrs:{prop:"",label:"客户属性"},scopedSlots:t._u([{key:"default",fn:function(e){return["0"===e.row.type?a("span",[t._v("聚货通")]):"3"===e.row.type?a("span",[t._v("供应商")]):"2"===e.row.type&&"1"===e.row.subtype?a("span",[t._v("一级代理")]):"2"===e.row.type&&"2"===e.row.subtype?a("span",[t._v("二级代理")]):"1"===e.row.type&&"0"===e.row.subtype?a("span",[t._v("直客")]):"1"===e.row.type&&"1"===e.row.subtype?a("span",[t._v("同行")]):a("span",[t._v("--")])]}}])}),a("el-table-column",{attrs:{prop:"parentName",label:"所属上级"}})],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":t.pagination.page,"page-size":t.pagination.size,layout:"total, prev, pager, next",total:t.pagination.total},on:{"update:currentPage":function(e){return t.$set(t.pagination,"page",e)},"update:current-page":function(e){return t.$set(t.pagination,"page",e)},"current-change":t.handleCustomerChange}})],1),a("el-dialog",{attrs:{title:"选择请款申请单",visible:t.isAccount,"close-on-click-modal":!1,width:"1200px"},on:{"update:visible":function(e){t.isAccount=e},closed:function(e){t.isAccount=!1,t.account="",t.accountArr=[]}}},[a("div",{staticStyle:{"text-align":"right"}},[a("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"请款申请单号",size:"small",clearable:""},model:{value:t.account,callback:function(e){t.account=e},expression:"account"}}),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.getAccountList}},[t._v("\n            查询\n          ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.dialogLoading,expression:"dialogLoading"}],ref:"accountTable",staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:t.accountData,border:"",height:"400px"},on:{"selection-change":t.onAccountSelection}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{prop:"id",label:"请款申请单号","min-width":"150","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"applyTime",label:"请款日期",width:"160"}}),a("el-table-column",{attrs:{prop:"custName",label:"客户名称"}}),a("el-table-column",{attrs:{prop:"",label:"结算账户"}}),a("el-table-column",{attrs:{prop:"payMethod",label:"来源",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s((t.sourceData.find(function(t){return t.id===e.row.payMethod})||{}).name)+"\n            ")]}}])}),a("el-table-column",{attrs:{prop:"currencyName",label:"货币",width:"100"}}),a("el-table-column",{attrs:{prop:"exRate",label:"汇率",width:"100"}}),a("el-table-column",{attrs:{prop:"payAmount",label:"金额"}}),a("el-table-column",{attrs:{prop:"selfAmount",label:"本币金额"}})],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":t.page,"page-size":t.size,layout:"total, prev, pager, next",total:t.total},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.handleAccountChange}}),a("div",{staticStyle:{"text-align":"right","padding-top":"20px"}},[a("el-button",{on:{click:function(e){t.isAccount=!1,t.account="",t.accountArr=[]}}},[t._v("\n            取 消\n          ")]),a("el-button",{attrs:{type:"primary"},on:{click:t.accountSelectionConfirm}},[t._v("\n            确 定\n          ")])],1)],1),a("el-dialog",{attrs:{title:"选择发票",visible:t.isInvoice,"close-on-click-modal":!1,width:"1200px"},on:{"update:visible":function(e){t.isInvoice=e},closed:t.cancelInvoice}},[a("div",{staticStyle:{"text-align":"right"}},[a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:t.selectLoading,placeholder:"服务大类",size:"small",filterable:"",clearable:""},on:{focus:t.getServiceType,change:t.onService},model:{value:t.serviceTypeId,callback:function(e){t.serviceTypeId=e},expression:"serviceTypeId"}},t._l(t.serviceTypeList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),a("el-input",{staticClass:"input-with-select",staticStyle:{width:"250px","margin-right":"10px"},attrs:{placeholder:"请输入内容",size:"small",clearable:""},model:{value:t.keyWord,callback:function(e){t.keyWord=e},expression:"keyWord"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",size:"small",placeholder:"请选择"},slot:"prepend",model:{value:t.selectType,callback:function(e){t.selectType=e},expression:"selectType"}},[a("el-option",{directives:[{name:"show",rawName:"v-show",value:!["02","06"].includes(t.serviceTypeId),expression:"!['02','06'].includes(serviceTypeId)"}],attrs:{label:"原单号",value:"1"}}),a("el-option",{directives:[{name:"show",rawName:"v-show",value:["02"].includes(t.serviceTypeId),expression:"['02'].includes(serviceTypeId)"}],attrs:{label:"提单号",value:"4"}}),a("el-option",{directives:[{name:"show",rawName:"v-show",value:["02","06"].includes(t.serviceTypeId),expression:"['02', '06'].includes(serviceTypeId)"}],attrs:{label:"SO号",value:"5"}}),a("el-option",{directives:[{name:"show",rawName:"v-show",value:["02"].includes(t.serviceTypeId),expression:"['02'].includes(serviceTypeId)"}],attrs:{label:"柜号",value:"6"}})],1)],1),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.getInvoiceList}},[t._v("\n            查询\n          ")])],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.dialogLoading,expression:"dialogLoading"}]},[t.invoiceData.length?a("vxe-table",{ref:"invoiceTable",staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:t.invoiceData,"auto-resize":!0,border:"",resizable:"",size:"small",height:"400"},on:{"checkbox-change":t.onInvoiceSelection,"checkbox-all":t.onInvoiceAll}},[a("vxe-table-column",{attrs:{fixed:"left",type:"checkbox",width:"55"}}),a("vxe-table-column",{attrs:{visible:"02"!==t.serviceTypeId&&"06"!==t.serviceTypeId,fixed:"left",width:"160",title:"原单号"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.orderCode))])]}}],null,!1,2549254981)}),a("vxe-table-column",{attrs:{fixed:"left",visible:"02"===t.serviceTypeId||"06"===t.serviceTypeId,width:"160",title:"SO号"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s((e.row.soNoList||[]).join(",")))])]}}],null,!1,2108195871)}),a("vxe-table-column",{attrs:{visible:"02"===t.serviceTypeId,width:"160",title:"提单号"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s((e.row.billNoList||[]).join(",")))])]}}],null,!1,528558280)}),a("vxe-table-column",{attrs:{visible:"02"===t.serviceTypeId,width:"160",title:"航空单号"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s((e.row.airNoList||[]).join(",")))])]}}],null,!1,3875341849)}),a("vxe-table-column",{attrs:{visible:"02"===t.serviceTypeId,width:"160",title:"柜号"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s((e.row.containerNoList||[]).join(",")))])]}}],null,!1,3174292868)}),a("vxe-table-column",{attrs:{title:"开票日期",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.invDate))])]}}],null,!1,2385324867)}),a("vxe-table-column",{attrs:{title:"审核时间",width:"170"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.auditTime))])]}}],null,!1,202786590)}),a("vxe-table-column",{attrs:{title:"货币",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(""+(e.row.currencyName||"")+(e.row.currencyId||"")))])]}}],null,!1,2595197676)}),a("vxe-table-column",{attrs:{title:"汇率",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.exRate))])]}}],null,!1,1133638521)}),a("vxe-table-column",{attrs:{title:"金额","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.amount))])]}}],null,!1,1167497322)}),a("vxe-table-column",{attrs:{title:"本币金额","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.selfAmount))])]}}],null,!1,3043539318)})],1):t._e()],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":t.page,"page-size":t.size,layout:"total, prev, pager, next",total:t.total},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.handleInvoiceChange}}),a("div",{staticStyle:{"text-align":"right","padding-top":"20px"}},[a("el-button",{on:{click:t.cancelInvoice}},[t._v("\n            取 消\n          ")]),a("el-button",{attrs:{type:"primary"},on:{click:t.invoiceSelectionConfirm}},[t._v("\n            确 定\n          ")])],1)],1)],1)],1)])},y=[],g=(a("28a5"),a("75fc")),v=(a("55dd"),a("96cf"),a("3b8d")),b=(a("7f7f"),a("7514"),a("7dfc")),x=a("5a0c"),k=a.n(x);function w(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)}return a}function T(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?w(a,!0).forEach(function(e){Object(o["a"])(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):w(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function _(){return{payAmount:void 0,selfAmount:void 0,custTag:void 0,agentId:void 0,agentName:void 0,currencyId:void 0,currencyName:void 0,serialNumber:void 0,custId:void 0,custName:void 0,custType:void 0,exRate:void 0,id:void 0,payTime:void 0,remark:void 0,status:void 0,payType:void 0,payMethod:void 0}}var O=function(t){function e(){var t;return Object(s["a"])(this,e),t=Object(l["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.form=_(),t.formRules={id:[{required:!0,message:"付款单号不能为空",trigger:"blur"}],serialNumber:[{validator:function(t,e,a){var n=/[\u4e00-\u9fa5]/;e&&n.test(e)?a(new Error("付款流水号不能是中文")):a()},trigger:"blur"}],agentId:[{required:!0,message:"请选择所属公司",trigger:"change"}],currencyId:[{required:!0,message:"请选择货币",trigger:"change"}],custId:[{required:!0,message:"客户不能为空",trigger:"change"}],exRate:[{required:!0,message:"汇率不能为空(根据货币确定)",trigger:"blur"}],payAmount:[{required:!0,message:"请款申请单金额不能为空",trigger:"blur"}],selfAmount:[{required:!0,message:"本币金额不能为空",trigger:"blur"}],payTime:[{required:!0,message:"请选择请款申请单日期",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],payMethod:[{required:!0,message:"请选择付款方式",trigger:"change"}],payType:[{required:!0,message:"请选择付款类型",trigger:"change"}]},t.name="",t.account="",t.keyWord="",t.selectType="",t.serviceTypeId="",t.isCustomer=!1,t.isAccount=!1,t.isInvoice=!1,t.custTypeList=[],t.serviceTypeList=[],t.customerData=[],t.accountData=[],t.accountArr=[],t.invoiceData=[],t.invoiceArr=[],t.companyList=[],t.tableData1=[],t.tableData2=[],t.detailLoading=!1,t.dialogLoading=!1,t.selectLoading=!1,t.currencyList=[],t.currentId="",t.total=0,t.page=1,t.size=10,t.pagination={page:1,size:10,total:0},t.selfCurrency={currencyId:"RMB",currencyName:"人民币"},t}return Object(d["a"])(e,t),Object(c["a"])(e,[{key:"countNum",value:function(t,e){return parseFloat((t*e).toFixed(2))}},{key:"setData",value:function(t){this.getCurrencyList(),t?(this.currentId=t,this.getPaymentById(t)):(this.form.agentId=this.custId,this.form.agentName=this.custName,this.setCustomerType())}},{key:"setCustomerType",value:function(){var t=this.custType,e=this.custSubtype;"0"===t?this.custTypeList=[{id:"3",name:"供应商"}]:"2"===t&&"1"===e&&"1"===this.form.custTag?this.custTypeList=[{id:"0",name:"聚货通"},{id:"3",name:"供应商"}]:"2"===t&&"1"===e&&"2"===this.form.custTag?this.custTypeList=[{id:"2",name:"代理商"}]:"2"===t&&"2"===e?this.custTypeList=[{id:"2",name:"代理商"}]:(this.custTypeList=[],this.form.custType=void 0)}},{key:"resetDialog",value:function(){this.pagination={page:1,size:10,total:0},this.name=""}},{key:"onComType",value:function(){this.form.agentId="",this.form.agentName="",this.form.custName="",this.form.custId="",this.form.custType="",this.form.clientType="",this.tableData1=[],this.tableData2=[],this.customerData=[],this.setCustomerType(),"2"!==this.form.custTag&&(this.form.agentId=this.custId,this.form.agentName=this.custName)}},{key:"onCompany",value:function(){var t=this;this.form.agentName="",this.form.custName="",this.form.custId="",this.form.custType="",this.form.clientType="",this.tableData1=[],this.tableData2=[],this.customerData=[];var e=this.companyList.find(function(e){return e.id===t.form.agentId});e&&(this.form.agentName=e.name)}},{key:"getCompanyList",value:function(){var t=this;this.selectLoading=!0,Object(b["S"])().then(function(e){var a=e.data||[];t.companyList=a,t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"handleCustType",value:function(){this.form.custName="",this.form.custId="",this.form.clientType="",this.form.exRate=void 0,this.tableData1=[],this.tableData2=[],this.customerData=[]}},{key:"handleCustomer",value:function(){var t=Object(v["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.resetDialog(),this.isCustomer=!0;case 2:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"onCustomerRow",value:function(t){var e=t.type,a=t.subtype;this.isCustomer=!1,this.form.custId=t.id,this.form.custName=t.name,this.form.clientType=e+(a?"-".concat(a):""),this.accountData=[],this.onExRate()}},{key:"handleCustomerChange",value:function(t){this.pagination.page=t}},{key:"getCustomerType",value:function(){var t=Object(v["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.custType,a=this.custSubtype,this.form.custType){t.next=7;break}return this.$message.error("请选择客户类型"),t.abrupt("return",!1);case 7:if("2"!==e||"1"!==a||"1"!==this.form.custTag||"0"!==this.form.custType){t.next=12;break}this.customerData=[{id:"0",name:"聚货通",type:"0",countryId:"CN",subtype:"",parentName:""}],this.pagination.total=this.customerData.length,t.next=28;break;case 12:if("2"!==e||"1"!==a||"1"!==this.form.custTag||"3"!==this.form.custType){t.next=17;break}return t.next=15,this.getSupplierList();case 15:t.next=28;break;case 17:if("2"!==e||"1"!==a||"2"!==this.form.custTag){t.next=22;break}this.customerData=[{id:this.custId,name:this.custName,type:"2",subtype:"1",countryId:this.userCountryId,parentName:"聚货通"}],this.pagination.total=this.customerData.length,t.next=28;break;case 22:if("0"!==e){t.next=27;break}return t.next=25,this.getSupplierList();case 25:t.next=28;break;case 27:"2"===e&&"2"===a&&(this.customerData=[{id:this.parentId,name:this.parentName,type:"2",subtype:"1",countryId:this.userCountryId,parentName:"聚货通"}]);case 28:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"getSupplierList",value:function(){var t=Object(v["a"])(regeneratorRuntime.mark(function t(){var e,a=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.dialogLoading=!0,e={page:this.pagination.page,size:9999,name:this.name},t.next=4,Object(b["Q"])(e).then(function(t){var e=t.data||{},n=e.result||[];a.customerData=n.map(function(t){return t.type="3",t}),a.pagination.total=e.total,a.dialogLoading=!1}).catch(function(t){return a.dialogLoading=!1,t});case 4:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"getAgentList",value:function(){var t=Object(v["a"])(regeneratorRuntime.mark(function t(){var e,a=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.dialogLoading=!0,e={parentId:"0",page:this.pagination.page,size:9999,name:this.name},t.next=4,Object(b["o"])(e).then(function(t){var e=t.data||{},n=e.result||[];a.customerData=n.map(function(t){return t.type="2",t}),a.pagination.total=e.total,a.dialogLoading=!1}).catch(function(t){return a.dialogLoading=!1,t});case 4:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"getCurrencyList",value:function(){var t=this;Object(b["t"])().then(function(e){var a=e.data||{};t.currencyList=a.result||[],t.currencyList.map(function(e){e.countries.some(function(e){return e.id===t.userCountryId})&&(t.selfCurrency={currencyId:e.id,currencyName:e.name})})}).catch(function(t){return t})}},{key:"onExRate",value:function(){var t=this;this.form.exRate=void 0,this.form.selfAmount=void 0,this.form.payAmount=void 0,this.form.currencyId&&(this.selfCurrency.currencyId!==this.form.currencyId?Object(b["x"])({c1:this.form.currencyId,c2:this.selfCurrency.currencyId}).then(function(e){var a=e.data||[];if(a.length<=0)t.$message.error("暂无汇率，请配置");else{var n=a.filter(function(e){return e.lcId===t.form.currencyId}).map(function(t){return t.time=k()(t.effective).unix(),t}).sort(function(t,e){return e.time-t.time}),i=n[0]||{};i.lcId===t.form.currencyId&&(t.form.exRate=i.rate),t.form.exRate||t.$message.error("暂无汇率，请配置")}}).catch(function(t){return t}):this.form.exRate=1)}},{key:"onAmount",value:function(){this.form.exRate>0&&(this.form.selfAmount=this.countNum(this.form.payAmount||0,this.form.exRate))}},{key:"getPaymentById",value:function(t){var e=this;this.detailLoading=!0,Object(b["G"])({id:t}).then(function(){var t=Object(v["a"])(regeneratorRuntime.mark(function t(a){var n,i,o,s,c;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:n=a.data||{},i=n.payApplyEntityList,o=n.invoiceEntityList,s=n.custType,c=Object(r["a"])(n,["payApplyEntityList","invoiceEntityList","custType"]),e.form=T({},c,{custType:s?s.substring(0,1):"1",clientType:s}),e.form.exRate>0&&(e.form.selfAmount=e.countNum(e.form.payAmount||0,e.form.exRate)),e.setCustomerType(),e.tableData1=i||[],e.tableData2=o||[],e.detailLoading=!1;case 8:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(t){return e.detailLoading=!1,t})}},{key:"handleSave",value:function(){var t=this,e=this.$refs.editForm;e.validate(function(e){if(!e)return!1;if(t.tableData1.length<=0&&t.tableData2.length<=0)t.$message.error("请至少选择一个请款申请单或发票");else{t.detailLoading=!0;var a=t.form,n=a.clientType,i=(a.custType,a.custTag,Object(r["a"])(a,["clientType","custType","custTag"])),o=T({},i,{custType:n,operatorCustId:t.custId,selfId:t.selfCurrency.currencyId,status:0});t.currencyList.map(function(t){t.id===o.currencyId&&(o.currencyName=t.name)}),o.applyIdList=t.tableData1.filter(function(t){return"X"!==t.tag}).map(function(t){return t.id}),o.invoiceList=t.tableData2.filter(function(t){return"X"!==t.tag}).map(function(t){return t.id}),t.isOnce?Object(b["a"])(o).then(function(e){t.$message({type:"success",message:"新增成功"}),t.resetForm(),t.detailLoading=!1,t.$emit("back"),t.$emit("getTableData")}).catch(function(e){return t.detailLoading=!1,e}):Object(b["l"])(o).then(function(e){t.$message({type:"success",message:"编辑成功"}),t.resetForm(),t.detailLoading=!1,t.$emit("back"),t.$emit("getTableData")}).catch(function(e){return t.detailLoading=!1,e})}})}},{key:"handleBack",value:function(){this.$emit("back"),this.resetForm()}},{key:"resetForm",value:function(){this.form=_(),this.tableData1=[],this.tableData2=[],this.customerData=[],this.page=1,this.size=10;var t=this.$refs.editForm;this.$nextTick(function(){t.clearValidate()})}},{key:"handleAccountChange",value:function(t){this.page=t,this.getAccountList()}},{key:"handleInvoiceChange",value:function(t){this.page=t,this.getInvoiceList()}},{key:"handleAccount",value:function(){this.isAccount=!0,this.page=1,this.accountArr=this.tableData1.filter(function(t){return"X"!==t.tag}).map(function(t){return t.id}),this.getAccountList()}},{key:"getAccountList",value:function(){var t=this;this.dialogLoading=!0;var e={model:{id:this.account,agentId:[this.form.agentId],custId:this.form.custId,status:"1"},page:this.page,size:this.size};Object(b["P"])(e).then(function(e){var a=e.data||{};t.accountData=a.result||[],t.total=a.total,t.accountArr.length&&t.accountArr.map(function(e){var a=t.accountData.find(function(t){return t.id===e||"".concat(t.id)===e});a&&t.$nextTick(function(){var e=t.$refs.accountTable;e.toggleCheckboxRow(a,!0)})}),t.dialogLoading=!1}).catch(function(e){return t.dialogLoading=!1,[null,e]})}},{key:"onAccountSelection",value:function(t){this.accountArr=(t||[]).map(function(t){return T({},t,{tag:"1"})})}},{key:"accountSelectionConfirm",value:function(){this.isAccount=!1,this.account="";var t=this.tableData1.filter(function(t){return"X"!==t.tag}),e=[].concat(Object(g["a"])(this.accountArr),Object(g["a"])(t)),a={},n=e.reduce(function(t,e){return a[e.id]||(a[e.id]=!0,t.push(e)),t},[]);this.tableData1=n}},{key:"handleDelete",value:function(t,e){"1"===e?this.tableData1[t].tag="X":"2"===e&&(this.invoiceData[t].tag="X")}},{key:"getServiceType",value:function(){var t=this,e={cas:"",custId:this.form.custId},a=(this.form.clientType||"").split("-")[0]||"";"1"===a&&(e.cas="C"),"2"===a&&(e.cas="A"),"3"===a&&(e.cas="S"),this.selectLoading=!0,Object(b["U"])(e).then(function(e){t.selectLoading=!1;var a=e.data||[];t.serviceTypeList=a.map(function(t){return{id:t.typeId,name:t.typeName}})}).catch(function(){t.serviceTypeList=[],t.selectLoading=!1})}},{key:"onService",value:function(){this.invoiceData=[]}},{key:"handleInvoice",value:function(){this.form.custId?(this.isInvoice=!0,this.page=1,this.invoiceArr=this.tableData2.filter(function(t){return"X"!==t.tag})):this.$message.error("请选择客户")}},{key:"getInvoiceList",value:function(){var t=this;if(this.serviceTypeId){this.dialogLoading=!0;var e={model:{flag:"1",custId:this.form.custId,clientId:this.form.agentId,serviceTypeId:this.serviceTypeId,orderCode:"1"===this.selectType?this.keyWord:void 0,code:"3"===this.selectType?this.keyWord:void 0,billNo:"4"===this.selectType?this.keyWord:void 0,soNo:"5"===this.selectType?this.keyWord:void 0,containerNo:"6"===this.selectType?this.keyWord:void 0},size:this.size,page:this.page};Object(b["N"])(e).then(function(e){var a=e.data||{};t.invoiceData=a.result,t.total=a.total,t.invoiceArr.length&&t.invoiceArr.map(function(e){var a=t.invoiceData.find(function(t){return t.id===e.id||"".concat(t.id)===e.id});a&&t.$nextTick(function(){var e=t.$refs.invoiceTable;e.toggleCheckboxRow(a,!0)})}),t.dialogLoading=!1}).catch(function(e){return t.dialogLoading=!1,[null,e]})}else this.$message.error("请选择服务")}},{key:"onInvoiceSelection",value:function(t){t.checked?this.invoiceArr.push(t.row):this.invoiceArr=this.invoiceArr.filter(function(e){return e.id!==t.row.id}),this.invoiceArr=this.invoiceArr.map(function(t){return T({},t,{tag:"1"})})}},{key:"onInvoiceAll",value:function(t){var e=this;t.checked?this.invoiceArr=[].concat(Object(g["a"])(this.invoiceArr),Object(g["a"])(this.invoiceData)).reduce(function(t,e){return t.find(function(t){return t.id===e.id})||t.push(e),t},[]):this.invoiceArr=this.invoiceArr.filter(function(t){return!e.invoiceData.find(function(e){return e.id===t.id})})}},{key:"cancelInvoice",value:function(){this.isInvoice=!1,this.serviceTypeId="",this.selectType="",this.keyWord="",this.invoiceArr=[],this.invoiceData=[]}},{key:"invoiceSelectionConfirm",value:function(){this.isInvoice=!1,this.serviceTypeId="",this.selectType="",this.keyWord="";var t=this.tableData2.filter(function(t){return"X"!==t.tag}),e=[].concat(Object(g["a"])(this.invoiceArr),Object(g["a"])(t)),a={},n=e.reduce(function(t,e){return a[e.id]||(a[e.id]=!0,t.push(e)),t},[]);this.tableData2=n}},{key:"custId",get:function(){var t=f["a"].info||{},e=t.custId;return e}},{key:"custName",get:function(){var t=f["a"].info||{},e=t.custName;return e}},{key:"userCountryId",get:function(){var t=f["a"].info||{},e=t.countryId;return e}},{key:"username",get:function(){var t=f["a"].info||{},e=t.username;return e}},{key:"custType",get:function(){var t=f["a"].info||{},e=t.custType;return e}},{key:"parentId",get:function(){var t=f["a"].info||{},e=t.parentId;return e}},{key:"parentName",get:function(){var t=f["a"].info||{},e=t.parentName;return e}},{key:"custSubtype",get:function(){var t=f["a"].info||{},e=t.custSubtype;return e}},{key:"statusData",get:function(){var t=this.statusList;return t}},{key:"sourceData",get:function(){var t=this.sourceList;return t}},{key:"categoryData",get:function(){var t=this.categoryList;return t}},{key:"amountFilter",get:function(){var t=this,e=this.tableData1.filter(function(t){return"X"!==t.tag}),a=0;return e.map(function(e){e.payAmount&&e.exRate>0&&(a+=t.countNum(e.payAmount,e.exRate))}),parseFloat(a.toFixed(2))}},{key:"table",get:function(){return this.tableData1.filter(function(t){return"X"!==t.tag})}},{key:"customerList",get:function(){return this.customerData.slice((this.pagination.page-1)*this.pagination.size,this.pagination.page*this.pagination.size)}},{key:"invoiceFilter",get:function(){var t=this,e=this.tableData2.filter(function(t){return"X"!==t.tag}),a=0;return e.map(function(e){e.amount&&e.exRate>0&&(a+=t.countNum(e.amount,e.exRate))}),parseFloat(a.toFixed(2))}},{key:"invoicesTable",get:function(){return this.tableData2.filter(function(t){return"X"!==t.tag})}}]),e}(m["e"]);O=p["a"]([Object(m["a"])({name:"detail",components:{},props:{isEdit:{type:Boolean,default:!1},isOnce:{type:Boolean,default:!1},statusList:{type:Array,default:function(){return[]}},sourceList:{type:Array,default:function(){return[]}},categoryList:{type:Array,default:function(){return[]}}}})],O);var S=O,I=S,L=(a("ec8d"),a("2877")),j=Object(L["a"])(I,h,y,!1,null,"0f9f05b9",null),D=j.exports;function A(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)}return a}function C(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?A(a,!0).forEach(function(e){Object(o["a"])(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):A(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}var N=function(t){function e(){var t;return Object(s["a"])(this,e),t=Object(l["a"])(this,Object(u["a"])(e).apply(this,arguments)),t.searchForm={comType:void 0,comId:void 0,id:void 0,custName:void 0,end:void 0,start:void 0,status:void 0,payMethod:void 0,payType:void 0},t.auditForm={id:"",status:1,note:""},t.auditFormRules={status:[{required:!0,message:"请选择审核状态",trigger:"change"}],note:[{required:!0,message:"请填写拒绝原因",trigger:"change"}]},t.time=[],t.type="P",t.tableData=[],t.companyList=[],t.total=0,t.page=1,t.size=10,t.selectType="2",t.keyWord="",t.loading=!1,t.dialogLoading=!1,t.selectLoading=!1,t.dialogAudit=!1,t.isEdit=!1,t.isOnce=!1,t.detailShow=!1,t.statusList=[{name:"未审核",id:0},{name:"已通过",id:1},{name:"已拒绝",id:2},{name:"审核中",id:3}],t.categoryList=[{name:"采购付款",id:"0"},{name:"赔付",id:"1"},{name:"抵扣",id:"2"}],t.sourceList=[{name:"银行汇款",id:"0"},{name:"微信",id:"1"},{name:"支付宝",id:"2"},{name:"PayPal",id:"3"},{name:"其它",id:"4"}],t.companyTypeList=[{id:"1",name:"本公司"},{id:"2",name:"分公司"}],t}return Object(d["a"])(e,t),Object(c["a"])(e,[{key:"handleAdd",value:function(){this.detailShow=!0,this.isEdit=!0,this.isOnce=!0;var t=this.$refs.detailForm;t.setData()}},{key:"handleEdit",value:function(t){this.detailShow=!0,this.isEdit=!0,this.isOnce=!1;var e=this.$refs.detailForm;e.setData(t.id)}},{key:"handleDetail",value:function(t){this.detailShow=!0,this.isEdit=!1,this.isOnce=!1;var e=this.$refs.detailForm;e.setData(t)}},{key:"handleDelete",value:function(t){var e=this,a={id:t};this.$confirm("请确认是否删除该条数据?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){Object(b["i"])(a).then(function(t){e.$message({type:"success",message:"删除成功"}),e.handleSearch()}).catch(function(t){return t})}).catch(function(){return!1})}},{key:"cancelAudit",value:function(){this.auditForm={id:"",status:1,note:""};var t=this.$refs.auditForm;this.$nextTick(function(){t.clearValidate()}),this.dialogAudit=!1}},{key:"handleAudit",value:function(t,e){var a=this;if(0===t.status){var n={id:t.id,status:3,note:""};Object(b["g"])(n).then(function(){a.tableData[e].status=3}).catch(function(t){return t})}this.dialogAudit=!0,this.auditForm={id:t.id,status:1,note:""}}},{key:"confirmAudit",value:function(){var t=this,e=C({},this.auditForm);this.dialogLoading=!0,Object(b["g"])(e).then(function(){t.$message.success("操作成功"),t.dialogLoading=!1,t.cancelAudit(),t.handleSearch()}).catch(function(){t.dialogLoading=!1})}},{key:"handlePass",value:function(t){}},{key:"handleRefuse",value:function(t){}},{key:"handleResubmit",value:function(t){}},{key:"onComType",value:function(){this.tableData=[],this.searchForm.comId="",this.companyList=[],this.handleSearch(1)}},{key:"onCompany",value:function(){this.tableData=[],this.handleSearch(1)}},{key:"getCompanyList",value:function(){var t=this;this.selectLoading=!0,Object(b["S"])().then(function(e){var a=e.data||[];t.companyList=a,t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"handleSearch",value:function(t){var e=this;t&&(this.page=t);var a=this.searchForm,n=a.comType,i=a.comId,o=Object(r["a"])(a,["comType","comId"]),s=this.custId,c={model:C({},o,{custName:"2"===this.selectType?this.keyWord:void 0,id:"3"===this.selectType?this.keyWord:void 0,custTag:n,agentId:"1"===n?[s]:i?[i]:[]}),size:this.size,page:this.page};Array.isArray(this.time)&&this.time.length>0&&(c.model.start=this.time[0],c.model.end=this.time[1]),this.loading=!0,Object(b["H"])(c).then(function(t){var a=t.data||{};e.tableData=a.result||[],e.total=a.total,e.loading=!1}).catch(function(t){return e.loading=!1,[null,t]})}},{key:"handleSizeChange",value:function(t){this.size=t,this.handleSearch()}},{key:"handleCurrentChange",value:function(t){this.page=t,this.handleSearch()}},{key:"created",value:function(){this.time=[k()().subtract(30,"d").format("YYYY-MM-DD"),k()().format("YYYY-MM-DD")];var t=this.custType,e=this.custSubtype;this.searchForm.comType="1","2"===t&&"1"===e&&(this.searchForm.comType="2"),this.handleSearch()}},{key:"custId",get:function(){var t=f["a"].info||{},e=t.custId;return e}},{key:"custName",get:function(){var t=f["a"].info||{},e=t.custName;return e}},{key:"custType",get:function(){var t=f["a"].info||{},e=t.custType;return e}},{key:"custSubtype",get:function(){var t=f["a"].info||{},e=t.custSubtype;return e}}]),e}(m["e"]);N=p["a"]([Object(m["a"])({name:"",components:{detail:D},props:{}})],N);var z=N,$=z,F=Object(L["a"])($,n,i,!1,null,"b32c6b40",null);e["default"]=F.exports},"7dfc":function(t,e,a){"use strict";a.d(e,"Q",function(){return s}),a.d(e,"o",function(){return c}),a.d(e,"p",function(){return l}),a.d(e,"U",function(){return u}),a.d(e,"W",function(){return d}),a.d(e,"V",function(){return p}),a.d(e,"s",function(){return m}),a.d(e,"t",function(){return f}),a.d(e,"D",function(){return h}),a.d(e,"E",function(){return y}),a.d(e,"A",function(){return g}),a.d(e,"h",function(){return v}),a.d(e,"X",function(){return b}),a.d(e,"Y",function(){return x}),a.d(e,"B",function(){return k}),a.d(e,"C",function(){return w}),a.d(e,"H",function(){return T}),a.d(e,"G",function(){return _}),a.d(e,"i",function(){return O}),a.d(e,"a",function(){return S}),a.d(e,"l",function(){return I}),a.d(e,"x",function(){return L}),a.d(e,"M",function(){return j}),a.d(e,"J",function(){return D}),a.d(e,"I",function(){return A}),a.d(e,"K",function(){return C}),a.d(e,"b",function(){return N}),a.d(e,"m",function(){return z}),a.d(e,"j",function(){return $}),a.d(e,"q",function(){return F}),a.d(e,"L",function(){return R}),a.d(e,"P",function(){return E}),a.d(e,"N",function(){return P}),a.d(e,"O",function(){return M}),a.d(e,"k",function(){return W}),a.d(e,"c",function(){return q}),a.d(e,"n",function(){return X}),a.d(e,"v",function(){return B}),a.d(e,"f",function(){return Y}),a.d(e,"e",function(){return H}),a.d(e,"d",function(){return Q}),a.d(e,"g",function(){return J}),a.d(e,"z",function(){return U}),a.d(e,"w",function(){return V}),a.d(e,"r",function(){return G}),a.d(e,"R",function(){return K}),a.d(e,"y",function(){return Z}),a.d(e,"S",function(){return tt}),a.d(e,"F",function(){return et}),a.d(e,"T",function(){return at}),a.d(e,"u",function(){return nt});a("8e6e"),a("ac6a"),a("456d");var n=a("bd86"),i=a("b32d");function r(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,n)}return a}function o(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?r(a,!0).forEach(function(e){Object(n["a"])(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):r(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function s(t){var e={url:"/auth/supplier/getSupplierList",method:"get",params:t};return Object(i["a"])(e)}function c(t){var e={url:"/auth/agent/getAgentList",method:"get",params:t};return Object(i["a"])(e)}function l(t){var e={url:"/cfg/type/getServiceTypeList",method:"get",params:t};return Object(i["a"])(e)}function u(t){var e={url:"/auth/custtype/getServerType",method:"get",params:t};return Object(i["a"])(e)}function d(t){var e={url:"/finance/account/rollback",method:"get",params:t};return Object(i["a"])(e)}function p(t){var e={url:"/orders/worder/getOrderList",method:"post",data:t};return Object(i["a"])(e)}function m(t){var e={url:"/finance/costitem/getCostitemList",method:"get",params:t};return Object(i["a"])(e)}function f(t){var e={url:"/setting/currency/getCurrencyList",method:"get",params:o({page:1,size:999},t)};return Object(i["a"])(e)}function h(t){var e={url:"/finance/account/page",method:"post",data:t};return Object(i["a"])(e)}function y(t){var e={url:"finance/account/order_invoice",method:"post",data:t};return Object(i["a"])(e)}function g(t){var e={url:"/finance/account/getInvoice",method:"get",params:t};return Object(i["a"])(e)}function v(t){var e={url:"/finance/account/deleteInvoice",method:"post",params:t};return Object(i["a"])(e)}function b(t){var e={url:"/finance/account/saveInvoice",method:"post",data:t};return Object(i["a"])(e)}function x(t){var e={url:"/finance/account/updateInvoice",method:"post",data:t};return Object(i["a"])(e)}function k(t){var e={url:"/finance/account/exportAll",method:"post",responseType:"blob",data:t};return Object(i["a"])(e)}function w(t){var e={url:"/finance/account/export2",method:"post",responseType:"blob",data:t};return Object(i["a"])(e)}function T(t){var e={url:"/finance/p/page",method:"post",data:t};return Object(i["a"])(e)}function _(t){var e={url:"/finance/p/get",method:"get",params:t};return Object(i["a"])(e)}function O(t){var e={url:"/auth/p/del",method:"delete",params:t};return Object(i["a"])(e)}function S(t){var e={url:"/finance/p/add",method:"post",data:t};return Object(i["a"])(e)}function I(t){var e={url:"/finance/p/edit",method:"post",data:t};return Object(i["a"])(e)}function L(t){var e={url:"/setting/exchange/rate",method:"get",params:t};return Object(i["a"])(e)}function j(t){var e={url:"/finance/r/page",method:"post",data:t};return Object(i["a"])(e)}function D(t){var e={url:"/finance/account/query",method:"post",data:t};return Object(i["a"])(e)}function A(t){var e={url:"/finance/r/payback",method:"get",params:t};return Object(i["a"])(e)}function C(t){var e={url:"/finance/r/info",method:"get",params:t};return Object(i["a"])(e)}function N(t){var e={url:"/finance/r/add",method:"post",data:t};return Object(i["a"])(e)}function z(t){var e={url:"/finance/r/edit",method:"post",data:t};return Object(i["a"])(e)}function $(t){var e={url:"/auth/r/del",method:"delete",params:t};return Object(i["a"])(e)}function F(t){var e={url:"/auth/acct/getAcctList",method:"get",params:t};return Object(i["a"])(e)}function R(t){var e={url:"/finance/r/export",method:"post",responseType:"blob",data:t};return Object(i["a"])(e)}function E(t){var e={url:"/finance/apply/page",method:"post",data:t};return Object(i["a"])(e)}function P(t){var e={url:"/finance/account/handel",method:"post",data:t};return Object(i["a"])(e)}function M(t){var e={url:"/finance/apply/get",method:"get",params:t};return Object(i["a"])(e)}function W(t){var e={url:"/auth/apply/del",method:"delete",params:t};return Object(i["a"])(e)}function q(t){var e={url:"/finance/apply/add",method:"post",data:t};return Object(i["a"])(e)}function X(t){var e={url:"/finance/apply/edit",method:"post",data:t};return Object(i["a"])(e)}function B(t){var e={url:"/auth/customer/customer",method:"post",data:t};return Object(i["a"])(e)}function Y(t){var e={url:"/finance/account/audit",method:"get",params:t};return Object(i["a"])(e)}function H(t){var e={url:"/finance/r/audit",method:"get",params:t};return Object(i["a"])(e)}function Q(t){var e={url:"/auth/apply/audit",method:"post",params:t};return Object(i["a"])(e)}function J(t){var e={url:"/auth/p/audit",method:"post",params:t};return Object(i["a"])(e)}function U(t){var e={url:"/orders/fullorder/getOrderList",method:"post",data:t};return Object(i["a"])(e)}function V(t){var e={url:"/orders/declare_order/get_declare_data",method:"post",data:t};return Object(i["a"])(e)}function G(t){var e={url:"/orders/card/get_data",method:"post",data:t};return Object(i["a"])(e)}function K(t){var e={url:"/orders/trailer/page",method:"post",data:t};return Object(i["a"])(e)}function Z(t){var e={url:"/express/web/expressorder/list",method:"post",data:t};return Object(i["a"])(e)}function tt(){var t={url:"/auth/agent/customer_finance",method:"get"};return Object(i["a"])(t)}function et(t){var e={url:"/finance/bill/billPage",method:"post",data:t};return Object(i["a"])(e)}function at(t){var e={url:"/finance/account/unverified",method:"post",data:t};return Object(i["a"])(e)}function nt(t){var e={url:"/auth/supplier/custType",method:"post",data:t};return Object(i["a"])(e)}},d97f:function(t,e,a){},ec8d:function(t,e,a){"use strict";var n=a("d97f"),i=a.n(n);i.a}}]);