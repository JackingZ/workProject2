(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["invoice-receivable"],{"2b3f":function(e,t,a){},"8d2b":function(e,t,a){"use strict";var i=a("2b3f"),r=a.n(i);r.a},9341:function(e,t,a){},"9aa6":function(e,t,a){"use strict";var i=a("9341"),r=a.n(i);r.a},dddd:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","min-height":"inherit"}},[a("div",{staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.detailShow,expression:"!detailShow"}],staticClass:"app-container"},[a("div",{staticClass:"finance-header"},[a("div",{staticStyle:{width:"100px",color:"#909399","font-weight":"400","font-size":"16px"}},[e._v("\n          应收款\n        ")]),a("div",{staticStyle:{width:"130px"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{loading:e.selectLoading,placeholder:"服务大类",size:"small",filterable:""},on:{change:e.handleService},model:{value:e.searchForm.serviceTypeId,callback:function(t){e.$set(e.searchForm,"serviceTypeId",t)},expression:"searchForm.serviceTypeId"}},e._l(e.serviceList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),a("div",{staticStyle:{flex:"1","text-align":"right"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:"05"===e.searchForm.serviceTypeId,expression:"searchForm.serviceTypeId === '05'"}],attrs:{loading:e.excelLoading,type:"primary",size:"small"},on:{click:e.handleExport}},[e._v("\n            导出当前数据\n          ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"05"===e.searchForm.serviceTypeId,expression:"searchForm.serviceTypeId === '05'"}],attrs:{loading:e.exportLoading,type:"primary",size:"small"},on:{click:e.handleExport2}},[e._v("\n            导出明细\n          ")])],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"app-panel"},[a("el-row",[a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:24}},[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["finaReceiveAdd"],expression:"['finaReceiveAdd']"}],staticStyle:{float:"left"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:e.handleAdd}},[e._v("\n              新增应收款\n            ")]),"2"===e.custType&&"1"===e.custSubtype||"3"===e.custType?a("el-select",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{size:"small",placeholder:"公司类型"},on:{change:e.onComType},model:{value:e.searchForm.comType,callback:function(t){e.$set(e.searchForm,"comType",t)},expression:"searchForm.comType"}},e._l(e.companyTypeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1):e._e(),"2"===e.searchForm.comType||"4"===e.searchForm.comType||"5"===e.searchForm.comType?a("el-select",{staticStyle:{width:"170px","margin-right":"5px"},attrs:{loading:e.selectLoading,size:"small",placeholder:"所属公司",filterable:"",clearable:""},on:{change:e.onCompany,focus:e.getCompanyList},model:{value:e.searchForm.comId,callback:function(t){e.$set(e.searchForm,"comId",t)},expression:"searchForm.comId"}},e._l(e.companyList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1):e._e(),a("el-select",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{placeholder:"状态",size:"small",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},e._l(e.statusList,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1),a("el-select",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{placeholder:"核销状态",size:"small",clearable:""},model:{value:e.searchForm.ifVerify,callback:function(t){e.$set(e.searchForm,"ifVerify",t)},expression:"searchForm.ifVerify"}},[a("el-option",{attrs:{label:"已核销",value:1}}),a("el-option",{attrs:{label:"未核销",value:0}})],1),a("el-date-picker",{staticStyle:{width:"240px","margin-right":"5px"},attrs:{type:"daterange","unlink-panels":"",align:"right",size:"small","range-separator":"~","value-format":"yyyy-MM-dd","start-placeholder":"起始日期","end-placeholder":"结束日期"},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}}),a("el-input",{staticClass:"input-with-select",staticStyle:{width:"250px","margin-right":"10px"},attrs:{placeholder:"请输入内容",size:"small",clearable:""},model:{value:e.keyWord,callback:function(t){e.keyWord=t},expression:"keyWord"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",size:"small",placeholder:"请选择"},slot:"prepend",model:{value:e.selectType,callback:function(t){e.selectType=t},expression:"selectType"}},[a("el-option",{directives:[{name:"show",rawName:"v-show",value:!["02","06"].includes(e.searchForm.serviceTypeId),expression:"!['02','06'].includes(searchForm.serviceTypeId)"}],attrs:{label:"原单号",value:"1"}}),a("el-option",{attrs:{label:"开票企业",value:"2"}}),a("el-option",{directives:[{name:"show",rawName:"v-show",value:["02"].includes(e.searchForm.serviceTypeId),expression:"['02'].includes(searchForm.serviceTypeId)"}],attrs:{label:"提单号",value:"4"}}),a("el-option",{directives:[{name:"show",rawName:"v-show",value:["02","06"].includes(e.searchForm.serviceTypeId),expression:"['02', '06'].includes(searchForm.serviceTypeId)"}],attrs:{label:"SO号",value:"5"}}),a("el-option",{directives:[{name:"show",rawName:"v-show",value:["02"].includes(e.searchForm.serviceTypeId),expression:"['02'].includes(searchForm.serviceTypeId)"}],attrs:{label:"柜号",value:"6"}})],1)],1),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["finaReceiveQuery"],expression:"['finaReceiveQuery']"}],attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleSearch(1)}}},[e._v("\n              查询\n            ")])],1)],1),a("div",{staticStyle:{height:"680px"}},[e.tableData.length?a("vxe-table",{staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.tableData,"auto-resize":!0,height:"640",border:"",resizable:"",size:"small"},on:{"checkbox-change":e.rowSelectChange}},[a("vxe-table-column",{attrs:{fixed:"left",type:"checkbox",width:"55"}}),a("vxe-table-column",{attrs:{visible:"02"!==e.searchForm.serviceTypeId&&"06"!==e.searchForm.serviceTypeId,fixed:"left",width:"160",title:"原单号"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.orderCode))])]}}],null,!1,2549254981)}),a("vxe-table-column",{attrs:{fixed:"left",visible:"02"===e.searchForm.serviceTypeId||"06"===e.searchForm.serviceTypeId,width:"160",title:"SO号"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s((t.row.soNoList||[]).join(",")))])]}}],null,!1,2108195871)}),a("vxe-table-column",{attrs:{visible:"02"===e.searchForm.serviceTypeId,width:"160",title:"提单号"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s((t.row.billNoList||[]).join(",")))])]}}],null,!1,528558280)}),a("vxe-table-column",{attrs:{visible:"02"===e.searchForm.serviceTypeId,width:"160",title:"航空单号"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s((t.row.airNoList||[]).join(",")))])]}}],null,!1,3875341849)}),a("vxe-table-column",{attrs:{visible:"02"===e.searchForm.serviceTypeId,width:"160",title:"柜号"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s((t.row.containerNoList||[]).join(",")))])]}}],null,!1,3174292868)}),a("vxe-table-column",{attrs:{title:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s((e.statusList.find(function(e){return e.id===t.row.status})||{}).name))])]}}],null,!1,641954429)}),a("vxe-table-column",{attrs:{title:"核销状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.ifVerify?a("span",[e._v("已核销")]):e._e(),0===t.row.ifVerify?a("span",[e._v("未核销")]):e._e()]}}],null,!1,1233879789)}),a("vxe-table-column",{attrs:{title:"发票日期",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.invDate))])]}}],null,!1,2385324867)}),a("vxe-table-column",{attrs:{title:"客户名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.clientName))])]}}],null,!1,549671992)}),a("vxe-table-column",{attrs:{title:"客户属性",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"===t.row.clientProperty?a("span",[e._v("聚货通")]):"3"===t.row.clientProperty?a("span",[e._v("供应商")]):"2-1"===t.row.clientProperty?a("span",[e._v("一级代理")]):"2-2"===t.row.clientProperty?a("span",[e._v("二级代理")]):"1-0"===t.row.clientProperty?a("span",[e._v("直客")]):"1-1"===t.row.clientProperty?a("span",[e._v("同行")]):a("span",[e._v("--")])]}}],null,!1,804418718)}),a("vxe-table-column",{attrs:{title:"货币",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(""+(t.row.currencyName||"")+(t.row.currencyId||"")))])]}}],null,!1,2595197676)}),a("vxe-table-column",{attrs:{"min-width":"100",title:"金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.amount))])]}}],null,!1,1167497322)}),a("vxe-table-column",{attrs:{width:"170",title:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.createTime))])]}}],null,!1,2774630583)}),a("vxe-table-column",{attrs:{title:"审核时间",width:"170"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.auditTime))])]}}],null,!1,202786590)}),a("vxe-table-column",{attrs:{width:"170",title:"截止付款时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.cutoffTime))])]}}],null,!1,1444452830)}),a("vxe-table-column",{attrs:{width:"100",title:"逾期天数"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.day))])]}}],null,!1,955831162)}),a("vxe-table-column",{attrs:{fixed:"right",title:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.ifVerify&&"3"!==t.row.status&&e.$checkPermission(["finaReceiveUpdate"])?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("\n                  编辑\n                ")]):e._e(),0===t.row.ifVerify&&e.$checkPermission(["finaReceiveDel"])?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleDelete(t.row.id)}}},[e._v("\n                  删除\n                ")]):e._e(),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["finaReceiveDetail"],expression:"['finaReceiveDetail']"}],attrs:{type:"text"},on:{click:function(a){return e.handleDetail(t.row.id)}}},[e._v("\n                  查看详情\n                ")]),"1"!==t.row.status&&e.$checkPermission(["finaReceiveAudit"])?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleAudit(t.row,t.$index)}}},[e._v("\n                  审核\n                ")]):e._e()]}}],null,!1,856113560)})],1):e._e(),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":e.page,"page-size":e.size,layout:"total, prev, pager, next",total:e.total},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.detailShow,expression:"detailShow"}],staticClass:"app-container"},[a("detail",{ref:"detailForm",attrs:{"is-add":e.isAdd,"is-view":e.isView,"is-edit":e.isEdit,"is-once":e.isOnce,"status-list":e.statusList},on:{back:function(t){e.detailShow=!1},getTableData:e.handleSearch}})],1),a("el-dialog",{attrs:{title:"订单详情",visible:e.moreShow,"close-on-click-modal":!1,width:"800px"},on:{"update:visible":function(t){e.moreShow=t},closed:function(t){e.moreShow=!1}}},[a("orderInfo",{attrs:{"order-form":e.orderForm,"status-list":e.statusList,"subtype-list":e.subtypeList,loading:e.dialogLoading}})],1),a("el-dialog",{attrs:{title:"申请调校",visible:e.dialogAdjust,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.dialogAdjust=t},closed:function(t){e.dialogAdjust=!1}}},[a("adjust")],1),a("el-dialog",{attrs:{title:"申请抵扣",visible:e.dialogDeduct,"close-on-click-modal":!1,width:"1000px"},on:{"update:visible":function(t){e.dialogDeduct=t},closed:function(t){e.dialogDeduct=!1}}},[a("deduct")],1),a("el-dialog",{attrs:{title:"发票审核",visible:e.dialogAudit,"close-on-click-modal":!1,width:"700px"},on:{"update:visible":function(t){e.dialogAudit=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}]},[a("el-form",{ref:"auditForm",staticStyle:{"padding-top":"20px"},attrs:{model:e.auditForm,rules:e.auditFormRules,"label-width":"110px",size:"small"}},[a("el-form-item",{attrs:{label:"审核",prop:"status"}},[a("el-radio-group",{model:{value:e.auditForm.status,callback:function(t){e.$set(e.auditForm,"status",t)},expression:"auditForm.status"}},[a("el-radio",{attrs:{label:"1"}},[e._v("\n                通过\n              ")]),a("el-radio",{attrs:{label:"2"}},[e._v("\n                拒绝\n              ")])],1)],1)],1),a("div",{staticStyle:{"text-align":"right","padding-top":"10px"}},[a("el-button",{attrs:{size:"small"},on:{click:e.cancelAudit}},[e._v("\n            取 消\n          ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirmAudit}},[e._v("\n            确 定\n          ")])],1)],1)])],1)])},r=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("a8db")),o=a("bd86"),s=(a("7514"),a("96cf"),a("3b8d")),l=a("d225"),c=a("b0b4"),u=a("308d"),d=a("6bb5"),m=a("4e2b"),p=a("9ab4"),h=a("60a3"),f=a("9dba"),y=a("812b"),v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.detailLoading,expression:"detailLoading"}],staticStyle:{"background-color":"#ffffff"}},[a("div",{staticStyle:{padding:"0 20px","line-height":"50px","border-bottom":"1px solid #e8e8e8"}},[a("div",{staticStyle:{"text-align":"right"}},[a("span",{staticStyle:{cursor:"pointer"},on:{click:e.handleBack}},[a("i",{staticClass:"el-icon-back"}),a("span",[e._v("返回")])])])]),a("div",{staticClass:"app-panel order-detail"},[a("el-row",{staticStyle:{padding:"10px"}},[a("el-col",{staticStyle:{"font-weight":"700","font-size":"18px","line-height":"30px"},attrs:{span:4}},[e._v("\n        应收款\n      ")]),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:20}},[e.isView?e._e():a("el-button",{attrs:{type:"primary",size:"mini",disabled:!e.form.exRate},on:{click:e.handleSave}},[e._v("\n          "+e._s(e.isOnce?"提交":"重新提交")+"\n        ")])],1)],1),e.form.code||e.form.status?a("el-row",{staticStyle:{"background-color":"#f2f2f2",padding:"10px 20px"}},[e.form.code?a("el-col",{attrs:{span:6}},[e._v("\n        编号："+e._s(e.form.code)+"\n      ")]):e._e(),e.form.status?a("el-col",{attrs:{span:6}},[e._v("\n        状态："+e._s((e.statusList.find(function(t){return t.id===e.form.status})||{}).name)+"\n      ")]):e._e(),e.isView?a("el-col",{attrs:{span:6}},[e._v("\n        核销状态："+e._s(1===e.form.ifVerify?"已核销":"未核销")+"\n      ")]):e._e()],1):e._e(),a("el-form",{ref:"editForm",class:e.isView?"view-item":"",staticStyle:{"padding-top":"20px"},attrs:{model:e.form,rules:e.formRules,"label-width":"110px",size:"small"}},[a("el-form-item",{attrs:{label:"客户",prop:"clientName"}},[e.isView?a("span",[e._v("\n          "+e._s(e.form.clientName)+"\n        ")]):a("el-input",{attrs:{size:"small",placeholder:"请输入",disabled:""},model:{value:e.form.clientName,callback:function(t){e.$set(e.form,"clientName",t)},expression:"form.clientName"}},[e.isOnce?a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleCustomer},slot:"append"}):e._e()],1)],1),a("el-form-item",{attrs:{label:"服务类型",prop:"serviceTypeId"}},[e.isView?a("span",[e._v("\n          "+e._s(e.form.serviceTypeName)+"\n        ")]):a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:!e.form.clientId,loading:e.selectLoading,placeholder:"请选择"},on:{change:e.onServiceType,focus:e.getServiceType},model:{value:e.form.serviceTypeId,callback:function(t){e.$set(e.form,"serviceTypeId",t)},expression:"form.serviceTypeId"}},e._l(e.serviceTypeList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),a("el-form-item",{attrs:{label:"原单号",prop:"orderCode"}},[e.isView?a("span",{staticClass:"number-text"},[e._v("\n          "+e._s(e.form.orderCode)+"\n        ")]):a("el-input",{attrs:{size:"small",placeholder:"请输入",disabled:""},model:{value:e.form.orderCode,callback:function(t){e.$set(e.form,"orderCode",t)},expression:"form.orderCode"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleCode},slot:"append"})],1)],1),a("el-form-item",{attrs:{label:"发票日期",prop:"invDate"}},[e.isView?a("span",[e._v("\n          "+e._s(e.form.invDate)+"\n        ")]):a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择"},model:{value:e.form.invDate,callback:function(t){e.$set(e.form,"invDate",t)},expression:"form.invDate"}})],1),a("el-form-item",{attrs:{label:"发票类型",prop:"invoiceType"}},[e.isView?a("span",[e._v("\n          "+e._s((e.invoiceTypeList.find(function(t){return t.value===e.form.invoiceType})||{}).label)+"\n        ")]):a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small",filterable:""},model:{value:e.form.invoiceType,callback:function(t){e.$set(e.form,"invoiceType",t)},expression:"form.invoiceType"}},e._l(e.invoiceTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("el-form-item",{attrs:{label:"发票货币",prop:"currencyId"}},[e.isView?a("span",[e._v("\n          "+e._s(e.form.currencyId)+"\n        ")]):a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",size:"small",loading:e.selectLoading,filterable:""},on:{change:e.onCurrency},model:{value:e.form.currencyId,callback:function(t){e.$set(e.form,"currencyId",t)},expression:"form.currencyId"}},e._l(e.currencyList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name+"-"+e.sign,value:e.id}})}),1)],1),a("el-form-item",{attrs:{label:"汇率",prop:"exRate"}},[e.isView?a("span",[e._v("\n          "+e._s(e.form.exRate)+"\n        ")]):a("el-input-number",{staticClass:"input-number-valiate",attrs:{controls:!1,placeholder:"请输入",size:"small",min:0,max:9999},on:{change:e.onAmount},model:{value:e.form.exRate,callback:function(t){e.$set(e.form,"exRate",t)},expression:"form.exRate"}})],1),e.isView&&["02","06"].includes(e.form.serviceTypeId)?a("el-form-item",{attrs:{label:"SO号"}},[a("span",{staticClass:"number-text"},[e._v(e._s((e.form.soNoList||[]).join(",")))])]):e._e(),e.isView&&"02"===e.form.serviceTypeId?a("el-form-item",{attrs:{label:"提单号"}},[a("span",{staticClass:"number-text"},[e._v(e._s((e.form.billNoList||[]).join(",")))])]):e._e(),e.isView&&"02"===e.form.serviceTypeId?a("el-form-item",{attrs:{label:"航空单号"}},[a("span",{staticClass:"number-text"},[e._v(e._s((e.form.airNoList||[]).join(",")))])]):e._e(),e.isView&&"02"===e.form.serviceTypeId?a("el-form-item",{attrs:{label:"柜号"}},[a("span",{staticClass:"number-text"},[e._v(e._s((e.form.containerNoList||[]).join(",")))])]):e._e(),e.isView?a("el-form-item",{attrs:{label:"审核时间"}},[a("span",[e._v("\n          "+e._s(e.form.auditTime)+"\n        ")])]):e._e(),a("el-form-item",{attrs:{label:"截止付款时间"}},[e._v("\n        "+e._s(e.form.cutoffTime||"--")+"\n      ")]),a("el-form-item",{attrs:{label:"付款时间"}},[e._v("\n        "+e._s(e.form.payTime||"--")+"\n      ")]),a("el-form-item",{attrs:{label:"逾期天数"}},[e._v("\n        "+e._s(e.form.day||"--")+"\n      ")]),e.isView?e._e():a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入",clearable:""},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1),e.isView?a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"备注"}},[a("span",[e._v("\n          "+e._s(e.form.remark)+"\n        ")])]):e._e()],1),a("div",[a("div",{staticStyle:{"border-top":"1px solid #e8e8e8","line-height":"50px"}},[e._v("\n        明细行\n      ")]),a("el-row",[a("el-col",{attrs:{span:20}},[a("span",{staticStyle:{"font-weight":"700","padding-left":"20px"}},[e._v("总计：")]),a("span",[e._v("开票总金额：")]),a("span",[e._v(e._s(e.amountText))]),a("span",[e._v(e._s((e.form.currencyName||"--")+"/"+(e.form.currencyId||"")))]),a("span",[e._v("， 账单本币总金额：")]),a("span",[e._v(e._s(e.selfAmountText))]),a("span",[e._v(e._s((e.selfCurrency.currencyName||"--")+"/"+(e.selfCurrency.currencyId||"")))])]),a("el-col",{attrs:{span:4}},[a("div",{staticStyle:{"text-align":"right","padding-right":"10px"}},[e.isView?e._e():a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleAddBill}},[e._v("\n              添加明细行\n            ")])],1)])],1),a("el-table",{staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.tableData,"header-align":"center",align:"center",border:""}},[a("el-table-column",{attrs:{label:"行号",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(t.$index+1)+"\n          ")]}}])}),a("el-table-column",{attrs:{prop:"costitemName",label:"项目"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isView?a("span",[e._v("\n              "+e._s(t.row.costitemName)+"\n            ")]):a("el-input",{attrs:{size:"small",placeholder:"请输入",clearable:"",disabled:""},model:{value:t.row.costitemName,callback:function(a){e.$set(t.row,"costitemName",a)},expression:"scope.row.costitemName"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(a){return e.handleProject(t.$index)}},slot:"append"})],1)]}}])}),a("el-table-column",{attrs:{prop:"itemDesc",label:"说明"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isView?a("span",[e._v("\n              "+e._s(t.row.itemDesc)+"\n            ")]):a("el-input",{attrs:{size:"small",placeholder:"请输入",clearable:""},model:{value:t.row.itemDesc,callback:function(a){e.$set(t.row,"itemDesc",a)},expression:"scope.row.itemDesc"}})]}}])}),a("el-table-column",{attrs:{prop:"quantity",label:"数量",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isView?a("span",[e._v("\n              "+e._s(t.row.quantity)+"\n            ")]):a("el-input-number",{staticClass:"input-number-valiate",attrs:{controls:!1,placeholder:"请输入",size:"small",min:-99999999,max:99999999},on:{change:function(a){return e.handlerChange(t.row)}},model:{value:t.row.quantity,callback:function(a){e.$set(t.row,"quantity",a)},expression:"scope.row.quantity"}})]}}])}),a("el-table-column",{attrs:{prop:"price",label:"单价",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isView?a("span",[e._v("\n              "+e._s(t.row.price)+"\n            ")]):a("el-input-number",{staticClass:"input-number-valiate",attrs:{controls:!1,placeholder:"请输入",size:"small",min:-999999,max:999999,precision:4},on:{change:function(a){return e.handlerChange(t.row)}},model:{value:t.row.price,callback:function(a){e.$set(t.row,"price",a)},expression:"scope.row.price"}})]}}])}),a("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120"}}),a("el-table-column",{attrs:{prop:"selfAmount",label:"账单本币金额",width:"120"}}),a("el-table-column",{attrs:{fixed:"right",width:"100px",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isView?e._e():a("el-button",{staticStyle:{color:"#f56c6c"},attrs:{type:"text"},on:{click:function(a){return e.handleDelete(t.$index)}}},[e._v("\n              删除\n            ")])]}}])})],1),a("el-dialog",{attrs:{title:"选择客户",visible:e.isCustomer,"close-on-click-modal":!1,width:"1000px"},on:{"update:visible":function(t){e.isCustomer=t},closed:function(t){e.isCustomer=!1}}},[a("div",{staticStyle:{"text-align":"right"}},["2"===e.custType&&"1"===e.custSubtype?a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"公司类型"},on:{change:e.onComType},model:{value:e.form.custTag,callback:function(t){e.$set(e.form,"custTag",t)},expression:"form.custTag"}},[a("el-option",{attrs:{label:"本公司",value:"1"}}),a("el-option",{attrs:{label:"分公司",value:"2"}})],1):e._e(),"2"===e.custType&&"1"===e.custSubtype&&"2"===e.form.custTag?a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:e.selectLoading,size:"small",placeholder:"所属公司",filterable:"",clearable:""},on:{change:e.onCompany,focus:e.getCompanyList},model:{value:e.form.agentId,callback:function(t){e.$set(e.form,"agentId",t)},expression:"form.agentId"}},e._l(e.companyList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1):e._e(),a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{placeholder:"客户类型",filterable:"",size:"small"},on:{change:e.onClientType},model:{value:e.form.clientType,callback:function(t){e.$set(e.form,"clientType",t)},expression:"form.clientType"}},e._l(e.custTypeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1),"3"!==e.custType||"0"!==e.form.clientType?a("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"客户",size:"small",clearable:""},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}}):e._e(),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onCustomer}},[e._v("\n            查询\n          ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.customerList,border:"",height:"375px"},on:{"row-click":function(t){return e.onTableRowClick(t,"customer")}}},[a("el-table-column",{attrs:{prop:"name",label:"客户名称"}}),a("el-table-column",{attrs:{prop:"",label:"客户属性"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"===t.row.type?a("span",[e._v("聚货通")]):"3"===t.row.type?a("span",[e._v("供应商")]):"2"===t.row.type&&"1"===t.row.subtype?a("span",[e._v("一级代理")]):"2"===t.row.type&&"2"===t.row.subtype?a("span",[e._v("二级代理")]):"1"===t.row.type&&"0"===t.row.subtype?a("span",[e._v("直客")]):"1"===t.row.type&&"1"===t.row.subtype?a("span",[e._v("同行")]):a("span",[e._v("--")])]}}])}),a("el-table-column",{attrs:{prop:"parentName",label:"所属上级"}})],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":e.pagination.page,"page-size":e.pagination.size,layout:"total, prev, pager, next",total:e.pagination.total},on:{"update:currentPage":function(t){return e.$set(e.pagination,"page",t)},"update:current-page":function(t){return e.$set(e.pagination,"page",t)},"current-change":e.handlePageChange}})],1),a("el-dialog",{attrs:{title:"选择原单号",visible:e.isNumber,"close-on-click-modal":!1,width:"1200px"},on:{"update:visible":function(t){e.isNumber=t},closed:e.cancelNumber}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}]},[a("div",{staticStyle:{"text-align":"right"}},[a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{placeholder:"订单类别",size:"small",filterable:""},on:{change:e.handleNumber},model:{value:e.searchForm.type,callback:function(t){e.$set(e.searchForm,"type",t)},expression:"searchForm.type"}},e._l(e.typeList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),a("el-date-picker",{staticStyle:{width:"240px","margin-right":"5px"},attrs:{clearable:!1,"unlink-panels":"",type:"daterange",align:"right",size:"small","value-format":"yyyy-MM-dd","range-separator":"~","start-placeholder":"下单起始时间","end-placeholder":"下单截止时间"},model:{value:e.searchForm.orderTime,callback:function(t){e.$set(e.searchForm,"orderTime",t)},expression:"searchForm.orderTime"}}),a("el-input",{staticClass:"input-with-select",staticStyle:{width:"250px","margin-right":"10px"},attrs:{placeholder:"请输入内容",size:"small",clearable:""},model:{value:e.searchForm.number,callback:function(t){e.$set(e.searchForm,"number",t)},expression:"searchForm.number"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",size:"small",placeholder:"请选择"},slot:"prepend",model:{value:e.selectType,callback:function(t){e.selectType=t},expression:"selectType"}},[a("el-option",{directives:[{name:"show",rawName:"v-show",value:!["02","06"].includes(e.form.serviceTypeId),expression:"!['02','06'].includes(form.serviceTypeId)"}],attrs:{label:"原单号",value:"1"}}),a("el-option",{directives:[{name:"show",rawName:"v-show",value:["02"].includes(e.form.serviceTypeId),expression:"['02'].includes(form.serviceTypeId)"}],attrs:{label:"航空单号",value:"3"}}),a("el-option",{directives:[{name:"show",rawName:"v-show",value:["02"].includes(e.form.serviceTypeId),expression:"['02'].includes(form.serviceTypeId)"}],attrs:{label:"提单号",value:"4"}}),a("el-option",{directives:[{name:"show",rawName:"v-show",value:["02","06"].includes(e.form.serviceTypeId),expression:"['02', '06'].includes(form.serviceTypeId)"}],attrs:{label:"SO号",value:"5"}}),a("el-option",{directives:[{name:"show",rawName:"v-show",value:["02"].includes(e.form.serviceTypeId),expression:"['02'].includes(form.serviceTypeId)"}],attrs:{label:"柜号",value:"6"}})],1)],1),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.handleNumber}},[e._v("\n              查询\n            ")])],1),"02"!==e.form.serviceTypeId?a("el-table",{staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.numberData,border:"","max-height":"300"},on:{"row-click":function(t){return e.onTableRowClick(t,"order")}}},[a("el-table-column",{attrs:{width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return["06"!==e.form.serviceTypeId?a("span",[e._v(e._s(t.row.code))]):e._e(),"06"===e.form.serviceTypeId?a("span",[e._v(e._s((t.row.soCodes||[]).join(",")))]):e._e()]}}],null,!1,541117857)},[a("template",{slot:"header"},["06"!==e.form.serviceTypeId?a("span",[e._v("原单号")]):e._e(),"06"===e.form.serviceTypeId?a("span",[e._v("SO号")]):e._e()])],2),a("el-table-column",{attrs:{formatter:e.formmatType,label:"业务类型",width:"100"}}),a("el-table-column",{attrs:{prop:"createTime",label:"下单时间",width:"180"}}),a("el-table-column",{attrs:{label:"下单客户","show-overflow-tooltip":"",prop:"buyerName"}}),a("el-table-column",{attrs:{label:"下单仓库",width:"180",prop:"warehouseName","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"packages",label:"箱数",width:"120"}}),a("el-table-column",{attrs:{prop:"volumes",label:"体积",width:"120"}})],1):e._e(),"02"===e.form.serviceTypeId&&e.searchForm.type&&e.bookingData.length>0?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.bookingData,border:"","max-height":"300"},on:{"row-click":function(t){return e.onTableRowClick(t,"order")}}},[a("el-table-column",{attrs:{fixed:"left",prop:"code",label:"原单号","min-width":"180","show-overflow-tooltip":""}}),"1"===e.searchForm.type?a("el-table-column",{attrs:{prop:"soCode",label:"SO号","min-width":"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.soCode||"-")+"\n              ")]}}],null,!1,564337601)}):e._e(),"0"===e.searchForm.type?a("el-table-column",{attrs:{prop:"billNo",label:"提单号","min-width":"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.billNo||"-")+"\n              ")]}}],null,!1,648134554)}):e._e(),"0"===e.searchForm.type?a("el-table-column",{attrs:{prop:"airNo",label:"航空单号","min-width":"150","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.airNo||"-")+"\n              ")]}}],null,!1,2703078379)}):e._e(),a("el-table-column",{attrs:{prop:"",formatter:e.formatStatus,label:"订单状态",width:"120"}}),a("el-table-column",{attrs:{prop:"audit",label:"审核状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"===t.row.audit?a("span",[e._v("待审核")]):"1"===t.row.audit?a("span",[e._v("审核通过")]):"2"===t.row.audit?a("span",[e._v("审核拒绝")]):e._e()]}}],null,!1,1049201113)}),a("el-table-column",{attrs:{prop:"businessType",label:"业务类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return["0"===t.row.businessType?a("span",[e._v("空运")]):"1"===t.row.businessType?a("span",[e._v("海运")]):"2"===t.row.businessType?a("span",[e._v("铁路")]):"4"===t.row.businessType?a("span",[e._v("卡航")]):e._e()]}}],null,!1,1224297036)}),a("el-table-column",{attrs:{prop:"bsServiceName",label:"服务","min-width":"150","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"portsFromName",label:"起运港",width:"180"}}),a("el-table-column",{attrs:{prop:"portsToName",label:"目的港",width:"180"}}),a("el-table-column",{attrs:{prop:"supplierName",label:"供应商名称",width:"180","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"custName",label:"下单客户",width:"180","show-overflow-tooltip":""}}),"1"===e.searchForm.type?a("el-table-column",{attrs:{label:"起运港提柜",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatContain(t.row,"251"))+"\n              ")]}}],null,!1,57053563)}):e._e(),"1"===e.searchForm.type?a("el-table-column",{attrs:{label:"起运港已装柜",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatContain(t.row,"252"))+"\n              ")]}}],null,!1,3337495448)}):e._e(),"1"===e.searchForm.type?a("el-table-column",{attrs:{label:"起运港已还柜",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatContain(t.row,"255"))+"\n              ")]}}],null,!1,3157835007)}):e._e(),"1"===e.searchForm.type?a("el-table-column",{attrs:{label:"目的港已提柜",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatContain(t.row,"256"))+"\n              ")]}}],null,!1,2143309596)}):e._e(),"1"===e.searchForm.type?a("el-table-column",{attrs:{label:"目的港已还柜",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e.formatContain(t.row,"257"))+"\n              ")]}}],null,!1,3968928061)}):e._e(),a("el-table-column",{attrs:{prop:"createTime",label:"下单时间",width:"180"}})],1):e._e(),a("el-pagination",{staticStyle:{"text-align":"right","margin-top":"10px"},attrs:{"current-page":e.pagination.page,"page-size":e.pagination.size,layout:"total, prev, pager, next",total:e.pagination.total},on:{"update:currentPage":function(t){return e.$set(e.pagination,"page",t)},"update:current-page":function(t){return e.$set(e.pagination,"page",t)},"current-change":function(t){return e.handleCurrentChange(t,"order")}}})],1)]),a("el-dialog",{attrs:{title:"选择项目",visible:e.isProject,"close-on-click-modal":!1,width:"1200px"},on:{"update:visible":function(t){e.isProject=t},closed:function(t){e.isProject=!1}}},[a("div",{staticStyle:{"text-align":"right"}},[a("el-input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{placeholder:"项目名称",size:"small",clearable:""},model:{value:e.searchForm.projectName,callback:function(t){e.$set(e.searchForm,"projectName",t)},expression:"searchForm.projectName"}}),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.getProjectList}},[e._v("\n            查询\n          ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.projectData,border:"",height:"300px"},on:{"row-click":function(t){return e.onTableRowClick(t,"project")}}},[a("el-table-column",{attrs:{prop:"name",label:"项目中文名称"}}),a("el-table-column",{attrs:{prop:"alias",label:"项目英文名称"}}),a("el-table-column",{attrs:{label:"项目类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s((t.row.types||[]).map(function(e){return e.typeName}).join(",")||"--")+"\n            ")]}}])}),a("el-table-column",{attrs:{prop:"settlement",label:"结算单位"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s((e.settlementList.find(function(e){return e.id===t.row.settlement})||{}).name||"--")+"\n            ")]}}])}),a("el-table-column",{attrs:{prop:"",label:"最低收费"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注",width:"200","show-overflow-tooltip":""}})],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":e.pagination.page,"page-size":e.pagination.size,layout:"total, prev, pager, next",total:e.pagination.total},on:{"update:currentPage":function(t){return e.$set(e.pagination,"page",t)},"update:current-page":function(t){return e.$set(e.pagination,"page",t)},"current-change":function(t){return e.handleCurrentChange(t,"project")}}})],1)],1)],1)])},g=[],b=(a("c5f6"),a("55dd"),a("28a5"),a("a481"),a("7f7f"),a("7dfc")),w=a("b70c"),k=a("5a0c"),T=a.n(k);function x(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?x(a,!0).forEach(function(t){Object(o["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):x(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function L(){return{serviceSubtypeId:void 0,currencyId:"RMB",currencyName:"人民币",selfId:void 0,selfName:void 0,selfAmount:0,exRate:1,id:void 0,amount:0,custTag:void 0,agentId:void 0,agentName:void 0,clientId:void 0,clientName:void 0,clientType:void 0,serviceTypeId:void 0,serviceTypeName:void 0,invoiceType:void 0,orderId:void 0,orderCode:void 0,invDate:T()().format("YYYY-MM-DD HH:mm:ss"),remark:void 0,billNoList:[],airNoList:[],soNoList:[],containerNoList:[]}}var I=function(e){function t(){var e;return Object(l["a"])(this,t),e=Object(u["a"])(this,Object(d["a"])(t).apply(this,arguments)),e.dayjs=T.a,e.form=L(),e.searchForm={name:"",type:"",number:"",projectName:"",orderTime:[]},e.pagination={page:1,size:10,total:0},e.formRules={agentId:[{required:!0,message:"请选择所属公司",trigger:"change"}],invoiceType:[{required:!0,message:"发票类型不能为空",trigger:"change"}],serviceTypeId:[{required:!0,message:"请选择服务类型",trigger:"change"}],currencyId:[{required:!0,message:"请选择发票货币",trigger:"change"}],exRate:[{required:!0,message:"汇率不能为空(根据发票货币确定)",trigger:"blur"}],clientName:[{required:!0,message:"客户不能为空",trigger:"change"}],invDate:[{required:!0,message:"请选择日期",trigger:"change"}],orderCode:[{required:!0,message:"原单号不能为空",trigger:"blur"}]},e.selfCurrency={currencyId:"RMB",currencyName:"人民币"},e.selectType="",e.detailLoading=!1,e.dialogLoading=!1,e.selectLoading=!1,e.isCustomer=!1,e.isNumber=!1,e.isProject=!1,e.invoiceTypeList=[{label:"订单发票",value:"1"},{label:"冲红发票",value:"2"}],e.serviceTypeList=[],e.currencyList=[],e.tableData=[],e.customerData=[],e.numberData=[],e.bookingData=[],e.projectData=[],e.companyList=[],e.custTypeList=[],e.settlementList=[{id:"0",name:"按重量"},{id:"1",name:"按体积"},{id:"2",name:"按金额"},{id:"3",name:"按票"},{id:"4",name:"按箱"},{id:"5",name:"按车"},{id:"6",name:"按柜"},{id:"7",name:"按里程"},{id:"8",name:"按时间"},{id:"9",name:"按托"},{id:"A",name:"按个数"}],e.orderStatusList=[],e.typeList=[],e.projectIndex=0,e.bookOrderStatusList=[],e}return Object(m["a"])(t,e),Object(c["a"])(t,[{key:"formatterCutoffTime",value:function(e){var t=e.cutoffTime;if(!t)return"--";if(T()(t).format("YYYY-MM-DD")===T()().format("YYYY-MM-DD"))return"--";var a=T()().diff(t,"day")+1;return a>0?a:"--"}},{key:"formatStatus",value:function(e){var t="";return this.bookOrderStatusList.map(function(a){a.key===e.orderStatus&&(t=a.value)}),t}},{key:"getStatusData",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.searchForm.type){e.next=2;break}return e.abrupt("return");case 2:return this.dialogLoading=!0,t={businessType:this.searchForm.type},e.next=6,Object(w["u"])(t).then(function(e){a.bookOrderStatusList=e.data||[]}).catch(function(){a.bookOrderStatusList=[],a.dialogLoading=!1});case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"formatContain",value:function(e,t){var a=(e||{}).containerStatus||[],i=a.filter(function(e){return e===t});return i.length+"/"+a.length}},{key:"handleBack",value:function(){this.resetDetail(),this.$emit("back")}},{key:"resetDetail",value:function(){this.form=L(),this.searchForm={name:"",type:"",number:"",projectName:"",orderTime:[]},this.tableData=[],this.customerData=[],this.typeList=[],this.serviceTypeList=[]}},{key:"validateData",value:function(e){var t=!0,a=this.$refs.editForm;if(a.validate(function(e){t=e}),0===this.tableData.length&&(this.$message.error("明细行不能为空"),t=!1),t)for(var i=0;i<this.tableData.length;i++){var r=this.tableData[i];if(!r.costitemId){this.$message.error("行号".concat(i+1,"项目不能为空")),t=!1;break}if(!r.itemDesc){this.$message.error("行号".concat(i+1,"说明不能为空")),t=!1;break}if(r.itemDesc.length>200){this.$message.error("行号".concat(i+1,"说明不能超过200个字符")),t=!1;break}if(!r.quantity&&0!==r.quantity){this.$message.error("行号".concat(i+1,"数量不能为空")),t=!1;break}if(!r.price&&0!==r.price){this.$message.error("行号".concat(i+1,"单价不能为空")),t=!1;break}t=!0}e(t)}},{key:"handleSave",value:function(){var e=this;this.validateData(function(t){if(t){var a=_({},e.form,{amount:e.amountText,selfAmount:e.selfAmountText,selfName:e.selfCurrency.currencyName,selfId:e.selfCurrency.currencyId,invDate:T()(e.form.invDate).format("YYYY-MM-DD"),status:"0",clientType:void 0,agentType:void 0,custTag:void 0,items:e.tableData.map(function(e){return e.price=parseFloat(e.price),e.amount=e.amount||0,e.selfAmount=e.selfAmount||0,e})});e.detailLoading=!0;var i=e.isOnce;i?Object(b["X"])(a).then(function(){e.detailLoading=!1,e.handleBack(),e.$emit("getTableData")}).catch(function(){e.detailLoading=!1}):Object(b["Y"])(a).then(function(){e.detailLoading=!1,e.handleBack(),e.$emit("getTableData")}).catch(function(){e.detailLoading=!1})}})}},{key:"onComType",value:function(){this.form.agentId="",this.form.agentName="",this.form.agentType="",this.form.clientName="",this.form.clientId="",this.form.clientType="",this.form.clientProperty="",this.form.orderCode="",this.form.orderId="",this.form.serviceTypeId="",this.form.serviceTypeName="",this.form.billNoList=[],this.form.airNoList=[],this.form.soNoList=[],this.form.containerNoList=[],this.numberData=[],this.typeList=[],this.customerData=[],this.setCustomerType(),"2"!==this.form.custTag&&(this.form.agentId=this.custId,this.form.agentName=this.custName,this.form.agentType=this.custType)}},{key:"onCompany",value:function(){var e=this;this.form.agentName="",this.form.agentType="",this.form.clientName="",this.form.clientId="",this.form.clientType="",this.form.clientProperty="",this.form.orderCode="",this.form.orderId="",this.form.serviceTypeId="",this.form.serviceTypeName="",this.form.billNoList=[],this.form.airNoList=[],this.form.soNoList=[],this.form.containerNoList=[],this.numberData=[],this.typeList=[],this.customerData=[];var t=this.companyList.find(function(t){return t.id===e.form.agentId});t&&(this.form.agentName=t.name,this.form.agentType="2")}},{key:"getCompanyList",value:function(){var e=this;this.selectLoading=!0,Object(b["S"])().then(function(t){var a=t.data||[];e.companyList=a,e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,t})}},{key:"onClientType",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.form.clientName="",this.form.clientId="",this.form.clientProperty="",this.form.orderCode="",this.form.orderId="",this.form.serviceTypeId="",this.form.serviceTypeName="",this.form.billNoList=[],this.form.airNoList=[],this.form.soNoList=[],this.form.containerNoList=[],this.numberData=[],this.typeList=[],this.customerData=[];case 14:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getServiceType",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t={cas:"",custId:this.form.clientId},"1"===this.form.clientType&&(t.cas="C"),"2"===this.form.clientType&&(t.cas="A"),this.selectLoading=!0,e.next=6,Object(b["U"])(t).then(function(e){a.selectLoading=!1;var t=e.data||[];a.serviceTypeList=JSON.parse(JSON.stringify(t).replace(/typeName/g,"name").replace(/typeId/g,"id").replace(/children/g,"list"))}).catch(function(){a.serviceTypeList=[],a.selectLoading=!1});case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"handleCustomer",value:function(){this.resetDialog(),this.isCustomer=!0}},{key:"onCustomer",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.custType,a=this.custSubtype,this.form.clientType){e.next=7;break}return this.$message.error("请选择客户类型"),e.abrupt("return",!1);case 7:if("3"!==t||"0"!==this.form.clientType){e.next=12;break}this.customerData=[{id:"0",name:"聚货通",type:"0",subtype:"",countryId:"CN",parentName:this.custName}],this.pagination.total=this.customerData.length,e.next=24;break;case 12:if("3"!==t||"2"!==this.form.clientType){e.next=17;break}return e.next=15,this.getAgentList("0");case 15:e.next=24;break;case 17:if("2"!==t||"1"!==a||"2"!==this.form.clientType){e.next=22;break}return e.next=20,this.getAgentList();case 20:e.next=24;break;case 22:return e.next=24,this.getCustomerData();case 24:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getCustomerData",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.dialogLoading=!0,t={custIds:[this.form.agentId],name:this.searchForm.name},e.next=4,Object(b["v"])(t).then(function(e){var t=e.data||[],i=t;a.customerData=i,a.pagination.total=a.customerData.length,a.dialogLoading=!1}).catch(function(e){return a.dialogLoading=!1,e});case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getAgentList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,i=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.dialogLoading=!0,a={page:this.pagination.page,size:9999,name:this.searchForm.name,parentId:t||this.form.agentId},e.next=4,Object(b["o"])(a).then(function(e){var t=e.data||{},a=t.result||[];i.customerData=a.map(function(e){return e.type="2",e}),i.pagination.total=t.total,i.dialogLoading=!1}).catch(function(e){return i.dialogLoading=!1,e});case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"handlePageChange",value:function(e){this.pagination.page=e}},{key:"handleCode",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.form.serviceTypeId){e.next=3;break}return this.$message.error("请选择服务类型"),e.abrupt("return");case 3:return this.numberData=[],this.bookingData=[],this.resetDialog(),this.isNumber=!0,this.searchForm.orderTime=[T()().subtract(30,"d").format("YYYY-MM-DD"),T()().format("YYYY-MM-DD")],e.next=10,this.handleNumber();case 10:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"cancelNumber",value:function(){this.isNumber=!1,this.numberData=[],this.bookingData=[],this.searchForm.type="",this.selectType=""}},{key:"handleNumber",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if("00"===this.form.serviceTypeId&&this.getExpressList(),"01"===this.form.serviceTypeId&&this.getCarOrderList(),"02"!==this.form.serviceTypeId){e.next=7;break}return this.bookingData=[],e.next=6,this.getStatusData();case 6:this.getBookOrderList();case 7:"03"===this.form.serviceTypeId&&this.getDeclareOrderList(),"04"===this.form.serviceTypeId&&this.getWarehouseList(),"05"===this.form.serviceTypeId&&this.getFullOrderList(),"06"===this.form.serviceTypeId&&this.getTrailerOrderList();case 11:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getBookOrderList",value:function(){var e=this;if(this.searchForm.type){this.dialogLoading=!0;var t={model:{businessType:this.searchForm.type,custId:this.form.agentId,custType:this.form.agentType,endTime:this.searchForm.orderTime[1],airNo:"3"===this.selectType?this.searchForm.number:void 0,billNo:"4"===this.selectType?this.searchForm.number:void 0,so:"5"===this.selectType?this.searchForm.number:void 0,containerNo:"6"===this.selectType?this.searchForm.number:void 0,orderType:"0",startTime:this.searchForm.orderTime[0],targetId:this.form.clientId},page:this.pagination.page,size:this.pagination.size};Object(w["p"])(t).then(function(t){e.dialogLoading=!1;var a=t.data||{};e.bookingData=(a.result||[]).map(function(e){return e.code=e.markNo,e}),e.pagination.total=a.total||0}).catch(function(t){return e.dialogLoading=!1,e.bookingData=[],e.pagination.total=0,t})}}},{key:"getTrailerOrderList",value:function(){var e=this,t={model:{sellerId:this.form.agentId,type:this.searchForm.type,soCodes:this.searchForm.number,orderType:0,customerId:this.form.clientId,endDate:this.searchForm.orderTime[1]+" 23:59:59",startDate:this.searchForm.orderTime[0]+" 00:00:00"},page:this.pagination.page,size:this.pagination.size};this.dialogLoading=!0,Object(b["R"])(t).then(function(t){e.dialogLoading=!1;var a=t.data||{};e.numberData=(a.result||[]).map(function(t){return{id:t.id,code:t.number||"--",type:t.type,createTime:t.createTime,buyerName:t.customerName||"--",warehouseName:t.wareHouse||"--",soCodes:t.soCodes||[],packages:t.total||"--",volumes:(e.$volumeConversion(t.volume,t.umVolume,"CBM")||"--")+"m³"}}),e.pagination.total=a.total||0}).catch(function(t){return e.dialogLoading=!1,e.numberData=[],e.pagination.total=0,t})}},{key:"getCarOrderList",value:function(){var e=this,t={model:{sellerId:this.form.agentId,isTask:"1",type:this.searchForm.type,number:this.searchForm.number,orderType:0,customerId:this.form.clientId,endDate:this.searchForm.orderTime[1]+" 23:59:59",startDate:this.searchForm.orderTime[0]+" 00:00:00"},page:this.pagination.page,size:this.pagination.size};this.dialogLoading=!0,Object(b["r"])(t).then(function(t){e.dialogLoading=!1;var a=t.data||{};e.numberData=(a.result||[]).map(function(t){return{id:t.id,code:t.number||"--",type:t.goodsId,createTime:t.createTime,buyerName:t.customerName||"--",warehouseName:t.warehouseName||"--",packages:t.total||"--",volumes:(e.$volumeConversion(t.volume,t.umVolume,"CBM")||"--")+"m³"}}),e.pagination.total=a.total||0}).catch(function(t){return e.dialogLoading=!1,e.numberData=[],e.pagination.total=0,t})}},{key:"getDeclareOrderList",value:function(){var e=this,t={model:{sellerId:this.form.agentId,declare:this.searchForm.type,number:this.searchForm.number,orderType:0,customerId:this.form.clientId,endDate:this.searchForm.orderTime[1]+" 23:59:59",startDate:this.searchForm.orderTime[0]+" 00:00:00"},page:this.pagination.page,size:this.pagination.size};this.dialogLoading=!0,Object(b["w"])(t).then(function(t){e.dialogLoading=!1;var a=t.data||{};e.numberData=(a.result||[]).map(function(t){return{id:t.id,code:t.number,type:t.type,createTime:t.createTime,buyerName:t.customerName||"--",warehouseName:"--",packages:t.total||"--",volumes:(e.$volumeConversion(t.volume,e.$getVolumeUnitByLengthUnit((t.um||{}).umLength),"CBM")||"--")+"m³"}}),e.pagination.total=a.total||0}).catch(function(t){return e.dialogLoading=!1,e.numberData=[],e.pagination.total=0,t})}},{key:"getFullOrderList",value:function(){var e=this,t=this.custType,a={model:{buyerId:"0"===t?void 0:this.form.clientId,type:this.searchForm.type,code:this.searchForm.number,sellerId:"0"===t?this.form.clientId:this.form.agentId,endDate:this.searchForm.orderTime[1]+" 23:59:59",startDate:this.searchForm.orderTime[0]+" 00:00:00",salesmanStatusTag:!0},page:this.pagination.page,size:this.pagination.size};this.dialogLoading=!0,Object(b["z"])(a).then(function(t){e.dialogLoading=!1;var a=t.data||{};e.numberData=(a.result||[]).map(function(t){return{id:t.id,code:t.code,type:t.type,createTime:t.createTime,buyerName:(t.buyer||{}).name||"--",warehouseName:(t.warehouse||{}).name||"--",packages:t.packages||"--",volumes:(e.$volumeConversion(t.volumes,e.$getVolumeUnitByLengthUnit((t.um||{}).umLength),"CBM")||"--")+"m³"}}),e.pagination.total=a.total||0}).catch(function(t){return e.dialogLoading=!1,e.numberData=[],e.pagination.total=0,t})}},{key:"getWarehouseList",value:function(){var e=this,t={model:{type:this.searchForm.type,code:this.searchForm.number,buyer:{id:this.form.clientId},seller:{id:this.form.agentId},orderType:0,flag:1,endDate:this.searchForm.orderTime[1]+" 23:59:59",startDate:this.searchForm.orderTime[0]+" 00:00:00"},page:this.pagination.page,size:this.pagination.size};this.dialogLoading=!0,Object(b["V"])(t).then(function(t){e.dialogLoading=!1;var a=t.data||{};e.numberData=(a.result||[]).map(function(t){return{id:t.id,code:t.code,type:t.type,createTime:t.createTime,buyerName:(t.buyer||{}).name||"--",warehouseName:(t.warehouse||{}).name||"--",packages:t.packages||"--",volumes:(e.$volumeConversion(t.volumes,e.$getVolumeUnitByLengthUnit((t.um||{}).umLength),"CBM")||"--")+"m³"}}),e.pagination.total=a.total||0}).catch(function(){e.numberData=[],e.pagination.total=0,e.dialogLoading=!1})}},{key:"getExpressList",value:function(){var e=this;this.dialogLoading=!0;var t={current:this.pagination.page,size:this.pagination.size,data:{type:this.searchForm.type,custId:this.form.agentId,custType:this.form.agentType,orderNo:this.searchForm.number,start:this.searchForm.orderTime[0],end:this.searchForm.orderTime[1]}};Object(b["y"])(t).then(function(t){var a=t.data||{};e.numberData=(a.records||[]).map(function(t){return{id:t.id,code:t.orderNo,type:t.type||"--",createTime:t.createTime,buyerName:t.custName||"--",warehouseName:"--",packages:t.packageNum||"--",volumes:(e.$volumeConversion(t.totalVolume,e.$getVolumeUnitByLengthUnit(t.unitMeasure),"CBM")||"--")+"m³"}}),e.pagination.total=a.total,e.dialogLoading=!1}).catch(function(t){return e.dialogLoading=!1,t})}},{key:"onServiceType",value:function(e){var t=this.serviceTypeList.find(function(t){return t.id===e})||{};this.form.serviceTypeName=t.name,this.form.orderCode="",this.form.orderId="",this.numberData=[],this.typeList=t.list||[]}},{key:"handleAddBill",value:function(){this.tableData.push({costitemId:"",costitemName:"",itemDesc:"",quantity:0,price:0,amount:0,selfAmount:0,confirm:0})}},{key:"handleDelete",value:function(e){this.tableData[e];this.tableData.splice(e,1)}},{key:"handlerChange",value:function(e){if(e.quantity&&e.price){var t=e.quantity*e.price;e.amount=parseFloat(t.toFixed(2))}else e.amount=0;this.calculateTotalPrice()}},{key:"calculateTotalPrice",value:function(){var e=this;this.tableData=this.tableData.map(function(t){return String(e.form.exRate)?t.selfAmount=parseFloat((t.amount*e.form.exRate).toFixed(2)):t.selfAmount=t.amount,t})}},{key:"handleProject",value:function(e){this.form.serviceTypeId?(this.projectIndex=e,this.resetDialog(),this.isProject=!0,this.getProjectList()):this.$message.error("请选择服务类型")}},{key:"onTableRowClick",value:function(e,t){if("customer"===t){var a=e.type,i=e.subtype;this.form.clientName=e.name,this.form.clientId=e.id,this.form.clientProperty=a+(i?"-".concat(i):""),this.form.orderCode="",this.form.orderId="",this.form.serviceTypeId="",this.form.serviceTypeName="",this.isCustomer=!1}"order"===t&&(this.isNumber=!1,this.form.orderId=e.id,this.form.orderCode=e.code,this.form.billNoList=e.billNo?[e.billNo]:[],this.form.airNoList=e.airNo?[e.airNo]:[],this.form.soNoList="06"===this.form.serviceTypeId?e.soCodes:e.soCode?[e.soCode]:[],this.form.containerNoList=e.containerNo?e.containerNo.split(","):[],this.form.serviceSubtypeId="02"!==this.form.serviceTypeId?e.type:e.businessType),"project"===t&&(this.tableData[this.projectIndex].costitemName=e.name,this.tableData[this.projectIndex].costitemId=e.id,this.isProject=!1)}},{key:"resetDialog",value:function(){this.pagination={page:1,size:10,total:0},this.searchForm={name:"",type:"",number:"",projectName:"",orderTime:[]},this.selectType=""}},{key:"handleCurrentChange",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t,a){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.pagination.page=t,"order"!==a){e.next=4;break}return e.next=4,this.handleNumber();case 4:"project"===a&&this.getProjectList();case 5:case"end":return e.stop()}},e,this)}));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"getProjectList",value:function(){var e=this,t={name:this.searchForm.projectName,serviceTypeId:this.form.serviceTypeId,page:this.pagination.page,size:this.pagination.size};this.dialogLoading=!0,Object(b["s"])(t).then(function(t){e.dialogLoading=!1;var a=t.data||{};e.projectData=a.result||[],e.pagination.total=a.total||0}).catch(function(){e.dialogLoading=!1})}},{key:"getDetailsById",value:function(e){var t=this,a={id:e};Object(b["A"])(a).then(function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(a){var i,r,o,s,l;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i=a.data,r=i.items,o=i.clientProperty,s=Object(n["a"])(i,["items","clientProperty"]),t.selfCurrency={currencyId:s.selfId,currencyName:s.selfName},e.prev=2,t.form=_({},s,{clientProperty:o,agentType:t.custType,clientType:o?o.substring(0,1):"1"}),t.setCustomerType(),e.next=7,t.getServiceType();case 7:l=t.serviceTypeList.find(function(e){return e.id===t.form.serviceTypeId}),l&&(t.typeList=l.list),t.tableData=r,t.detailLoading=!1,e.next=16;break;case 13:e.prev=13,e.t0=e["catch"](2),t.detailLoading=!1;case 16:case"end":return e.stop()}},e,null,[[2,13]])}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){t.detailLoading=!1})}},{key:"onAmount",value:function(){this.calculateTotalPrice()}},{key:"onCurrency",value:function(){var e=this,t=this.currencyList.find(function(t){return t.id===e.form.currencyId});if(!t)return this.form.currencyName="",this.form.exRate="",void this.calculateTotalPrice();if(this.form.currencyName=t.name,this.selfCurrency.currencyId===this.form.currencyId)return this.form.exRate=1,void this.calculateTotalPrice();this.form.exRate="";var a={c1:this.selfCurrency.currencyId,c2:this.form.currencyId};Object(b["x"])(a).then(function(t){var a=t.data||[];if(a.length<=0)e.$message.error("暂无汇率，请配置");else{var i=a.filter(function(t){return t.lcId===e.form.currencyId}).map(function(e){return e.time=T()(e.effective).unix(),e}).sort(function(e,t){return t.time-e.time}),r=i[0]||{};r.lcId===e.form.currencyId&&(e.form.exRate=r.rate),e.form.exRate?e.calculateTotalPrice():e.$message.error("暂无汇率，请配置")}}).catch(function(e){return e})}},{key:"getCurrencyList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.selectLoading=!0,e.next=3,Object(b["t"])().then(function(e){t.selectLoading=!1;var a=e.data||{};t.currencyList=a.result||[]}).catch(function(e){return t.selectLoading=!1,t.currencyList=[],e});case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"show",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,i=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.detailLoading=!0,e.next=3,this.getCurrencyList();case 3:this.currencyList.map(function(e){e.countries.some(function(e){return e.id===i.userCountryId})&&(i.selfCurrency={currencyId:e.id,currencyName:e.name})}),a=this.$refs.editForm,this.$nextTick(function(){a.clearValidate()}),t?this.getDetailsById(t):(this.form=L(),this.form.agentId=this.custId,this.form.agentName=this.custName,this.form.agentType=this.custType,this.onCurrency(),this.tableData=[],this.resetDialog(),this.setCustomerType(),this.detailLoading=!1);case 7:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"setCustomerType",value:function(){var e=this.custType,t=this.custSubtype;"0"===e?this.custTypeList=[{id:"2",name:"代理商"}]:"2"===e&&"1"===t&&"1"===this.form.custTag?this.custTypeList=[{id:"2",name:"二级代理商"},{id:"1",name:"客户"}]:"2"===e&&"1"===t&&"2"===this.form.custTag?this.custTypeList=[{id:"1",name:"客户"}]:"2"===e&&"2"===t?this.custTypeList=[{id:"1",name:"客户"}]:"3"===e?this.custTypeList=[{id:"0",name:"聚货通"},{id:"2",name:"代理商"},{id:"1",name:"客户"}]:(this.custTypeList=[],this.form.clientType=void 0)}},{key:"formmatStatus",value:function(e){var t=this.orderStatusList.find(function(t){return t.id===e.status.WS_IN})||{};return t.name||"--"}},{key:"formmatType",value:function(e){var t=this.typeList.find(function(t){return Number(t.id)===Number(e.type)})||{};return t.name||"--"}},{key:"custId",get:function(){var e=f["a"].info||{},t=e.custId;return t}},{key:"custName",get:function(){var e=f["a"].info||{},t=e.custName;return t}},{key:"custType",get:function(){var e=f["a"].info||{},t=e.custType;return t}},{key:"custSubtype",get:function(){var e=f["a"].info||{},t=e.custSubtype;return t}},{key:"userCountryId",get:function(){var e=f["a"].info||{};return e.countryId}},{key:"customerList",get:function(){return this.customerData.slice((this.pagination.page-1)*this.pagination.size,this.pagination.page*this.pagination.size)}},{key:"amountText",get:function(){var e=0;return this.tableData.map(function(t){e+=t.amount}),parseFloat(e.toFixed(2))}},{key:"selfAmountText",get:function(){var e=0;return this.tableData.map(function(t){e+=t.selfAmount}),parseFloat(e.toFixed(2))}}]),t}(h["e"]);I=p["a"]([Object(h["a"])({name:"detail",components:{},props:{isAdd:{type:Boolean,default:!1},isView:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1},isOnce:{type:Boolean,default:!1},statusList:{type:Array,default:function(){return[]}}}})],I);var N=I,S=N,D=(a("9aa6"),a("2877")),C=Object(D["a"])(S,v,g,!1,null,"609e99a4",null),F=C.exports,j=a("f640"),O=a("4e71"),$=a("f248");function z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function R(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?z(a,!0).forEach(function(t){Object(o["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):z(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var P=function(e){function t(){var e;return Object(l["a"])(this,t),e=Object(u["a"])(this,Object(d["a"])(t).apply(this,arguments)),e.searchForm={serviceTypeId:"02",comType:void 0,comId:void 0,code:void 0,clientName:void 0,endDate:void 0,orderCode:void 0,startDate:void 0,status:void 0,ifVerify:void 0},e.auditForm={id:"",status:"1",note:""},e.auditFormRules={status:[{required:!0,message:"请选择审核状态",trigger:"change"}],note:[{required:!0,message:"请填写拒绝原因",trigger:"change"}]},e.time=[],e.type="R",e.tableData=[],e.companyList=[],e.options=[],e.total=0,e.page=1,e.size=10,e.selectType="2",e.keyWord="",e.loading=!1,e.dialogLoading=!1,e.selectLoading=!1,e.excelLoading=!1,e.exportLoading=!1,e.dialogAudit=!1,e.isEdit=!1,e.isAdd=!1,e.isView=!1,e.isOnce=!1,e.moreShow=!1,e.detailShow=!1,e.dialogAdjust=!1,e.dialogDeduct=!1,e.statusList=[{name:"未审核",id:"0"},{name:"已通过",id:"1"},{name:"已拒绝",id:"2"},{name:"审核中",id:"3"}],e.companyTypeList=[],e.serviceList=[],e.typeList=[],e.orderForm={},e}return Object(m["a"])(t,e),Object(c["a"])(t,[{key:"formatterCutoffTime",value:function(e){var t=e.cutoffTime;if(!t)return"--";if(T()(t).format("YYYY-MM-DD")===T()().format("YYYY-MM-DD"))return"--";var a=T()().diff(t,"day")+1;return a>0&&0===e.ifVerify?a:"--"}},{key:"getTypeList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object($["c"])().then(function(e){var a=e.data||[];t.typeList=a.reduce(function(e,t){var a=e.find(function(e){return e.id===t.typeId});return a?a.subtypeList.push({id:t.subtypeId,name:t.subtypeName}):e.push({id:t.typeId,name:t.typeName,subtypeList:[{id:t.subtypeId,name:t.subtypeName}]}),e},[])}).catch(function(){t.typeList=[]});case 2:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"onComType",value:function(){this.tableData=[],this.searchForm.comId="",this.companyList=[],this.handleSearch(1)}},{key:"onCompany",value:function(){this.tableData=[],this.handleSearch(1)}},{key:"getCompanyList",value:function(){var e=this;if(this.selectLoading=!0,"2"===this.searchForm.comType)Object(b["S"])().then(function(t){var a=t.data||[];e.companyList=a,e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,t});else if("4"===this.searchForm.comType){var t={custIds:[this.custId]};Object(b["v"])(t).then(function(t){var a=t.data||[];e.companyList=a,e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,t})}else if("5"===this.searchForm.comType){var a={parentId:"0",page:1,size:9999};Object(b["o"])(a).then(function(t){var a=t.data||{},i=a.result||[];e.companyList=i,e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,t})}}},{key:"getServiceList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.selectLoading=!0,t={custType:"1"},e.next=4,Object(b["p"])(t).then(function(e){a.serviceList=e.data||[],a.selectLoading=!1}).catch(function(e){return a.selectLoading=!1,e});case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"handleService",value:function(){this.tableData=[],this.handleSearch(1)}},{key:"cancelAudit",value:function(){this.auditForm={id:"",status:"1",note:""};var e=this.$refs.auditForm;this.$nextTick(function(){e.clearValidate()}),this.dialogAudit=!1}},{key:"handleAudit",value:function(e,t){var a=this;if("0"===e.status){var i={id:e.id,status:"3",note:""};Object(b["f"])(i).then(function(){a.tableData[t].status="3"}).catch(function(e){return e})}this.dialogAudit=!0,this.auditForm={id:e.id,status:"1",note:""}}},{key:"rollbackInvoice",value:function(e){var t=this;this.$confirm("请确认是否状态回滚?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){t.loading=!0,Object(b["W"])({id:e}).then(function(){t.loading=!1,t.$message.success("状态回滚成功"),t.handleSearch()}).catch(function(){t.loading=!1})}).catch(function(){return!1})}},{key:"confirmAudit",value:function(){var e=this,t=R({},this.auditForm);this.dialogLoading=!0,Object(b["f"])(t).then(function(){e.$message.success("操作成功"),e.dialogLoading=!1,e.cancelAudit(),e.handleSearch()}).catch(function(){e.dialogLoading=!1})}},{key:"handleExport",value:function(){var e=this,t=this.searchForm,a=t.comType,i=t.comId,r=Object(n["a"])(t,["comType","comId"]),o=this.custId,s=R({},r,{orderCode:"1"===this.selectType?this.keyWord:void 0,clientName:"2"===this.selectType?this.keyWord:void 0,code:"3"===this.selectType?this.keyWord:void 0,billNo:"4"===this.selectType?this.keyWord:void 0,soNo:"5"===this.selectType?this.keyWord:void 0,containerNo:"6"===this.selectType?this.keyWord:void 0,custTag:a,enterpriseId:"1"===a||"3"===a?[o]:i?[i]:[],request:"0",size:9999,page:1,type:this.type});Array.isArray(this.time)&&this.time.length>0&&(s.startDate=this.time[0],s.endDate=this.time[1]),this.excelLoading=!0,Object(b["B"])(R({},s)).then(function(t){e.excelLoading=!1;var a=document.createElement("a");document.body.appendChild(a);var i=new Blob([t],{type:"application/vnd.ms-excel"}),r=URL.createObjectURL(i);a.href=r,a.download="应收款"+T()().format("YYYY-MM-DD_HH-mm-ss")+".xls",a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)}).catch(function(t){e.excelLoading=!1,t.data.text().then(function(t){try{var a=JSON.parse(t);200!==a.code&&e.$message.error(a.msg||"文件下载失败")}catch(i){return i}})})}},{key:"rowSelectChange",value:function(e){e.checked?this.options.push(e.row):this.options=this.options.filter(function(t){return t.id!==e.row.id})}},{key:"handleExport2",value:function(){var e=this;if(this.options.length<=0)this.$message.error("请勾选列表同一客户的应收款");else{this.exportLoading=!0;var t={idList:this.options.map(function(e){return e.id})};Object(b["C"])(t).then(function(t){e.exportLoading=!1;var a=document.createElement("a");document.body.appendChild(a);var i=new Blob([t],{type:"application/vnd.ms-excel"}),r=URL.createObjectURL(i);a.href=r,a.download="应收款"+T()().format("YYYY-MM-DD_HH-mm-ss")+".xls",a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),e.options=[],e.$nextTick(function(){var t=e.$refs.tableSelect;t.clearCheckboxRow()})}).catch(function(t){e.exportLoading=!1,t.data.text().then(function(t){try{var a=JSON.parse(t);200!==a.code&&e.$message.error(a.msg||"文件下载失败")}catch(i){return i}})})}}},{key:"handleAdd",value:function(){this.detailShow=!0,this.isEdit=!1,this.isAdd=!0,this.isView=!1,this.isOnce=!0;var e=this.$refs.detailForm;e.show()}},{key:"handleEdit",value:function(e){this.detailShow=!0,this.isEdit=!0,this.isAdd=!1,this.isView=!1,this.isOnce=!1;var t=this.$refs.detailForm;t.show(e.id)}},{key:"handleDetail",value:function(e){this.detailShow=!0,this.isEdit=!1,this.isAdd=!1,this.isView=!0,this.isOnce=!1;var t=this.$refs.detailForm;t.show(e)}},{key:"handleDelete",value:function(e){var t=this,a={id:e};this.$confirm("请确认是否删除该条数据?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){Object(b["h"])(a).then(function(e){t.$message({type:"success",message:"删除成功"}),t.handleSearch()}).catch(function(e){return e})}).catch(function(){return!1})}},{key:"handleOrder",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,i=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return[],a={id:t.id},this.loading=!0,e.next=5,this.getTypeList();case 5:Object(b["A"])(a).then(function(e){i.loading=!1,i.moreShow=!0;var a=e.data||{},r=a.invoiceOrderEntity||{};i.orderForm={orderDate:r.orderDate,channelName:r.channelName,wsCode:r.wsCode,packages:r.packages,weights:r.weights,serviceTypeName:t.serviceTypeName,serviceTypeId:t.serviceTypeId,serviceSubtypeId:t.serviceSubtypeId,code:t.code,clientProperty:t.clientProperty,orderCode:t.orderCode,status:t.status,clientName:t.clientName,agentName:t.agentName,currencyName:t.currencyName,invDate:t.invDate}}).catch(function(){i.loading=!1});case 6:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"handlePass",value:function(e){}},{key:"handleRefuse",value:function(e){}},{key:"handleResubmit",value:function(e){}},{key:"handleDeduct",value:function(e){this.dialogDeduct=!0}},{key:"handleAdjust",value:function(e){this.dialogAdjust=!0}},{key:"handleSearch",value:function(e){var t=this;this.loading=!0,e&&(this.page=e);var a=this.searchForm,i=a.comType,r=a.comId,o=Object(n["a"])(a,["comType","comId"]),s=this.custId,l=R({},o,{orderCode:"1"===this.selectType?this.keyWord:void 0,clientName:"2"===this.selectType?this.keyWord:void 0,code:"3"===this.selectType?this.keyWord:void 0,billNo:"4"===this.selectType?this.keyWord:void 0,soNo:"5"===this.selectType?this.keyWord:void 0,containerNo:"6"===this.selectType?this.keyWord:void 0,custTag:i,enterpriseId:"1"===i||"3"===i?[s]:r?[r]:[],request:"0",size:this.size,page:this.page,type:this.type});Array.isArray(this.time)&&this.time.length>0&&(l.startDate=this.time[0],l.endDate=this.time[1]),Object(b["D"])(l).then(function(e){var a=e.data||{};t.tableData=(a.result||[]).map(function(e){return e.invDate=T()(e.invDate).format("YYYY-MM-DD"),e}),t.options.length&&t.options.map(function(e){var a=t.tableData.find(function(t){return t.id===e.id||"".concat(t.id)===e.id});a&&t.$nextTick(function(){var e=t.$refs.tableSelect;e.toggleCheckboxRow(a,!0)})}),t.total=a.total,t.loading=!1}).catch(function(e){return t.loading=!1,[null,e]})}},{key:"handleSizeChange",value:function(e){this.size=e,this.handleSearch()}},{key:"handleCurrentChange",value:function(e){this.page=e,this.handleSearch()}},{key:"created",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.time=[T()().subtract(30,"d").format("YYYY-MM-DD"),T()().format("YYYY-MM-DD")],t=this.custType,a=this.custSubtype,this.searchForm.comType="1","2"===t&&"1"===a?(this.companyTypeList=[{id:"1",name:"本公司"},{id:"2",name:"分公司"}],this.searchForm.comType="2"):"3"===t&&(this.companyTypeList=[{id:"3",name:"聚货通"},{id:"4",name:"客户"},{id:"5",name:"代理商"}],this.searchForm.comType="3"),e.next=7,this.getServiceList();case 7:this.handleSearch();case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"custId",get:function(){var e=f["a"].info||{},t=e.custId;return t}},{key:"custType",get:function(){var e=f["a"].info||{},t=e.custType;return t}},{key:"custSubtype",get:function(){var e=f["a"].info||{},t=e.custSubtype;return t}},{key:"subtypeList",get:function(){var e=this,t=this.typeList.find(function(t){return t.id===e.orderForm.serviceTypeId});return t?t.subtypeList:[]}}]),t}(h["e"]);P=p["a"]([Object(h["a"])({name:"",components:{orderInfo:y["a"],detail:F,adjust:j["a"],deduct:O["a"]},props:{}})],P);var A=P,Y=A,V=(a("8d2b"),Object(D["a"])(Y,i,r,!1,null,"b368be50",null));t["default"]=V.exports}}]);