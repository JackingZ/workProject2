(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["notice-center"],{"3efc":function(e,t,n){"use strict";var a=n("b437"),i=n.n(a);i.a},a189:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"roles-container"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[n("div",{staticClass:"app-container"},[n("el-row",{staticClass:"header-title"},[n("el-col",{attrs:{span:20}},[n("h3",[e._v("通知中心")])]),n("el-col",{staticStyle:{"text-align":"right",padding:"6px"},attrs:{span:4}},[n("el-button",{staticStyle:{"font-size":"14px"},attrs:{type:"text",size:"small"},on:{click:e.onRoute}},[e._v("\n            通知配置\n          ")])],1)],1),n("div",{staticClass:"app-panel"},[n("el-row",[n("el-col",{attrs:{span:20}},[n("el-radio-group",{attrs:{size:"small"},on:{change:e.onNotice},model:{value:e.searchForm.noticeId,callback:function(t){e.$set(e.searchForm,"noticeId",t)},expression:"searchForm.noticeId"}},e._l(e.noticeList,function(t){return n("el-radio-button",{key:t.id,attrs:{label:t.id}},[e._v("\n                "+e._s(t.name)+"\n              ")])}),1)],1),n("el-col",{attrs:{span:4}},[n("el-input",{attrs:{placeholder:"关键词搜索",size:"small"},model:{value:e.searchForm.keyWord,callback:function(t){e.$set(e.searchForm,"keyWord",t)},expression:"searchForm.keyWord"}},[n("el-button",{attrs:{slot:"append",size:"small",icon:"el-icon-search"},on:{click:e.onSearch},slot:"append"})],1)],1)],1),n("el-row",{staticClass:"notice-number"},[n("el-col",{attrs:{span:14}},e._l(e.numberList,function(t){return n("el-button",{key:t.id,staticClass:"btn-number",class:e.searchForm.status===t.id?"active-number":"",attrs:{type:"text",size:"small"},on:{click:function(n){return e.onNumber(t.id)}}},[e._v("\n              "+e._s(t.name+"("+t.account+")")+"\n            ")])}),1),n("el-col",{staticStyle:{"text-align":"right"},attrs:{span:10}},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onSign}},[e._v("\n              标记为已读\n            ")]),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onAllSign}},[e._v("\n              全部标为已读\n            ")])],1)],1),n("el-table",{ref:"tables",staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{data:e.tableData,"row-key":"id",height:"calc(100vh - 350px)",border:""},on:{select:e.handleSelected,"select-all":e.handleSelectAll}},[n("el-table-column",{attrs:{fixed:"left",type:"selection",width:"55"}}),n("el-table-column",{attrs:{prop:"msgTitle",label:"消息标题",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{class:0===t.row.isRead?"unemail-icon":"emailed-icon"}),e._v("\n               \n              "),n("span",[e._v("\n                "+e._s(t.row.msgTitle)+"\n              ")])]}}])}),n("el-table-column",{attrs:{prop:"msgContent",label:"消息内容"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{staticClass:"word-limit",staticStyle:{cursor:"pointer"},on:{click:function(n){return e.onInfo(t.row)}}},[e._v("\n                "+e._s(t.row.msgContent)+"\n              ")])]}}])}),n("el-table-column",{attrs:{prop:"receiveTime",label:"接收时间",width:"180"}}),n("el-table-column",{attrs:{prop:"msgType",label:"消息类型",width:"150"}}),n("el-table-column",{attrs:{prop:"",label:"",width:"180"},scopedSlots:e._u([{key:"header",fn:function(t){return[n("el-select",{staticClass:"sub-notice",attrs:{placeholder:"消息子类型",size:"mini",filterable:"",clearable:""},on:{focus:e.setType,change:function(n){return e.onType(n,t.row)}},model:{value:e.searchForm.typeId,callback:function(t){e.$set(e.searchForm,"typeId",t)},expression:"searchForm.typeId"}},e._l(e.typeList,function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)]}},{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.msgSubtype)+"\n            ")]}}])})],1),n("el-pagination",{staticStyle:{"text-align":"right","padding-bottom":"10px"},attrs:{"current-page":e.page,"page-size":e.size,layout:"total, prev, pager, next",total:e.total},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)])])},i=[],s=(n("96cf"),n("3b8d")),o=(n("c5f6"),n("75fc")),l=(n("7514"),n("7f7f"),n("d225")),r=n("b0b4"),c=n("308d"),u=n("6bb5"),d=n("4e2b"),h=n("9ab4"),p=n("60a3"),f=n("17e1"),m=n("4c9b"),g=function(e){function t(){var e;return Object(l["a"])(this,t),e=Object(c["a"])(this,Object(u["a"])(t).apply(this,arguments)),e.loading=!1,e.searchForm={noticeId:"all",typeId:"",keyWord:void 0,status:"all"},e.noticeOption=[],e.noticeList=[],e.numberList=[{name:"全部",id:"all",account:0},{name:"未读",id:0,account:0},{name:"已读",id:1,account:0}],e.typeList=[],e.selectedData=[],e.tableData=[],e.page=1,e.size=10,e.total=0,e}return Object(d["a"])(t,e),Object(r["a"])(t,[{key:"getDing",value:function(){var e=this;m["a"].$on("fromNoticeUpdateDing",function(t){e.queryAll()})}},{key:"setDing",value:function(){m["a"].$emit("toNoticeUpdateDing")}},{key:"onRoute",value:function(){this.$router.push({path:"/system/notice-config"})}},{key:"onSearch",value:function(){this.queryAll(1)}},{key:"onNotice",value:function(){this.selectedData=[],this.setType(),this.queryAll(1)}},{key:"onNumber",value:function(e){this.searchForm.status=e,this.selectedData=[],this.queryAll(1)}},{key:"onSign",value:function(){if(this.selectedData.length<=0)this.$message.error("请勾选信息");else{var e=this.selectedData.map(function(e){return e.id}),t=e.join(",");this.updateHomePage(t)}}},{key:"onAllSign",value:function(){this.updateHomePage()}},{key:"onInfo",value:function(e){var t=this;this.$confirm(e.msgContent,e.msgTitle,{confirmButtonText:"知道了",closeOnClickModal:!1,showCancelButton:!1,type:"info"}).then(function(){t.updateHomePage(e.id)}).catch(function(){t.updateHomePage(e.id)})}},{key:"updateHomePage",value:function(e){var t=this;this.loading=!0,Object(f["o"])({readId:"1",ids:e}).then(function(e){t.$message({type:"success",message:"保存成功"}),t.loading=!1,t.selectedData=[],t.queryAll(1),t.setDing()}).catch(function(e){return t.loading=!1,e})}},{key:"setType",value:function(){var e=this;if("all"===this.searchForm.noticeId){var t=[];this.noticeOption.map(function(e){(e.result||[]).map(function(e){t.push({name:e.name,id:e.unqId})})});var n={};this.typeList=t.reduce(function(e,t){return n[t.id]||(n[t.id]=!0,e.push(t)),e},[]),this.typeList.unshift({name:"全部",id:"all"})}else this.noticeOption.map(function(t){t.id===e.searchForm.noticeId&&(e.typeList=(t.result||[]).map(function(e){return{name:e.name,id:e.unqId}}),e.typeList.unshift({name:"全部",id:"all"}))})}},{key:"onType",value:function(e,t){this.selectedData=[],this.queryAll(1)}},{key:"handleSelected",value:function(e,t){var n=e.find(function(e){return e.id===t.id});n?this.selectedData.push(t):this.selectedData=this.selectedData.filter(function(e){return e.id!==t.id})}},{key:"handleSelectAll",value:function(e){var t=this;e.length?this.selectedData=[].concat(Object(o["a"])(this.selectedData),Object(o["a"])(e)).reduce(function(e,t){return e.find(function(e){return e.id===t.id})||e.push(t),e},[]):this.selectedData=this.selectedData.filter(function(e){return!t.tableData.find(function(t){return t.id===e.id})})}},{key:"toggleSelection",value:function(e,t){var n=this,a=this.$refs.tables;a.clearSelection(),e.length>0&&e.map(function(e){var a=n.$refs.tables;a.toggleRowSelection(e,t)})}},{key:"queryAll",value:function(e){var t=this;this.loading=!0;var n=this.searchForm,a=n.noticeId,i=n.keyWord,s=n.status,o=n.typeId;e&&(this.page=e);var l={model:{msgTypeId:"all"===a?void 0:a,isRead:"all"===s?void 0:s,msgTitle:i,msgSubtypeId:"all"===o?void 0:o},page:this.page,size:this.size};Object(f["d"])(l).then(function(e){t.loading=!1;var n=e.data||{};t.tableData=n.result||[];var a=t.tableData.filter(function(e){return t.selectedData.find(function(t){return t.id===e.id})});t.$nextTick(function(){t.toggleSelection(a)}),t.total=n.total,t.setNumber(n.allCount,n.noReadCount,n.isReadCount)}).catch(function(e){return t.loading=!1,e})}},{key:"setNumber",value:function(e,t,n){this.numberList[0].account=e||0,this.numberList[1].account=t||0,this.numberList[2].account=n||0}},{key:"handleSizeChange",value:function(e){this.size=Number(e),this.queryAll()}},{key:"handleCurrentChange",value:function(e){this.page=Number(e),this.queryAll()}},{key:"getNoticeList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,Object(f["f"])();case 4:t=e.sent,this.noticeOption=t.data||[],this.noticeList=this.noticeOption.map(function(e){return{name:e.name,id:e.unqId}}),this.noticeList.unshift({name:"全部通知",id:"all"}),e.next=14;break;case 10:return e.prev=10,e.t0=e["catch"](1),this.loading=!1,e.abrupt("return",e.t0);case 14:case"end":return e.stop()}},e,this,[[1,10]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"beforeDestory",value:function(){m["a"].$off("toNoticeUpdateDing")}},{key:"mounted",value:function(){this.getDing()}},{key:"created",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getNoticeList();case 2:this.setType(),this.queryAll();case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}]),t}(p["e"]);g=h["a"]([Object(p["a"])({name:"",components:{},props:{}})],g);var y=g,b=y,v=(n("3efc"),n("2877")),k=Object(v["a"])(b,a,i,!1,null,"f6e8b618",null);t["default"]=k.exports},b437:function(e,t,n){}}]);