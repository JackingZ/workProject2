(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["agent-booking-plan"],{"221b":function(e,t,a){"use strict";var i=a("96a9"),r=a.n(i);r.a},"75e8":function(e,t,a){},"7df6":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","min-height":"inherit"}},[a("div",{staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[a("div",{staticClass:"app-container"},[a("head-info",{attrs:{info:"",title:"发货计划"}}),a("div",{staticClass:"app-panel"},[a("el-row",[a("el-col",{attrs:{span:2}},[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:e.addProduct}},[e._v("\n              新增\n            ")])],1),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:22}},["0"===e.custType?a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:e.selectLoading,size:"small",placeholder:"所属公司",filterable:"",clearable:""},on:{change:e.onCompany,focus:e.getCompanyList},model:{value:e.selectValue.comId,callback:function(t){e.$set(e.selectValue,"comId",t)},expression:"selectValue.comId"}},e._l(e.companyList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1):e._e(),a("el-select",{staticStyle:{width:"100px","margin-right":"5px"},attrs:{loading:e.selectLoading,placeholder:"业务类型",size:"small",clearable:"",filterable:""},on:{focus:e.getBusinessType,change:e.onType},model:{value:e.selectValue.type,callback:function(t){e.$set(e.selectValue,"type",t)},expression:"selectValue.type"}},e._l(e.typelist,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:e.selectLoading,size:"small",clearable:"",filterable:"",placeholder:"目的国"},on:{focus:e.getCountryList},model:{value:e.selectValue.countryId,callback:function(t){e.$set(e.selectValue,"countryId",t)},expression:"selectValue.countryId"}},e._l(e.countryList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name+"-"+e.alias,value:e.id}})}),1),a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:e.selectLoading,disabled:!e.selectValue.type,clearable:"",filterable:"",size:"small",placeholder:"服务"},on:{focus:e.getBscList,change:e.onFlight},model:{value:e.selectValue.bscId,callback:function(t){e.$set(e.selectValue,"bscId",t)},expression:"selectValue.bscId"}},e._l(e.flightList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:e.selectLoading,disabled:!e.selectValue.bscId,clearable:"",filterable:"",size:"small",placeholder:"服务商"},on:{focus:e.getBsTransList},model:{value:e.selectValue.bscTransId,callback:function(t){e.$set(e.selectValue,"bscTransId",t)},expression:"selectValue.bscTransId"}},e._l(e.bsTransList,function(e){return a("el-option",{key:e.id,attrs:{label:e.orgName+"/"+e.serviceCode,value:e.id}})}),1),a("el-date-picker",{staticStyle:{width:"240px","margin-right":"5px"},attrs:{"unlink-panels":"",clearable:"",type:"daterange",align:"right",size:"small","value-format":"yyyy-MM-dd","range-separator":"~","start-placeholder":"起始时间","end-placeholder":"截止时间"},model:{value:e.selectValue.shipTime,callback:function(t){e.$set(e.selectValue,"shipTime",t)},expression:"selectValue.shipTime"}}),a("el-input",{staticClass:"input-with-select",staticStyle:{width:"180px","margin-right":"10px"},attrs:{placeholder:"服务名称",size:"small",clearable:""},model:{value:e.selectValue.bscName,callback:function(t){e.$set(e.selectValue,"bscName",t)},expression:"selectValue.bscName"}}),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.queryAll(1)}}},[e._v("\n              查询\n            ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"planTable",staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.tableData,height:"calc(100vh - 313px)",border:""}},[a("el-table-column",{attrs:{width:"120",label:"业务类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s((e.typelist.find(function(e){return e.value===t.row.type})||{}).label)+"\n            ")]}}])}),a("el-table-column",{attrs:{prop:"countryName","min-width":"120",label:"目的国"}}),a("el-table-column",{attrs:{prop:"bscName","min-width":"180",label:"订舱服务","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s("1"===t.row.type||"2"===t.row.type?t.row.volume+"CBM":t.row.weight+"KG")+"\n            ")]}}])},[a("template",{slot:"header"},[e._v("\n              体积/重量\n            ")])],2),a("el-table-column",{attrs:{prop:"year",width:"100",label:"年度"}}),a("el-table-column",{attrs:{prop:"periodName","min-width":"120",label:"期间"}}),a("el-table-column",{attrs:{prop:"createTime",width:"180",label:"创建时间"}}),a("el-table-column",{attrs:{fixed:"right",width:"200",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.editProduct(t.row)}}},[e._v("\n                编辑\n              ")]),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.deleteProduct(t.row)}}},[e._v("\n                删除\n              ")])]}}])})],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":e.page,"page-size":e.size,layout:"total, prev, pager, next",total:e.total},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),a("el-dialog",{attrs:{title:e.dialogTitle,width:"960px",visible:e.isAddEditVisible,"close-on-click-modal":!1},on:{"update:visible":function(t){e.isAddEditVisible=t},closed:e.cancel}},[a("addEditForm",{ref:"addEditForm",attrs:{"is-edit":e.isEdit},on:{cancel:e.cancel,queryAll:e.queryAll}})],1)],1)],1)])])},r=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("c5f6"),a("bd86")),l=a("a8db"),s=(a("96cf"),a("3b8d")),o=a("d225"),c=a("b0b4"),u=a("308d"),d=a("6bb5"),p=a("4e2b"),m=a("9ab4"),h=a("60a3"),f=a("9dba"),y=a("b32d");function b(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?b(a,!0).forEach(function(t){Object(n["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):b(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function v(e){var t={url:"/finance/fisCal/get",method:"post",data:e};return Object(y["a"])(t)}function w(e){var t={url:"/auth/agent/getAgentList",method:"get",params:e};return Object(y["a"])(t)}function k(e){var t=e.page,a=e.size,i=Object(l["a"])(e,["page","size"]),r={url:"/cfg/bs/getBsList",method:"post",data:{page:t,size:a,model:g({},i)}};return Object(y["a"])(r)}function L(e){var t={url:"/cfg/bs/getBsTransList",method:"post",data:e};return Object(y["a"])(t)}function F(e){var t={url:"/orders/sales_plan/plan_list",method:"post",data:e};return Object(y["a"])(t)}function x(e){var t={url:"/orders/sales_plan/save",method:"post",data:e};return Object(y["a"])(t)}function O(e){var t={url:"/orders/sales_plan/delete",method:"get",params:e};return Object(y["a"])(t)}function I(){var e={url:"/setting/area/getCountryList",method:"get"};return Object(y["a"])(e)}function T(e){var t={url:"/setting/dict/item/type",method:"get",params:e};return Object(y["a"])(t)}var j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}]},[a("el-form",{ref:"selectForm",attrs:{model:e.selectForm,rules:e.formRules,"label-width":"100px","label-position":"right",size:"small"}},["0"!==e.custType||e.isEdit?e._e():a("el-form-item",{attrs:{label:"所属公司",prop:"companyId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{loading:e.selectLoading,size:"small",placeholder:"请选择",filterable:"",clearable:""},on:{change:e.onCompany,focus:e.getCompanyList},model:{value:e.selectForm.companyId,callback:function(t){e.$set(e.selectForm,"companyId",t)},expression:"selectForm.companyId"}},e._l(e.companyList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),a("el-form-item",{attrs:{label:"业务类型",prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.isEdit,placeholder:"请选择",size:"small"},on:{change:e.onType},model:{value:e.selectForm.type,callback:function(t){e.$set(e.selectForm,"type",t)},expression:"selectForm.type"}},e._l(e.typelist,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),a("el-form-item",{attrs:{label:"订舱服务",prop:"bscId"}},[a("el-popover",{attrs:{placement:"bottom-start"}},[a("el-row",[a("el-form-item",{attrs:{label:"目的国","label-width":"60px"}},[a("el-select",{staticStyle:{width:"275px"},attrs:{loading:e.selectLoading,size:"mini",clearable:"",filterable:"",placeholder:"请选择"},on:{focus:e.getCountryList},model:{value:e.selectForm.countryId,callback:function(t){e.$set(e.selectForm,"countryId",t)},expression:"selectForm.countryId"}},e._l(e.countryList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name+"-"+e.alias,value:e.id}})}),1)],1)],1),a("el-row",[a("el-form-item",{attrs:{label:"服务","label-width":"60px"}},[a("el-select",{staticStyle:{width:"275px"},attrs:{loading:e.selectLoading,disabled:!e.selectForm.type,clearable:"",filterable:"",size:"small",placeholder:"请选择"},on:{focus:e.getBscList,change:e.onFlight},model:{value:e.selectForm.bscId,callback:function(t){e.$set(e.selectForm,"bscId",t)},expression:"selectForm.bscId"}},e._l(e.flightList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),a("div",{staticClass:"el-select el-select--small",staticStyle:{width:"100%"},attrs:{slot:"reference"},slot:"reference"},[a("el-input",{attrs:{placeholder:"服务",readonly:"","suffix-icon":"el-select__caret el-input__icon el-icon-arrow-up"},model:{value:e.selectForm.bscName,callback:function(t){e.$set(e.selectForm,"bscName",t)},expression:"selectForm.bscName"}})],1)],1)],1),a("el-form-item",{attrs:{label:"服务商",prop:"serviceName"}},[a("el-input",{attrs:{disabled:!0,placeholder:"请选择"},model:{value:e.selectForm.serviceName,callback:function(t){e.$set(e.selectForm,"serviceName",t)},expression:"selectForm.serviceName"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.showServiceLine},slot:"append"})],1)],1),"1"===e.selectForm.type||"2"===e.selectForm.type?a("el-form-item",{attrs:{label:"体积",prop:"volume"}},[a("div",{staticClass:"input-content"},[a("div",{staticStyle:{flex:"1"}},[a("el-input-number",{staticClass:"input-number-valiate input-border",attrs:{controls:!1,placeholder:"请输入",min:0,max:999999,precision:2},model:{value:e.selectForm.volume,callback:function(t){e.$set(e.selectForm,"volume",t)},expression:"selectForm.volume"}})],1),a("div",{staticClass:"input-unit"},[e._v("\n          CBM\n        ")])])]):e._e(),"0"===e.selectForm.type||"4"===e.selectForm.type?a("el-form-item",{attrs:{label:"重量",prop:"weight"}},[a("div",{staticClass:"input-content"},[a("div",{staticStyle:{flex:"1"}},[a("el-input-number",{staticClass:"input-number-valiate input-border",attrs:{controls:!1,placeholder:"请输入",min:0,max:999999,precision:2},model:{value:e.selectForm.weight,callback:function(t){e.$set(e.selectForm,"weight",t)},expression:"selectForm.weight"}})],1),a("div",{staticClass:"input-unit"},[e._v("\n          KG\n        ")])])]):e._e(),a("el-form-item",{attrs:{label:"年度",prop:"year"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"year",placeholder:"年度","value-format":"yyyy",size:"small",clearable:""},on:{change:e.onYear},model:{value:e.selectForm.year,callback:function(t){e.$set(e.selectForm,"year",t)},expression:"selectForm.year"}})],1),a("el-form-item",{attrs:{label:"期间",prop:"period"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{loading:e.selectLoading,disabled:!e.selectForm.year,placeholder:"请选择",size:"small",clearable:"",filterable:""},on:{focus:e.getFiscalList},model:{value:e.selectForm.period,callback:function(t){e.$set(e.selectForm,"period",t)},expression:"selectForm.period"}},e._l(e.fiscalList,function(e,t){return a("el-option",{key:t,attrs:{label:e.fiscalPeriod,value:e.id}})}),1)],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{placeholder:"请输入",maxlength:150},model:{value:e.selectForm.remark,callback:function(t){e.$set(e.selectForm,"remark",t)},expression:"selectForm.remark"}})],1)],1),a("div",{staticStyle:{"text-align":"right",padding:"10px"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("\n      取 消\n    ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.saveConfirm}},[e._v("\n      确 定\n    ")])],1),a("el-dialog",{attrs:{width:"1200px",title:"选择服务商",visible:e.innerVisible,"append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t},closed:e.onCancel}},[a("div",{staticStyle:{"text-align":"right"}},[a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{size:"small",placeholder:"起运时间",filterable:"",clearable:""},model:{value:e.searchForm.shipDay,callback:function(t){e.$set(e.searchForm,"shipDay",t)},expression:"searchForm.shipDay"}},e._l(e.weekdays1,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{size:"small",placeholder:"截报关时间",filterable:"",clearable:""},model:{value:e.searchForm.customDay,callback:function(t){e.$set(e.searchForm,"customDay",t)},expression:"searchForm.customDay"}},e._l(e.weekdays1,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1),a("el-input",{staticStyle:{width:"250px","margin-right":"10px"},attrs:{size:"small",placeholder:"请输入",maxlength:150},model:{value:e.keyWord,callback:function(t){e.keyWord=t},expression:"keyWord"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",size:"small",placeholder:"请选择"},slot:"prepend",model:{value:e.keyType,callback:function(t){e.keyType=t},expression:"keyType"}},[a("el-option",{attrs:{label:"服务编码",value:"1"}}),a("el-option",{attrs:{label:"服务机构",value:"2"}})],1)],1),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onSearch}},[e._v("\n        查询\n      ")])],1),e.isType?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tableSelect",staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.tableData,height:"400px",border:""},on:{"row-click":e.rowClick,"selection-change":e.rowSelectChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{prop:"orgName",label:"服务机构","min-width":"150","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"serviceCode",label:"服务编码","min-width":"150","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"entreportName",label:"中转港","min-width":"150","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"dischargeName",label:"卸货港","min-width":"150","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"days",label:"运输天数",width:"100"}}),a("el-table-column",{attrs:{formatter:e.formatDays,prop:"shipDay",label:"起运时间","min-width":"120"}}),a("el-table-column",{attrs:{formatter:e.formatDays,prop:"docDay",label:"截文件时间","min-width":"120"}}),a("el-table-column",{attrs:{formatter:e.formatDays,prop:"customDay",label:"截报关时间","min-width":"120"}}),a("el-table-column",{attrs:{formatter:e.formatType,prop:"orgType2",label:"二程机构类型",width:"120"}}),a("el-table-column",{attrs:{prop:"orgName2",label:"二程服务机构","min-width":"150","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"dischargeName2",label:"二程卸货港","min-width":"150","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"days2",label:"二程运输天数",width:"120"}}),a("el-table-column",{attrs:{formatter:e.formatDays,prop:"shipDay2",label:"二程起运时间","min-width":"120"}})],1):e._e(),a("div",{staticStyle:{"text-align":"right",padding:"10px 0"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onSave}},[e._v("\n        确定\n      ")])],1)],1)],1)},S=[];a("7f7f"),a("55dd"),a("7514"),a("28a5");function N(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?N(a,!0).forEach(function(t){Object(n["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):N(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _(){return{companyId:void 0,companyName:void 0,volume:void 0,serviceName:"",serviceId:void 0,type:"0",bscId:"",bscName:"",bscTransId:"",countryId:"",year:void 0,period:void 0,weight:void 0,remark:void 0}}var V=function(e){function t(){var e;return Object(o["a"])(this,t),e=Object(u["a"])(this,Object(d["a"])(t).apply(this,arguments)),e.loading=!1,e.formLoading=!1,e.selectLoading=!1,e.innerVisible=!1,e.selectForm=_(),e.tableData=[],e.countryList=[],e.flightList=[],e.fiscalList=[],e.selectOption=[],e.companyList=[],e.typelist=[],e.formRules={companyId:{required:!0,message:"请选择所属公司",trigger:"change"},type:{required:!0,message:"请选择业务类型",trigger:"change"},bscId:{required:!0,message:"请选择订舱服务",trigger:"change"},weight:{required:!0,message:"重量不能为空",trigger:"blur"},volume:{required:!0,message:"体积不能为空",trigger:"blur"},year:{required:!0,message:"请选择年度",trigger:"change"},period:{required:!0,message:"请选择期间",trigger:"change"}},e.weekdays1=[{label:"星期一",value:1},{label:"星期二",value:2},{label:"星期三",value:3},{label:"星期四",value:4},{label:"星期五",value:5},{label:"星期六",value:6},{label:"星期日",value:7}],e.searchForm={shipDay:void 0,customDay:void 0,orgName:void 0,serviceCode:void 0},e.keyType="1",e.keyWord="",e.isType="",e}return Object(p["a"])(t,e),Object(c["a"])(t,[{key:"formatType",value:function(e,t,a){var i="";switch(a){case"1":i="船东";break;case"2":i="空运公司";break;case"3":i="铁路公司";break}return i}},{key:"showServiceLine",value:function(){var e=this;if(this.selectForm.bscId){this.isType=this.selectForm.type;var t={page:1,size:999,model:C({id:this.selectForm.bscId},this.searchForm)};this.innerVisible=!0,this.$nextTick(function(){var t=e.$refs.tableSelect;t.clearSelection()}),this.loading=!0,L(t).then(function(t){var a=t.data||{};e.tableData=a.result||[];var i=e.selectForm,r=(i.type,i.bscTransId);if(r){var n=e.selectForm.bscTransId.split(",");n.map(function(t){var a=e.tableData.find(function(e){return e.id===t||"".concat(e.id)===t});a&&e.$nextTick(function(){var t=e.$refs.tableSelect;t.toggleRowSelection(a,!0)})})}e.loading=!1}).catch(function(t){return e.loading=!1,t})}else this.$message.warning("请选择服务")}},{key:"onSearch",value:function(){"1"===this.keyType?(this.searchForm.serviceCode=this.keyWord,this.searchForm.orgName=void 0):(this.searchForm.serviceCode=void 0,this.searchForm.orgName=this.keyWord),this.showServiceLine()}},{key:"rowClick",value:function(e){}},{key:"resetRow",value:function(){this.searchForm={shipDay:void 0,customDay:void 0,orgName:void 0,serviceCode:void 0},this.tableData=[],this.keyType="1",this.keyWord="",this.isType="",this.selectOption=[],this.innerVisible=!1}},{key:"rowSelectChange",value:function(e){this.selectOption=e}},{key:"onCancel",value:function(){this.resetRow()}},{key:"onSave",value:function(){var e=this.selectOption.sort(function(e,t){return e.id-t.id});this.selectForm.serviceId=e.map(function(e){return e.serviceCode}).join(","),this.selectForm.serviceName=e.map(function(e){return e.orgName+"/"+e.serviceCode}).join(","),this.selectForm.bscTransId=e.map(function(e){return e.id}).join(","),this.resetRow()}},{key:"formatDays",value:function(e,t,a){var i=this.weekdays1,r=i.find(function(e){return e.value===a})||{};return r.label||""}},{key:"onYear",value:function(){this.selectForm.period=void 0,this.fiscalList=[]}},{key:"getBusinessType",value:function(){var e=this;this.formLoading=!0;var t={type:"BOOKING_BUSINESS_TYPE"};T(t).then(function(t){t.success&&(e.typelist=t.data||[]),e.formLoading=!1}).catch(function(t){return e.formLoading=!1,t})}},{key:"getFiscalList",value:function(){var e=this;this.selectLoading=!0;var t=this.custType,a={page:1,size:9999,year:this.selectForm.year,custTag:"1",custId:["0"===t?this.selectForm.companyId:this.custId]};v(a).then(function(t){var a=t.data||{};e.fiscalList=a.result||[],e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,t})}},{key:"getCountryList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.selectLoading=!0,e.next=3,I().then(function(e){if(t.selectLoading=!1,e.success){var a=e.data||{};t.countryList=a.result||[]}}).catch(function(e){return t.selectLoading=!1,e});case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getCompanyList",value:function(){var e=this;this.selectLoading=!0;var t={page:1,size:9999,parentId:this.custId};w(t).then(function(t){var a=t.data||{};e.companyList=a.result||[],e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,t})}},{key:"onCompany",value:function(e){this.selectForm.companyName="";var t=this.companyList.find(function(t){return t.id===e});t&&(this.selectForm.companyName=t.name)}},{key:"onType",value:function(){this.flightList=[],this.selectForm.bscId="",this.selectForm.bscName="",this.selectForm.bscTransId="",this.selectForm.serviceId="",this.selectForm.serviceName="",this.selectForm.countryId=""}},{key:"onFlight",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getCountryList();case 2:this.flightList.map(function(e){t.selectForm.bscId===e.id&&(t.selectForm.countryId=e.countryToId,t.selectForm.bscName=e.name)}),this.selectForm.bscTransId="",this.selectForm.serviceId="",this.selectForm.serviceName="",this.selectOption=[];case 7:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getBscList",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.selectLoading=!0,t={page:1,size:99999,conveyance:this.selectForm.type,countryToId:this.selectForm.countryId},e.next=4,k(t).then(function(e){var t=e.data||{},i=t.result;a.flightList=i.map(function(e){return e.id=e.id+"",e}),a.selectLoading=!1}).catch(function(e){return a.selectLoading=!1,[e,null]});case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"filterMethod",value:function(e,t){var a=t.name||"";return a.indexOf(e)>-1}},{key:"setData",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a,i,r=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t.list,a=Object(l["a"])(t,["list"]),this.selectForm=C({},a),e.prev=2,this.formLoading=!0,this.getFiscalList(),e.next=7,this.getBscList();case 7:return i=this.flightList.find(function(e){return r.selectForm.bscId===e.id})||{},this.selectForm.countryId=i.countryToId,this.selectForm.bscName=i.name,e.next=12,this.getCountryList();case 12:this.formLoading=!1,e.next=19;break;case 15:return e.prev=15,e.t0=e["catch"](2),this.formLoading=!1,e.abrupt("return",e.t0);case 19:case"end":return e.stop()}},e,this,[[2,15]])}));function t(t){return e.apply(this,arguments)}return t}()},{key:"resetForm",value:function(){this.selectForm=_()}},{key:"cancel",value:function(){this.$emit("cancel")}},{key:"save",value:function(e){var t=this;this.formLoading=!0,x(e).then(function(e){t.$message({type:"success",message:"保存成功"}),t.formLoading=!1,t.$emit("cancel"),t.$emit("queryAll")}).catch(function(e){return t.formLoading=!1,e})}},{key:"saveConfirm",value:function(){var e=this,t=this.custType,a=this.$refs.selectForm;a.validate(function(a){if(!a)return!1;var i=e.selectForm,r=i.companyId,n=i.companyName,s=Object(l["a"])(i,["companyId","companyName"]),o=C({},s,{companyId:"0"===t?r:e.custId,companyName:"0"===t?n:e.custName});e.countryList.map(function(t){e.selectForm.countryId===t.id&&(o.countryName=t.name)}),e.flightList.map(function(t){e.selectForm.bscId===t.id&&(o.bscName=t.name)});var c=e.fiscalList.find(function(t){return t.id===e.selectForm.period});c&&(o.periodName=c.fiscalPeriod),e.save(o)})}},{key:"created",value:function(){this.getBusinessType()}},{key:"custType",get:function(){var e=f["a"].info||{},t=e.custType;return t}},{key:"custId",get:function(){var e=f["a"].info||{},t=e.custId;return t}},{key:"custName",get:function(){var e=f["a"].info||{},t=e.custName;return t}}]),t}(h["e"]);V=m["a"]([Object(h["a"])({name:"",components:{},props:{isEdit:{type:Boolean,default:!1}}})],V);var D=V,z=D,$=(a("aa5d"),a("2877")),P=Object($["a"])(z,j,S,!1,null,"5b5b9d9e",null),E=P.exports,B=a("5a0c"),R=a.n(B);function A(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function q(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(a,!0).forEach(function(t){Object(n["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var Y=function(e){function t(){var e;return Object(o["a"])(this,t),e=Object(u["a"])(this,Object(d["a"])(t).apply(this,arguments)),e.dialogTitle="",e.isAddEditVisible=!1,e.isEdit=!1,e.loading=!1,e.tableData=[],e.selectValue={countryId:void 0,bscId:void 0,comId:void 0,bscTransId:void 0,type:void 0,bscName:void 0,shipTime:[]},e.selectLoading=!1,e.page=1,e.size=10,e.total=0,e.countryList=[],e.companyList=[],e.typelist=[],e.bsTransList=[],e.flightList=[],e}return Object(p["a"])(t,e),Object(c["a"])(t,[{key:"getCompanyList",value:function(){var e=this;this.selectLoading=!0;var t={page:1,size:9999,parentId:this.custId};w(t).then(function(t){var a=t.data||{};e.companyList=a.result||[],e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,t})}},{key:"getBusinessType",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){var t,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.selectLoading=!0,t={type:"BOOKING_BUSINESS_TYPE"},e.next=4,T(t).then(function(e){e.success&&(a.typelist=e.data||[],a.selectLoading=!1)}).catch(function(e){return a.selectLoading=!1,e});case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"onType",value:function(){this.flightList=[],this.bsTransList=[],this.selectValue.bscId=void 0,this.selectValue.bscTransId=void 0}},{key:"onFlight",value:function(){var e=this;this.selectValue.bscTransId=void 0,this.bsTransList=[],this.getCountryList(),this.flightList.map(function(t){e.selectValue.bscId===t.id&&(e.selectValue.countryId=t.countryToId)})}},{key:"onCompany",value:function(e){this.tableData=[],this.queryAll(1)}},{key:"getCountryList",value:function(){var e=this;this.selectLoading=!0,I().then(function(t){if(e.selectLoading=!1,t.success){var a=t.data||{};e.countryList=a.result||[]}}).catch(function(t){return e.selectLoading=!1,t})}},{key:"getBscList",value:function(){var e=this;this.selectLoading=!0;var t={page:1,size:99999,conveyance:this.selectValue.type,countryToId:this.selectValue.countryId};k(t).then(function(t){var a=t.data||{},i=a.result;e.flightList=i.map(function(e){return e.id=e.id+"",e}),e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,[t,null]})}},{key:"getBsTransList",value:function(){var e=this,t={page:1,size:999,model:{id:this.selectValue.bscId}};this.selectLoading=!0,L(t).then(function(t){var a=t.data||{};e.bsTransList=a.result||[],e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,t})}},{key:"queryAll",value:function(e){var t=this;this.loading=!0;var a=this.selectValue,i=a.shipTime,r=a.comId,n=Object(l["a"])(a,["shipTime","comId"]);e&&(this.page=e);var s={page:this.page,size:this.size,model:q({},n,{companyId:r})};Array.isArray(i)&&i.length>0&&(s.model.startTime=i[0]+" 00:00:00",s.model.endTime=i[1]+" 23:59:59"),F(s).then(function(e){var a=e.data||{};t.tableData=a.result||[],t.total=a.total,t.loading=!1}).catch(function(e){return t.loading=!1,e})}},{key:"addProduct",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.isAddEditVisible=!0,this.dialogTitle="新增发货计划",this.isEdit=!1;case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"editProduct",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t){var a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.isAddEditVisible=!0,this.dialogTitle="编辑发货计划",this.isEdit=!0,this.$nextTick(function(){var e=a.$refs.addEditForm;e.setData(t)});case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"cancel",value:function(){this.isAddEditVisible=!1,this.clearValidate()}},{key:"clearValidate",value:function(){var e=this;this.$nextTick(function(){var t=e.$refs.addEditForm,a=t.$refs.selectForm;t.resetForm(),a.clearValidate()})}},{key:"deleteProduct",value:function(e){var t=this;this.$confirm("请确认是否删除该计划?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){t.loading=!0,O({id:e.id}).then(function(e){t.$message({type:"success",message:"删除成功"}),t.queryAll()}).catch(function(e){return t.loading=!1,e})}).catch(function(){return!1})}},{key:"handleSizeChange",value:function(e){this.size=Number(e),this.queryAll()}},{key:"handleCurrentChange",value:function(e){this.page=Number(e),this.queryAll()}},{key:"created",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.selectValue.shipTime=[R()().startOf("month").format("YYYY-MM-DD"),R()().endOf("month").format("YYYY-MM-DD")],e.next=3,this.getBusinessType();case 3:this.queryAll();case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"custType",get:function(){var e=f["a"].info||{},t=e.custType;return t}},{key:"custSubtype",get:function(){var e=f["a"].info||{},t=e.custSubtype;return t}},{key:"custId",get:function(){var e=f["a"].info||{},t=e.custId;return t}},{key:"custName",get:function(){var e=f["a"].info||{},t=e.custName;return t}}]),t}(h["e"]);Y=m["a"]([Object(h["a"])({name:"",components:{addEditForm:E},props:{}})],Y);var M=Y,W=M,G=(a("221b"),Object($["a"])(W,i,r,!1,null,"6c684529",null));t["default"]=G.exports},"96a9":function(e,t,a){},aa5d:function(e,t,a){"use strict";var i=a("75e8"),r=a.n(i);r.a}}]);