(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["plan-distribut"],{"04ef":function(t,e,a){},2697:function(t,e,a){"use strict";var r=a("04ef"),n=a.n(r);n.a},28956:function(t,e,a){"use strict";var r=a("6970"),n=a.n(r);n.a},3369:function(t,e,a){},6970:function(t,e,a){},ade8:function(t,e,a){"use strict";var r=a("b67a"),n=a.n(r);n.a},b67a:function(t,e,a){},c7db:function(t,e,a){"use strict";var r=a("3369"),n=a.n(r);n.a},ec0f:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","min-height":"inherit"}},[a("div",{staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[a("div",{staticClass:"app-container"},[a("head-info",{attrs:{info:"",title:"销售计划"}}),a("div",{staticClass:"app-panel"},[a("el-tabs",{on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[t.$checkPermission(["salesCompanyPlan"])?a("el-tab-pane",{attrs:{label:"公司计划",name:"first"}},["first"===t.activeName?a("CompanyPlan"):t._e()],1):t._e(),t.$checkPermission(["salesDepartPlan"])?a("el-tab-pane",{attrs:{label:"部门计划",name:"second"}},["second"===t.activeName?a("DepartPlan"):t._e()],1):t._e(),t.$checkPermission(["salesMenPlan"])?a("el-tab-pane",{attrs:{label:"业务员计划",name:"third"}},["third"===t.activeName?a("PersonPlan"):t._e()],1):t._e()],1)],1)],1)])])},n=[],i=a("d225"),s=a("b0b4"),o=a("308d"),l=a("6bb5"),c=a("4e2b"),u=a("9ab4"),d=a("60a3"),m=a("ac1a"),p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.detailShow,expression:"!detailShow"}]},[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:t.addPlan}},[t._v("\n          新增计划\n        ")])],1),a("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:18}},["0"===t.custType?a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:t.selectLoading,size:"small",placeholder:"所属公司",filterable:"",clearable:""},on:{change:t.onCompany,focus:t.getCompanyList},model:{value:t.searchForm.comId,callback:function(e){t.$set(t.searchForm,"comId",e)},expression:"searchForm.comId"}},t._l(t.companyList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e(),a("el-date-picker",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{type:"year",placeholder:"年度","value-format":"yyyy",size:"small",clearable:""},on:{change:function(e){return t.onYear("1")}},model:{value:t.searchForm.year,callback:function(e){t.$set(t.searchForm,"year",e)},expression:"searchForm.year"}}),a("el-select",{staticStyle:{width:"130px","margin-right":"10px"},attrs:{loading:t.selectLoading,disabled:!t.searchForm.year||!t.firstId,placeholder:"期间",size:"small",clearable:"",filterable:""},on:{focus:function(e){return t.getFiscalList("1")}},model:{value:t.searchForm.period,callback:function(e){t.$set(t.searchForm,"period",e)},expression:"searchForm.period"}},t._l(t.fiscalList1,function(t,e){return a("el-option",{key:e,attrs:{label:t.fiscalPeriod,value:t.id}})}),1),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["salesCompanySearch"],expression:"['salesCompanySearch']"}],attrs:{type:"primary",size:"small"},on:{click:function(e){return t.queryAll(1)}}},[t._v("\n          查询\n        ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:t.tableData,height:"calc(100vh - 355px)",border:""}},[a("el-table-column",{attrs:{label:"年度",width:"120",prop:"year"}}),a("el-table-column",{attrs:{formatter:t.formatMonth,label:"期间","min-width":"150"}}),a("el-table-column",{attrs:{label:"公司名称","min-width":"150",prop:"companyName"}}),a("el-table-column",{attrs:{label:"业务类型-任务量","min-width":"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v("空运："+t._s((e.row.airNum||"--")+"KG, "))]),a("span",[t._v("海运："+t._s((e.row.seaNum||"--")+"CBM, "))]),a("span",[t._v("铁路："+t._s((e.row.trainNum||"--")+"CBM, "))]),a("span",[t._v("卡航："+t._s((e.row.carNum||"--")+"KG "))])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(a){return t.editRow(e.row)}}},[t._v("\n            编辑\n          ")]),a("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(a){return t.distributRow(e.row)}}},[t._v("\n            分配\n          ")]),a("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(a){return t.viewRow(e.row)}}},[t._v("\n            查看\n          ")])]}}])})],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":t.page,"page-size":t.size,layout:"total, prev, pager, next",total:t.total},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.handleCurrentChange}})],1),a("distributInfo",{directives:[{name:"show",rawName:"v-show",value:t.detailShow,expression:"detailShow"}],ref:"distribut",attrs:{"is-edit":t.isEdit},on:{close:t.closed}}),a("el-dialog",{attrs:{title:t.isEdit?"编辑计划":"新增计划","close-on-click-modal":!1,width:"600px",visible:t.dialogShow},on:{"update:visible":function(e){t.dialogShow=e},closed:t.cancel}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.dialogLoading,expression:"dialogLoading"}]},[a("el-form",{ref:"editForm",staticStyle:{"padding-right":"20px"},attrs:{model:t.form,"label-width":"100px",size:"small",rules:t.formRules}},["0"===t.custType?a("el-form-item",{attrs:{label:"所属公司",prop:"companyId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{loading:t.selectLoading,size:"small",placeholder:"请选择",filterable:"",clearable:""},on:{change:t.onCompanyChange,focus:t.getCompanyList},model:{value:t.form.companyId,callback:function(e){t.$set(t.form,"companyId",e)},expression:"form.companyId"}},t._l(t.companyList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1):t._e(),a("el-form-item",{attrs:{label:"年度",prop:"year"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"year",placeholder:"请选择","value-format":"yyyy",size:"small",clearable:""},on:{change:function(e){return t.onYear("2")}},model:{value:t.form.year,callback:function(e){t.$set(t.form,"year",e)},expression:"form.year"}})],1),a("el-form-item",{attrs:{label:"期间",prop:"period"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{loading:t.selectLoading,disabled:t.isEdit||!t.form.year||!t.form.companyId,placeholder:"请选择",size:"small",clearable:"",filterable:""},on:{focus:function(e){return t.getFiscalList("2")},change:t.onFiscal},model:{value:t.form.period,callback:function(e){t.$set(t.form,"period",e)},expression:"form.period"}},t._l(t.fiscalList2,function(t,e){return a("el-option",{key:e,attrs:{label:t.fiscalPeriod,value:t.id}})}),1)],1),a("el-form-item",{attrs:{label:"空运业务量",prop:"airNum"}},[a("div",{staticClass:"input-content"},[a("div",{staticStyle:{flex:"1"}},[a("el-input-number",{staticClass:"input-number-valiate input-border",attrs:{controls:!1,placeholder:"请输入",min:0,max:999999,step:1,"step-strictly":""},model:{value:t.form.airNum,callback:function(e){t.$set(t.form,"airNum",e)},expression:"form.airNum"}})],1),a("div",{staticClass:"input-unit"},[t._v("\n              KG\n            ")])])]),a("el-form-item",{attrs:{label:"海运业务量",prop:"seaNum"}},[a("div",{staticClass:"input-content"},[a("div",{staticStyle:{flex:"1"}},[a("el-input-number",{staticClass:"input-number-valiate input-border",attrs:{controls:!1,placeholder:"请输入",min:0,max:999999,step:1,"step-strictly":""},model:{value:t.form.seaNum,callback:function(e){t.$set(t.form,"seaNum",e)},expression:"form.seaNum"}})],1),a("div",{staticClass:"input-unit"},[t._v("\n              CBM\n            ")])])]),a("el-form-item",{attrs:{label:"铁路业务量",prop:"trainNum"}},[a("div",{staticClass:"input-content"},[a("div",{staticStyle:{flex:"1"}},[a("el-input-number",{staticClass:"input-number-valiate input-border",attrs:{controls:!1,placeholder:"请输入",min:0,max:999999,step:1,"step-strictly":""},model:{value:t.form.trainNum,callback:function(e){t.$set(t.form,"trainNum",e)},expression:"form.trainNum"}})],1),a("div",{staticClass:"input-unit"},[t._v("\n              CBM\n            ")])])]),a("el-form-item",{attrs:{label:"卡航业务量",prop:"carNum"}},[a("div",{staticClass:"input-content"},[a("div",{staticStyle:{flex:"1"}},[a("el-input-number",{staticClass:"input-number-valiate input-border",attrs:{controls:!1,placeholder:"请输入",min:0,max:999999,step:1,"step-strictly":""},model:{value:t.form.carNum,callback:function(e){t.$set(t.form,"carNum",e)},expression:"form.carNum"}})],1),a("div",{staticClass:"input-unit"},[t._v("\n              KG\n            ")])])])],1),a("div",{staticStyle:{padding:"10px 0","text-align":"right"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:t.cancel}},[t._v("\n          取 消\n        ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.confirm}},[t._v("\n          确 定\n        ")])],1)],1)])],1)},h=[],f=(a("8e6e"),a("ac6a"),a("456d"),a("c5f6"),a("bd86")),y=a("a8db"),v=(a("7f7f"),a("7514"),a("9dba")),g=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("el-row",[a("el-col",{attrs:{span:6}},[a("span",{staticStyle:{"line-height":"32px"}},[t._v("任务分配")])]),a("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:18}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.goBack}},[t._v("\n        返 回\n      ")]),t.isEdit&&"company"===t.isType?a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.save}},[t._v("\n        保 存\n      ")]):t._e(),t.isEdit&&"company"!==t.isType?a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.addItem}},[t._v("\n        新 增\n      ")]):t._e()],1)],1),a("el-form",{ref:"form",attrs:{model:t.form,"label-position":"left",size:"small"}},["depart"===t.isType?a("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"部门名称","label-width":"70px"}},[t._v("\n      "+t._s(t.form.deptName)+"\n    ")]):t._e(),"sales"===t.isType?a("el-form-item",{staticStyle:{width:"30%"},attrs:{label:"业务员名称","label-width":"90px"}},[t._v("\n      "+t._s(t.form.userName)+"\n    ")]):t._e(),a("el-form-item",{staticStyle:{width:"20%"},attrs:{label:"年度","label-width":"50px"}},[t._v("\n      "+t._s(t.form.year)+"\n    ")]),a("el-form-item",{staticStyle:{width:"40%"},attrs:{label:"期间","label-width":"50px"}},[a("span",[t._v(t._s(t.form.month+"("))]),a("span",[t._v(t._s(t.form.monthStart+"~"))]),a("span",[t._v(t._s(t.form.monthEnd+")"))])])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"company"===t.isType,expression:"isType === 'company'"}]},[t.tableData.length?a("el-table",{staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:t.tableData,height:"calc(100vh - 365px)",border:""}},[a("el-table-column",{attrs:{"min-width":"150",prop:"companyName",label:"公司"}}),a("el-table-column",{attrs:{"min-width":"120"},scopedSlots:t._u([{key:"header",fn:function(e){return[a("span",{staticStyle:{display:"block"}},[t._v("空运")]),a("span",[t._v(t._s(t.airNumTotal(e)))]),a("span",[t._v("/")]),a("span",[t._v(t._s(t.form.airNum)+" KG")])]}},{key:"default",fn:function(e){return[a("div",[t.isEdit?a("el-input-number",{staticClass:"input-number-valiate",attrs:{size:"small",controls:!1,placeholder:"请输入",min:0,max:999999},model:{value:e.row.airNum,callback:function(a){t.$set(e.row,"airNum",a)},expression:"scope.row.airNum"}}):a("span",[t._v(t._s(e.row.airNum))])],1)]}}],null,!1,315809026)}),a("el-table-column",{attrs:{"min-width":"120"},scopedSlots:t._u([{key:"header",fn:function(e){return[a("span",{staticStyle:{display:"block"}},[t._v("海运")]),a("span",[t._v(t._s(t.seaNumTotal(e)))]),a("span",[t._v("/")]),a("span",[t._v(t._s(t.form.seaNum)+" CBM")])]}},{key:"default",fn:function(e){return[a("div",[t.isEdit?a("el-input-number",{staticClass:"input-number-valiate",attrs:{size:"small",controls:!1,placeholder:"请输入",min:0,max:999999},model:{value:e.row.seaNum,callback:function(a){t.$set(e.row,"seaNum",a)},expression:"scope.row.seaNum"}}):a("span",[t._v(t._s(e.row.seaNum))])],1)]}}],null,!1,2335541103)}),a("el-table-column",{attrs:{"min-width":"120"},scopedSlots:t._u([{key:"header",fn:function(e){return[a("span",{staticStyle:{display:"block"}},[t._v("铁路")]),a("span",[t._v(t._s(t.trainNumTotal(e)))]),a("span",[t._v("/")]),a("span",[t._v(t._s(t.form.trainNum)+" CBM")])]}},{key:"default",fn:function(e){return[a("div",[t.isEdit?a("el-input-number",{staticClass:"input-number-valiate",attrs:{size:"small",controls:!1,placeholder:"请输入",min:0,max:999999},model:{value:e.row.trainNum,callback:function(a){t.$set(e.row,"trainNum",a)},expression:"scope.row.trainNum"}}):a("span",[t._v(t._s(e.row.trainNum))])],1)]}}],null,!1,3843669638)}),a("el-table-column",{attrs:{"min-width":"120"},scopedSlots:t._u([{key:"header",fn:function(e){return[a("span",{staticStyle:{display:"block"}},[t._v("卡航")]),a("span",[t._v(t._s(t.carNumTotal(e)))]),a("span",[t._v("/")]),a("span",[t._v(t._s(t.form.carNum)+" KG")])]}},{key:"default",fn:function(e){return[a("div",[t.isEdit?a("el-input-number",{staticClass:"input-number-valiate",attrs:{size:"small",controls:!1,placeholder:"请输入",min:0,max:999999},model:{value:e.row.carNum,callback:function(a){t.$set(e.row,"carNum",a)},expression:"scope.row.carNum"}}):a("span",[t._v(t._s(e.row.carNum))])],1)]}}],null,!1,2274457635)})],1):t._e()],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"company"!==t.isType,expression:"isType !== 'company'"}],staticClass:"order-detail"},[a("div",{staticClass:"masonry"},t._l(t.taskData,function(e,r){return a("div",{key:r,staticClass:"task-card"},[a("div",{staticClass:"task-card-header"},[e.taskEdit?t._e():a("div",[a("el-row",[a("el-col",{attrs:{span:14}},[a("span",{staticStyle:{"font-weight":"bold","font-size":"16px","line-height":"32px"}},[t._v("\n                  第"+t._s(e.week||"")+"周\n                ")])]),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:10}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.isEdit&&e.details.some(function(t){return t.id}),expression:"isEdit && item.details.some((d) => d.id)"}],staticStyle:{color:"#f56c6c"},attrs:{type:"text",size:"small"},on:{click:function(a){return t.deleteItem(e)}}},[t._v("\n                  删除\n                ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.isEdit&&!t.taskData.some(function(t){return t.taskEdit}),expression:"isEdit && !taskData.some((d) => d.taskEdit)"}],attrs:{type:"text",size:"small"},on:{click:function(a){return t.editItem(e,r)}}},[t._v("\n                  编辑\n                ")])],1)],1),a("el-row",{staticStyle:{"font-size":"13px",color:"#999"}},[a("el-col",{attrs:{span:16}},[t._v("\n                "+t._s(t.filterWeek(e))+"\n              ")]),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:8}},[t._v("\n                共"+t._s(e.days)+"天\n              ")])],1)],1),e.taskEdit?a("div",[a("el-select",{staticStyle:{width:"45%"},attrs:{size:"small",placeholder:"任务周期",clearable:"",filterable:""},on:{change:function(e){return t.onWeek(e,r)}},model:{value:e.week,callback:function(a){t.$set(e,"week",a)},expression:"item.week"}},t._l(t.weekList,function(t){return a("el-option",{key:t.id,attrs:{label:"第"+t.id+"周("+t.start+"~"+t.end+")",value:t.id}})}),1)],1):t._e()]),a("div",{staticClass:"task-card-contain"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.taskEdit,expression:"item.taskEdit"}]},[a("el-row",{staticStyle:{"padding-bottom":"10px"}},[a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:11}},[t._v("\n                服务组\n              ")]),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:11}},[t._v("\n                目标\n              ")])],1),t._l(e.details,function(e,n){return a("div",{key:n,staticClass:"item-after-icon"},[a("el-select",{staticStyle:{width:"45%"},attrs:{size:"small",placeholder:"服务组",clearable:"",filterable:""},on:{change:function(e){return t.onGroup(e,r,n)}},model:{value:e.groupId,callback:function(a){t.$set(e,"groupId",a)},expression:"jtem.groupId"}},t._l(t.serviceList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),a("el-input-number",{staticClass:"input-number-valiate",staticStyle:{width:"45%"},attrs:{size:"small",controls:!1,placeholder:"请输入",min:0,max:999999,step:1,"step-strictly":""},model:{value:e.num,callback:function(a){t.$set(e,"num",a)},expression:"jtem.num"}}),a("span",[a("i",0===n?{staticClass:"el-icon-circle-plus-outline item-icon-plus",on:{click:function(e){return t.addRangeData(r,n)}}}:{staticClass:"el-icon-remove-outline item-icon-reduce",on:{click:function(e){return t.deleteRangeData(r,n)}}})])],1)})],2),e.taskEdit?t._e():a("div",[a("el-table",{staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.details,border:""}},[a("el-table-column",{attrs:{label:"服务组",prop:"groupName"}}),a("el-table-column",{attrs:{label:"目标",prop:"num"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                  "+t._s(e.row.num+("1"===e.row.business||"2"===e.row.business?"CBM":"KG"))+"\n                ")]}}],null,!0)})],1)],1),a("el-row",[a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:24}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.taskEdit,expression:"item.taskEdit"}],attrs:{size:"mini"},on:{click:function(a){return t.cancelItem(e,r)}}},[t._v("\n                取消\n              ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.taskEdit,expression:"item.taskEdit"}],staticStyle:{float:"right"},attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.saveItem(e)}}},[t._v("\n                保存\n              ")])],1)],1)],1)])}),0)])],1)},b=[],k=(a("5df3"),a("4f7f"),a("75fc")),w=(a("96cf"),a("3b8d")),x=a("b32d");function _(t){var e={url:"/orders/year_plan/plan_page",method:"post",data:t};return Object(x["a"])(e)}function S(t){var e={url:"/orders/year_plan/save_plan",method:"post",data:t};return Object(x["a"])(e)}function I(t){var e={url:"/orders/year_plan/save_company_plan",method:"post",data:t};return Object(x["a"])(e)}function N(t){var e={url:"/orders/year_plan/company_page",method:"post",data:t};return Object(x["a"])(e)}function O(t){var e={url:"/orders/year_plan/dept_page",method:"post",data:t};return Object(x["a"])(e)}function L(t){var e={url:"/orders/year_plan/save_dept_plan",method:"post",data:t};return Object(x["a"])(e)}function D(t){var e={url:"/orders/year_plan/dept_view",method:"get",params:t};return Object(x["a"])(e)}function j(t){var e={url:"/orders/year_plan/user_page",method:"post",data:t};return Object(x["a"])(e)}function C(t){var e={url:"/orders/year_plan/save_user_plan",method:"post",data:t};return Object(x["a"])(e)}function F(t){var e={url:"/orders/year_plan/user_view",method:"get",params:t};return Object(x["a"])(e)}function T(t){var e={url:"/auth/dept/getDeptList",method:"get",params:t};return Object(x["a"])(e)}function E(t){var e={url:"/orders/year_plan/only_dept",method:"post",data:t};return Object(x["a"])(e)}function Y(t){var e={url:"/orders/year_plan/dept_del",method:"get",params:t};return Object(x["a"])(e)}function $(t){var e={url:"/orders/year_plan/user_del",method:"get",params:t};return Object(x["a"])(e)}function z(t){var e={url:"/finance/fisCal/get",method:"post",data:t};return Object(x["a"])(e)}function P(){var t={url:"/auth/agent/customer_finance",method:"get"};return Object(x["a"])(t)}function M(t){var e={url:"/auth/agent/customer_by_id",method:"get",params:t};return Object(x["a"])(e)}function R(t){var e={url:"/auth/agent/getAgentList",method:"get",params:t};return Object(x["a"])(e)}function q(t){var e={url:"/cfg/sale/getSaleGroupList",method:"post",data:t};return Object(x["a"])(e)}function B(t){var e={url:"/auth/user/getUsersInDept",method:"get",params:t};return Object(x["a"])(e)}var G=a("5a0c"),A=a.n(G);function K(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}function J(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?K(a,!0).forEach(function(e){Object(f["a"])(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):K(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}var U=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(o["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.loading=!1,t.tableData=[],t.taskData=[],t.copyData=[],t.serviceList=[],t.companyList=[],t.weekList=[],t.form={},t.isType="",t}return Object(c["a"])(e,t),Object(s["a"])(e,[{key:"filterWeek",value:function(t){return A()(t.weekStart).format("YYYY-MM-DD")+"~"+A()(t.weekEnd).format("YYYY-MM-DD")}},{key:"airNumTotal",value:function(t){return this.tableData.reduce(function(t,e){return t+=e.airNum||0,t},0)}},{key:"seaNumTotal",value:function(t){return this.tableData.reduce(function(t,e){return t+=e.seaNum||0,t},0)}},{key:"trainNumTotal",value:function(t){return this.tableData.reduce(function(t,e){return t+=e.trainNum||0,t},0)}},{key:"carNumTotal",value:function(t){return this.tableData.reduce(function(t,e){return t+=e.carNum||0,t},0)}},{key:"setData",value:function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(e,a){var r,n,i;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.isType=a,r=e.monthStart,n=e.monthEnd,i=Object(y["a"])(e,["monthStart","monthEnd"]),this.form=J({},i,{monthStart:A()(r).format("YYYY-MM-DD"),monthEnd:A()(n).format("YYYY-MM-DD")}),this.setWeek(),this.getGroupList(),t.next=7,this.getDetail();case 7:case"end":return t.stop()}},t,this)}));function e(e,a){return t.apply(this,arguments)}return e}()},{key:"setWeek",value:function(){var t=this.form,e=t.monthStart,a=t.monthEnd,r=A()(e).format("YYYY-MM-DD"),n=A()(a).format("YYYY-MM-DD"),i=A()(r).day(),s="";s=i>0?A()(r).endOf("week").add(1,"day").format("YYYY-MM-DD"):r;var o=A()(s).unix(),l=A()(n).unix(),c=[];if(o>=l)c=[{start:r,end:n,days:A()(n).diff(A()(r),"day")+1,id:"1"}];else for(var u=(l-o)/604800,d=Math.ceil(u),m=0;m<=d;m++){var p=A()(s).add(7*(m-1)+1,"day").format("YYYY-MM-DD"),h=A()(s).add(7*m,"day").format("YYYY-MM-DD");0===m?c.push({start:r,end:s,days:A()(s).diff(A()(r),"day")+1,id:"".concat(m+1)}):m===d?c.push({start:p,end:n,days:A()(n).diff(A()(p),"day")+1,id:"".concat(d+1)}):c.push({start:p,end:h,days:7,id:"".concat(m+1)})}this.weekList=c}},{key:"getDetail",value:function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(){var e,a,r,n,i,s,o,l,c,u,d,m,p,h,f=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if("company"!==this.isType){t.next=32;break}if(this.loading=!0,t.prev=2,e=[],a=this.custType,"0"!==a){t.next=12;break}return t.next=8,M({custId:this.form.companyId});case 8:r=t.sent,e=r.data||[],t.next=16;break;case 12:return t.next=14,P();case 14:n=t.sent,e=n.data||[];case 16:return this.companyList=e.map(function(t){return{companyId:t.id,companyName:t.name,parentId:f.form.companyId,period:f.form.period,monthStart:f.form.monthStart+" 00:00:00",monthEnd:f.form.monthEnd+" 23:59:59",seaNum:0,trainNum:0,airNum:0,carNum:0,year:f.form.year,yearId:f.form.id}}),i={model:{yearId:this.form.id},page:1,size:9999},t.next=20,N(i);case 20:s=t.sent,o=(s.data||{}).result||[],l=this.companyList.map(function(t){var e=o.find(function(e){return e.companyId===t.companyId});return e&&(t=J({},e,{parentId:e.parentId||f.form.companyId})),t}),this.tableData=l,this.loading=!1,t.next=30;break;case 27:t.prev=27,t.t0=t["catch"](2),this.loading=!1;case 30:t.next=50;break;case 32:return this.loading=!0,t.prev=33,c=null,"depart"===this.isType?(u={id:this.form.id},c=D(u)):"sales"===this.isType&&(d={period:this.form.period,userId:this.form.userId,year:this.form.year,start:this.form.monthStart+" 00:00:00",end:this.form.monthEnd+" 23:59:59",month:this.form.month},c=F(d)),t.next=38,c;case 38:m=t.sent,p=m.data||{},this.taskData=[],h=p.results||[],this.form.id=(p.yearDeptPlan||{}).id,h.length?(this.taskData=h.map(function(t){return J({},t,{taskEdit:!1})}),this.copyData=JSON.parse(JSON.stringify(this.taskData))):this.isEdit&&this.taskData.push({taskEdit:!0,week:void 0,weekStart:"",weekEnd:"",days:"",details:[{groupId:void 0,business:"",groupName:"",num:0}]}),this.loading=!1,t.next=50;break;case 47:t.prev=47,t.t1=t["catch"](33),this.loading=!1;case 50:case"end":return t.stop()}},t,this,[[2,27],[33,47]])}));function e(){return t.apply(this,arguments)}return e}()},{key:"getGroupList",value:function(){var t=this,e={model:{},page:1,size:9999};this.loading=!0,q(e).then(function(e){var a=e.data||{},r=a.result||[];t.serviceList=r.filter(function(t){return"1"===t.status}),t.loading=!1}).catch(function(){t.loading=!1})}},{key:"save",value:function(){var t=this;if(this.loading=!0,"company"===this.isType){var e={yearPlan:J({},this.form,{monthStart:A()(this.form.monthStart).format("YYYY-MM-DD")+" 00:00:00",monthEnd:A()(this.form.monthEnd).format("YYYY-MM-DD")+" 23:59:59"}),companyPlan:this.tableData};I(e).then(function(e){t.loading=!1,t.$message({type:"success",message:"保存成功"}),t.goBack()}).catch(function(e){return t.loading=!1,e})}}},{key:"onWeek",value:function(t,e){this.taskData[e].weekStart="",this.taskData[e].weekEnd="",this.taskData[e].days="";var a=this.weekList.find(function(e){return e.id===t});a&&(this.taskData[e].weekStart=a.start+" 00:00:00",this.taskData[e].weekEnd=a.end+" 23:59:59",this.taskData[e].days=a.days)}},{key:"onGroup",value:function(t,e,a){this.taskData[e].details[a].groupName="",this.taskData[e].details[a].business="";var r=this.serviceList.find(function(e){return e.id===t});r&&(this.taskData[e].details[a].groupName=r.name,this.taskData[e].details[a].business=r.subtypeId)}},{key:"addItem",value:function(){var t=this.taskData.every(function(t){return t.details.some(function(t){return t.id})});t?(this.taskData=JSON.parse(JSON.stringify(this.copyData)),this.taskData.push({taskEdit:!0,week:void 0,weekStart:"",weekEnd:"",days:"",details:[{groupId:void 0,business:"",groupName:"",num:0}]})):this.$message.error("请先保存再新增")}},{key:"editItem",value:function(t,e){this.taskData[e].taskEdit=!0}},{key:"cancelItem",value:function(t,e){t.details.some(function(t){return t.id})?(this.taskData[e].taskEdit=!1,this.taskData[e].details=JSON.parse(JSON.stringify(this.copyData[e].details))):this.taskData.splice(e,1)}},{key:"saveItem",value:function(t){var e=this,a=this.taskData.filter(function(e){return e.week===t.week}).length,r=t.details,n=r.map(function(t){return t.groupId}),i=Object(k["a"])(new Set(n));if(t.week)if(a>1)this.$message.error("任务周期不能重复");else if(t.details.every(function(t){return t.groupId}))if(i.length<n.length)this.$message.error("服务组不能重复");else{this.loading=!0;var s=[];this.taskData.map(function(t){t.details&&t.details.map(function(a){s.push(J({},a,{did:e.form.id,week:t.week,weekStart:t.weekStart,weekEnd:t.weekEnd,days:t.days}))})});var o=null;if("depart"===this.isType){var l={yearDeptPlan:J({},this.form,{monthStart:A()(this.form.monthStart).format("YYYY-MM-DD")+" 00:00:00",monthEnd:A()(this.form.monthEnd).format("YYYY-MM-DD")+" 23:59:59"}),details:s};o=L(l)}else if("sales"===this.isType){var c={yearUserPlan:J({},this.form,{monthStart:A()(this.form.monthStart).format("YYYY-MM-DD")+" 00:00:00",monthEnd:A()(this.form.monthEnd).format("YYYY-MM-DD")+" 23:59:59"}),details:s};o=C(c)}o.then(function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(a){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e.$message({type:"success",message:"保存成功"}),t.next=3,e.getDetail();case 3:e.loading=!1;case 4:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(t){return e.loading=!1,t})}else this.$message.error("服务组不能为空");else this.$message.error("任务周期不能为空")}},{key:"deleteItem",value:function(t){var e=this;this.$confirm("请确认是否删除该条数据?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){var a={did:e.form.id,week:t.week},r=null;"depart"===e.isType?r=Y:"sales"===e.isType&&(r=$),r(a).then(function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(a){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e.$message({type:"success",message:"删除成功"}),t.next=3,e.getDetail();case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()).catch(function(t){return t})}).catch(function(){return!1})}},{key:"addRangeData",value:function(t,e){this.taskData[t].details.push({groupId:void 0,business:"",groupName:"",num:0})}},{key:"deleteRangeData",value:function(t,e){this.taskData[t].details.splice(e,1)}},{key:"goBack",value:function(){this.isType="",this.tableData=[],this.companyList=[],this.taskData=[],this.copyData=[],this.$emit("close")}},{key:"custId",get:function(){var t=v["a"].info||{},e=t.custId;return e}},{key:"custName",get:function(){var t=v["a"].info||{},e=t.custName;return e}},{key:"custType",get:function(){var t=v["a"].info||{},e=t.custType;return e}}]),e}(d["e"]);U=u["a"]([Object(d["a"])({name:"addEditForm",components:{},props:{isEdit:{type:Boolean,default:!1}}})],U);var W=U,V=W,H=(a("2697"),a("2877")),Q=Object(H["a"])(V,g,b,!1,null,"01627da4",null),X=Q.exports;function Z(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}function tt(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?Z(a,!0).forEach(function(e){Object(f["a"])(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Z(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}function et(){return{year:void 0,period:void 0,month:void 0,companyId:void 0,monthStart:void 0,monthEnd:void 0,airNum:0,seaNum:0,trainNum:0,carNum:0}}var at=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(o["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.loading=!1,t.dialogShow=!1,t.detailShow=!1,t.dialogLoading=!1,t.selectLoading=!1,t.isEdit=!1,t.tableData=[],t.companyList=[],t.fiscalList1=[],t.fiscalList2=[],t.firstId="",t.firstName="",t.searchForm={year:void 0,comId:void 0,period:void 0},t.form=et(),t.page=1,t.size=10,t.total=0,t.formRules={companyId:{required:!0,message:"请选择所属公司",trigger:"change"},year:{required:!0,message:"请选择年度",trigger:"change"},period:{required:!0,message:"请选择期间",trigger:"change"},airNum:{required:!0,message:"空运业务量不能为空",trigger:"blur"},seaNum:{required:!0,message:"海运业务量不能为空",trigger:"blur"},trainNum:{required:!0,message:"铁路业务量不能为空",trigger:"blur"},carNum:{required:!0,message:"卡航业务量不能为空",trigger:"blur"}},t}return Object(c["a"])(e,t),Object(s["a"])(e,[{key:"closed",value:function(){this.detailShow=!1,this.queryAll()}},{key:"onCompany",value:function(t){this.firstId="",this.firstName="";var e=this.companyList.find(function(e){return e.id===t});e&&(this.firstId=t,this.firstName=e.name),this.tableData=[],this.queryAll(1)}},{key:"onCompanyChange",value:function(t){this.form.companyName="";var e=this.companyList.find(function(e){return e.id===t});e&&(this.form.companyId=e.id,this.form.companyName=e.name)}},{key:"getCompanyList",value:function(){var t=this;this.selectLoading=!0;var e={page:1,size:9999,parentId:this.custId};R(e).then(function(e){var a=e.data||{};t.companyList=a.result||[],t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"onYear",value:function(t){"1"===t?(this.searchForm.period=void 0,this.fiscalList1=[]):(this.form.period=void 0,this.fiscalList2=[])}},{key:"formatMonth",value:function(t){return t.month+"("+A()(t.monthStart).format("YYYY-MM-DD")+"~"+A()(t.monthEnd).format("YYYY-MM-DD")+")"}},{key:"getFiscalList",value:function(t){var e=this;this.selectLoading=!0;this.custType;var a={page:1,size:9999,year:"1"===t?this.searchForm.year:this.form.year,custTag:"1",custId:"1"===t?[this.firstId]:[this.form.companyId]};z(a).then(function(a){var r=a.data||{},n=r.result||[];"1"===t?e.fiscalList1=n:e.fiscalList2=n.filter(function(t){return"0"===t.typePlan}),e.selectLoading=!1}).catch(function(t){return e.selectLoading=!1,t})}},{key:"onFiscal",value:function(t){this.form.month=void 0,this.form.monthStart=void 0,this.form.monthEnd=void 0;var e=this.fiscalList2.find(function(e){return e.id===t});e&&(this.form.month=e.fiscalPeriod,this.form.monthStart=e.startTime,this.form.monthEnd=e.endTime)}},{key:"queryAll",value:function(t){var e=this;this.loading=!0,t&&(this.page=t);var a=this.searchForm,r=a.comId,n=Object(y["a"])(a,["comId"]),i={page:this.page,size:this.size,model:tt({},n,{companyId:r})};_(i).then(function(t){e.loading=!1;var a=t.data||{};e.tableData=a.result||[],e.total=t.data.total}).catch(function(t){return e.loading=!1,t})}},{key:"confirm",value:function(){var t=this,e=this.$refs.editForm;e.validate(function(e){if(!e)return!1;t.dialogLoading=!0;var a=t.form,r=a.monthStart,n=a.monthEnd,i=Object(y["a"])(a,["monthStart","monthEnd"]),s=tt({},i,{monthStart:A()(r).format("YYYY-MM-DD")+" 00:00:00",monthEnd:A()(n).format("YYYY-MM-DD")+" 23:59:59"});S(s).then(function(e){t.$message({type:"success",message:"保存成功"}),t.dialogShow=!1,t.dialogLoading=!1,t.queryAll(),t.resetForm(),t.clearValidate()}).catch(function(e){return t.dialogLoading=!1,e})})}},{key:"addPlan",value:function(){this.form.companyId=this.firstId,this.form.companyName=this.firstName,this.isEdit=!1,this.dialogShow=!0}},{key:"editRow",value:function(t){this.isEdit=!0,this.dialogShow=!0,this.form=tt({},t),this.getFiscalList("2")}},{key:"distributRow",value:function(t){this.isEdit=!0,this.detailShow=!0;var e=this.$refs.distribut;this.$nextTick(function(){e.setData(t,"company")})}},{key:"viewRow",value:function(t){this.isEdit=!1,this.detailShow=!0;var e=this.$refs.distribut;this.$nextTick(function(){e.setData(t,"company")})}},{key:"cancel",value:function(){this.dialogShow=!1,this.resetForm(),this.clearValidate()}},{key:"clearValidate",value:function(){var t=this;this.$nextTick(function(){var e=t.$refs.editForm;e.clearValidate()})}},{key:"resetForm",value:function(){this.form=et(),this.fiscalList2=[]}},{key:"handleCurrentChange",value:function(t){this.page=Number(t),this.queryAll()}},{key:"created",value:function(){var t=this.custId,e=this.custName,a=this.custType,r=this.custSubtype,n=this.ifCustomer,i=this.parentId,s=this.parentName;"2"===a&&"2"===r&&n?(this.firstId=i,this.firstName=s):"0"!==a?(this.firstId=t,this.firstName=e):(this.firstId="",this.firstName=""),this.queryAll()}},{key:"custId",get:function(){var t=v["a"].info||{},e=t.custId;return e}},{key:"custName",get:function(){var t=v["a"].info||{},e=t.custName;return e}},{key:"custType",get:function(){var t=v["a"].info||{},e=t.custType;return e}},{key:"custSubtype",get:function(){var t=v["a"].info||{},e=t.custSubtype;return e}},{key:"parentId",get:function(){var t=v["a"].info||{},e=t.parentId;return e}},{key:"parentName",get:function(){var t=v["a"].info||{},e=t.parentName;return e}},{key:"ifCustomer",get:function(){var t=v["a"].info||{},e=1===t.ifCustomer;return e}}]),e}(d["e"]);at=u["a"]([Object(d["a"])({name:"Company",components:{distributInfo:X},props:{wsId:{type:String,default:""}}})],at);var rt=at,nt=rt,it=(a("ade8"),Object(H["a"])(nt,p,h,!1,null,"4d6918c2",null)),st=it.exports,ot=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.detailShow,expression:"!detailShow"}]},[a("el-row",{staticStyle:{"margin-bottom":"10px"}},[a("el-col",{attrs:{span:4}},[a("span",{staticStyle:{"line-height":"32px"}},[t._v("公司销售任务")])]),a("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:20}},["0"===t.custType?a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:t.selectLoading,size:"small",placeholder:"所属公司",filterable:"",clearable:""},on:{change:t.onCompany,focus:t.getCompanyList},model:{value:t.searchForm.parentId,callback:function(e){t.$set(t.searchForm,"parentId",e)},expression:"searchForm.parentId"}},t._l(t.companyList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e(),"0"===t.custType||"2"===t.custType&&"1"===t.custSubtype?a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{disabled:"0"===t.custType&&!t.searchForm.parentId,loading:t.selectLoading,size:"small",placeholder:"分公司",filterable:"",clearable:""},on:{change:t.onUnCompany,focus:t.getUnFinanceCompanyList},model:{value:t.searchForm.comId,callback:function(e){t.$set(t.searchForm,"comId",e)},expression:"searchForm.comId"}},t._l(t.unCompanyList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e(),a("el-date-picker",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{type:"year",placeholder:"年度","value-format":"yyyy",size:"small",clearable:""},on:{change:t.onYear},model:{value:t.searchForm.year,callback:function(e){t.$set(t.searchForm,"year",e)},expression:"searchForm.year"}}),a("el-select",{staticStyle:{width:"130px","margin-right":"10px"},attrs:{loading:t.selectLoading,disabled:!t.searchForm.year,placeholder:"期间",size:"small",clearable:"",filterable:""},on:{focus:t.getFiscalList},model:{value:t.searchForm.period,callback:function(e){t.$set(t.searchForm,"period",e)},expression:"searchForm.period"}},t._l(t.fiscalList,function(t,e){return a("el-option",{key:e,attrs:{label:t.fiscalPeriod,value:t.id}})}),1),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["salesDepartSearch"],expression:"['salesDepartSearch']"}],attrs:{type:"primary",size:"small"},on:{click:t.handleSearch}},[t._v("\n          查询\n        ")])],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("el-col",{staticStyle:{"line-height":"32px"},attrs:{span:12}},[a("svg-icon",{attrs:{name:"air"}}),t._v("\n              空运任务\n            ")],1),a("el-col",{staticStyle:{"line-height":"29px"},attrs:{span:12}},[a("span",{staticStyle:{"text-align":"right","font-size":"24px","font-weight":"bold"}},[t._v("\n                "+t._s(t.taskObj.airNum||"--")+"\n              ")]),t._v("KG\n            ")])],1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("el-col",{staticStyle:{"line-height":"32px"},attrs:{span:12}},[a("svg-icon",{attrs:{name:"boat"}}),t._v("\n              海运任务\n            ")],1),a("el-col",{staticStyle:{"line-height":"29px"},attrs:{span:12}},[a("span",{staticStyle:{"text-align":"right","font-size":"24px","font-weight":"bold"}},[t._v("\n                "+t._s(t.taskObj.seaNum||"--")+"\n              ")]),t._v("CBM\n            ")])],1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("el-col",{staticStyle:{"line-height":"32px"},attrs:{span:12}},[a("svg-icon",{attrs:{name:"train"}}),t._v("\n              铁路任务\n            ")],1),a("el-col",{staticStyle:{"line-height":"29px"},attrs:{span:12}},[a("span",{staticStyle:{"text-align":"right","font-size":"24px","font-weight":"bold"}},[t._v("\n                "+t._s(t.taskObj.trainNum||"--")+"\n              ")]),t._v("CBM\n            ")])],1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("el-col",{staticStyle:{"line-height":"32px"},attrs:{span:12}},[a("svg-icon",{attrs:{name:"car"}}),t._v("\n              卡航任务\n            ")],1),a("el-col",{staticStyle:{"line-height":"29px"},attrs:{span:12}},[a("span",{staticStyle:{"text-align":"right","font-size":"24px","font-weight":"bold"}},[t._v("\n                "+t._s(t.taskObj.carNum||"--")+"\n              ")]),t._v("KG\n            ")])],1)],1)],1)],1),a("div",[a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:t.addDepart}},[t._v("\n        新增部门\n      ")])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:t.tableData,height:"calc(100vh - 460px)",border:""}},[a("el-table-column",{attrs:{label:"部门","min-width":"120",prop:"deptName"}}),a("el-table-column",{attrs:{label:"业务类型-任务量","min-width":"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v("空运："+t._s((e.row.airNum||"--")+"KG, "))]),a("span",[t._v("海运："+t._s((e.row.seaNum||"--")+"CBM, "))]),a("span",[t._v("铁路："+t._s((e.row.trainNum||"--")+"CBM, "))]),a("span",[t._v("卡航："+t._s((e.row.carNum||"--")+"KG "))])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(a){return t.editRow(e.row)}}},[t._v("\n            分配\n          ")]),a("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(a){return t.viewRow(e.row)}}},[t._v("\n            查看\n          ")])]}}])})],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":t.page,"page-size":t.size,layout:"total, prev, pager, next",total:t.total},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},"current-change":t.handleCurrentChange}})],1),a("distributInfo",{directives:[{name:"show",rawName:"v-show",value:t.detailShow,expression:"detailShow"}],ref:"distribut",attrs:{"is-edit":t.isEdit},on:{close:t.closed}}),a("el-dialog",{attrs:{title:"新增部门","close-on-click-modal":!1,width:"600px",visible:t.dialogShow},on:{"update:visible":function(e){t.dialogShow=e},closed:t.cancel}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.dialogLoading,expression:"dialogLoading"}]},[a("el-form",{ref:"editForm",staticStyle:{"padding-right":"20px"},attrs:{model:t.form,"label-width":"100px",size:"small"}},[a("el-form-item",{attrs:{label:"部门",prop:"departId"}},[a("el-tree-select",{attrs:{data:t.departmentList,"default-expand-all":!1,clearable:"",filterable:"",size:"small",placeholder:"请选择"},model:{value:t.form.departId,callback:function(e){t.$set(t.form,"departId",e)},expression:"form.departId"}})],1)],1),a("div",{staticStyle:{padding:"10px 0","text-align":"right"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:t.cancel}},[t._v("\n          取 消\n        ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.confirm}},[t._v("\n          确 定\n        ")])],1)],1)])],1)},lt=[];a("a481");function ct(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}function ut(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ct(a,!0).forEach(function(e){Object(f["a"])(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ct(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}var dt=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(o["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.loading=!1,t.dialogShow=!1,t.detailShow=!1,t.dialogLoading=!1,t.selectLoading=!1,t.isEdit=!1,t.tableData=[],t.companyList=[],t.unCompanyList=[],t.fiscalList=[],t.departmentList=[],t.companyTypeList=[],t.firstId="",t.searchForm={comType:"1",parentId:"",comId:"",year:"",period:""},t.form={departId:""},t.taskObj={airNum:0,seaNum:0,trainNum:0,carNum:0},t.page=1,t.size=10,t.total=0,t}return Object(c["a"])(e,t),Object(s["a"])(e,[{key:"closed",value:function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.detailShow=!1,t.next=3,this.handleSearch();case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"onComType",value:function(){this.tableData=[],this.searchForm.comId="",this.companyList=[]}},{key:"onCompany",value:function(t){this.searchForm.comId="",this.unCompanyList=[],this.tableData=[],this.onYear();var e=this.companyList.find(function(e){return e.id===t});e&&(this.firstId=t)}},{key:"onUnCompany",value:function(t){this.tableData=[]}},{key:"onYear",value:function(){this.searchForm.period=void 0,this.fiscalList=[]}},{key:"getCompanyList",value:function(){var t=this;this.selectLoading=!0;var e={page:1,size:9999,parentId:this.custId};R(e).then(function(e){var a=e.data||{};t.companyList=a.result||[],t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"getUnFinanceCompanyList",value:function(){var t=this,e=this.custType;if(this.selectLoading=!0,"0"===e){var a={custId:this.searchForm.parentId};M(a).then(function(e){var a=e.data||[];t.unCompanyList=a,t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}else P().then(function(e){var a=e.data||[];t.unCompanyList=a,t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"getFiscalList",value:function(){var t=this;this.selectLoading=!0;var e={page:1,size:9999,year:this.searchForm.year,custTag:"1",custId:[this.firstId]};z(e).then(function(e){var a=e.data||{};t.fiscalList=a.result||[],t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"getCompanyTask",value:function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(){var e,a,r,n,i=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.loading=!0,e=this.searchForm,e.comType,a=e.comId,e.parentId,r=Object(y["a"])(e,["comType","comId","parentId"]),n={model:ut({companyId:a},r),page:1,size:9999},t.next=5,N(n).then(function(t){var e=(t.data||{}).result||[],a=e.find(function(t){return t.companyId===n.model.companyId})||{};i.taskObj=a}).catch(function(t){return i.loading=!1,t});case 5:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"handleSearch",value:function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.custType,a=this.custSubtype,"0"!==e&&("2"!==e||"1"!==a)||this.searchForm.comId){t.next=7;break}return this.$message.error("请选择分公司"),t.abrupt("return");case 7:if(this.searchForm.period){t.next=10;break}return this.$message.error("请选择期间"),t.abrupt("return");case 10:return t.next=12,this.getCompanyTask();case 12:this.queryAll(1);case 13:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"queryAll",value:function(t){var e=this,a=this.custType,r=this.custSubtype;if("0"!==a&&("2"!==a||"1"!==r)||this.searchForm.comId)if(this.searchForm.period){this.loading=!0,t&&(this.page=t);var n=this.searchForm,i=(n.comType,n.comId),s=Object(y["a"])(n,["comType","comId"]),o={page:this.page,size:this.size,model:ut({},s,{companyId:i})};O(o).then(function(t){e.loading=!1;var a=t.data||{};e.tableData=a.result||[],e.total=t.data.total}).catch(function(t){return e.loading=!1,t})}else this.$message.error("请选择期间");else this.$message.error("请选择分公司")}},{key:"getDepartment",value:function(){var t=this;this.dialogLoading=!0;var e=this.searchForm,a=(e.comType,e.comId),r=(Object(y["a"])(e,["comType","comId"]),{custId:a,deptId:""});T(r).then(function(e){var a=e.data.result||[],r=JSON.parse(JSON.stringify(a).replace(/name/g,"label").replace(/id/g,"value"));t.departmentList=r,t.dialogLoading=!1}).catch(function(e){return t.dialogLoading=!1,e})}},{key:"addDepart",value:function(){var t=this.custType,e=this.custSubtype;"0"!==t&&("2"!==t||"1"!==e)||this.searchForm.comId?this.searchForm.period?(this.dialogShow=!0,this.getDepartment()):this.$message.error("请选择期间"):this.$message.error("请选择分公司")}},{key:"recursionName",value:function(t,e){var a,r=!1,n=function e(n){r||n.map(function(n,i){if(t===n.value)return a=n.label,r=!0;n.children&&n.children.length>0&&e(n.children)})};return n(e),a}},{key:"confirm",value:function(){var t=this;if(this.form.departId){this.dialogLoading=!0;var e=this.searchForm,a=(e.comType,e.comId),r=(e.parentId,Object(y["a"])(e,["comType","comId","parentId"])),n=this.recursionName(this.form.departId,this.departmentList),i=ut({},r,{companyId:a,deptId:this.form.departId,deptName:n}),s=this.fiscalList.find(function(e){return e.id===t.searchForm.period});s&&(i.month=s.fiscalPeriod,i.monthStart=s.startTime+" 00:00:00",i.monthEnd=s.endTime+" 23:59:59"),E(i).then(function(e){t.$message({type:"success",message:"保存成功"}),t.dialogShow=!1,t.dialogLoading=!1,t.queryAll(),t.resetForm()}).catch(function(e){return t.dialogLoading=!1,e})}else this.$message.error("请选择部门")}},{key:"editRow",value:function(t){this.isEdit=!0,this.detailShow=!0;var e=this.$refs.distribut;this.$nextTick(function(){e.setData(t,"depart")})}},{key:"viewRow",value:function(t){this.isEdit=!1,this.detailShow=!0;var e=this.$refs.distribut;this.$nextTick(function(){e.setData(t,"depart")})}},{key:"cancel",value:function(){this.dialogShow=!1,this.resetForm()}},{key:"resetForm",value:function(){this.form={departId:""}}},{key:"handleCurrentChange",value:function(t){this.page=Number(t),this.queryAll()}},{key:"created",value:function(){var t=this.custType,e=this.custSubtype,a=this.custId,r=this.ifCustomer,n=this.parentId;this.firstId="2"===t&&"2"===e&&r?n:"0"!==t?a:"","0"!==t&&"2"===t&&"1"!==e&&(this.searchForm.comId=a)}},{key:"custId",get:function(){var t=v["a"].info||{},e=t.custId;return e}},{key:"deptId",get:function(){var t=v["a"].info||{},e=t.deptId;return e}},{key:"custType",get:function(){var t=v["a"].info||{},e=t.custType;return e}},{key:"custSubtype",get:function(){var t=v["a"].info||{},e=t.custSubtype;return e}},{key:"parentId",get:function(){var t=v["a"].info||{},e=t.parentId;return e}},{key:"ifCustomer",get:function(){var t=v["a"].info||{},e=1===t.ifCustomer;return e}}]),e}(d["e"]);dt=u["a"]([Object(d["a"])({name:"department",components:{distributInfo:X},props:{}})],dt);var mt=dt,pt=mt,ht=(a("c7db"),Object(H["a"])(pt,ot,lt,!1,null,"6e598398",null)),ft=ht.exports,yt=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.detailShow,expression:"!detailShow"}]},[a("el-row",{staticStyle:{"margin-bottom":"10px"}},[a("el-col",{attrs:{span:4}},[a("span",{staticStyle:{"line-height":"32px"}},[t._v("部门销售任务")])]),a("el-col",{staticStyle:{"text-align":"right","padding-right":"10px"},attrs:{span:20}},["0"===t.custType?a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{loading:t.selectLoading,size:"small",placeholder:"所属公司",filterable:"",clearable:""},on:{change:t.onCompany,focus:t.getCompanyList},model:{value:t.searchForm.parentId,callback:function(e){t.$set(t.searchForm,"parentId",e)},expression:"searchForm.parentId"}},t._l(t.companyList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e(),"0"===t.custType||"2"===t.custType&&"1"===t.custSubtype?a("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{disabled:"0"===t.custType&&!t.searchForm.parentId,loading:t.selectLoading,size:"small",placeholder:"分公司",filterable:"",clearable:""},on:{change:t.onUnCompany,focus:t.getUnFinanceCompanyList},model:{value:t.searchForm.comId,callback:function(e){t.$set(t.searchForm,"comId",e)},expression:"searchForm.comId"}},t._l(t.unCompanyList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1):t._e(),a("el-tree-select",{staticStyle:{display:"inline-block",width:"140px","margin-right":"5px"},attrs:{disabled:!t.searchForm.comId,data:t.departmentList,"default-expand-all":!1,clearable:"",filterable:"",size:"small",placeholder:"部门"},model:{value:t.searchForm.departId,callback:function(e){t.$set(t.searchForm,"departId",e)},expression:"searchForm.departId"}}),a("el-date-picker",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{type:"year",placeholder:"年度","value-format":"yyyy",size:"small",clearable:""},on:{change:t.onYear},model:{value:t.searchForm.year,callback:function(e){t.$set(t.searchForm,"year",e)},expression:"searchForm.year"}}),a("el-select",{staticStyle:{width:"130px","margin-right":"10px"},attrs:{loading:t.selectLoading,disabled:!t.searchForm.year,placeholder:"期间",size:"small",clearable:"",filterable:""},on:{focus:t.getFiscalList},model:{value:t.searchForm.period,callback:function(e){t.$set(t.searchForm,"period",e)},expression:"searchForm.period"}},t._l(t.fiscalList,function(t,e){return a("el-option",{key:e,attrs:{label:t.fiscalPeriod,value:t.id}})}),1),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["salesMenSearch"],expression:"['salesMenSearch']"}],attrs:{type:"primary",size:"small"},on:{click:t.handleSearch}},[t._v("\n          查询\n        ")])],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("el-col",{staticStyle:{"line-height":"32px"},attrs:{span:12}},[a("svg-icon",{attrs:{name:"air"}}),t._v("\n              空运任务\n            ")],1),a("el-col",{staticStyle:{"line-height":"29px"},attrs:{span:12}},[a("span",{staticStyle:{"text-align":"right","font-size":"24px","font-weight":"bold"}},[t._v("\n                "+t._s(t.taskObj.airNum||"--")+"\n              ")]),t._v("KG\n            ")])],1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("el-col",{staticStyle:{"line-height":"32px"},attrs:{span:12}},[a("svg-icon",{attrs:{name:"boat"}}),t._v("\n              海运任务\n            ")],1),a("el-col",{staticStyle:{"line-height":"29px"},attrs:{span:12}},[a("span",{staticStyle:{"text-align":"right","font-size":"24px","font-weight":"bold"}},[t._v("\n                "+t._s(t.taskObj.seaNum||"--")+"\n              ")]),t._v("CBM\n            ")])],1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("el-col",{staticStyle:{"line-height":"32px"},attrs:{span:12}},[a("svg-icon",{attrs:{name:"train"}}),t._v("\n              铁路任务\n            ")],1),a("el-col",{staticStyle:{"line-height":"29px"},attrs:{span:12}},[a("span",{staticStyle:{"text-align":"right","font-size":"24px","font-weight":"bold"}},[t._v("\n                "+t._s(t.taskObj.trainNum||"--")+"\n              ")]),t._v("CBM\n            ")])],1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-card",{attrs:{shadow:"hover"}},[a("el-row",[a("el-col",{staticStyle:{"line-height":"32px"},attrs:{span:12}},[a("svg-icon",{attrs:{name:"car"}}),t._v("\n              卡航任务\n            ")],1),a("el-col",{staticStyle:{"line-height":"29px"},attrs:{span:12}},[a("span",{staticStyle:{"text-align":"right","font-size":"24px","font-weight":"bold"}},[t._v("\n                "+t._s(t.taskObj.carNum||"--")+"\n              ")]),t._v("KG\n            ")])],1)],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:t.tableData,height:"calc(100vh - 390px)",border:""}},[a("el-table-column",{attrs:{label:"业务员","min-width":"120",prop:"userName"}}),a("el-table-column",{attrs:{label:"业务类型-任务量","min-width":"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v("空运："+t._s((e.row.airNum||"--")+"KG, "))]),a("span",[t._v("海运："+t._s((e.row.seaNum||"--")+"CBM, "))]),a("span",[t._v("铁路："+t._s((e.row.trainNum||"--")+"CBM, "))]),a("span",[t._v("卡航："+t._s((e.row.carNum||"--")+"KG "))])]}}])}),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(a){return t.editRow(e.row)}}},[t._v("\n            分配\n          ")]),a("el-button",{attrs:{type:"text",size:"medium"},on:{click:function(a){return t.viewRow(e.row)}}},[t._v("\n            查看\n          ")])]}}])})],1)],1),a("distributInfo",{directives:[{name:"show",rawName:"v-show",value:t.detailShow,expression:"detailShow"}],ref:"distribut",attrs:{"is-edit":t.isEdit},on:{close:t.closed}})],1)},vt=[];function gt(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)}return a}function bt(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?gt(a,!0).forEach(function(e){Object(f["a"])(t,e,a[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):gt(a).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))})}return t}var kt=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(o["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.loading=!1,t.detailShow=!1,t.selectLoading=!1,t.isEdit=!1,t.tableData=[],t.companyList=[],t.unCompanyList=[],t.personList=[],t.fiscalList=[],t.departmentList=[],t.companyTypeList=[],t.firstId="",t.searchForm={comType:"1",comId:"",departId:"",parentId:"",year:"",period:""},t.form={departId:""},t.taskObj={airNum:0,seaNum:0,trainNum:0,carNum:0},t.page=1,t.size=10,t.total=0,t}return Object(c["a"])(e,t),Object(s["a"])(e,[{key:"closed",value:function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.detailShow=!1,t.next=3,this.handleSearch();case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"onComType",value:function(){this.tableData=[],this.searchForm.comId="",this.companyList=[]}},{key:"onCompany",value:function(t){this.searchForm.comId="",this.unCompanyList=[],this.tableData=[],this.searchForm.departId="",this.departmentList=[],this.onYear();var e=this.companyList.find(function(e){return e.id===t});e&&(this.firstId=t)}},{key:"onUnCompany",value:function(t){this.tableData=[],this.searchForm.departId="",this.departmentList=[],this.getDepartment()}},{key:"onYear",value:function(){this.searchForm.period=void 0,this.fiscalList=[]}},{key:"getCompanyList",value:function(){var t=this;this.selectLoading=!0;var e={page:1,size:9999,parentId:this.custId};R(e).then(function(e){var a=e.data||{};t.companyList=a.result||[],t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"getUnFinanceCompanyList",value:function(){var t=this,e=this.custType;if(this.selectLoading=!0,"0"===e){var a={custId:this.searchForm.parentId};M(a).then(function(e){var a=e.data||[];t.unCompanyList=a,t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}else P().then(function(e){var a=e.data||[];t.unCompanyList=a,t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"getFiscalList",value:function(){var t=this;this.selectLoading=!0;var e={page:1,size:9999,year:this.searchForm.year,custTag:"1",custId:[this.firstId]};z(e).then(function(e){var a=e.data||{};t.fiscalList=a.result||[],t.selectLoading=!1}).catch(function(e){return t.selectLoading=!1,e})}},{key:"getDepartment",value:function(){var t=this,e=this.searchForm,a=(e.comType,e.comId),r=(Object(y["a"])(e,["comType","comId"]),{custId:a,deptId:""});T(r).then(function(e){var a=e.data.result||[],r=JSON.parse(JSON.stringify(a).replace(/name/g,"label").replace(/id/g,"value"));t.departmentList=r}).catch(function(t){return t})}},{key:"getPersonList",value:function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(){var e,a=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e={deptId:this.searchForm.departId},t.next=3,B(e).then(function(t){var e=t.data||[];a.personList=e}).catch(function(t){return a.loading=!1,t});case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"getDepartTask",value:function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(){var e,a,r,n,i,s=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.searchForm,e.comType,a=e.comId,r=e.departId,e.parentId,n=Object(y["a"])(e,["comType","comId","departId","parentId"]),i={model:bt({companyId:a,deptId:r},n),page:1,size:9999},t.next=4,O(i).then(function(t){var e=(t.data||{}).result||[],a=e.find(function(t){return t.deptId===r})||{};s.taskObj=a}).catch(function(t){return s.loading=!1,t});case 4:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"handleSearch",value:function(){var t=Object(w["a"])(regeneratorRuntime.mark(function t(){var e,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.custType,a=this.custSubtype,"0"!==e&&("2"!==e||"1"!==a)||this.searchForm.comId){t.next=7;break}return this.$message.error("请选择分公司"),t.abrupt("return");case 7:if(this.searchForm.departId){t.next=12;break}return this.$message.error("请选择部门"),t.abrupt("return");case 12:if(this.searchForm.period){t.next=15;break}return this.$message.error("请选择期间"),t.abrupt("return");case 15:return this.loading=!0,t.next=18,this.getDepartTask();case 18:return t.next=20,this.getPersonList();case 20:this.queryAll(1);case 21:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()},{key:"queryAll",value:function(t){var e=this,a=this.custType,r=this.custSubtype;if("0"!==a&&("2"!==a||"1"!==r)||this.searchForm.comId)if(this.searchForm.departId)if(this.searchForm.period){this.loading=!0,t&&(this.page=t);var n=this.searchForm,i=(n.comType,n.comId),s=n.departId,o=(n.parentId,Object(y["a"])(n,["comType","comId","departId","parentId"])),l={page:1,size:9999,model:bt({},o,{companyId:i,deptId:s})};j(l).then(function(t){e.loading=!1;var a=t.data||{},r=a.result||[],n={},i=e.fiscalList.find(function(t){return t.id===e.searchForm.period});i&&(n.month=i.fiscalPeriod,n.monthStart=i.startTime,n.monthEnd=i.endTime);var s=e.personList.map(function(t){return{companyId:e.searchForm.comId,companyName:"",deptId:e.searchForm.departId,deptName:e.searchForm.departName,userId:t.id,userName:t.name,period:e.searchForm.period,year:e.searchForm.year,month:n.month,monthStart:n.monthStart,monthEnd:n.monthEnd,seaNum:0,trainNum:0,airNum:0,carNum:0}});e.tableData=s.map(function(t){var e=r.find(function(e){return e.userId===t.userId});return e&&(t=bt({},e)),t})}).catch(function(t){return e.loading=!1,t})}else this.$message.error("请选择期间");else this.$message.error("请选择部门");else this.$message.error("请选择分公司")}},{key:"editRow",value:function(t){this.isEdit=!0,this.detailShow=!0;var e=this.$refs.distribut;this.$nextTick(function(){e.setData(t,"sales")})}},{key:"viewRow",value:function(t){this.isEdit=!1,this.detailShow=!0;var e=this.$refs.distribut;this.$nextTick(function(){e.setData(t,"sales")})}},{key:"handleCurrentChange",value:function(t){this.page=Number(t),this.queryAll()}},{key:"created",value:function(){var t=this.custType,e=this.custSubtype,a=this.custId,r=this.ifCustomer,n=this.parentId;this.firstId="2"===t&&"2"===e&&r?n:"0"!==t?a:"","0"!==t&&"2"===t&&"1"!==e&&(this.searchForm.comId=this.custId,this.getDepartment())}},{key:"custId",get:function(){var t=v["a"].info||{},e=t.custId;return e}},{key:"deptId",get:function(){var t=v["a"].info||{},e=t.deptId;return e}},{key:"custType",get:function(){var t=v["a"].info||{},e=t.custType;return e}},{key:"custSubtype",get:function(){var t=v["a"].info||{},e=t.custSubtype;return e}},{key:"parentId",get:function(){var t=v["a"].info||{},e=t.parentId;return e}},{key:"ifCustomer",get:function(){var t=v["a"].info||{},e=1===t.ifCustomer;return e}}]),e}(d["e"]);kt=u["a"]([Object(d["a"])({name:"salesman",components:{distributInfo:X},props:{}})],kt);var wt=kt,xt=wt,_t=(a("28956"),Object(H["a"])(xt,yt,vt,!1,null,"3756a2ce",null)),St=_t.exports,It=function(t){function e(){var t;return Object(i["a"])(this,e),t=Object(o["a"])(this,Object(l["a"])(e).apply(this,arguments)),t.activeName="",t}return Object(c["a"])(e,t),Object(s["a"])(e,[{key:"handleClick",value:function(t,e){}},{key:"created",value:function(){this.$checkPermission(["salesCompanyPlan"])?this.activeName="first":this.$checkPermission(["salesDepartPlan"])&&!this.$checkPermission(["salesCompanyPlan"])?this.activeName="second":this.$checkPermission(["salesMenPlan"])&&!this.$checkPermission(["salesCompanyPlan","salesDepartPlan"])&&(this.activeName="third")}},{key:"labelPosition",get:function(){var t=m["a"].language;return t&&"en"===t?"top":"left"}},{key:"lang",get:function(){var t=m["a"].language;return t||"en"}}]),e}(d["e"]);It=u["a"]([Object(d["a"])({name:"",components:{CompanyPlan:st,DepartPlan:ft,PersonPlan:St},props:{}})],It);var Nt=It,Ot=Nt,Lt=Object(H["a"])(Ot,r,n,!1,null,"91d9ca24",null);e["default"]=Lt.exports}}]);