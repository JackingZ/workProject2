(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["notice-manage"],{"0c56":function(e,t,i){"use strict";var n=i("3c3f"),a=i.n(n);a.a},2797:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"roles-container"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[i("div",{staticClass:"app-container"},[i("head-info",{attrs:{title:"通知管理",info:""}}),i("div",{staticClass:"app-panel"},[i("el-table",{ref:"tables",staticStyle:{width:"100%","margin-bottom":"10px"},attrs:{data:e.tableData,"row-key":"id",height:"calc(100vh - 250px)",border:""}},[i("el-table-column",{attrs:{prop:"msgType",label:"通知类型",width:"120"}}),i("el-table-column",{attrs:{prop:"msgSubType",label:"通知项",width:"180","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"",label:""},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-checkbox",{attrs:{disabled:(t.row.juList||[]).length<=0},on:{change:function(i){return e.checkChange(t.row,i,"0")}},model:{value:t.row.isJuCheck,callback:function(i){e.$set(t.row,"isJuCheck",i)},expression:"scope.row.isJuCheck"}},[e._v("\n                聚货通\n              ")]),i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.onSign(t.row,"0")}}},[e._v("\n                服务("+e._s((t.row.juList||[]).length)+")\n              ")]),i("span",{staticStyle:{border:"1px solid #ccc",margin:"0 30px"}}),i("el-checkbox",{attrs:{disabled:(t.row.goList||[]).length<=0},on:{change:function(i){return e.checkChange(t.row,i,"3")}},model:{value:t.row.isGoCheck,callback:function(i){e.$set(t.row,"isGoCheck",i)},expression:"scope.row.isGoCheck"}},[e._v("\n                供应商\n              ")]),i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.onSign(t.row,"3")}}},[e._v("\n                服务("+e._s((t.row.goList||[]).length)+")\n              ")]),i("span",{staticStyle:{border:"1px solid #ccc",margin:"0 30px"}}),i("el-checkbox",{attrs:{disabled:(t.row.daiList||[]).length<=0},on:{change:function(i){return e.checkChange(t.row,i,"2")}},model:{value:t.row.isDaiCheck,callback:function(i){e.$set(t.row,"isDaiCheck",i)},expression:"scope.row.isDaiCheck"}},[e._v("\n                代理商\n              ")]),i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.onSign(t.row,"2")}}},[e._v("\n                服务("+e._s((t.row.daiList||[]).length)+")\n              ")]),i("span",{staticStyle:{border:"1px solid #ccc",margin:"0 30px"}}),i("el-checkbox",{attrs:{disabled:(t.row.keList||[]).length<=0},on:{change:function(i){return e.checkChange(t.row,i,"1")}},model:{value:t.row.isKeCheck,callback:function(i){e.$set(t.row,"isKeCheck",i)},expression:"scope.row.isKeCheck"}},[e._v("\n                客户\n              ")]),i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.onSign(t.row,"1")}}},[e._v("\n                服务("+e._s((t.row.keList||[]).length)+")\n              ")])]}}])}),i("el-table-column",{attrs:{prop:"",label:"通知模版",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.editRow(t.row)}}},[e._v("\n                通知模版\n              ")])]}}])})],1),i("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"600px","close-on-click-modal":!1},on:{close:e.cancel}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogloading,expression:"dialogloading"}]},[i("el-form",{ref:"selectForm",attrs:{model:e.selectForm,rules:e.formRules,"label-width":"110px","label-position":"right"}},[i("el-form-item",{attrs:{label:"模板标题",prop:"templateTitle"}},[i("el-input",{attrs:{placeholder:"请输入",maxlength:20},model:{value:e.selectForm.templateTitle,callback:function(t){e.$set(e.selectForm,"templateTitle",t)},expression:"selectForm.templateTitle"}})],1),i("el-form-item",{attrs:{label:"模板内容",prop:"templateContent"}},[i("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入"},model:{value:e.selectForm.templateContent,callback:function(t){e.$set(e.selectForm,"templateContent",t)},expression:"selectForm.templateContent"}})],1)],1),i("div",{staticStyle:{"text-align":"right",padding:"10px 20px 0"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("\n                取 消\n              ")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.saveTemplate}},[e._v("\n                确 定\n              ")])],1)],1)]),i("el-dialog",{attrs:{title:"关联服务【"+e.title+"】",visible:e.dialogService,"close-on-click-modal":!1,width:"960px"},on:{"update:visible":function(t){e.dialogService=t},close:e.close}},[i("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogloading,expression:"dialogloading"}],ref:"transferItem",staticStyle:{height:"500px"},attrs:{filterable:"","filter-method":e.filterMethod,titles:["服务","已选择"],props:{key:"id",label:"name"},"filter-placeholder":"输入搜索",data:e.serviceList},model:{value:e.serviceOption,callback:function(t){e.serviceOption=t},expression:"serviceOption"}}),i("div",{staticStyle:{"text-align":"right",margin:"0 40px 0"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:e.close}},[e._v("\n              取 消\n            ")]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.saveService}},[e._v("\n              确 定\n            ")])],1)],1)],1)],1)])])},a=[],o=(i("8e6e"),i("ac6a"),i("456d"),i("7514"),i("7f7f"),i("bd86")),s=i("a8db"),l=i("d225"),r=i("b0b4"),c=i("308d"),u=i("6bb5"),d=i("4e2b"),p=i("9ab4"),h=i("60a3"),g=i("17e1");function v(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}function m(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?v(i,!0).forEach(function(t){Object(o["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):v(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var f=function(e){function t(){var e;return Object(l["a"])(this,t),e=Object(c["a"])(this,Object(u["a"])(t).apply(this,arguments)),e.tableData=[],e.serviceList=[],e.serviceOption=[],e.selectForm={templateTitle:"",templateContent:""},e.formRules={templateTitle:[{required:!0,message:"模板标题不能为空",trigger:"blur"}],templateContent:[{required:!0,message:"模板内容不能为空",trigger:"blur"}]},e.checkObj={},e.isType="",e.loading=!1,e.dialogloading=!1,e.dialogVisible=!1,e.dialogService=!1,e.title="",e}return Object(d["a"])(t,e),Object(r["a"])(t,[{key:"created",value:function(){this.queryAll()}},{key:"queryAll",value:function(){var e=this;this.loading=!0,Object(g["e"])({page:1,size:999}).then(function(t){var i=t.data||{},n=i.result||[];e.tableData=n.map(function(e){var t=e.isJuCheck,i=e.isGoCheck,n=e.isDaiCheck,a=e.isKeCheck,o=Object(s["a"])(e,["isJuCheck","isGoCheck","isDaiCheck","isKeCheck"]);return m({},o,{isJuCheck:1===t,isGoCheck:1===i,isDaiCheck:1===n,isKeCheck:1===a})}),e.loading=!1}).catch(function(t){return e.loading=!1,t})}},{key:"editRow",value:function(e){var t=e.templateTitle,i=e.templateContent,n=e.subTypeId,a=e.msgType,o=e.msgSubType;this.title=a+"-"+o,this.selectForm={templateTitle:t,templateContent:i,unqId:n},this.dialogVisible=!0}},{key:"filterMethod",value:function(e,t){var i=t.name||"";return i.indexOf(e)>-1}},{key:"onSign",value:function(e,t){var i=e.juList,n=e.goList,a=e.daiList,o=e.keList;"0"===t?(this.title="聚货通",this.serviceOption=i.map(function(e){return e.serviceId})):"1"===t?(this.title="客户",this.serviceOption=o.map(function(e){return e.serviceId})):"2"===t?(this.title="代理商",this.serviceOption=a.map(function(e){return e.serviceId})):"3"===t&&(this.title="供应商",this.serviceOption=n.map(function(e){return e.serviceId})),this.checkObj=e,this.isType=t,this.dialogService=!0,this.getServiceTypeData()}},{key:"getServiceTypeData",value:function(){var e=this;this.dialogloading=!0,Object(g["j"])({custType:this.isType}).then(function(t){e.serviceList=t.data||[],e.dialogloading=!1}).catch(function(t){return e.dialogloading=!1,t})}},{key:"close",value:function(){this.serviceOption=[],this.dialogService=!1,this.title="",this.checkObj={},this.isType=""}},{key:"saveService",value:function(){var e=this,t=this.serviceOption.map(function(t){var i=e.serviceList.find(function(e){return t===e.id})||{};return{serviceId:i.id,serviceName:i.name}}).filter(function(e){return e.serviceId&&e.serviceName});this.dialogloading=!0,this.updateService(this.checkObj,this.isType,t)}},{key:"checkChange",value:function(e,t,i){this.loading=!0,this.updateService(e,i)}},{key:"updateService",value:function(e,t,i){var n=this,a=e.isJuCheck,o=e.isGoCheck,s=e.isDaiCheck,l=e.isKeCheck,r=e.juList,c=e.goList,u=e.daiList,d=e.keList,p=e.subTypeId,h=e.id,v={};"0"===t?v={customerType:t,isCheck:a?1:0,serviceList:i||r,unqId:p,id:h}:"1"===t?v={customerType:t,isCheck:l?1:0,serviceList:i||d,unqId:p,id:h}:"2"===t?v={customerType:t,isCheck:s?1:0,serviceList:i||u,unqId:p,id:h}:"3"===t&&(v={customerType:t,isCheck:o?1:0,serviceList:i||c,unqId:p,id:h}),Object(g["p"])(v).then(function(e){n.$message({type:"success",message:"保存成功"}),n.dialogloading=!1,n.loading=!1,n.close(),n.queryAll()}).catch(function(e){return n.dialogloading=!1,n.loading=!1,e})}},{key:"cancel",value:function(){this.selectForm={templateTitle:"",templateContent:""},this.title="",this.dialogVisible=!1;var e=this.$refs.selectForm;this.$nextTick(function(){e.clearValidate()})}},{key:"saveTemplate",value:function(){var e=this,t=this.$refs.selectForm;t.validate(function(t){if(!t)return!1;e.dialogloading=!0,Object(g["r"])(e.selectForm).then(function(t){e.$message({type:"success",message:"保存成功"}),e.dialogloading=!1,e.cancel(),e.queryAll()}).catch(function(t){return e.dialogloading=!1,t})})}}]),t}(h["e"]);f=p["a"]([Object(h["a"])({name:"",components:{},props:{}})],f);var b=f,k=b,y=(i("0c56"),i("2877")),w=Object(y["a"])(k,n,a,!1,null,"0be7e7ea",null);t["default"]=w.exports},"3c3f":function(e,t,i){}}]);