(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["operating-cost-projects"],{"30b76":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","min-height":"inherit"}},[i("div",{staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[i("div",{staticClass:"app-container"},[i("head-info",{attrs:{info:"",title:"成本项目"}}),i("div",{staticClass:"app-panel"},[i("div",[i("el-row",[i("el-col",{staticStyle:{"text-align":"right"},attrs:{span:24}},[i("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{placeholder:"服务类型",clearable:"",filterable:"",size:"small"},on:{change:function(t){return e.onReset("SELECT_TYPE")}},model:{value:e.selectValue.serviceTypeId,callback:function(t){e.$set(e.selectValue,"serviceTypeId",t)},expression:"selectValue.serviceTypeId"}},e._l(e.serviceTypeList,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),i("el-select",{staticStyle:{width:"130px","margin-right":"5px"},attrs:{placeholder:"项目类型",disabled:!e.selectValue.serviceTypeId,clearable:"",filterable:"",size:"small"},model:{value:e.selectValue.typeId,callback:function(t){e.$set(e.selectValue,"typeId",t)},expression:"selectValue.typeId"}},e._l(e.costitemTypeList,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),i("el-input",{staticStyle:{width:"180px","margin-right":"10px"},attrs:{size:"small",clearable:"",placeholder:"请输入成本项目关键字"},model:{value:e.selectValue.name,callback:function(t){e.$set(e.selectValue,"name",t)},expression:"selectValue.name"}}),i("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["qquery"],expression:"['qquery']"}],attrs:{type:"primary",size:"small"},on:{click:function(t){return e.queryAll(1)}}},[e._v("\n                查询\n              ")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.tableData,height:"calc(100vh - 313px)",border:""}},[i("el-table-column",{attrs:{label:"项目中文名称",prop:"name"}}),i("el-table-column",{attrs:{label:"项目英文名称",prop:"alias"}}),i("el-table-column",{attrs:{label:"服务类型",width:"120",prop:"serviceTypeName"}}),i("el-table-column",{attrs:{label:"项目类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s((t.row.types||[]).map(function(e){return e.typeName}).join(",")||"--")+"\n              ")]}}])}),i("el-table-column",{attrs:{label:"结算单位",width:"120",prop:"settlement"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s((e.settlementList.find(function(e){return e.id===t.row.settlement})||{}).name||"--")+"\n              ")]}}])}),i("el-table-column",{attrs:{label:"发票描述",prop:"invoice"}}),i("el-table-column",{attrs:{label:"备注",prop:"remark"}})],1),i("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":e.page,"page-size":e.size,layout:"total, prev, pager, next",total:e.total},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),i("el-dialog",{attrs:{title:e.isEdit?"编辑成本项目":"新增成本项目",visible:e.isAddEditVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.isAddEditVisible=t},closed:e.close}},[i("div",[i("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],ref:"editForm",staticStyle:{"padding-right":"20px"},attrs:{model:e.selectForm,rules:e.formRules,size:"small","label-width":"130px","label-position":"right"}},[i("el-form-item",{attrs:{label:"项目中文名称",prop:"name"}},[i("el-input",{ref:"firstInput",attrs:{maxlength:20,placeholder:"请输入"},model:{value:e.selectForm.name,callback:function(t){e.$set(e.selectForm,"name",t)},expression:"selectForm.name"}})],1),i("el-form-item",{attrs:{label:"项目英文名称",prop:"alias"}},[i("el-input",{attrs:{maxlength:50,placeholder:"请输入"},model:{value:e.selectForm.alias,callback:function(t){e.$set(e.selectForm,"alias",t)},expression:"selectForm.alias"}})],1),i("el-form-item",{attrs:{label:"服务类型",prop:"serviceTypeId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",filterable:"",placeholder:"请选择"},on:{change:function(t){return e.onReset("FORM_TYPE")}},model:{value:e.selectForm.serviceTypeId,callback:function(t){e.$set(e.selectForm,"serviceTypeId",t)},expression:"selectForm.serviceTypeId"}},e._l(e.serviceTypeList,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),i("el-form-item",{attrs:{label:"项目类型",prop:"typeList"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",multiple:"",disabled:!e.selectForm.serviceTypeId,placeholder:"请选择"},model:{value:e.selectForm.typeList,callback:function(t){e.$set(e.selectForm,"typeList",t)},expression:"selectForm.typeList"}},e._l(e.costitemTypeList,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),i("el-form-item",{attrs:{label:"结算单位",prop:"settlement"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",filterable:"",placeholder:"请选择"},model:{value:e.selectForm.settlement,callback:function(t){e.$set(e.selectForm,"settlement",t)},expression:"selectForm.settlement"}},e._l(e.settlementList,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),i("el-form-item",{attrs:{label:"发票描述",prop:"invoice"}},[i("el-input",{attrs:{maxlength:100,placeholder:"请输入"},model:{value:e.selectForm.invoice,callback:function(t){e.$set(e.selectForm,"invoice",t)},expression:"selectForm.invoice"}})],1),i("el-form-item",{attrs:{label:"备注"}},[i("el-input",{attrs:{maxlength:100,placeholder:"请输入"},model:{value:e.selectForm.remark,callback:function(t){e.$set(e.selectForm,"remark",t)},expression:"selectForm.remark"}})],1),"04"===e.selectForm.serviceTypeId?i("el-form-item",{attrs:{label:"是否按区间计费",prop:"ranging"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择"},model:{value:e.selectForm.ranging,callback:function(t){e.$set(e.selectForm,"ranging",t)},expression:"selectForm.ranging"}},[i("el-option",{attrs:{label:"是",value:!0}}),i("el-option",{attrs:{label:"否",value:!1}})],1)],1):e._e()],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.close}},[e._v("\n                取 消\n              ")]),i("el-button",{attrs:{type:"primary"},on:{click:e.saveConfirm}},[e._v("\n                确 定\n              ")])],1)])],1)])],1)])])},r=[],n=(i("8e6e"),i("456d"),i("c5f6"),i("ac6a"),i("5df3"),i("7f7f"),i("7514"),i("96cf"),i("3b8d")),l=i("bd86"),s=i("d225"),o=i("b0b4"),c=i("308d"),u=i("6bb5"),d=i("4e2b"),m=i("9ab4"),p=i("60a3"),v=i("9dba"),f=i("b32d");function g(e){var t={url:"/finance/costitem/getCostitemList",method:"get",params:e};return Object(f["a"])(t)}function h(e){var t={url:"/finance/costitem/saveCostitem",method:"post",data:e};return Object(f["a"])(t)}function y(e){var t={url:"/finance/costitem/deleteCostitem",method:"delete",params:e};return Object(f["a"])(t)}function b(e){var t={url:"/cfg/type/getServiceTypeConfigList",method:"get",params:e};return Object(f["a"])(t)}function k(e){var t={url:"/cfg/type/getServiceSubtypeConfigList",method:"get",params:e};return Object(f["a"])(t)}function T(e){var t={url:"/finance/costitem/getUmBySettlement",method:"get",params:e};return Object(f["a"])(t)}function w(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,a)}return i}function F(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?w(i,!0).forEach(function(t){Object(l["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var L=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(c["a"])(this,Object(u["a"])(t).apply(this,arguments)),e.loading=!1,e.dialogShow=!1,e.dialogLoading=!1,e.isEdit=!1,e.isAddEditVisible=!1,e.tableData=[],e.serviceTypeList=[],e.costitemTypeList=[],e.umBySettlement=[],e.settlementList=[{id:"0",name:"按重量"},{id:"1",name:"按体积"},{id:"2",name:"按金额"},{id:"3",name:"按票"},{id:"4",name:"按箱"},{id:"5",name:"按车"},{id:"6",name:"按柜"},{id:"7",name:"按里程"},{id:"8",name:"按时间"},{id:"9",name:"按托"},{id:"A",name:"按个数"}],e.selectValue={serviceTypeId:void 0,typeId:void 0,name:void 0},e.selectForm={name:void 0,alias:void 0,serviceTypeId:void 0,serviceTypeName:void 0,typeList:[],settlement:void 0,umId:void 0,umName:void 0,invoice:void 0,remark:void 0,ranging:void 0},e.formRules={name:[{required:!0,message:"项目中文名称不能为空",trigger:"blur"},{min:2,max:30,message:"长度在 2 到 30 个字符",trigger:"blur"}],alias:[{required:!0,message:"项目英文名称不能为空",trigger:"blur"},{validator:function(e,t,i){var a=/[\u4e00-\u9fa5]/;t?a.test(t)?i(new Error("英文名称不能有中文")):i():i(new Error("英文名称不能为空"))},trigger:"blur"}],serviceTypeId:[{required:!0,message:"请选择服务类型",trigger:"change"}],typeList:[{required:!0,message:"请选择项目类型",trigger:"change"}],settlement:[{required:!0,message:"请选择结算单位",trigger:"change"}],umId:[{required:!0,message:"请选择计量单位",trigger:"change"}],invoice:[{required:!0,message:"发票描述不能为空",trigger:"blur"}],ranging:[{required:!0,message:"请选择是否按区间计费",trigger:"change"}]},e.currentId="",e.page=1,e.size=10,e.total=0,e}return Object(d["a"])(t,e),Object(o["a"])(t,[{key:"queryAll",value:function(e){var t=this;this.loading=!0,e&&(this.page=e);var i=F({page:this.page,size:this.size},this.selectValue);g(i).then(function(e){var i=e.data||{};t.tableData=i.result||[],t.total=i.total,t.loading=!1}).catch(function(e){return t.loading=!1,e})}},{key:"getServiceTypeList",value:function(){var e=this,t={page:1,size:9999};b(t).then(function(t){var i=t.data||{};e.serviceTypeList=i.result||[]}).catch(function(e){return e})}},{key:"getCostitemTypeList",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var i,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i={typeId:t,page:1,size:9999},e.next=3,k(i).then(function(e){a.costitemTypeList=e.data||[]}).catch(function(e){return e});case 3:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"getUmBySettlement",value:function(){var e=Object(n["a"])(regeneratorRuntime.mark(function e(t){var i,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i={settlement:t},e.next=3,T(i).then(function(e){a.umBySettlement=e.data||[]}).catch(function(e){return e});case 3:case"end":return e.stop()}},e)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"onReset",value:function(e){switch(e){case"FORM_TYPE":this.selectForm.typeList=[],this.costitemTypeList=[],this.selectForm.ranging="";var t=this.selectForm.serviceTypeId;t&&(this.selectForm.serviceTypeName=this.findByKeyValueReturnAnotherKeyValue(this.serviceTypeList,"id",t,"name"),this.getCostitemTypeList(t).catch(function(e){return e}));break;case"SELECT_TYPE":this.selectValue.typeId="",this.costitemTypeList=[];var i=this.selectValue.serviceTypeId;i&&this.getCostitemTypeList(i).catch(function(e){return e});break;case"FORM_UM":this.selectForm.umId="",this.umBySettlement=[];var a=this.selectForm.settlement;a&&this.getUmBySettlement(a).catch(function(e){return e});break;default:break}}},{key:"findByKeyValueReturnAnotherKeyValue",value:function(e,t,i,a){return(e.find(function(e){return e[t]===i})||{})[a]}},{key:"saveCostitemData",value:function(){var e=this;this.isEdit=!1,this.isAddEditVisible=!0,this.$nextTick(function(){var t=e.$refs.firstInput;t.focus()})}},{key:"toEditForm",value:function(e){var t=this;this.currentId=e.id;var i=e.name,a=e.alias,r=e.serviceTypeId,n=e.serviceTypeName,l=e.types,s=e.umId,o=e.umName,c=e.invoice,u=e.remark,d=e.settlement,m=e.ranging,p=l.map(function(e){return e.typeId}).filter(function(e){return!!e})||[];this.selectForm={name:i,alias:a,serviceTypeId:r,serviceTypeName:n,typeList:p,umId:s,umName:o,invoice:c,remark:u,settlement:d,ranging:m},this.dialogLoading=!0,Promise.all([this.getCostitemTypeList(this.selectForm.serviceTypeId)]).then(function(){t.dialogLoading=!1}).catch(function(){t.dialogLoading=!1}),this.isEdit=!0,this.isAddEditVisible=!0}},{key:"deleteData",value:function(e){var t=this,i={id:e.id};this.$confirm("请确认是否删除该条数据?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){y(i).then(function(e){t.$message({type:"success",message:"删除成功"}),t.queryAll()}).catch(function(e){return e})}).catch(function(){return!1})}},{key:"saveConfirm",value:function(){var e=this;this.$refs.editForm.validate(function(t){if(!t)return!1;e.dialogLoading=!0;var i=e.selectForm.typeList,a=i.map(function(t){var i=e.costitemTypeList,a=void 0===i?[]:i;return{typeId:t,typeName:a.find(function(e){return e.id===t}).name||""}}),r=F({},e.selectForm,{},{types:a});delete r.typeList,e.isEdit&&(r.id=e.currentId),h(r).then(function(t){e.close(),e.$message({type:"success",message:"操作成功"}),e.queryAll(),e.dialogLoading=!1}).catch(function(t){return e.dialogLoading=!1,t})})}},{key:"close",value:function(){this.isAddEditVisible=!1,this.isEdit=!1,this.currentId="",this.reset()}},{key:"reset",value:function(){this.selectForm={name:void 0,alias:void 0,serviceTypeId:void 0,serviceTypeName:void 0,typeList:[],settlement:void 0,umId:void 0,umName:void 0,invoice:void 0,remark:void 0,ranging:void 0},this.clearValidate()}},{key:"clearValidate",value:function(){var e=this.$refs.editForm;this.$nextTick(function(){e.clearValidate()})}},{key:"handleSizeChange",value:function(e){this.size=Number(e),this.queryAll()}},{key:"handleCurrentChange",value:function(e){this.page=Number(e),this.queryAll()}},{key:"created",value:function(){this.getServiceTypeList(),this.queryAll()}},{key:"custId",get:function(){var e=v["a"].info||{},t=e.custId;return t}},{key:"custName",get:function(){var e=v["a"].info||{},t=e.custName;return t}}]),t}(p["e"]);L=m["a"]([Object(p["a"])({name:"ProjectsCost",components:{},props:{}})],L);var x=L,I=x,O=i("2877"),S=Object(O["a"])(I,a,r,!1,null,"43ddfe42",null);t["default"]=S.exports}}]);