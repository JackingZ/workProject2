(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["report-definition"],{2437:function(e,t,a){},3060:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","min-height":"inherit"}},[a("div",{staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[a("div",{staticClass:"app-container"},[a("head-info",{attrs:{info:"",title:"报表定义"}}),a("div",{staticClass:"app-panel"},[a("el-row",[a("el-col",{attrs:{span:4}},[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["reportsAdd"],expression:"['reportsAdd']"}],staticStyle:{"margin-left":"10px"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:e.addForm}},[e._v("\n              新增报表\n            ")])],1),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:20}},[a("el-input",{staticClass:"input-with-select",staticStyle:{width:"280px","margin-right":"10px"},attrs:{size:"small",placeholder:"请输入"},model:{value:e.selectValue.name,callback:function(t){e.$set(e.selectValue,"name",t)},expression:"selectValue.name"}},[a("template",{slot:"prepend"},[e._v("\n                报表名称\n              ")])],2),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["reportsQuery"],expression:"['reportsQuery']"}],attrs:{type:"primary",size:"small"},on:{click:function(t){return e.queryAll(1)}}},[e._v("\n              查询\n            ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.tableData,height:"calc(100vh - 313px)",border:""}},[a("el-table-column",{attrs:{prop:"name",width:"230",label:"报表名称"}}),a("el-table-column",{attrs:{prop:"tag",width:"150",label:"报表标识"}}),a("el-table-column",{attrs:{prop:"ip","min-width":"120",label:"报表地址"}}),a("el-table-column",{attrs:{prop:"createTime",label:"添加时间",width:"180"}}),a("el-table-column",{attrs:{fixed:"right",width:"160",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["reportsUpdate"],expression:"['reportsUpdate']"}],attrs:{type:"text"},on:{click:function(a){return e.editForm(t.row)}}},[e._v("\n                编辑\n              ")])]}}])})],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":e.page,"page-size":e.size,layout:"total, prev, pager, next",total:e.total},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),a("el-dialog",{attrs:{title:e.title,visible:e.isItemDialogShow,"close-on-click-modal":!1,width:"960px"},on:{"update:visible":function(t){e.isItemDialogShow=t},close:e.closeAgent}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.agentLoading,expression:"agentLoading"}]},[a("el-transfer",{ref:"transferItem",staticStyle:{height:"500px"},attrs:{filterable:"","filter-method":e.filterMethod,titles:["选择关联代理商","已关联代理商"],props:{key:"id",label:"name"},"filter-placeholder":"输入搜索",data:e.agentList},model:{value:e.agentForm.selectAgents,callback:function(t){e.$set(e.agentForm,"selectAgents",t)},expression:"agentForm.selectAgents"}})],1),a("div",{staticStyle:{"text-align":"right",margin:"0 40px 0"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:e.closeAgent}},[e._v("\n            取 消\n          ")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.setAgentConfirm}},[e._v("\n            确 定\n          ")])],1)]),a("el-dialog",{attrs:{title:e.editTitle,visible:e.isEditFormShow,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.isEditFormShow=t},closed:e.closeForm}},[a("add-edit-form",{ref:"editForm",attrs:{"select-form":e.selectForm,loading:e.isEditFormLoading,"format-list":e.formatList,"page-list":e.pageList},on:{saveConfirm:e.saveConfirm,closeForm:e.closeForm}}),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeForm}},[e._v("\n            取 消\n          ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveConfirm}},[e._v("\n            确 定\n          ")])],1)],1)],1)])])},n=[],i=(a("8e6e"),a("ac6a"),a("456d"),a("c5f6"),a("768b")),o=(a("96cf"),a("3b8d")),s=(a("7514"),a("bd86")),l=(a("7f7f"),a("d225")),c=a("b0b4"),u=a("308d"),d=a("6bb5"),m=a("4e2b"),g=a("9ab4"),p=a("60a3"),f=a("9dba"),h=a("ac1a"),v=a("b32d");function b(e){var t={url:"/report/r/page",method:"post",data:e};return Object(v["a"])(t)}function y(e){var t={url:"/report/r/up",method:"post",data:e};return Object(v["a"])(t)}function w(e){var t={url:"/report/r/del",method:"delete",params:e};return Object(v["a"])(t)}function F(e){var t={url:"/report/r/on",method:"get",params:e};return Object(v["a"])(t)}function x(e){var t={url:"/report/r/un",method:"post",data:e};return Object(v["a"])(t)}function k(e){var t={url:"/auth/agent/getAgentList",method:"get",params:e};return Object(v["a"])(t)}function O(e){var t={url:"/report/r/agent",method:"get",params:e};return Object(v["a"])(t)}var j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"content"},[a("el-form",{ref:"selectForm",staticStyle:{"padding-right":"20px"},attrs:{model:e.selectForm,rules:e.formRules,"label-width":"110px",size:"small"}},[a("el-form-item",{attrs:{label:"报表名称",prop:"name"}},[a("el-input",{ref:"firstInput",attrs:{maxlength:10,placeholder:"请输入",size:"small","show-word-limit":""},model:{value:e.selectForm.name,callback:function(t){e.$set(e.selectForm,"name",t)},expression:"selectForm.name"}})],1),a("el-form-item",{attrs:{label:"报表标识",prop:"tag"}},[a("el-input",{attrs:{maxlength:10,placeholder:"请输入",size:"small","show-word-limit":""},model:{value:e.selectForm.tag,callback:function(t){e.$set(e.selectForm,"tag",t)},expression:"selectForm.tag"}})],1),a("el-form-item",{attrs:{label:"报表ip地址",prop:"ip"}},[a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入",size:"small",maxlength:200,"show-word-limit":""},model:{value:e.selectForm.ip,callback:function(t){e.$set(e.selectForm,"ip",t)},expression:"selectForm.ip"}})],1)],1)],1)},S=[],L=function(e){function t(){var e;return Object(l["a"])(this,t),e=Object(u["a"])(this,Object(d["a"])(t).apply(this,arguments)),e.formRules={name:[{required:!0,message:"报表名称不能为空",trigger:"blur"}],serialNo:[{required:!0,message:"序号不能为空",trigger:"blur"}],ip:[{required:!0,message:"报表ip地址不能为空",trigger:"blur"}],category:[{required:!0,message:"报表类型不能为空",trigger:"blur"}],format:[{required:!0,message:"请选择报表格式",trigger:"change"}],fileName:[{required:!0,message:"报表文件名不能为空",trigger:"blur"}],ifNeedParam:[{required:!0,message:"请选择是否需要参数",trigger:"change"}],tag:[{required:!0,message:"请输入报表标识",trigger:"change"}]},e}return Object(m["a"])(t,e),Object(c["a"])(t,[{key:"formatData",get:function(){return this.formatList||[]}}]),t}(p["e"]);L=g["a"]([Object(p["a"])({name:"addEditForm",components:{},props:{formatList:{type:Array,default:function(){return[]}},selectForm:{type:Object,default:function(){return{}}},loading:{type:Boolean,default:!1}}})],L);var A=L,I=A,$=(a("576a"),a("2877")),C=Object($["a"])(I,j,S,!1,null,"307511a3",null),E=C.exports;function z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function q(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?z(a,!0).forEach(function(t){Object(s["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):z(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function N(){return{name:void 0,serialNo:void 0,ip:void 0,category:void 0,report:void 0,format:void 0,fileName:void 0,ifNeedParam:!1,tag:void 0,id:void 0}}var D=function(e){function t(){var e;return Object(l["a"])(this,t),e=Object(u["a"])(this,Object(d["a"])(t).apply(this,arguments)),e.loading=!1,e.isEdit=!1,e.editTitle="",e.isEditFormShow=!1,e.isEditFormLoading=!1,e.tableData=[],e.currentId="",e.currentServiceId="",e.title="关联代理商",e.agentForm={selectAgents:[]},e.selectValue={name:void 0},e.selectForm=N(),e.pageList=[{name:"aaa",id:"0"},{name:"bbb",id:"1"},{name:"ccc",id:"2"}],e.selectLoading=!1,e.agentList=[],e.formatList=[{name:"rpx",id:0},{name:"rpm",id:1},{name:"rpr",id:2},{name:"xls",id:3},{name:"xlsx",id:4}],e.agentLoading=!1,e.isItemDialogShow=!1,e.props={label:"name",value:"id"},e.page=1,e.size=10,e.total=0,e}return Object(m["a"])(t,e),Object(c["a"])(t,[{key:"formatValue",value:function(e){var t="";return this.formatList.map(function(a){a.id===e.format&&(t=a.name)}),t}},{key:"deletData",value:function(e){var t=this,a={id:e.id};this.$confirm("请确认是否删除该条数据?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){w(a).then(function(e){t.$message({type:"success",message:"删除成功"}),t.queryAll()}).catch(function(e){return e})}).catch(function(){return!1})}},{key:"addForm",value:function(){var e=this;this.isEdit=!1,this.editTitle="新增报表",this.isEditFormShow=!0,this.$nextTick(function(){var t=e.$refs.editForm,a=t.$refs.firstInput;a.focus()})}},{key:"editForm",value:function(e){this.currentId=e.id,this.selectForm=q({},e),this.isEdit=!0,this.editTitle="编辑报表",this.isEditFormShow=!0}},{key:"resetForm",value:function(){this.selectForm=N();var e=this.$refs.editForm,t=e.$refs.selectForm;this.$nextTick(function(){t.clearValidate()})}},{key:"closeForm",value:function(){this.isEditFormShow=!1,this.resetForm()}},{key:"saveConfirm",value:function(){var e=this,t=this.$refs.editForm,a=t.$refs.selectForm;a.validate(function(t){if(!t)return!1;e.isEditFormLoading=!0;var a={id:e.selectForm.id,ip:e.selectForm.ip,tag:e.selectForm.tag,name:e.selectForm.name};y(a).then(function(t){e.$message({type:"success",message:"保存成功"}),e.isEditFormLoading=!1,e.closeForm(),e.queryAll()}).catch(function(t){return e.isEditFormLoading=!1,t})})}},{key:"getAgentList",value:function(){var e=this,t={page:1,size:9999,parentId:this.custId};k(t).then(function(t){var a=t.data||{},r=a.result||[];e.agentList=r.filter(function(e){return"1"===e.status})}).catch(function(e){return e})}},{key:"filterMethod",value:function(e,t){var a=t.name||"";return a.indexOf(e)>-1}},{key:"closeAgent",value:function(){this.isItemDialogShow=!1;var e=this.$refs.transferItem;e.clearQuery("left"),e.clearQuery("right")}},{key:"setAgentConfirm",value:function(){var e=this;this.agentLoading=!0;var t=this.agentForm.selectAgents.map(function(t){var a=e.agentList.find(function(e){return e.id===t})||{},r=a.name;return{agentId:t,name:r}}),a={list:[],reportId:this.currentServiceId};a.list=t.filter(function(e){return e.name&&e.agentId}),x(a).then(function(t){e.$message({type:"success",message:"保存成功"}),e.closeAgent(),e.agentLoading=!1,e.queryAll()}).catch(function(t){return e.agentLoading=!1,t})}},{key:"associatedAgent",value:function(e){var t=this;this.title="关联代理商【"+e.name+"】",this.isItemDialogShow=!0,this.currentServiceId=e.id,this.agentLoading=!0;var a={reportId:e.id};O(a).then(function(e){t.agentLoading=!1;var a=e.data||[];t.agentForm.selectAgents=a}).catch(function(e){return t.agentLoading=!1,e})}},{key:"onStatus",value:function(){var e=Object(o["a"])(regeneratorRuntime.mark(function e(t,a){var r,n,o,s,l=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t.status&&t.status!==a){e.next=2;break}return e.abrupt("return");case 2:return r=a?"开启":"禁用",e.next=5,this.$confirm("此操作将".concat(r,"该报表，是否继续？"),"提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(e){return[null,e]}).catch(function(e){return[e,null]});case 5:if(n=e.sent,o=Object(i["a"])(n,2),s=o[0],o[1],!s){e.next=11;break}return e.abrupt("return");case 11:F({id:t.id}).then(function(e){l.$message.success("修改成功"),l.queryAll()}).catch(function(e){return e});case 12:case"end":return e.stop()}},e,this)}));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"handleSizeChange",value:function(e){this.size=Number(e),this.queryAll()}},{key:"handleCurrentChange",value:function(e){this.page=Number(e),this.queryAll()}},{key:"queryAll",value:function(e){var t=this;this.loading=!0,e&&(this.page=e);var a=q({},this.selectValue,{page:this.page,size:this.size});b(a).then(function(e){t.loading=!1;var a=e.data||{};t.tableData=a.result||[],t.total=e.data.total}).catch(function(e){return t.loading=!1,e})}},{key:"created",value:function(){this.queryAll(),this.getAgentList()}},{key:"labelPosition",get:function(){var e=h["a"].language;return e&&"en"===e?"top":"left"}},{key:"lang",get:function(){var e=h["a"].language;return e||"en"}},{key:"custId",get:function(){var e=f["a"].info||{},t=e.custId;return t}},{key:"custName",get:function(){var e=f["a"].info||{},t=e.custName;return t}}]),t}(p["e"]);D=g["a"]([Object(p["a"])({name:"Port",components:{addEditForm:E},props:{}})],D);var P=D,_=P,T=(a("4acd"),Object($["a"])(_,r,n,!1,null,"649a0699",null));t["default"]=T.exports},"4acd":function(e,t,a){"use strict";var r=a("2437"),n=a.n(r);n.a},"576a":function(e,t,a){"use strict";var r=a("e7f0"),n=a.n(r);n.a},e7f0:function(e,t,a){}}]);