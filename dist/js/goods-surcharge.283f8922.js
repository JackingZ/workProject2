(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["goods-surcharge"],{"1e9b":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAABHNCSVQICAgIfAhkiAAAAGRJREFUGJXF0LEJgFAQA9Ccdm7yCxewdBixdBMb4W/iKsmfRfGshN+c2Hld4JHAAcFJGkn2T24DlAGcKaU9KoKkLGkOwSfk7k0pZSM5RaYBADO73P0ws+51sppeJS0/Y5JD/fAbvDw8mbaIFiYAAAAASUVORK5CYII="},"43ea":function(e,t,i){},"4d58":function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","min-height":"inherit"}},[r("app-slide",{directives:[{name:"loading",rawName:"v-loading",value:e.isSideLoading,expression:"isSideLoading"}],attrs:{width:"420","is-active":e.isActive}},[r("div",{staticStyle:{"padding-bottom":"5px","border-bottom":"1px solid #e8e8e8"}},[r("el-row",[r("el-col",{staticStyle:{"line-height":"32px"},attrs:{span:5}},[e._v("\n          商品类别\n        ")]),r("el-col",{staticStyle:{"text-align":"right"},attrs:{span:19}})],1)],1),r("el-tree",{ref:"treeList",staticClass:"filter-tree",attrs:{data:e.treeList,props:e.treeProps,"expand-on-click-node":!1,load:e.loadNode,lazy:"","empty-text":"暂无数据",accordion:"","highlight-current":""},on:{"node-click":e.onTreeClick}})],1),r("div",{staticStyle:{display:"flex","align-items":"center"}},[r("div",{staticClass:"arrow-btn",on:{click:e.toggle}},[r("img",{class:{arrow:!e.isActive},attrs:{src:i("1e9b"),alt:""}})])]),r("div",{staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto"}},[r("div",{staticClass:"app-container"},[r("head-info",{attrs:{title:"商品类别",info:"点击左侧的商品类别目录节点"}}),r("div",{staticClass:"app-panel"},[e.currentNode&&e.currentNode.level<3&&e.$checkPermission(["jhtQuoteAdd"])?r("el-button",{staticStyle:{"margin-right":"20px"},attrs:{size:"small",type:"text"},on:{click:e.addType}},[e._v("\n          新增\n        ")]):e._e(),r("el-input",{staticStyle:{width:"250px"},attrs:{placeholder:"类别名称",clearable:"",size:"small"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.tableData,height:"calc(100vh - 295px)",border:""}},[r("el-table-column",{attrs:{label:"类别名称","min-width":"150",prop:"title","show-overflow-tooltip":""}}),r("el-table-column",{attrs:{label:"备注","min-width":"200",prop:"remarks","show-overflow-tooltip":""}}),1===e.searchForm.type?r("el-table-column",{attrs:{label:"是否全检产品",width:"150",prop:"checked"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.checked?r("span",[e._v("否")]):0===t.row.checked?r("span",[e._v("是")]):e._e()]}}],null,!1,178823563)}):e._e(),r("el-table-column",{attrs:{label:"设置附加费",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.currentNode&&2===e.currentNode.level?r("el-button",{attrs:{disabled:!e.$checkPermission(["jhtQuoteSetCost"]),type:"text",size:"medium"},on:{click:function(i){return e.setCost(t.row)}}},[e._v("\n                设置附加费\n              ")]):r("span",[e._v("--")])]}}])}),r("el-table-column",{attrs:{label:"操作",width:"120",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["jhtQuoteUpdate"],expression:"['jhtQuoteUpdate']"}],attrs:{type:"text",size:"medium"},on:{click:function(i){return e.editRow(t.row)}}},[e._v("\n                编辑\n              ")]),r("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["jhtQuoteDel"],expression:"['jhtQuoteDel']"}],attrs:{type:"text",size:"medium"},on:{click:function(i){return e.deteleRow(t.row)}}},[e._v("\n                删除\n              ")])]}}])})],1),r("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":e.page,"page-size":e.size,layout:"total, prev, pager, next",total:e.total},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"current-change":e.handleCurrentChange}})],1)],1)]),r("el-dialog",{attrs:{title:e.isEdit?"编辑商品类别":"新增商品类别",visible:e.isDialogFormShow,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.isDialogFormShow=t},closed:e.cancel}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}]},[r("el-form",{ref:"editForm",staticStyle:{"padding-right":"20px"},attrs:{model:e.form,rules:e.formRules,"label-width":"120px","label-position":"right",size:"small"}},[r("el-form-item",{attrs:{prop:"title",label:"类别名称"}},[r("el-input",{staticStyle:{width:"100%"},attrs:{autocomplete:"off",maxlength:50},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),1===e.searchForm.type?r("el-form-item",{attrs:{label:"是否全检产品",prop:"checked"}},[r("el-radio-group",{model:{value:e.form.checked,callback:function(t){e.$set(e.form,"checked",t)},expression:"form.checked"}},[r("el-radio",{attrs:{label:1}},[e._v("\n              否\n            ")]),r("el-radio",{attrs:{label:0}},[e._v("\n              是\n            ")])],1)],1):e._e(),r("el-form-item",{attrs:{label:"备注"}},[r("el-input",{staticStyle:{width:"100%"},attrs:{maxlength:200,autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"请输入"},model:{value:e.form.remarks,callback:function(t){e.$set(e.form,"remarks",t)},expression:"form.remarks"}})],1)],1),r("div",{staticStyle:{"text-align":"right","padding-top":"10px"},attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("\n          取 消\n        ")]),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.saveCustoms}},[e._v("\n          确 定\n        ")])],1)],1)]),r("el-dialog",{attrs:{title:"设置附加费",visible:e.isSetVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.isSetVisible=t},close:e.close}},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],staticStyle:{"padding-right":"30px"}},[r("el-form",{ref:"costForm",attrs:{model:e.selectForm,"label-width":"90px","label-position":"right",size:"small"}},[r("el-form-item",{attrs:{label:"计费单位",prop:"billingUnit"}},[r("el-radio-group",{attrs:{disabled:"0"!==e.custType},on:{change:e.onBillUnit},model:{value:e.selectForm.billingUnit,callback:function(t){e.$set(e.selectForm,"billingUnit",t)},expression:"selectForm.billingUnit"}},[r("el-radio",{attrs:{label:1}},[e._v("\n              按重量\n            ")]),r("el-radio",{attrs:{label:2}},[e._v("\n              按个数\n            ")]),r("el-radio",{attrs:{label:3}},[e._v("\n              按金额\n            ")]),r("el-radio",{attrs:{label:4}},[e._v("\n              单询\n            ")])],1)],1),4!==e.selectForm.billingUnit?r("el-form-item",{attrs:{label:"附加费(￥)",prop:"sections"}},e._l(e.selectForm.sections,function(t,i){return r("div",{key:i,staticClass:"item-after-icon"},[r("el-select",{staticStyle:{width:"200px"},attrs:{disabled:"0"!==e.custType,placeholder:"国家",size:"small",filterable:""},model:{value:e.selectForm.sections[i].countryId,callback:function(t){e.$set(e.selectForm.sections[i],"countryId",t)},expression:"selectForm.sections[index].countryId"}},e._l(e.countryList,function(e,t){return r("el-option",{key:t,attrs:{label:e.name+"-"+e.alias,value:e.id}})}),1),r("el-input-number",{staticClass:"input-number-valiate",attrs:{controls:!1,placeholder:"单价",min:0,max:999999,precision:2},model:{value:e.selectForm.sections[i].price,callback:function(t){e.$set(e.selectForm.sections[i],"price",t)},expression:"selectForm.sections[index].price"}}),"0"===e.custType?r("span",[r("i",0===i?{staticClass:"el-icon-circle-plus-outline item-icon-plus",on:{click:e.addRangeData}}:{staticClass:"el-icon-remove-outline item-icon-reduce",on:{click:function(t){return e.deleteRangeData(i)}}})]):e._e()],1)}),0):e._e()],1),r("div",{staticStyle:{"padding-top":"10px","text-align":"right"}},[r("el-button",{attrs:{size:"small"},on:{click:e.close}},[e._v("\n          取 消\n        ")]),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.saveCost}},[e._v("\n          确 定\n        ")])],1)],1)])],1)},n=[],a=(i("8e6e"),i("ac6a"),i("456d"),i("386d"),i("7514"),i("96cf"),i("3b8d")),o=(i("7f7f"),i("bd86")),s=(i("6b54"),i("d225")),c=i("b0b4"),l=i("308d"),u=i("6bb5"),d=i("4e2b"),m=i("9ab4"),p=i("60a3"),h=i("9dba"),f=i("b32d");function v(e){var t={url:"/setting/product/get_all_data",method:"post",data:e};return Object(f["a"])(t)}function g(e){var t={url:"/setting/product/save",method:"post",data:e};return Object(f["a"])(t)}function y(e){var t={url:"/setting/product/get_price",method:"get",params:e};return Object(f["a"])(t)}function b(e){var t={url:"/setting/product/save_price",method:"post",data:e};return Object(f["a"])(t)}function k(){var e={url:"/setting/area/getCountryList",method:"get"};return Object(f["a"])(e)}function w(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function x(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?w(i,!0).forEach(function(t){Object(o["a"])(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):w(i).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}var F=function(e){function t(){var e;return Object(s["a"])(this,t),e=Object(l["a"])(this,Object(u["a"])(t).apply(this,arguments)),e.isEdit=!1,e.isDialogFormShow=!1,e.isActive=!0,e.isSideLoading=!1,e.loading=!1,e.dialogLoading=!1,e.formLoading=!1,e.isSetVisible=!1,e.list=[],e.countryList=[],e.treeList=[],e.size=10,e.page=1,e.search="",e.treeProps={label:"title",children:"children",isLeaf:"leaf"},e.searchForm={type:2,countryId:void 0,countryName:void 0},e.selectForm={billingUnit:1,sections:[]},e.currentNode={},e.form={checked:void 0,title:void 0,remarks:void 0,countryId:void 0,countryName:void 0,createTime:void 0,createUser:void 0,id:void 0,parentId:void 0,titleAlias:void 0,type:void 0},e.formRules={title:{required:!0,message:"类别名称不能为空",trigger:"blur"},checked:{required:!0,message:"请选择是否全检产品",trigger:"change"}},e}return Object(d["a"])(t,e),Object(c["a"])(t,[{key:"mounted",value:function(){this.treeList=[{id:0,title:"目录表"}]}},{key:"toggle",value:function(){this.isActive=!this.isActive}},{key:"handleCurrentChange",value:function(e){this.page=e}},{key:"loadNode",value:function(e,t){var i=this;this.currentNode=e;var r=e.data||{},n=e.level.toString();if("0"!==n){var a=this.searchForm,o=a.countryId,s=a.countryName,c=a.type;if(1===c&&(!o||!s))return this.$message.error("请先选择国家"),void t([]);this.loading=!0,v({parentId:r.id,countryId:o,countryName:s,type:c}).then(function(e){var r=e.data||[],a=r.map(function(e){return"2"===n&&(e.leaf=!0),e});i.list=a,i.loading=!1,t(a)}).catch(function(e){return i.loading=!1,e})}}},{key:"refreshNode",value:function(e){e.loaded=!1,e.expand(e)}},{key:"onTreeClick",value:function(e,t,i){t.isLeaf||(this.search="",this.refreshNode(i.node))}},{key:"deteleRow",value:function(e){var t=this;this.$confirm("请确认是否删除该条数据?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){var i={id:e.id,deleted:1};g(i).then(function(e){t.$message({type:"success",message:"删除成功"}),t.refreshNode(t.currentNode)}).catch(function(e){return e})}).catch(function(){return!1})}},{key:"addType",value:function(){var e=this.searchForm,t=e.countryId,i=e.countryName,r=e.type;if(1!==r||t&&i){var n=this.currentNode.data;Array.isArray(n)&&(this.currentNode.data=n[0]),this.isDialogFormShow=!0,this.isEdit=!1}else this.$message.error("请先选择国家")}},{key:"editRow",value:function(e){this.isDialogFormShow=!0,this.isEdit=!0,this.form=x({},e)}},{key:"cancel",value:function(){this.isDialogFormShow=!1,this.reset()}},{key:"reset",value:function(){this.form={checked:void 0,title:void 0,remarks:void 0},this.clearValidate()}},{key:"clearValidate",value:function(){var e=this;this.$nextTick(function(){var t=e.$refs.editForm;t.clearValidate()})}},{key:"saveCustoms",value:function(){var e=this;this.$refs.editForm.validate(function(t){if(!t)return!1;e.dialogLoading=!0;var i=x({},e.form,{},e.searchForm),r=e.currentNode.data;e.isEdit||(i.parentId=r.id,i.createUser=e.userId),g(i).then(function(t){e.dialogLoading=!1,e.cancel(),e.$message({type:"success",message:"保存成功"}),e.refreshNode(e.currentNode)}).catch(function(t){return e.dialogLoading=!1,t})})}},{key:"onType",value:function(){this.treeList=[{id:0,title:"目录表"}],this.list=[],1===this.searchForm.type?(this.searchForm.countryId=this.countryList[0].id,this.searchForm.countryName=this.countryList[0].name):(this.searchForm.countryId=void 0,this.searchForm.countryName=void 0)}},{key:"onCountry",value:function(){var e=this;this.searchForm.countryName="",this.countryList.map(function(t){e.searchForm.countryId===t.id&&(e.searchForm.countryName=t.name)}),this.treeList=[{id:0,title:"目录表"}],this.list=[]}},{key:"getCountryList",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,i,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k();case 3:t=e.sent,i=t.data||{},r=i.result||[],this.countryList=r.map(function(e){var t=e.name,i=e.alias;return x({},e,{label:t+"-"+i})}),e.next=13;break;case 9:return e.prev=9,e.t0=e["catch"](0),this.formLoading=!1,e.abrupt("return",e.t0);case 13:case"end":return e.stop()}},e,this,[[0,9]])}));function t(){return e.apply(this,arguments)}return t}()},{key:"getCostList",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var i,r,n=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y({categoryId:t});case 3:i=e.sent,r=i.data||[],r.length>0?(this.selectForm.sections=[],r.map(function(e){var t=e.categoryId,i=e.countryId,r=e.countryName,a=e.price,o=e.unitId,s=e.unitName,c=e.id;n.selectForm.sections.push({categoryId:t,countryId:i,countryName:r,price:a,unitId:o,unitName:s,id:c})})):this.selectForm.sections=[{countryId:void 0,price:void 0}],e.next=12;break;case 8:return e.prev=8,e.t0=e["catch"](0),this.formLoading=!1,e.abrupt("return",e.t0);case 12:case"end":return e.stop()}},e,this,[[0,8]])}));function t(t){return e.apply(this,arguments)}return t}()},{key:"setCost",value:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var i,r,n,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.selectForm.billingUnit=t.billingUnit||1,e.next=3,y({categoryId:t.id});case 3:if(i=e.sent,r=i.data||[],n=this.custType,!(r.length>0)){e.next=11;break}this.selectForm.sections=[],r.map(function(e){var t=e.categoryId,i=e.countryId,r=e.countryName,n=e.price,o=e.unitId,s=e.unitName,c=e.id;a.selectForm.sections.push({categoryId:t,countryId:i,countryName:r,price:n,unitId:o,unitName:s,id:c})}),e.next=17;break;case 11:if("0"!==n){e.next=15;break}this.selectForm.sections=[{countryId:void 0,price:void 0}],e.next=17;break;case 15:return this.$message.error("暂无上级配置，无法添加"),e.abrupt("return");case 17:return this.isSetVisible=!0,this.formLoading=!0,this.selectForm.id=t.id,e.next=22,this.getCountryList();case 22:this.formLoading=!1;case 23:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"addRangeData",value:function(){this.selectForm.sections.push({countryId:void 0,price:void 0})}},{key:"deleteRangeData",value:function(e){this.selectForm.sections.splice(e,1)}},{key:"close",value:function(){var e=this;this.isSetVisible=!1,this.selectForm={billingUnit:1,sections:[{countryId:void 0,price:void 0}]},this.$nextTick(function(){var t=e.$refs.costForm;t.clearValidate()})}},{key:"onBillUnit",value:function(){4===this.selectForm.billingUnit&&(this.selectForm.sections=[{countryId:void 0,price:void 0}])}},{key:"saveCost",value:function(){var e=this,t=this.$refs.costForm;t.validate(function(t){if(!t)return!1;var i=e.selectForm,r=i.sections,n=i.id,a=i.billingUnit,o=Array.isArray(r)&&r.every(function(e){return e.countryId&&e.price});if(o||4===a){var s=r.reduce(function(e,t){return e.find(function(e){return e.countryId===t.countryId})||e.push(t),e},[]);if(s.length<r.length)e.$message.error("国家不能重复");else{var c=r.map(function(t){var i=e.countryList.find(function(e){return e.id===t.countryId})||{};return x({},t,{countryName:i.name,categoryId:n,unitId:"RMB",unitName:"人民币"})});e.formLoading=!0;var l={id:n,billingUnit:a,list:c},u=e.currentNode.data;e.isEdit||(l.parentId=u.id,l.createUser=e.userId),b(l).then(function(t){e.formLoading=!1,e.$message({type:"success",message:"保存成功"}),e.close(),e.refreshNode(e.currentNode)}).catch(function(t){return e.formLoading=!1,t})}}else e.$message.error("请填写完整国家和单价")})}},{key:"custType",get:function(){var e=h["a"].info||{},t=e.custType;return t}},{key:"userId",get:function(){var e=h["a"].info||{},t=e.username;return t}},{key:"tableData",get:function(){var e=this.resultData,t=this.page,i=this.size;return e.slice((t-1)*i,t*i)}},{key:"total",get:function(){var e=this.resultData;return e.length}},{key:"resultData",get:function(){var e=this.search,t=this.list;return e?t.filter(function(t){var i=t||{},r=i.title,n={title:r};return Object.keys(n).some(function(i){return String(t[i]).indexOf(e)>-1})}):t}},{key:"isAddBtnShow",get:function(){var e=this.currentNode;return!!(e&&Object.keys(e).length>0&&1!==e.level)}}]),t}(p["e"]);F=m["a"]([Object(p["a"])({name:"",components:{},props:{}})],F);var A=F,N=A,I=(i("80f5"),i("2877")),S=Object(I["a"])(N,r,n,!1,null,"3d3809a8",null);t["default"]=S.exports},"80f5":function(e,t,i){"use strict";var r=i("43ea"),n=i.n(r);n.a}}]);