(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pda-config"],{"16d8":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:e.id}})},n=[],o=(a("8e6e"),a("ac6a"),a("456d"),a("bd86")),r=a("d225"),s=a("b0b4"),l=a("308d"),c=a("6bb5"),u=a("4e2b"),d=a("9ab4"),p=(a("a7be"),a("44f8"),a("a6e0"),a("60a3")),h={previewStyle:"vertical",usageStatistics:!1,toolbarItems:["heading","bold","italic","strike","divider","hr","quote","divider","ul","ol","task","indent","outdent","divider","table","image","link","divider","code","codeblock"]},f=a("547e"),m=a.n(f);function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(a,!0).forEach(function(t){Object(o["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var b=function(){return"markdown-editor-"+ +new Date+(1e3*Math.random()).toFixed(0)},y=function(e){function t(){return Object(r["a"])(this,t),Object(l["a"])(this,Object(c["a"])(t).apply(this,arguments))}return Object(u["a"])(t,e),Object(s["a"])(t,[{key:"onValueChange",value:function(e,t){this.markdownEditor&&e!==t&&e!==this.markdownEditor.getValue()&&this.markdownEditor.setValue(e)}},{key:"onLanguageChange",value:function(){this.destroyEditor(),this.initEditor()}},{key:"onHeightChange",value:function(e){this.markdownEditor&&this.markdownEditor.height(e)}},{key:"onModeChange",value:function(e){this.markdownEditor&&this.markdownEditor.changeMode(e)}},{key:"mounted",value:function(){this.initEditor()}},{key:"destroyed",value:function(){this.destroyEditor()}},{key:"initEditor",value:function(){var e=this,t=document.getElementById(this.id);t&&(this.markdownEditor=new m.a(g({el:t},this.editorOptions)),this.value&&this.markdownEditor.setValue(this.value),this.markdownEditor.on("change",function(){e.$emit("input",e.markdownEditor.getValue())}))}},{key:"destroyEditor",value:function(){this.markdownEditor&&(this.markdownEditor.off("change"),this.markdownEditor.remove(),this.markdownEditor=void 0)}},{key:"focus",value:function(){this.markdownEditor&&this.markdownEditor.focus()}},{key:"setValue",value:function(e){this.markdownEditor&&this.markdownEditor.setValue(e)}},{key:"getValue",value:function(){return this.markdownEditor?this.markdownEditor.getValue():""}},{key:"setHtml",value:function(e){this.markdownEditor&&this.markdownEditor.setHtml(e)}},{key:"getHtml",value:function(){return this.markdownEditor?this.markdownEditor.getHtml():""}},{key:"editorOptions",get:function(){var e=Object.assign({},h,this.options);return e.initialEditType=this.mode,e.height=this.height,e.language=this.language,e}}]),t}(p["e"]);d["a"]([Object(p["c"])({required:!0})],y.prototype,"value",void 0),d["a"]([Object(p["c"])({default:b})],y.prototype,"id",void 0),d["a"]([Object(p["c"])({default:function(){return h}})],y.prototype,"options",void 0),d["a"]([Object(p["c"])({default:"markdown"})],y.prototype,"mode",void 0),d["a"]([Object(p["c"])({default:"300px"})],y.prototype,"height",void 0),d["a"]([Object(p["c"])({default:"en_US"})],y.prototype,"language",void 0),d["a"]([Object(p["f"])("value")],y.prototype,"onValueChange",null),d["a"]([Object(p["f"])("language")],y.prototype,"onLanguageChange",null),d["a"]([Object(p["f"])("height")],y.prototype,"onHeightChange",null),d["a"]([Object(p["f"])("mode")],y.prototype,"onModeChange",null),y=d["a"]([Object(p["a"])({name:"MarkdownEditor"})],y);var k=y,w=k,O=a("2877"),j=Object(O["a"])(w,i,n,!1,null,null,null);t["a"]=j.exports},50516:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{display:"flex","flex-flow":"row nowrap","min-height":"inherit"}},[a("div",{staticClass:"dashboard-container",staticStyle:{flex:"1",overflow:"auto",height:"calc(100vh - 114px)"}},[a("div",{staticClass:"app-container"},[a("head-info",{attrs:{info:"",title:"PDA版本管理"}}),a("div",{staticClass:"app-panel"},[a("el-row",[a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:24}},[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["addStock"],expression:"['addStock']"}],staticStyle:{float:"left"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:e.addPDA}},[e._v("\n              新增版本\n            ")]),a("el-date-picker",{staticStyle:{width:"240px","margin-right":"10px"},attrs:{clearable:!1,"unlink-panels":"",type:"daterange",align:"right",size:"small","value-format":"yyyy-MM-dd","start-placeholder":"起期","end-placeholder":"止期"},model:{value:e.createTime,callback:function(t){e.createTime=t},expression:"createTime"}}),a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["queryStock"],expression:"['queryStock']"}],attrs:{type:"primary",size:"small"},on:{click:function(t){return e.queryAll(1)}}},[e._v("\n              查询\n            ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%",margin:"10px 0"},attrs:{data:e.tableData,height:"calc(100vh - 330px)",border:""}},[a("el-table-column",{attrs:{prop:"versions",label:"版本号"}}),a("el-table-column",{attrs:{prop:"createTime",label:"发布时间",width:"160"}}),a("el-table-column",{attrs:{label:"下载apk",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{disabled:!e.$checkPermission(["PDALoadAPK"]),type:"text"},on:{click:function(a){return e.loadAPK(t.row)}}},[e._v("\n                下载apk\n              ")]),a("el-button",{directives:[{name:"copy",rawName:"v-copy",value:t.row.apkUrl,expression:"scope.row.apkUrl"}],attrs:{type:"text"}},[e._v("\n                复制下载链接\n              ")])]}}])}),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{staticClass:"switchStyle",attrs:{value:t.row.status,disabled:!e.$checkPermission(["stockChangeStatus"]),"active-text":"上线","inactive-text":"下线","active-value":1,"inactive-value":0},on:{change:function(a){return e.onStatus(t.row,a)}}})]}}])}),a("el-table-column",{attrs:{prop:"uploaded",label:"是否强制更新",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{directives:[{name:"show",rawName:"v-show",value:1===t.row.uploaded,expression:"scope.row.uploaded === 1"}]},[e._v("强制更新")]),a("span",{directives:[{name:"show",rawName:"v-show",value:0===t.row.uploaded,expression:"scope.row.uploaded === 0"}]},[e._v("不强制更新")])]}}])}),a("el-table-column",{attrs:{fixed:"right",width:"150",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["deleteStock"],expression:"['deleteStock']"}],attrs:{type:"text"},on:{click:function(a){return e.deletePDA(t.row)}}},[e._v("\n                删除\n              ")]),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.updateLog(t.row)}}},[e._v("\n                更新日志\n              ")])]}}])})],1),a("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":e.page,"page-size":e.size,layout:"total, prev, pager, next",total:e.total},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),a("el-dialog",{attrs:{title:e.isEdit?"编辑版本":"新增版本",visible:e.isAddEditVisible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.isAddEditVisible=t},close:e.cancel}},[a("div",{staticStyle:{"padding-right":"20px"}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],ref:"editForm",attrs:{model:e.selectForm,rules:e.formRules,"label-width":"120px","label-position":"right",size:"small"}},[a("el-form-item",{attrs:{label:"版本号",prop:"versions"}},[a("el-input",{ref:"firstInput",attrs:{maxlength:20,placeholder:"请输入"},model:{value:e.selectForm.versions,callback:function(t){e.$set(e.selectForm,"versions",t)},expression:"selectForm.versions"}})],1),a("el-form-item",{attrs:{label:"更新日志",prop:"content"}},[a("markdown-editor",{ref:"markdownEditor",attrs:{options:{hideModeSwitch:!0,previewStyle:"tab",toolbarItems:["heading","bold","italic"]},height:"200px"},model:{value:e.selectForm.content,callback:function(t){e.$set(e.selectForm,"content",t)},expression:"selectForm.content"}})],1),a("el-form-item",{attrs:{label:"上传apk",prop:"path"}},[a("el-upload",{ref:"uploadFile",attrs:{action:"",multiple:"",limit:1,"http-request":e.uploadFile,"on-remove":e.onFileRemove,"before-upload":e.beforeUpload,"file-list":e.fileList}},[a("el-button",{attrs:{size:"small"}},[a("i",{staticClass:"el-icon-upload"}),e._v("\n                    选择文件\n                  ")])],1)],1),a("el-form-item",{attrs:{label:"是否强制更新",prop:"uploaded"}},[a("el-radio-group",{model:{value:e.selectForm.uploaded,callback:function(t){e.$set(e.selectForm,"uploaded",t)},expression:"selectForm.uploaded"}},[a("el-radio",{attrs:{label:0}},[e._v("\n                    否\n                  ")]),a("el-radio",{attrs:{label:1}},[e._v("\n                    是\n                  ")])],1)],1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("\n              取 消\n            ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v("\n              确 定\n            ")])],1)]),a("el-dialog",{attrs:{title:e.logRow.versions+"更新日志",visible:e.visible,"close-on-click-modal":!1,width:"600px"},on:{"update:visible":function(t){e.visible=t},close:function(t){e.visible=!1}}},[a("div",{domProps:{innerHTML:e._s(e.logRow.logs)}})])],1)],1)])])},n=[],o=(a("8e6e"),a("ac6a"),a("456d"),a("c5f6"),a("bd86")),r=(a("28a5"),a("7f7f"),a("768b")),s=(a("96cf"),a("3b8d")),l=a("d225"),c=a("b0b4"),u=a("308d"),d=a("6bb5"),p=a("4e2b"),h=a("9ab4"),f=a("60a3"),m=a("b32d");function v(e){var t={url:"/wms/apk/page",method:"post",data:e};return Object(m["a"])(t)}function g(e){var t={url:"/wms/apk/switch",method:"get",params:e};return Object(m["a"])(t)}function b(e){var t={url:"/wms/apk/save",method:"post",data:e};return Object(m["a"])(t)}function y(e){var t={url:"/wms/apk/del",method:"get",params:e};return Object(m["a"])(t)}function k(e){var t={url:"/wms/aliyun/oss/upload",method:"post",data:e};return Object(m["a"])(t)}function w(e){var t={url:"/wms/aliyun/oss/del",method:"post",data:e};return Object(m["a"])(t)}var O=a("16d8"),j=a("5a0c"),x=a.n(j);function E(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,i)}return a}function S(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?E(a,!0).forEach(function(t){Object(o["a"])(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):E(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var P=function(e){function t(){var e;return Object(l["a"])(this,t),e=Object(u["a"])(this,Object(d["a"])(t).apply(this,arguments)),e.loading=!1,e.isAddEditVisible=!1,e.visible=!1,e.isEdit=!1,e.tableData=[],e.logRow={},e.selectForm={versions:void 0,path:void 0,content:void 0,logs:void 0,uploaded:void 0},e.createTime=[],e.formLoading=!1,e.page=1,e.size=10,e.total=0,e.fileList=[],e.formRules={versions:[{required:!0,message:"版本号不能为空",trigger:"blur"}],content:[{required:!0,message:"更新日志不能为空",trigger:"blur"}],path:[{required:!0,message:"上传apk不能为空",trigger:"blur"}],uploaded:[{required:!0,message:"请选择是否强制更新",trigger:"change"}]},e}return Object(p["a"])(t,e),Object(c["a"])(t,[{key:"loadAPK",value:function(e){e.path&&window.open("https://file.jhtinfo.net/"+e.path)}},{key:"updateLog",value:function(e){this.logRow=e,this.visible=!0}},{key:"onStatus",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark(function e(t,a){var i,n,o,s,l,c=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t.status!==a){e.next=2;break}return e.abrupt("return");case 2:if(1!==a){e.next=7;break}if(i=this.tableData.some(function(e){return 1===e.status}),!i){e.next=7;break}return this.$message.warning("只允许存在一个线上版本"),e.abrupt("return");case 7:return n=0===a?"禁用":"开启",e.next=10,this.$confirm("此操作将".concat(n,"该版本服务，是否继续？"),"提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(e){return[null,e]}).catch(function(e){return[e,null]});case 10:if(o=e.sent,s=Object(r["a"])(o,2),l=s[0],s[1],!l){e.next=16;break}return e.abrupt("return");case 16:g({id:t.id}).then(function(e){c.$message.success("修改成功"),c.queryAll()}).catch(function(e){return e});case 17:case"end":return e.stop()}},e,this)}));function t(t,a){return e.apply(this,arguments)}return t}()},{key:"beforeUpload",value:function(e){var t=e.name;if(-1===t.indexOf(".apk"))return this.fileList=[],this.selectForm.path="",this.$message.error("仅支持apk文件"),!1}},{key:"uploadFile",value:function(e){var t=this,a=new FormData,i=e.file.name.split("."),n=new File([e.file],"聚货通仓储"+(new Date).getTime()+"."+i[i.length-1],{type:e.file.type});a.append("file",n),this.formLoading=!0,k(a).then(function(e){t.formLoading=!1;var a=e.data||{};t.selectForm.path=a.objectName,t.$message.success("文件上传成功")}).catch(function(){t.formLoading=!1,t.selectForm.path=""})}},{key:"onFileRemove",value:function(){var e=this,t={ifPublic:!0,fileList:[this.selectForm.path]};this.formLoading=!0,w(t).then(function(){e.formLoading=!1,e.selectForm.path="",e.$message.success("文件删除成功")}).catch(function(){e.formLoading=!1,e.$message.success("文件删除失败")})}},{key:"addPDA",value:function(){var e=this;this.isEdit=!1,this.isAddEditVisible=!0,this.$nextTick(function(){var t=e.$refs.firstInput;t.focus()})}},{key:"deletePDA",value:function(e){var t=this,a={id:e.id};1!==e.status?this.$confirm("请确认是否删除该条数据?","温馨提示",{confirmButtonText:"确定",closeOnClickModal:!1,cancelButtonText:"取消",type:"warning"}).then(function(){y(a).then(function(e){t.$message({type:"success",message:"删除成功"}),t.queryAll()}).catch(function(e){return e})}).catch(function(){return!1}):this.$message.warning("线上版本不允许删除")}},{key:"cancel",value:function(){var e=this;this.isAddEditVisible=!1,this.selectForm={versions:void 0,ptah:void 0,content:void 0,logs:void 0,path:void 0,uploaded:void 0},this.fileList=[],this.$nextTick(function(){var t=e.$refs.editForm;t.clearValidate()})}},{key:"confirm",value:function(){var e=this,t=this.$refs.editForm;t.validate(function(t){if(!t)return!1;e.formLoading=!0;var a=S({},e.selectForm),i=e.$refs.markdownEditor.getHtml();a.logs=i,b(a).then(function(t){e.formLoading=!1,e.$message({type:"success",message:"操作成功"}),e.isAddEditVisible=!1,e.cancel(),e.queryAll()}).catch(function(t){return e.formLoading=!1,t})})}},{key:"queryAll",value:function(e){var t=this;this.loading=!0,e&&(this.page=e);var a={model:{start:this.createTime[0]+" 00:00:00",end:this.createTime[1]+" 23:59:59"},page:this.page,size:this.size};v(a).then(function(e){t.loading=!1;var a=e.data||{};t.tableData=(a.result||[]).map(function(e){return e.apkUrl="https://file.jhtinfo.net/"+e.path,e}),t.total=a.total}).catch(function(e){return t.loading=!1,e})}},{key:"handleSizeChange",value:function(e){this.size=Number(e),this.queryAll()}},{key:"handleCurrentChange",value:function(e){this.page=Number(e),this.queryAll()}},{key:"created",value:function(){this.createTime=[x()().subtract(30,"d").format("YYYY-MM-DD"),x()().format("YYYY-MM-DD")],this.queryAll()}}]),t}(f["e"]);P=h["a"]([Object(f["a"])({name:"",components:{MarkdownEditor:O["a"]},props:{}})],P);var F=P,D=F,$=a("2877"),A=Object($["a"])(D,i,n,!1,null,"003aef56",null);t["default"]=A.exports}}]);